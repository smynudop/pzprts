var rr=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Oh=rr((Rh,sr)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var or=Object.defineProperty,Ji=i=>{throw TypeError(i)},lr=(i,t,e)=>t in i?or(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,st=(i,t,e)=>lr(i,typeof t!="symbol"?t+"":t,e),Zi=(i,t,e)=>t.has(i)||Ji("Cannot "+e),Q=(i,t,e)=>(Zi(i,t,"read from private field"),t.get(i)),fi=(i,t,e)=>t.has(i)?Ji("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),pi=(i,t,e,s)=>(Zi(i,t,"write to private field"),t.set(i,e),e),Us=Array.isArray,hr=Array.prototype.indexOf,Fs=Array.from,Ke=Object.keys,Ve=Object.defineProperty,Pt=Object.getOwnPropertyDescriptor,ar=Object.getOwnPropertyDescriptors,cr=Object.prototype,ur=Array.prototype,tn=Object.getPrototypeOf,mi=Object.isExtensible;function dr(i){return i()}function Xe(i){for(var t=0;t<i.length;t++)i[t]()}const Y=2,en=4,as=8,Hs=16,wt=32,Mt=64,Ye=128,U=256,Je=512,$=1024,vt=2048,Ut=4096,kt=8192,cs=16384,br=32768,Ws=65536,fr=1<<17,pr=1<<19,sn=1<<20,Ls=1<<21,It=Symbol("$state"),nn=Symbol("legacy props");function rn(i){return i===this.v}function mr(i,t){return i!=i?t==t:i!==t||i!==null&&typeof i=="object"||typeof i=="function"}function Ks(i){return!mr(i,this.v)}function gr(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function yr(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function kr(i){throw new Error("https://svelte.dev/e/effect_orphan")}function vr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xr(){throw new Error("https://svelte.dev/e/hydration_failed")}function wr(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Cr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function qr(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let le=!1;function zr(){le=!0}const Nr=1,Sr=2,_r=16,Ar=2,Lr=8,jr=2,Vs="[",Xs="[!",Ys="]",ye={},P=Symbol();function Tr(i){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let L=null;function gi(i){L=i}function on(i,t=!1,e){var s=L={p:L,c:null,d:!1,e:null,m:!1,s:i,x:null,l:null};le&&!t&&(L.l={s:null,u:null,r1:[],r2:ze(!1)}),yn(()=>{s.d=!0})}function ln(i){const t=L;if(t!==null){i!==void 0&&(t.x=i);const o=t.e;if(o!==null){var e=C,s=q;t.e=null;try{for(var n=0;n<o.length;n++){var r=o[n];Bt(r.effect),lt(r.reaction),ti(r.fn)}}finally{Bt(e),lt(s)}}L=t.p,t.m=!0}return i||{}}function us(){return!le||L!==null&&L.l===null}function Et(i){if(typeof i!="object"||i===null||It in i)return i;const t=tn(i);if(t!==cr&&t!==ur)return i;var e=new Map,s=Us(i),n=qt(0),r=q,o=l=>{var h=q;lt(r);var a=l();return lt(h),a};return s&&e.set("length",qt(i.length)),new Proxy(i,{defineProperty(l,h,a){(!("value"in a)||a.configurable===!1||a.enumerable===!1||a.writable===!1)&&wr();var c=e.get(h);return c===void 0?(c=o(()=>qt(a.value)),e.set(h,c)):B(c,o(()=>Et(a.value))),!0},deleteProperty(l,h){var a=e.get(h);if(a===void 0)h in l&&(e.set(h,o(()=>qt(P))),ks(n));else{if(s&&typeof h=="string"){var c=e.get("length"),u=Number(h);Number.isInteger(u)&&u<c.v&&B(c,u)}B(a,P),ks(n)}return!0},get(l,h,a){var c;if(h===It)return i;var u=e.get(h),d=h in l;if(u===void 0&&(!d||(c=Pt(l,h))!=null&&c.writable)&&(u=o(()=>qt(Et(d?l[h]:P))),e.set(h,u)),u!==void 0){var f=x(u);return f===P?void 0:f}return Reflect.get(l,h,a)},getOwnPropertyDescriptor(l,h){var a=Reflect.getOwnPropertyDescriptor(l,h);if(a&&"value"in a){var c=e.get(h);c&&(a.value=x(c))}else if(a===void 0){var u=e.get(h),d=u==null?void 0:u.v;if(u!==void 0&&d!==P)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return a},has(l,h){var a;if(h===It)return!0;var c=e.get(h),u=c!==void 0&&c.v!==P||Reflect.has(l,h);if(c!==void 0||C!==null&&(!u||(a=Pt(l,h))!=null&&a.writable)){c===void 0&&(c=o(()=>qt(u?Et(l[h]):P)),e.set(h,c));var d=x(c);if(d===P)return!1}return u},set(l,h,a,c){var u,d=e.get(h),f=h in l;if(s&&h==="length")for(var p=a;p<d.v;p+=1){var k=e.get(p+"");k!==void 0?B(k,P):p in l&&(k=o(()=>qt(P)),e.set(p+"",k))}d===void 0?(!f||(u=Pt(l,h))!=null&&u.writable)&&(d=o(()=>qt(void 0)),B(d,o(()=>Et(a))),e.set(h,d)):(f=d.v!==P,B(d,o(()=>Et(a))));var g=Reflect.getOwnPropertyDescriptor(l,h);if(g!=null&&g.set&&g.set.call(c,a),!f){if(s&&typeof h=="string"){var m=e.get("length"),y=Number(h);Number.isInteger(y)&&y>=m.v&&B(m,y+1)}ks(n)}return!0},ownKeys(l){x(n);var h=Reflect.ownKeys(l).filter(u=>{var d=e.get(u);return d===void 0||d.v!==P});for(var[a,c]of e)c.v!==P&&!(a in l)&&h.push(a);return h},setPrototypeOf(){Cr()}})}function ks(i,t=1){B(i,i.v+t)}function ds(i){var t=Y|vt,e=q!==null&&(q.f&Y)!==0?q:null;return C===null||e!==null&&(e.f&U)!==0?t|=U:C.f|=sn,{ctx:L,deps:null,effects:null,equals:rn,f:t,fn:i,reactions:null,rv:0,v:null,wv:0,parent:e??C}}function Js(i){const t=ds(i);return t.equals=Ks,t}function hn(i){var t=i.effects;if(t!==null){i.effects=null;for(var e=0;e<t.length;e+=1)xt(t[e])}}function Br(i){for(var t=i.parent;t!==null;){if((t.f&Y)===0)return t;t=t.parent}return null}function an(i){var t,e=C;Bt(Br(i));try{hn(i),t=_n(i)}finally{Bt(e)}return t}function cn(i){var t=an(i),e=(Lt||(i.f&U)!==0)&&i.deps!==null?Ut:$;J(i,e),i.equals(t)||(i.v=t,i.wv=Nn())}const qe=new Map;function ze(i,t){var e={f:0,v:i,reactions:null,equals:rn,rv:0,wv:0};return e}function qt(i,t){const e=ze(i);return Qr(e),e}function X(i,t=!1){var e;const s=ze(i);return t||(s.equals=Ks),le&&L!==null&&L.l!==null&&((e=L.l).s??(e.s=[])).push(s),s}function Dr(i,t){return B(i,je(()=>x(i))),t}function B(i,t,e=!1){q!==null&&!it&&us()&&(q.f&(Y|Hs))!==0&&!(W!=null&&W.includes(i))&&qr();let s=e?Et(t):t;return un(i,s)}function un(i,t){if(!i.equals(t)){var e=i.v;Ae?qe.set(i,t):qe.set(i,e),i.v=t,(i.f&Y)!==0&&((i.f&vt)!==0&&an(i),J(i,(i.f&U)===0?$:Ut)),i.wv=Nn(),dn(i,vt),us()&&C!==null&&(C.f&$)!==0&&(C.f&(wt|Mt))===0&&(F===null?Mr([i]):F.push(i))}return t}function dn(i,t){var e=i.reactions;if(e!==null)for(var s=us(),n=e.length,r=0;r<n;r++){var o=e[r],l=o.f;(l&vt)===0&&(!s&&o===C||(J(o,t),(l&($|U))!==0&&((l&Y)!==0?dn(o,Ut):ps(o))))}}function Zs(i){console.warn("https://svelte.dev/e/hydration_mismatch")}let T=!1;function yt(i){T=i}let j;function ot(i){if(i===null)throw Zs(),ye;return j=i}function bs(){return ot(Ft(j))}function zt(i){if(T){if(Ft(j)!==null)throw Zs(),ye;j=i}}function js(){for(var i=0,t=j;;){if(t.nodeType===8){var e=t.data;if(e===Ys){if(i===0)return t;i-=1}else(e===Vs||e===Xs)&&(i+=1)}var s=Ft(t);t.remove(),t=s}}var yi,bn,fn,pn;function Ts(){if(yi===void 0){yi=window,bn=/Firefox/.test(navigator.userAgent);var i=Element.prototype,t=Node.prototype,e=Text.prototype;fn=Pt(t,"firstChild").get,pn=Pt(t,"nextSibling").get,mi(i)&&(i.__click=void 0,i.__className=void 0,i.__attributes=null,i.__style=void 0,i.__e=void 0),mi(e)&&(e.__t=void 0)}}function Ze(i=""){return document.createTextNode(i)}function ts(i){return fn.call(i)}function Ft(i){return pn.call(i)}function Nt(i,t){if(!T)return ts(i);var e=ts(j);if(e===null)e=j.appendChild(Ze());else if(t&&e.nodeType!==3){var s=Ze();return e==null||e.before(s),ot(s),s}return ot(e),e}function at(i,t=1,e=!1){let s=T?j:i;for(var n;t--;)n=s,s=Ft(s);if(!T)return s;var r=s==null?void 0:s.nodeType;if(e&&r!==3){var o=Ze();return s===null?n==null||n.after(o):s.before(o),ot(o),o}return ot(s),s}function mn(i){i.textContent=""}function gn(i){C===null&&q===null&&kr(),q!==null&&(q.f&U)!==0&&C===null&&yr(),Ae&&gr()}function Or(i,t){var e=t.last;e===null?t.last=t.first=i:(e.next=i,i.prev=e,t.last=i)}function Ht(i,t,e,s=!0){var n=C,r={ctx:L,deps:null,nodes_start:null,nodes_end:null,f:i|vt,first:null,fn:t,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(e)try{ri(r),r.f|=br}catch(h){throw xt(r),h}else t!==null&&ps(r);var o=e&&r.deps===null&&r.first===null&&r.nodes_start===null&&r.teardown===null&&(r.f&(sn|Ye))===0;if(!o&&s&&(n!==null&&Or(r,n),q!==null&&(q.f&Y)!==0)){var l=q;(l.effects??(l.effects=[])).push(r)}return r}function yn(i){const t=Ht(as,null,!1);return J(t,$),t.teardown=i,t}function Bs(i){gn();var t=C!==null&&(C.f&wt)!==0&&L!==null&&!L.m;if(t){var e=L;(e.e??(e.e=[])).push({fn:i,effect:C,reaction:q})}else{var s=ti(i);return s}}function Er(i){return gn(),ei(i)}function Rr(i){const t=Ht(Mt,i,!0);return()=>{xt(t)}}function Pr(i){const t=Ht(Mt,i,!0);return(e={})=>new Promise(s=>{e.outro?es(t,()=>{xt(t),s(void 0)}):(xt(t),s(void 0))})}function ti(i){return Ht(en,i,!1)}function ei(i){return Ht(as,i,!0)}function Be(i,t=[],e=ds){const s=t.map(e);return si(()=>i(...s.map(x)))}function si(i,t=0){return Ht(as|Hs|t,i,!0)}function Ne(i,t=!0){return Ht(as|wt,i,!0,t)}function kn(i){var t=i.teardown;if(t!==null){const e=Ae,s=q;vi(!0),lt(null);try{t.call(null)}finally{vi(e),lt(s)}}}function vn(i,t=!1){var e=i.first;for(i.first=i.last=null;e!==null;){var s=e.next;(e.f&Mt)!==0?e.parent=null:xt(e,t),e=s}}function Ir(i){for(var t=i.first;t!==null;){var e=t.next;(t.f&wt)===0&&xt(t),t=e}}function xt(i,t=!0){var e=!1;(t||(i.f&pr)!==0)&&i.nodes_start!==null&&($r(i.nodes_start,i.nodes_end),e=!0),vn(i,t&&!e),os(i,0),J(i,cs);var s=i.transitions;if(s!==null)for(const r of s)r.stop();kn(i);var n=i.parent;n!==null&&n.first!==null&&xn(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function $r(i,t){for(;i!==null;){var e=i===t?null:Ft(i);i.remove(),i=e}}function xn(i){var t=i.parent,e=i.prev,s=i.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),t!==null&&(t.first===i&&(t.first=s),t.last===i&&(t.last=e))}function es(i,t){var e=[];ii(i,e,!0),wn(e,()=>{xt(i),t&&t()})}function wn(i,t){var e=i.length;if(e>0){var s=()=>--e||t();for(var n of i)n.out(s)}else t()}function ii(i,t,e){if((i.f&kt)===0){if(i.f^=kt,i.transitions!==null)for(const o of i.transitions)(o.is_global||e)&&t.push(o);for(var s=i.first;s!==null;){var n=s.next,r=(s.f&Ws)!==0||(s.f&wt)!==0;ii(s,t,r?e:!1),s=n}}}function ss(i){Cn(i,!0)}function Cn(i,t){if((i.f&kt)!==0){i.f^=kt,(i.f&$)===0&&(i.f^=$),Le(i)&&(J(i,vt),ps(i));for(var e=i.first;e!==null;){var s=e.next,n=(e.f&Ws)!==0||(e.f&wt)!==0;Cn(e,n?t:!1),e=s}if(i.transitions!==null)for(const r of i.transitions)(r.is_global||t)&&r.in()}}let Se=[],Ds=[];function qn(){var i=Se;Se=[],Xe(i)}function Gr(){var i=Ds;Ds=[],Xe(i)}function ni(i){Se.length===0&&queueMicrotask(qn),Se.push(i)}function ki(){Se.length>0&&qn(),Ds.length>0&&Gr()}let Fe=!1,is=!1,ns=null,$t=!1,Ae=!1;function vi(i){Ae=i}let ke=[],q=null,it=!1;function lt(i){q=i}let C=null;function Bt(i){C=i}let W=null;function Qr(i){q!==null&&q.f&Ls&&(W===null?W=[i]:W.push(i))}let E=null,M=0,F=null;function Mr(i){F=i}let zn=1,rs=0,Lt=!1;function Nn(){return++zn}function Le(i){var t,e=i.f;if((e&vt)!==0)return!0;if((e&Ut)!==0){var s=i.deps,n=(e&U)!==0;if(s!==null){var r,o,l=(e&Je)!==0,h=n&&C!==null&&!Lt,a=s.length;if(l||h){var c=i,u=c.parent;for(r=0;r<a;r++)o=s[r],(l||!((t=o==null?void 0:o.reactions)!=null&&t.includes(c)))&&(o.reactions??(o.reactions=[])).push(c);l&&(c.f^=Je),h&&u!==null&&(u.f&U)===0&&(c.f^=U)}for(r=0;r<a;r++)if(o=s[r],Le(o)&&cn(o),o.wv>i.wv)return!0}(!n||C!==null&&!Lt)&&J(i,$)}return!1}function Ur(i,t){for(var e=t;e!==null;){if((e.f&Ye)!==0)try{e.fn(i);return}catch{e.f^=Ye}e=e.parent}throw Fe=!1,i}function xi(i){return(i.f&cs)===0&&(i.parent===null||(i.parent.f&Ye)===0)}function fs(i,t,e,s){if(Fe){if(e===null&&(Fe=!1),xi(t))throw i;return}if(e!==null&&(Fe=!0),Ur(i,t),xi(t))throw i}function Sn(i,t,e=!0){var s=i.reactions;if(s!==null)for(var n=0;n<s.length;n++){var r=s[n];W!=null&&W.includes(i)||((r.f&Y)!==0?Sn(r,t,!1):t===r&&(e?J(r,vt):(r.f&$)!==0&&J(r,Ut),ps(r)))}}function _n(i){var t,e=E,s=M,n=F,r=q,o=Lt,l=W,h=L,a=it,c=i.f;E=null,M=0,F=null,Lt=(c&U)!==0&&(it||!$t||q===null),q=(c&(wt|Mt))===0?i:null,W=null,gi(i.ctx),it=!1,rs++,i.f|=Ls;try{var u=(0,i.fn)(),d=i.deps;if(E!==null){var f;if(os(i,M),d!==null&&M>0)for(d.length=M+E.length,f=0;f<E.length;f++)d[M+f]=E[f];else i.deps=d=E;if(!Lt)for(f=M;f<d.length;f++)((t=d[f]).reactions??(t.reactions=[])).push(i)}else d!==null&&M<d.length&&(os(i,M),d.length=M);if(us()&&F!==null&&!it&&d!==null&&(i.f&(Y|Ut|vt))===0)for(f=0;f<F.length;f++)Sn(F[f],i);return r!==null&&r!==i&&(rs++,F!==null&&(n===null?n=F:n.push(...F))),u}finally{E=e,M=s,F=n,q=r,Lt=o,W=l,gi(h),it=a,i.f^=Ls}}function Fr(i,t){let e=t.reactions;if(e!==null){var s=hr.call(e,i);if(s!==-1){var n=e.length-1;n===0?e=t.reactions=null:(e[s]=e[n],e.pop())}}e===null&&(t.f&Y)!==0&&(E===null||!E.includes(t))&&(J(t,Ut),(t.f&(U|Je))===0&&(t.f^=Je),hn(t),os(t,0))}function os(i,t){var e=i.deps;if(e!==null)for(var s=t;s<e.length;s++)Fr(i,e[s])}function ri(i){var t=i.f;if((t&cs)===0){J(i,$);var e=C,s=L,n=$t;C=i,$t=!0;try{(t&Hs)!==0?Ir(i):vn(i),kn(i);var r=_n(i);i.teardown=typeof r=="function"?r:null,i.wv=zn;var o=i.deps,l}catch(h){fs(h,i,e,s||i.ctx)}finally{$t=n,C=e}}}function Hr(){try{vr()}catch(i){if(ns!==null)fs(i,ns,null);else throw i}}function An(){var i=$t;try{var t=0;for($t=!0;ke.length>0;){t++>1e3&&Hr();var e=ke,s=e.length;ke=[];for(var n=0;n<s;n++){var r=Kr(e[n]);Wr(r)}qe.clear()}}finally{is=!1,$t=i,ns=null}}function Wr(i){var t=i.length;if(t!==0)for(var e=0;e<t;e++){var s=i[e];if((s.f&(cs|kt))===0)try{Le(s)&&(ri(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?xn(s):s.fn=null))}catch(n){fs(n,s,null,s.ctx)}}}function ps(i){is||(is=!0,queueMicrotask(An));for(var t=ns=i;t.parent!==null;){t=t.parent;var e=t.f;if((e&(Mt|wt))!==0){if((e&$)===0)return;t.f^=$}}ke.push(t)}function Kr(i){for(var t=[],e=i;e!==null;){var s=e.f,n=(s&(wt|Mt))!==0,r=n&&(s&$)!==0;if(!r&&(s&kt)===0){if((s&en)!==0)t.push(e);else if(n)e.f^=$;else try{Le(e)&&ri(e)}catch(h){fs(h,e,null,e.ctx)}var o=e.first;if(o!==null){e=o;continue}}var l=e.parent;for(e=e.next;e===null&&l!==null;)e=l.next,l=l.parent}return t}function Os(i){var t;for(ki();ke.length>0;)is=!0,An(),ki();return t}function x(i){var t=i.f,e=(t&Y)!==0;if(q!==null&&!it){if(!(W!=null&&W.includes(i))){var s=q.deps;i.rv<rs&&(i.rv=rs,E===null&&s!==null&&s[M]===i?M++:E===null?E=[i]:(!Lt||!E.includes(i))&&E.push(i))}}else if(e&&i.deps===null&&i.effects===null){var n=i,r=n.parent;r!==null&&(r.f&U)===0&&(n.f^=U)}return e&&(n=i,Le(n)&&cn(n)),Ae&&qe.has(i)?qe.get(i):i.v}function je(i){var t=it;try{return it=!0,i()}finally{it=t}}const Vr=-7169;function J(i,t){i.f=i.f&Vr|t}function Xr(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(It in i)Es(i);else if(!Array.isArray(i))for(let t in i){const e=i[t];typeof e=="object"&&e&&It in e&&Es(e)}}}function Es(i,t=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!t.has(i)){t.add(i),i instanceof Date&&i.getTime();for(let s in i)try{Es(i[s],t)}catch{}const e=tn(i);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const s=ar(e);for(let n in s){const r=s[n].get;if(r)try{r.call(i)}catch{}}}}}const Yr=["touchstart","touchmove"];function Jr(i){return Yr.includes(i)}function Zr(i){var t=q,e=C;lt(null),Bt(null);try{return i()}finally{lt(t),Bt(e)}}const to=new Set,wi=new Set;function eo(i,t,e,s={}){function n(r){if(s.capture||be.call(t,r),!r.cancelBubble)return Zr(()=>e==null?void 0:e.call(this,r))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?ni(()=>{t.addEventListener(i,n,s)}):t.addEventListener(i,n,s),n}function Jt(i,t,e,s,n){var r={capture:s,passive:n},o=eo(i,t,e,r);(t===document.body||t===window||t===document)&&yn(()=>{t.removeEventListener(i,o,r)})}function be(i){var t,e=this,s=e.ownerDocument,n=i.type,r=((t=i.composedPath)==null?void 0:t.call(i))||[],o=r[0]||i.target,l=0,h=i.__root;if(h){var a=r.indexOf(h);if(a!==-1&&(e===document||e===window)){i.__root=e;return}var c=r.indexOf(e);if(c===-1)return;a<=c&&(l=a)}if(o=r[l]||i.target,o!==e){Ve(i,"currentTarget",{configurable:!0,get(){return o||s}});var u=q,d=C;lt(null),Bt(null);try{for(var f,p=[];o!==null;){var k=o.assignedSlot||o.parentNode||o.host||null;try{var g=o["__"+n];if(g!=null&&(!o.disabled||i.target===o))if(Us(g)){var[m,...y]=g;m.apply(o,[i,...y])}else g.call(o,i)}catch(w){f?p.push(w):f=w}if(i.cancelBubble||k===e||k===null)break;o=k}if(f){for(let w of p)queueMicrotask(()=>{throw w});throw f}}finally{i.__root=e,delete i.currentTarget,lt(u),Bt(d)}}}function so(i){var t=document.createElement("template");return t.innerHTML=i,t.content}function Rs(i,t){var e=C;e.nodes_start===null&&(e.nodes_start=i,e.nodes_end=t)}function ms(i,t){var e=(t&jr)!==0,s,n=!i.startsWith("<!>");return()=>{if(T)return Rs(j,null),j;s===void 0&&(s=so(n?i:"<!>"+i),s=ts(s));var r=e||bn?document.importNode(s,!0):s.cloneNode(!0);return Rs(r,r),r}}function fe(i,t){if(T){C.nodes_end=j,bs();return}i!==null&&i.before(t)}function De(i,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=e,i.nodeValue=e+"")}function oi(i,t){return Ln(i,t)}function io(i,t){Ts(),t.intro=t.intro??!1;const e=t.target,s=T,n=j;try{for(var r=ts(e);r&&(r.nodeType!==8||r.data!==Vs);)r=Ft(r);if(!r)throw ye;yt(!0),ot(r),bs();const o=Ln(i,{...t,anchor:r});if(j===null||j.nodeType!==8||j.data!==Ys)throw Zs(),ye;return yt(!1),o}catch(o){if(o===ye)return t.recover===!1&&xr(),Ts(),mn(e),yt(!1),oi(i,t);throw o}finally{yt(s),ot(n)}}const Zt=new Map;function Ln(i,{target:t,anchor:e,props:s={},events:n,context:r,intro:o=!0}){Ts();var l=new Set,h=u=>{for(var d=0;d<u.length;d++){var f=u[d];if(!l.has(f)){l.add(f);var p=Jr(f);t.addEventListener(f,be,{passive:p});var k=Zt.get(f);k===void 0?(document.addEventListener(f,be,{passive:p}),Zt.set(f,1)):Zt.set(f,k+1)}}};h(Fs(to)),wi.add(h);var a=void 0,c=Pr(()=>{var u=e??t.appendChild(Ze());return Ne(()=>{if(r){on({});var d=L;d.c=r}n&&(s.$$events=n),T&&Rs(u,null),a=i(u,s)||{},T&&(C.nodes_end=j),r&&ln()}),()=>{var d;for(var f of l){t.removeEventListener(f,be);var p=Zt.get(f);--p===0?(document.removeEventListener(f,be),Zt.delete(f)):Zt.set(f,p)}wi.delete(h),u!==e&&((d=u.parentNode)==null||d.removeChild(u))}});return Ps.set(a,c),a}let Ps=new WeakMap;function no(i,t){const e=Ps.get(i);return e?(Ps.delete(i),e(t)):Promise.resolve()}function Ci(i,t,[e,s]=[0,0]){T&&e===0&&bs();var n=i,r=null,o=null,l=P,h=e>0?Ws:0,a=!1;const c=(d,f=!0)=>{a=!0,u(f,d)},u=(d,f)=>{if(l===(l=d))return;let p=!1;if(T&&s!==-1){if(e===0){const g=n.data;g===Vs?s=0:g===Xs?s=1/0:(s=parseInt(g.substring(1)),s!==s&&(s=l?1/0:-1))}const k=s>e;!!l===k&&(n=js(),ot(n),yt(!1),p=!0,s=-1)}l?(r?ss(r):f&&(r=Ne(()=>f(n))),o&&es(o,()=>{o=null})):(o?ss(o):f&&(o=Ne(()=>f(n,[e+1,s]))),r&&es(r,()=>{r=null})),p&&yt(!0)};si(()=>{a=!1,t(c),a||u(null,null)},h),T&&(n=j)}function ro(i,t){return t}function oo(i,t,e,s){for(var n=[],r=t.length,o=0;o<r;o++)ii(t[o].e,n,!0);var l=r>0&&n.length===0&&e!==null;if(l){var h=e.parentNode;mn(h),h.append(e),s.clear(),_t(i,t[0].prev,t[r-1].next)}wn(n,()=>{for(var a=0;a<r;a++){var c=t[a];l||(s.delete(c.k),_t(i,c.prev,c.next)),xt(c.e,!l)}})}function lo(i,t,e,s,n,r=null){var o=i,l={flags:t,items:new Map,first:null};T&&bs();var h=null,a=!1,c=Js(()=>{var u=e();return Us(u)?u:u==null?[]:Fs(u)});si(()=>{var u=x(c),d=u.length;if(a&&d===0)return;a=d===0;let f=!1;if(T){var p=o.data===Xs;p!==(d===0)&&(o=js(),ot(o),yt(!1),f=!0)}if(T){for(var k=null,g,m=0;m<d;m++){if(j.nodeType===8&&j.data===Ys){o=j,f=!0,yt(!1);break}var y=u[m],w=s(y,m);g=jn(j,l,k,null,y,w,m,n,t,e),l.items.set(w,g),k=g}d>0&&ot(js())}T||ho(u,l,o,n,t,s,e),r!==null&&(d===0?h?ss(h):h=Ne(()=>r(o)):h!==null&&es(h,()=>{h=null})),f&&yt(!0),x(c)}),T&&(o=j)}function ho(i,t,e,s,n,r,o){var l=i.length,h=t.items,a=t.first,c=a,u,d=null,f=[],p=[],k,g,m,y;for(y=0;y<l;y+=1){if(k=i[y],g=r(k,y),m=h.get(g),m===void 0){var w=c?c.e.nodes_start:e;d=jn(w,t,d,d===null?t.first:d.next,k,g,y,s,n,o),h.set(g,d),f=[],p=[],c=d.next;continue}if(ao(m,k,y),(m.e.f&kt)!==0&&ss(m.e),m!==c){if(u!==void 0&&u.has(m)){if(f.length<p.length){var N=p[0],v;d=N.prev;var O=f[0],R=f[f.length-1];for(v=0;v<f.length;v+=1)qi(f[v],N,e);for(v=0;v<p.length;v+=1)u.delete(p[v]);_t(t,O.prev,R.next),_t(t,d,O),_t(t,R,N),c=N,d=R,y-=1,f=[],p=[]}else u.delete(m),qi(m,c,e),_t(t,m.prev,m.next),_t(t,m,d===null?t.first:d.next),_t(t,d,m),d=m;continue}for(f=[],p=[];c!==null&&c.k!==g;)(c.e.f&kt)===0&&(u??(u=new Set)).add(c),p.push(c),c=c.next;if(c===null)continue;m=c}f.push(m),d=m,c=m.next}if(c!==null||u!==void 0){for(var K=u===void 0?[]:Fs(u);c!==null;)(c.e.f&kt)===0&&K.push(c),c=c.next;var ht=K.length;if(ht>0){var tt=null;oo(t,K,tt,h)}}C.first=t.first&&t.first.e,C.last=d&&d.e}function ao(i,t,e,s){un(i.v,t),i.i=e}function jn(i,t,e,s,n,r,o,l,h,a){var c=(h&Nr)!==0,u=(h&_r)===0,d=c?u?X(n):ze(n):n,f=(h&Sr)===0?o:ze(o),p={i:f,v:d,k:r,a:null,e:null,prev:e,next:s};try{return p.e=Ne(()=>l(i,d,f,a),T),p.e.prev=e&&e.e,p.e.next=s&&s.e,e===null?t.first=p:(e.next=p,e.e.next=p.e),s!==null&&(s.prev=p,s.e.prev=p.e),p}finally{}}function qi(i,t,e){for(var s=i.next?i.next.e.nodes_start:e,n=t?t.e.nodes_start:e,r=i.e.nodes_start;r!==s;){var o=Ft(r);n.before(r),r=o}}function _t(i,t,e){t===null?i.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function co(i,t){ni(()=>{var e=i.getRootNode(),s=e.host?e:e.head??e.ownerDocument.head;if(!s.querySelector("#"+t.hash)){const n=document.createElement("style");n.id=t.hash,n.textContent=t.code,s.appendChild(n)}})}const zi=[...` 	
\r\f \v\uFEFF`];function uo(i,t,e){var s=""+i;if(e){for(var n in e)if(e[n])s=s?s+" "+n:n;else if(s.length)for(var r=n.length,o=0;(o=s.indexOf(n,o))>=0;){var l=o+r;(o===0||zi.includes(s[o-1]))&&(l===s.length||zi.includes(s[l]))?s=(o===0?"":s.substring(0,o))+s.substring(l+1):o=l}}return s===""?null:s}function bo(i,t,e,s,n,r){var o=i.__className;if(T||o!==e||o===void 0){var l=uo(e,s,r);(!T||l!==i.getAttribute("class"))&&(l==null?i.removeAttribute("class"):i.className=l),i.__className=e}else if(r&&n!==r)for(var h in r){var a=!!r[h];(n==null||a!==!!n[h])&&i.classList.toggle(h,a)}return r}function Ni(i,t){return i===t||(i==null?void 0:i[It])===t}function fo(i={},t,e,s){return ti(()=>{var n,r;return ei(()=>{n=r,r=[],je(()=>{i!==e(...r)&&(t(i,...r),n&&Ni(e(...n),i)&&t(null,...n))})}),()=>{ni(()=>{r&&Ni(e(...r),i)&&t(null,...r)})}}),i}function po(i=!1){const t=L,e=t.l.u;if(!e)return;let s=()=>Xr(t.s);if(i){let n=0,r={};const o=ds(()=>{let l=!1;const h=t.s;for(const a in h)h[a]!==r[a]&&(r[a]=h[a],l=!0);return l&&n++,n});s=()=>x(o)}e.b.length&&Er(()=>{Si(t,s),Xe(e.b)}),Bs(()=>{const n=je(()=>e.m.map(dr));return()=>{for(const r of n)typeof r=="function"&&r()}}),e.a.length&&Bs(()=>{Si(t,s),Xe(e.a)})}function Si(i,t){if(i.l.s)for(const e of i.l.s)x(e);t()}let Oe=!1;function mo(i){var t=Oe;try{return Oe=!1,[i(),Oe]}finally{Oe=t}}function _i(i){var t;return((t=i.ctx)==null?void 0:t.d)??!1}function Ai(i,t,e,s){var n,r=!le||(e&Ar)!==0,o=(e&Lr)!==0,l=!1,h;[h,l]=mo(()=>i[t]);var a=It in i||nn in i,c=(((n=Pt(i,t))==null?void 0:n.set)??(a&&t in i&&(v=>i[t]=v)))||void 0,u=s,d=!0,f=!1,p=()=>(f=!0,d&&(d=!1,u=s),u),k;if(r)k=()=>{var v=i[t];return v===void 0?p():(d=!0,f=!1,v)};else{var g=Js(()=>i[t]);g.f|=fr,k=()=>{var v=x(g);return v!==void 0&&(u=void 0),v===void 0?u:v}}if(c){var m=i.$$legacy;return function(v,O){return arguments.length>0?((!r||!O||m||l)&&c(O?k():v),v):k()}}var y=!1,w=X(h),N=ds(()=>{var v=k(),O=x(w);return y?(y=!1,O):w.v=v});return x(N),N.equals=Ks,function(v,O){if(arguments.length>0){const R=O?x(N):r&&o?Et(v):v;if(!N.equals(R)){if(y=!0,B(w,R),f&&u!==void 0&&(u=R),_i(N))return v;je(()=>x(N))}return v}return _i(N)?N.v:x(N)}}function go(i){return new yo(i)}var St,V;class yo{constructor(t){fi(this,St),fi(this,V);var e,s=new Map,n=(o,l)=>{var h=X(l);return s.set(o,h),h};const r=new Proxy({...t.props||{},$$events:{}},{get(o,l){return x(s.get(l)??n(l,Reflect.get(o,l)))},has(o,l){return l===nn?!0:(x(s.get(l)??n(l,Reflect.get(o,l))),Reflect.has(o,l))},set(o,l,h){return B(s.get(l)??n(l,h),h),Reflect.set(o,l,h)}});pi(this,V,(t.hydrate?io:oi)(t.component,{target:t.target,anchor:t.anchor,props:r,context:t.context,intro:t.intro??!1,recover:t.recover})),(!((e=t==null?void 0:t.props)!=null&&e.$$host)||t.sync===!1)&&Os(),pi(this,St,r.$$events);for(const o of Object.keys(Q(this,V)))o==="$set"||o==="$destroy"||o==="$on"||Ve(this,o,{get(){return Q(this,V)[o]},set(l){Q(this,V)[o]=l},enumerable:!0});Q(this,V).$set=o=>{Object.assign(r,o)},Q(this,V).$destroy=()=>{no(Q(this,V))}}$set(t){Q(this,V).$set(t)}$on(t,e){Q(this,St)[t]=Q(this,St)[t]||[];const s=(...n)=>e.call(this,...n);return Q(this,St)[t].push(s),()=>{Q(this,St)[t]=Q(this,St)[t].filter(n=>n!==s)}}$destroy(){Q(this,V).$destroy()}}St=new WeakMap,V=new WeakMap;let Tn;typeof HTMLElement=="function"&&(Tn=class extends HTMLElement{constructor(i,t,e){super(),st(this,"$$ctor"),st(this,"$$s"),st(this,"$$c"),st(this,"$$cn",!1),st(this,"$$d",{}),st(this,"$$r",!1),st(this,"$$p_d",{}),st(this,"$$l",{}),st(this,"$$l_u",new Map),st(this,"$$me"),this.$$ctor=i,this.$$s=t,e&&this.attachShadow({mode:"open"})}addEventListener(i,t,e){if(this.$$l[i]=this.$$l[i]||[],this.$$l[i].push(t),this.$$c){const s=this.$$c.$on(i,t);this.$$l_u.set(t,s)}super.addEventListener(i,t,e)}removeEventListener(i,t,e){if(super.removeEventListener(i,t,e),this.$$c){const s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let i=function(s){return n=>{const r=document.createElement("slot");s!=="default"&&(r.name=s),fe(n,r)}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;const t={},e=ko(this);for(const s of this.$$s)s in e&&(s==="default"&&!this.$$d.children?(this.$$d.children=i(s),t.default=!0):t[s]=i(s));for(const s of this.attributes){const n=this.$$g_p(s.name);n in this.$$d||(this.$$d[n]=He(n,s.value,this.$$p_d,"toProp"))}for(const s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=go({component:this.$$ctor,target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$host:this}}),this.$$me=Rr(()=>{ei(()=>{var s;this.$$r=!0;for(const n of Ke(this.$$c)){if(!((s=this.$$p_d[n])!=null&&s.reflect))continue;this.$$d[n]=this.$$c[n];const r=He(n,this.$$d[n],this.$$p_d,"toAttribute");r==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,r)}this.$$r=!1})});for(const s in this.$$l)for(const n of this.$$l[s]){const r=this.$$c.$on(s,n);this.$$l_u.set(n,r)}this.$$l={}}}attributeChangedCallback(i,t,e){var s;this.$$r||(i=this.$$g_p(i),this.$$d[i]=He(i,e,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[i]:this.$$d[i]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$me(),this.$$c=void 0)})}$$g_p(i){return Ke(this.$$p_d).find(t=>this.$$p_d[t].attribute===i||!this.$$p_d[t].attribute&&t.toLowerCase()===i)||i}});function He(i,t,e,s){var n;const r=(n=e[i])==null?void 0:n.type;if(t=r==="Boolean"&&typeof t!="boolean"?t!=null:t,!s||!e[i])return t;if(s==="toAttribute")switch(r){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(r){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}function ko(i){const t={};return i.childNodes.forEach(e=>{t[e.slot||"default"]=!0}),t}function vo(i,t,e,s,n,r){let o=class extends Tn{constructor(){super(i,e,n),this.$$p_d=t}static get observedAttributes(){return Ke(t).map(l=>(t[l].attribute||l).toLowerCase())}};return Ke(t).forEach(l=>{Ve(o.prototype,l,{get(){return this.$$c&&l in this.$$c?this.$$c[l]:this.$$d[l]},set(h){var a;h=He(l,h,t),this.$$d[l]=h;var c=this.$$c;if(c){var u=(a=Pt(c,l))==null?void 0:a.get;u?c[l]=h:c.$set({[l]:h})}}})}),s.forEach(l=>{Ve(o.prototype,l,{get(){var h;return(h=this.$$c)==null?void 0:h[l]}})}),i.element=o,o}function xo(i){L===null&&Tr(),le&&L.l!==null?wo(L).m.push(i):Bs(()=>{const t=je(i);if(typeof t=="function")return t})}function wo(i){var t=i.l;return t.u??(t.u={a:[],b:[],m:[]})}const Co="5";var Li;typeof window<"u"&&((Li=window.__svelte??(window.__svelte={})).v??(Li.v=new Set)).add(Co);zr();const gs={node:typeof sr=="object"&&typeof process=="object",browser:typeof document=="object"&&typeof window=="object"&&typeof location=="object"};let Ee=null;const ys=()=>{if(Ee)return Ee;const i=gs.browser,t=i?navigator.userAgent:"",e=t.indexOf("like Mac OS X")>-1,s=t.indexOf("Android")>-1,n={iOS:e,Android:s,mobile:e||s},r=function(){return t.match(/Safari\/([\w\.]+)/)&&t.match(/Chrome\/(\w+(\.\w+)?)/)?RegExp.$1:null}(),o=function(){return r===null&&t.match(/Safari\/([\w\.]+)/)&&t.match(/Version\/(\w+(\.\w+)?)/)?RegExp.$1:null}(),l={AndroidBrowser:n.Android&&o,Presto:!1},h={touchevent:i&&!!window.ontouchstart,pointerevent:i&&!!window.PointerEvent,mspointerevent:i,maxWidth:i,svgTextLength:!i,anchor_download:i&&document.createElement("a").download!==void 0};return Ee={bz:l,OS:n,API:h,browser:i},Ee},qo=function(){ys();const i=navigator.language;return!i||i.substr(0,2)==="ja"?"ja":"en"},jt={lang:qo(),env:ys()};class zo{constructor(t){this.puzzle=t,this.list={},this.init()}init(){this.add("font",1,{option:[1,2]}),this.add("cursor",!0),this.add("irowake",!1),this.add("irowakeblk",!1),this.add("dispmove",!0),this.add("disptype_yajilin",1,{option:[1,2]}),this.add("disptype_pipelinkr",1,{option:[1,2]}),this.add("disptype_bosanowa",1,{option:[1,2,3]}),this.add("snakebd",!1),this.add("dispqnumbg",!1),this.add("undefcell",!0),this.add("squarecell",!0),this.add("color_shadecolor",null),this.add("color_bgcolor","white"),this.add("use",jt.env.API.touchevent?2:1,{option:[1,2]}),this.add("use_tri",1,{option:[1,2,3]}),this.add("support_tri",!0),this.add("bgcolor",!1),this.add("singlenum",!jt.env.API.touchevent),this.add("enline",!0),this.add("lattice",!0),this.add("autocmp",!0,{variety:!0}),this.add("autoerr",!1,{variety:!0}),this.add("multierr",!1),this.add("allowempty",!1),this.add("forceallcell",!1),this.add("passallcell",!0),this.add("bdpadding",!0),this.add("discolor",!1),this.add("uramashu",!1,{volatile:!0})}add(t,e,s=null){s||(s={});const n={val:e,defval:e,volatile:!!s.volatile,option:null,variety:null};s.option&&(n.option=s.option),s.variety&&(n.variety={}),this.list[t]=n}getCurrentName(t){switch(t){case"color_qanscolor":t="color_shadecolor";break;case"autocmp_area":this.getexec("autocmp")&&(t="autocmp");break}return t}getNormalizedName(t){const e={name:t,pid:""};if(t.match(/\@/)){const s=t.split(/\@/);e.name=s[0],e.pid=s[1]}return e.name=this.getCurrentName(e.name),e}get(t){const e=this.getNormalizedName(t),s=e.name,n=this.list[s];if(!n)return null;if(n.variety){const r=e.pid!==void 0?e.pid:this.puzzle.pid;if(n.variety[r]!==void 0)return n.variety[r]}return n.val}set(t,e){const s=this.getNormalizedName(t),n=s.name;this.list[n]!==void 0&&(e=this.setproper(s,e),this.configevent(n,e),this.puzzle.emit("config",n,e))}reset(t){const e=this.getNormalizedName(t),s=this.list[e.name];s&&(s.variety&&!e.pid?(s.variety={},this.set(e.name,s.defval)):this.set(t,s.defval))}getList(){const t={};for(const e in this.list)this.getexec(e)&&(t[e]=this.get(e));return t}getAll(){const t={};for(const e in this.list){const s=this.list[e];if(!s.volatile&&(s.val!==s.defval&&(t[e]=s.val),!!s.variety))for(const n in s.variety)s.variety[n]!==s.defval&&(t[`${e}@${n}`]=s.variety[n])}return t}setAll(t){this.init();for(const e in t)this.set(e,t[e])}setproper(t,e){const s=t.name,n=this.list[s];switch(typeof n.defval){case"boolean":e=!!e;break;case"number":e=+e;break;case"string":e=`${e}`;break}return(!n.option||n.option.indexOf(e)>=0)&&(n.variety?n.variety[t.pid!==void 0?t.pid:this.puzzle.pid]=e:n.val=e),n.val}getexec(t){const e=this.puzzle,s=e.pid,n=!e.playeronly;let r=!1;switch(t){case"use":r=e.mouse.use;break;case"use_tri":r=s==="shakashaka";break;case"support_tri":r=s==="shakashaka";break;case"dispmove":r=e.board.linegraph.moveline;break;case"disptype_pipelinkr":r=s==="pipelinkr";break;case"disptype_bosanowa":r=s==="bosanowa";break;case"disptype_yajilin":r=s==="yajirin";break;case"bgcolor":r=s==="slither";break;case"irowake":r=e.painter.irowake;break;case"irowakeblk":r=e.painter.irowakeblk;break;case"snakebd":r=s==="hebi";break;case"dispqnumbg":r=s==="yinyang";break;case"undefcell":r=s==="shugaku";break;case"autocmp":r=!!e.painter.autocmp;break;case"autoerr":r=s==="hitori"||s==="gokigen"||s==="wagiri";break;case"singlenum":r=s==="hanare";break;case"enline":case"lattice":r=s==="kouchoku";break;case"bdpadding":r=n&&s==="goishi";break;case"discolor":r=n&&s==="tentaisho";break;case"uramashu":r=s==="mashu";break;case"forceallcell":r=s==="fillomino";break;case"passallcell":r=s==="arukone";break;default:r=!!this.list[t]}return r}configevent(t,e){const s=this.puzzle;if(this.getexec(t))switch(t){case"irowake":case"irowakeblk":case"dispmove":case"cursor":case"undefcell":case"autocmp":case"autoerr":case"snakebd":case"disptype_pipelinkr":case"disptype_yajilin":case"dispqnumbg":s.redraw();break;case"font":s.painter.initFont(),s.redraw();break;case"multierr":s.checker.multierr=e,s.checker.resetCache();break;case"allowempty":s.checker.allowempty=e;break;case"forceallcell":s.checker.forceallcell=e;break;case"disptype_bosanowa":s.setCanvasSizeByCellSize();break;case"color_shadecolor":s.painter.setColor("shadecolor",e);break;case"color_bgcolor":s.painter.setColor("bgcolor",e);break;case"uramashu":s.redraw();break}}}class Gt extends Array{constructor(t){super(),this.add=this.push,this.each=Array.prototype.forEach,t&&typeof t!="number"&&this.extend(t)}clone(){return new this.constructor}extend(t){this.push(...t)}notnull(){return this.filter(function(t){return!t.isnull})}remove(t){const e=this.indexOf(t);e>=0&&this.splice(e,1)}seterr(t){for(let e=0;e<this.length;e++)this[e].seterr(t)}setnoerr(){for(let t=0;t<this.length;t++)this[t].setnoerr()}setinfo(t){for(let e=0;e<this.length;e++)this[e].qinfo=t}allclear(t=!1){this.propsclear(["ques","ans","sub","info"],t)}ansclear(){this.propsclear(["ans","sub","info"],!0)}subclear(){this.propsclear(["sub","info"],!0)}errclear(){this.propsclear(["info"],!1)}trialclear(){this.propsclear(["trial"],!1)}propsclear(t,e){const s=this.length>0?this[0].getproplist(t):[];for(let n=0;n<this.length;n++){const r=this[n];for(let o=0;o<s.length;o++)r.propclear(s[o],e)}}}class A extends Gt{getRectSize(){if(this.length===0)return{x1:0,x2:0,y1:0,y2:0,cols:0,rows:0,cnt:0};const t={x1:999,x2:0,y1:999,y2:0,cols:0,rows:0,cnt:0};for(let e=0;e<this.length;e++){const s=this[e];t.x1>s.bx&&(t.x1=s.bx),t.x2<s.bx&&(t.x2=s.bx),t.y1>s.by&&(t.y1=s.by),t.y2<s.by&&(t.y2=s.by),t.cnt++}return t.cols=(t.x2-t.x1+2)/2,t.rows=(t.y2-t.y1+2)/2,t}getQnumCell(){for(let t=0,e=this.length;t<e;t++)if(this[t].isNum())return this[t];return null}getTopCell(){return this.length===0?null:this.toSorted((t,e)=>t.bx-e.bx||t.by-e.by)[0]}eraseLines(){}}class _e extends Gt{}class oe extends Gt{cellinside(){const t=new A,e=[];for(let s=0;s<this.length;s++){const n=this[s],r=n.sidecell[0],o=n.sidecell[1];!r.isnull&&e[r.id]!==!0&&(t.add(r),e[r.id]=!0),!o.isnull&&e[o.id]!==!0&&(t.add(o),e[o.id]=!0)}return t}crossinside(){const t=new _e,e=[];for(let s=0;s<this.length;s++){const n=this[s],r=n.sidecross[0],o=n.sidecross[1];!r.isnull&&e[r.id]!==!0&&(t.add(r),e[r.id]=!0),!o.isnull&&e[o.id]!==!0&&(t.add(o),e[o.id]=!0)}return t}}class Is extends Gt{}const b={NDIR:0,UP:1,DN:2,LT:3,RT:4};class Bn{constructor(t){this.bx=null,this.by=null,this.puzzle=t}get board(){return this.puzzle.board}equals(t){return this.bx===t.bx&&this.by===t.by}getaddr(){return new Z(this.puzzle,this.bx,this.by)}relcell(t,e){return this.board.getc(this.bx+t,this.by+e)}relcross(t,e){return this.board.getx(this.bx+t,this.by+e)}relbd(t,e){return this.board.getb(this.bx+t,this.by+e)}relexcell(t,e){return this.board.getex(this.bx+t,this.by+e)}relobj(t,e){return this.board.getobj(this.bx+t,this.by+e)}reldirbd(t,e){return this.getaddr().movedir(t,e).getb()}draw(){this.puzzle.painter.paintRange(this.bx-1,this.by-1,this.bx+1,this.by+1)}drawaround(){this.puzzle.painter.paintRange(this.bx-3,this.by-3,this.bx+3,this.by+3)}isinside(){const t=this.board;return this.bx>=t.minbx&&this.bx<=t.maxbx&&this.by>=t.minby&&this.by<=t.maxby}getdir(t,e){const s=t.bx-this.bx,n=t.by-this.by;return s===0&&n===-e?b.UP:s===0&&n===e?b.DN:s===-e&&n===0?b.LT:s===e&&n===0?b.RT:b.NDIR}getvert(t,e){const s=this.getdir(t,e);if(s===b.UP||s===b.DN)return!0;if(s===b.LT||s===b.RT)return!1}getnb(t){return t.bx-this.bx===0&&t.by-this.by===-2?this.relbd(0,-1):t.bx-this.bx===0&&t.by-this.by===2?this.relbd(0,1):t.bx-this.bx===-2&&t.by-this.by===0?this.relbd(-1,0):t.bx-this.bx===2&&t.by-this.by===0?this.relbd(1,0):this.board.emptyborder}getborderobj(t){return(t.bx&1)===0&&this.bx===t.bx&&Math.abs(this.by-t.by)===1||(t.by&1)===0&&this.by===t.by&&Math.abs(this.bx-t.bx)===1?(this.onborder()?this:t).getb():this.board.nullobj}onborder(){return!1}}class Z extends Bn{constructor(t,e,s){super(t),e!=null&&s!=null&&this.init(e,s)}reset(){this.bx=null,this.by=null}clone(){return new Z(this.puzzle,this.bx,this.by)}set(t){return this.bx=t.bx,this.by=t.by,this}init(t,e){return this.bx=t,this.by=e,this}move(t,e){return this.bx+=t,this.by+=e,this}oncell(){return!!(this.bx&1&&this.by&1)}oncross(){return!(this.bx&1)&&!(this.by&1)}onborder(){return!!(this.bx+this.by&1)}getc(){return this.board.getc(this.bx,this.by)}getx(){return this.board.getx(this.bx,this.by)}getb(){return this.board.getb(this.bx,this.by)}getex(){return this.board.getex(this.bx,this.by)}getobj(){return this.board.getobj(this.bx,this.by)}movedir(t,e){switch(t){case b.UP:this.by-=e;break;case b.DN:this.by+=e;break;case b.LT:this.bx-=e;break;case b.RT:this.bx+=e;break}return this}}class ji extends Z{}class Dt{constructor(t){this.old=null,this.num=null,this.property="",this.reqReset=!1,this.puzzle=t,this.manager=t.opemgr}get board(){return this.puzzle.board}decode(t){return!1}toString(){return""}toJSON(){return this.toString()}undo(){this.exec(this.old)}redo(){this.exec(this.num)}exec(t,e){}isModify(t){return!1}}class li extends Dt{constructor(t,e,s,n,r){super(t),this.pos=null,this.STRGROUP={C:"cell",X:"cross",B:"border",E:"excell"},this.STRPROP={U:"ques",N:"qnum",Z:"qnum2",C:"qchar",M:"anum",D:"qdir",A:"qans",S:"qsub",K:"qcmp",B:"snum",L:"line"},this.group=e.group,this.property=s,this.bx=e.bx,this.by=e.by,this.old=n,this.num=r,s.length>4&&s.substr(0,4)==="snum"&&(this.property="snum",this.pos=+s.substr(4))}decode(t){return this.group=this.STRGROUP[t[0].charAt(0)],this.property=this.STRPROP[t[0].charAt(1)],!this.group||!this.property?!1:(this.pos=t[0].substr(0,2)==="CB"&&t[0].length>2?+t[0].charAt(2):null,this.bx=+t[1],this.by=+t[2],this.old=+t[3],this.num=+t[4],!0)}toString(){let t="";for(const e in this.STRGROUP)if(this.group===this.STRGROUP[e]){t+=e;break}for(const e in this.STRPROP)if(this.property===this.STRPROP[e]){t+=e;break}return t==="CB"&&this.pos!==null&&(t+=this.pos),[t,this.bx,this.by,this.old,this.num].join(",")}isModify(t){const e=this.property;return t.group===this.group&&t.property===this.property&&t.num===this.old&&t.bx===this.bx&&t.by===this.by&&(e==="qnum"||e==="qnum2"||e==="qchar"||e==="anum"||e==="snum"&&t.pos===this.pos)?(t.num=this.num,!0):!1}exec(t,e){const s=this.puzzle.board,n=s.getObjectPos(this.group,this.bx,this.by);if(this.group!==n.group)return!0;switch(this.pos===null?n.setdata(this.property,t):n.setdata2(this.property,this.pos,t),n.draw(),this.property){case"qcmp":s.cell.each(function(r){n===r.base&&r.draw()});break;case"qsub":break;default:this.puzzle.checker.resetCache();break}}}class Dn extends Dt{constructor(){super(...arguments),this.prefix="AC",this.reqReset=!0}decode(t){return t[0]===this.prefix}toString(){return this.prefix}}class On extends Dt{constructor(t,e){super(t),this.prefix="AJ",this.reqReset=!0,this.old=e,this.num=e}decode(t){return t[0]!==this.prefix?!1:(this.old=this.num=t[1],!0)}toString(){return[this.prefix,this.num].join(",")}undo(){const t=this.puzzle.board.exec.boardtype[this.old][0];this.exec_ba(t)}redo(){const t=this.puzzle.board.exec.boardtype[this.num][1];this.exec_ba(t)}exec_ba(t,e){const s=this.puzzle,n=s.board;e=e||{x1:0,y1:0,x2:2*n.cols,y2:2*n.rows},n.exec.execadjust_main(t,e),s.redraw()}}class En extends Dt{constructor(t,e,s){super(t),this.prefix="AT",this.reqReset=!0,this.area={x1:0,y1:0,x2:0,y2:0},this.TURN=64,this.area=e,this.old=this.num=s}decode(t){return t[0]!==this.prefix?!1:(this.old=this.num=t[1],this.area.x1=+t[2],this.area.y1=+t[3],this.area.x2=+t[4],this.area.y2=+t[5],!0)}toString(){const t=this.area;return[this.prefix,this.num,t.x1,t.y1,t.x2,t.y2].join(",")}undo(){const t=this.area,e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},s=this.puzzle.board.exec.boardtype[this.old][0];if(s&this.TURN){const n=e.x1;e.x1=e.y1,e.y1=n}this.exec_bf(s,e)}redo(){const t=this.area,e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},s=this.puzzle.board.exec.boardtype[this.num][1];this.exec_bf(s,e)}exec_bf(t,e){const s=this.puzzle;s.board.exec.execadjust_main(t,e),s.redraw()}}class $s extends Dt{constructor(t,e,s){super(t),this.old=e,this.num=s}undo(){this.manager.position--,this.manager.resumeTrial(),this.manager.position++,this.manager.trialpos.pop(),this.manager.emitTrial(this.old)}redo(){this.manager.trialpos.push(this.manager.position),this.manager.emitTrial(this.num)}decode(t){return t[0]!=="TE"?!1:(this.old=+t[1],this.num=+t[2],!0)}toString(){return["TE",this.old,this.num].join(",")}}class Ti extends Dt{constructor(t,e){super(t),this.old=e}exec(t,e){this.manager.trialpos=t.concat(),t.length===0?this.puzzle.board.trialclear():(this.manager.position--,this.manager.resumeTrial(),this.manager.position++),this.manager.emitTrial(t.length),this.puzzle.redraw()}decode(t){return t[0]!=="TF"?!1:(t.shift(),this.old=JSON.parse(t.join(",")),!0)}toString(){return`TF,[${this.old.join(",")}]`}}class Bi extends Array{constructor(t){super(),this.puzzle=t,this.time=this.puzzle.getTime()}}class No{constructor(t){this.lastope=null,this.history=[],this.position=0,this.trialpos=[],this.disEmitTrial=0,this.broken=!1,this.initpos=0,this.disrec=0,this.disCombine=!1,this.forceRecord=!1,this.changeflag=!1,this.chainflag=!1,this.enableUndo=!1,this.enableRedo=!1,this.limitTrialUndo=!1,this.undoExec=!1,this.redoExec=!1,this.reqReset=!1,this.operationlist=[],this.puzzle=t,this.operationlist=[li,Dn,On,En,$s,Ti],this.addExtraOperation()}addExtraOperation(){}disableRecord(){this.disrec++}enableRecord(){this.disrec>0&&this.disrec--}checkexec(){this.history!==void 0&&(this.checkenable(),this.puzzle.emit("history"))}checkenable(){this.limitTrialUndo?this.enableUndo=this.position>this.trialpos[this.trialpos.length-1]+1:this.enableUndo=this.position>0,this.enableRedo=this.position<this.history.length,this.puzzle.board.trialstage=this.trialpos.length}allerase(){this.lastope=null,this.history=[],this.position=0,this.broken=!1,this.initpos=0,this.changeflag=!1,this.chainflag=!1,this.checkexec(),this.trialpos=[],this.limitTrialUndo=!1,this.puzzle.checker.resetCache()}newOperation(){this.changeflag=!1,this.chainflag=!1}newChain(){this.chainflag=!1}isModified(){return this.broken||this.initpos<this.position}resetModifiedState(){this.broken=!1,this.initpos=this.position}removeDescendant(){this.position<this.initpos&&(this.broken=!0);for(let t=this.history.length-1;t>=this.position;t--)this.history.pop();this.position=this.history.length,this.chainflag=!1}add(t){if(!this.puzzle.ready||!this.forceRecord&&this.disrec>0)return;this.enableRedo&&this.removeDescendant();const e=this.puzzle;(this.disCombine||!this.lastope||!t.isModify||!t.isModify(this.lastope))&&(this.chainflag||(this.history.push(new Bi(this.puzzle)),this.position++,this.chainflag=!0),this.history[this.history.length-1].push(t),this.lastope=t),t.property!=="qsub"&&t.property!=="qcmp"&&t.property!=="snum"&&e.checker.resetCache(),this.changeflag=!0,this.checkexec()}decodeHistory(t){this.allerase(),this.initpos=this.position=t.current||0,this.history=[];const e=t.datas||[];for(let s=0,n=e.length;s<n;s++){const r=new Bi(this.puzzle);this.history.push(r);let o=e[s];"time"in o&&(r.time=o.time,o=o.ope);for(let l=0,h=o.length;l<h;l++){const a=o[l].split(/,/);let c=null;const u=this.operationlist;for(let d=0;d<u.length;d++){const f=new u[d];if(f.decode(a)){c=f;break}}c&&(r.push(c),this.lastope=c)}}this.checkexec(),this.trialpos=t.trialpos||[],this.trialpos.length>0&&(this.resumeTrial(),this.limitTrialUndo=!0)}encodeHistory(t){t=t||{},this.initpos=this.position;const e={type:"pzpr",version:.4,time:void 0,current:void 0,trialpos:void 0,datas:void 0};if(t.time&&(e.time=this.puzzle.getTime()),this.history.length>0){e.current=this.position,this.trialpos.length>0&&(e.trialpos=this.trialpos);const s=[];for(let n=0;n<this.history.length;++n){const r=Array.prototype.slice.call(this.history[n]);t.time?s.push({ope:r,time:this.history[n].time}):s.push(r)}e.datas=s}return e}undo(){if(!this.enableUndo)return!1;const t=this.history[this.position-1];return this.reqReset=this.checkReqReset(t),this.preproc(),this.undoCore(),this.postproc(),this.enableUndo}redo(){if(!this.enableRedo)return!1;const t=this.history[this.position];return this.reqReset=this.checkReqReset(t),this.preproc(),this.redoCore(),this.postproc(),this.enableRedo}undoCore(){this.undoExec=!0;const t=this.history[this.position-1];for(let e=t.length-1;e>=0;e--)t[e]&&t[e].undo();this.position--,this.undoExec=!1}redoCore(){this.redoExec=!0;const t=this.history[this.position];for(let e=0;e<t.length;++e)t[e]&&t[e].redo();this.position++,this.redoExec=!1}resumeGoto(t){if(t<this.position)for(;t<this.position;)this.undoCore();else if(this.position<t)for(;this.position<t;)this.redoCore();this.checkenable()}checkReqReset(t){return t.some(function(e){return e.reqReset})}preproc(t=null){const e=this.puzzle,s=e.board;this.disableRecord(),e.painter.suspend(),e.errclear(),this.reqReset&&s.disableInfo()}postproc(){const t=this.puzzle,e=t.board;this.reqReset&&(e.setposAll(),e.setminmax(),e.enableInfo(),e.rebuildInfo(),t.redraw(!0),t.emit("adjust")),t.painter.unsuspend(),this.enableRecord(),this.checkexec()}enterTrial(){this.trialpos[this.trialpos.length-1]+1!==this.position&&(this.newOperation(),this.add(new $s(this.puzzle,this.trialpos.length,this.trialpos.length+1)),this.trialpos.push(this.position-1),this.limitTrialUndo=!0,this.checkexec(),this.newOperation(),this.emitTrial())}acceptTrial(){this.trialpos[this.trialpos.length-1]+1===this.position&&(this.position--,this.removeDescendant(),this.trialpos.pop()),this.trialpos.length>0&&(this.newOperation(),this.add(new Ti(this.puzzle,this.trialpos)),this.puzzle.board.trialclear()),this.trialpos=[],this.limitTrialUndo=!1,this.removeDescendant(),this.checkexec(),this.newOperation(),this.emitTrial()}rejectTrial(t){if(this.trialpos.length!==0){if(this.disableRecord(),t||this.trialpos.length===1){const e=this.trialpos[0];this.puzzle.board.trialclear(),this.trialpos=[],this.limitTrialUndo=!1,this.resumeGoto(e)}else this.resumeGoto(this.trialpos[this.trialpos.length-1]),this.resumeTrial();this.enableRecord(),this.removeDescendant(),this.checkexec(),this.newOperation(),this.emitTrial()}}resumeTrial(){if(this.trialpos.length>0){this.disEmitTrial++;const t=this.position;this.checkenable(),this.resumeGoto(this.trialpos[0]),this.puzzle.board.trialclear(!0),this.position<t&&(this.puzzle.board.trialstage=1,this.resumeGoto(t)),this.disEmitTrial--}}emitTrial(t=0){this.disEmitTrial===0&&this.puzzle.emit("trial",t===void 0?this.trialpos.length:t)}}class he extends Bn{constructor(t){super(t),this.id=null,this.isnull=!0,this.ques=0,this.qdir=0,this.qnum=-1,this.qnum2=-1,this.qchar=0,this.qans=0,this.anum=-1,this.line=0,this.qsub=0,this.qcmp=0,this.snum=[],this.error=0,this.qinfo=0,this.trial=0,this.propques=["ques","qdir","qnum","qnum2","qchar"],this.propans=["qans","anum","line","trial"],this.propsub=["qsub","qcmp","snum"],this.propinfo=["error","qinfo"],this.propnorec={color:1,error:1,qinfo:1},this.adjborder=null,this.maxnum=()=>999,this.minnum=()=>1,this.prehook={},this.posthook={},this.pureObject={...this}}initAdjBorder(){this.adjborder={top:this.relbd(0,-1),bottom:this.relbd(0,1),left:this.relbd(-1,0),right:this.relbd(1,0)}}setQues(t){this.setdata("ques",t)}setQans(t){this.setdata("qans",t)}setQdir(t){this.setdata("qdir",t)}setQnum(t){this.setdata("qnum",t)}setQnum2(t){this.setdata("qnum2",t)}setQchar(t){this.setdata("qchar",t)}setAnum(t){this.setdata("anum",t)}setLineVal(t){this.setdata("line",t)}setQsub(t){this.setdata("qsub",t)}setQcmp(t){this.setdata("qcmp",t)}setdata(t,e){const s=this[t];if(s===e||this.prehook[t]&&this.prehook[t].call(this,e))return;this.addOpe(t,s,e),this[t]=e;const n=this.board.trialstage;n>0&&(this.trial=n),this.board.modifyInfo(this,`${this.group}.${t}`),this.posthook[t]&&this.posthook[t].call(this,e)}addOpe(t,e,s){e!==s&&this.puzzle.opemgr.add(new li(this.puzzle,this,t,e,s))}setdata2(t,e,s){const n=this[t][e];if(n===s||this.prehook[t]&&this.prehook[t].call(this,e,s))return;this.addOpe(t+e,n,s),this[t][e]=s;const r=this.board.trialstage;r>0&&(this.trial=r),this.posthook[t]&&this.posthook[t].call(this,e,s)}propclear(t,e){const s=this.pureObject[t],n=this[t];n!==s&&!this.shouldSkipPropClear(t)&&(e&&!this.propnorec[t]&&this.addOpe(t,n,s),this[t]=s)}shouldSkipPropClear(t){return!1}getprops(){const t={},e=this.getproplist(["ques","ans","sub"]);for(let s=0;s<e.length;s++){const n=e[s],r=this[n];t[n]=Array.isArray(r)?r.slice():this[n]}return t}compare(t,e){const s=this.getproplist(["ques","ans","sub"]);for(let n=0;n<s.length;n++){const r=s[n],o=Array.isArray(this[r]),l=o?t[r].join(","):t[r],h=o?this[r].join(","):this[r];l!==h&&e(this.group,this.id,r,{source:l,target:h})}}getproplist(t){let e=[];for(let s=0;s<t.length;s++){let n=[];switch(t[s]){case"ques":n=this.propques;break;case"ans":n=this.propans;break;case"sub":n=this.propsub;break;case"info":n=this.propinfo;break;case"trial":n=["trial"];break}e=e.concat(n)}return e}getmaxnum(){return this.maxnum instanceof Function?this.maxnum():this.maxnum}getminnum(){return this.minnum instanceof Function?this.minnum():this.minnum}seterr(t){this.board.isenableSetError()&&(this.error=t)}setnoerr(){this.board.isenableSetError()&&this.error===0&&(this.error=-1)}setinfo(t){this.qinfo=t}is51cell(){return!1}remove51cell(){}set51cell(){}checkStableLine(t){}}class hi extends he{constructor(t,e){if(super(t),this.group="cell",this.lcnt=0,this.base=null,this.disInputHatena=!1,this.numberWithMB=!1,this.numberAsObject=!1,this.numberAsLetter=!1,this.numberRemainsUnshaded=!1,this.enableSubNumberArray=!1,this.sblk=null,this.adjacent=null,this.prehook={qnum:function(s,n){return this.getminnum()>0&&s===0},qnum2:function(s,n){return this.getminnum()>0&&s===0},anum:function(s,n){return this.getminnum()>0&&s===0}},this.posthook={},this.isLPobj={1:{11:1,12:1,14:1,15:1},2:{11:1,12:1,16:1,17:1},3:{11:1,13:1,15:1,16:1},4:{11:1,13:1,14:1,17:1}},this.noLPobj={1:{1:1,4:1,5:1,13:1,16:1,17:1,21:1},2:{1:1,2:1,3:1,13:1,14:1,15:1,21:1},3:{1:1,2:1,5:1,12:1,14:1,17:1,22:1},4:{1:1,3:1,4:1,12:1,15:1,16:1,22:1}},Object.assign(this,e),this.pureObject={...this},this.enableSubNumberArray||e!=null&&e.enableSubNumberArray){const s=this.pureObject.anum;this.snum=[s,s,s,s],this.pureObject.snum=this.snum.slice()}}initAdjacent(){this.adjacent={top:this.relobj(0,-2),bottom:this.relobj(0,2),left:this.relobj(-2,0),right:this.relobj(2,0)}}relobj(t,e){return super.relobj(t,e)}isCmp(){return!1}propclear(t,e){if(t==="snum"&&this.enableSubNumberArray)for(let s=0;s<4;++s){const n=this.pureObject.snum[s],r=this.snum[s];r!==n&&(e&&this.addOpe(t+s,r,n),this.snum[s]=n)}else super.propclear(t,e)}isShade(){return!this.isnull&&this.qans===1}isUnshade(){return!this.isnull&&this.qans!==1}setShade(){this.setQans(1)}clrShade(){this.setQans(0)}getNum(){return this.qnum!==-1?this.qnum:this.anum}setNum(t){if(!(this.getminnum()>0&&t===0)){if(this.puzzle.editmode)t=(this.numberAsObject||t===-2)&&this.qnum===t?-1:t,this.setQnum(t),this.setAnum(-1),this.numberRemainsUnshaded&&this.setQans(0),this.puzzle.painter.enablebcolor||this.setQsub(0),this.setQcmp(0),this.clrSnum();else if(this.qnum===-1){const e=t>-1&&!(this.numberAsObject&&this.anum===t)?t:-1,s=t<-1&&!(this.numberAsObject&&this.qsub===-t-1)?-t-1:0;this.setAnum(e),this.setQsub(s),this.setQdir(0),this.setQcmp(0),this.numberWithMB&&e===-1||this.clrSnum()}}}isNum(){return!this.isnull&&(this.qnum!==this.pureObject.qnum||this.anum!==this.pureObject.anum)}noNum(){return!this.isnull&&this.qnum===this.pureObject.qnum&&this.anum===this.pureObject.anum}isValidNum(){return!this.isnull&&(this.qnum>=0||this.anum>=0&&this.qnum===this.pureObject.qnum)}isNumberObj(){return this.qnum!==this.pureObject.qnum||this.anum!==this.pureObject.anum||this.numberWithMB&&this.qsub===1}sameNumber(t){return this.isValidNum()&&this.getNum()===t.getNum()}setSnum(t,e=null){if(!(this.isNum()&&e!==-1)){if(!this.enableSubNumberArray){this.setdata("snum",e),console.warn("snumがセットされましたが、候補数字が無効です。");return}this.setdata2("snum",t,e)}}clrSnum(){this.enableSubNumberArray?(this.setSnum(0,-1),this.setSnum(1,-1),this.setSnum(2,-1),this.setSnum(3,-1)):this.setSnum(-1)}is51cell(){return this.ques===51}set51cell(t){this.setQues(51),this.setQnum(0),this.setQnum2(0),this.setAnum(-1)}remove51cell(t){this.setQues(0),this.setQnum(0),this.setQnum2(0),this.setAnum(-1)}ice(){return this.ques===6}isEmpty(){return this.isnull||this.ques===7}isValid(){return!this.isnull&&this.ques!==7}isDeparture(){return!this.isnull&&!!this.base&&this.isNum()}isDestination(){return!this.isnull&&!!this.base&&!this.base.isnull}isLineStraight(){return this.lcnt===2&&this.adjborder.top.isLine()&&this.adjborder.bottom.isLine()?1:this.lcnt===2&&this.adjborder.left.isLine()&&this.adjborder.right.isLine()?2:0}isLineCurve(){return this.lcnt===2&&!this.isLineStraight()}isLP(t){return!!this.isLPobj[t][this.ques]}noLP(t){return!!this.noLPobj[t][this.ques]}countDir4Cell(t){const e=this.adjacent;let s=0;const n=[e.top,e.bottom,e.left,e.right];for(let r=0;r<4;r++)n[r].group==="cell"&&!n[r].isnull&&t(n[r])&&s++;return s}getdir4clist(){const t=this.adjacent,e=[],s=[t.top,t.bottom,t.left,t.right];for(let n=0;n<4;n++)s[n].group==="cell"&&!s[n].isnull&&e.push([s[n],n+1]);return e}getdir4cblist(){const t=this.adjacent,e=this.adjborder,s=[],n=[t.top,t.bottom,t.left,t.right],r=[e.top,e.bottom,e.left,e.right];for(let o=0;o<4;o++)(n[o].group==="cell"&&!n[o].isnull||!r[o].isnull)&&s.push([n[o],r[o],o+1]);return s}eraseMovedLines(){if(this.path===null)return;const t=this.path.clist;let e=0;for(let s=0,n=t.length;s<n;s++)for(let r=s+1;r<n;r++){const o=t[s].getnb(t[r]);o.isnull||(o.removeLine(),e++)}e>0&&t.draw()}}class So extends he{constructor(){super(...arguments),this.group="cross",this.lcnt=0}getNum(){return this.qnum}setNum(t){t=t===-2&&this.qnum===t?-1:t,this.setQnum(t)}noNum(){return!this.isnull&&this.qnum===-1}setCrossBorderError(){this.seterr(1),this.board.borderinside(this.bx-1,this.by-1,this.bx+1,this.by+1).seterr(1)}}class _o extends he{constructor(t,e){super(t),this.group="border",this.isvert=!1,this.inside=!1,this.path=null,this.enableLineNG=!1,this.prehook={qans(s){return this.ques!==0},line(s){return this.checkStableLine(s)}},this.posthook={},this.sidecell=[null,null],this.sidecross=[null,null],this.sideobj=[],Object.assign(this,e)}initSideObject(){const t=this.board.hasborder===2&&this.board.hasexcell===2;this.isvert?(this.sidecell[0]=!t||this.bx>0?this.relcell(-1,0):this.relexcell(-1,0),this.sidecell[1]=!t||this.bx<this.board.cols*2?this.relcell(1,0):this.relexcell(1,0),this.sidecross[0]=this.relcross(0,-1),this.sidecross[1]=this.relcross(0,1)):(this.sidecell[0]=!t||this.by>0?this.relcell(0,-1):this.relexcell(0,-1),this.sidecell[1]=!t||this.by<this.board.rows*2?this.relcell(0,1):this.relexcell(0,1),this.sidecross[0]=this.relcross(-1,0),this.sidecross[1]=this.relcross(1,0)),this.sideobj=this.board.borderAsLine?this.sidecross:this.sidecell}draw(){this.puzzle.painter.paintRange(this.bx-2,this.by-2,this.bx+2,this.by+2)}isLine(){return this.line>0}setLine(t){this.setLineVal(1),this.setQsub(0)}setPeke(t){this.setLineVal(0),this.setQsub(2)}removeLine(t){this.setLineVal(0),this.setQsub(0)}isBorder(){return this.ques>0||this.qans>0}setBorder(){this.puzzle.editmode?(this.setQues(1),this.setQans(0)):this.ques!==1&&this.setQans(1)}removeBorder(){this.puzzle.editmode?(this.setQues(0),this.setQans(0)):this.ques!==1&&this.setQans(0)}isVert(){return this.isvert}isHorz(){return!this.isvert}checkStableLine(t){return this.enableLineNG?t!==0&&this.isLineNG():!1}isLineEX(){return!1}isLineNG(){const t=this.sidecell[0],e=this.sidecell[1];return this.isVert()?t.noLP(b.RT)||e.noLP(b.LT):t.noLP(b.DN)||e.noLP(b.UP)}}class Rn extends he{constructor(t,e){super(t),this.group="excell",this.adjacent=null,Object.assign(this,e),this.pureObject={...this}}initAdjacent(){this.adjacent={top:this.relobj(0,-2),bottom:this.relobj(0,2),left:this.relobj(-2,0),right:this.relobj(2,0)}}relobj(t,e){return super.relobj(t,e)}getNum(){return this.qnum}setNum(t){this.setQnum(t)}noNum(){return!this.isnull&&this.qnum===-1}is51cell(){return this.ques===51}ice(){return!1}noLP(){return!1}}const Gs=i=>i.group==="cell",Pn=i=>i.group==="border",In=i=>i.group==="cross";class $n{constructor(t,e){this.enabled=!1,this.relation={},this.coloring=!1,this.components=null,this.modifyNodes=null,this.rebuildmode=!1,this.puzzle=t,this.gcoption=e}get board(){return this.puzzle.board}removeFromArray(t,e){const s=t.indexOf(e);s>=0&&t.splice(s,1)}setComponentRefs(t,e){}getObjNodeList(t){return[]}resetObjNodeList(t){}isnodevalid(t){return!1}isedgevalidbylinkobj(t){return!0}isedgevalidbynodeobj(t,e){return!0}isedgeexistsbylinkobj(t){const e=this.getSideNodesBySeparator(t);return e?e[0].nodes.indexOf(e[1])>=0:!1}calcNodeCount(t){return this.isnodevalid(t)?1:0}rebuild(){this.enabled&&(this.rebuildmode=!0,this.components=[],this.modifyNodes=[],this.rebuild2(),this.searchGraph(),this.rebuildmode=!1)}rebuild2(){const t=this.puzzle.board[this.pointgroup];for(let e=0;e<t.length;e++)this.setComponentRefs(t[e],null),this.resetObjNodeList(t[e]),this.isnodevalid(t[e])&&this.createNode(t[e]);if(this.linkgroup){const e=this.puzzle.board[this.linkgroup];for(let s=0;s<e.length;s++)this.setComponentRefs(e[s],null),this.isedgevalidbylinkobj(e[s])&&this.addEdgeByLinkObj(e[s])}else for(let e=0;e<t.length;e++)this.isnodevalid(t[e])&&this.setEdgeByNodeObj(t[e])}addEdgeByLinkObj(t){}setEdgeByNodeObj(t){}createComponentInstance(){return new Di(this.puzzle,this.gcoption)}createComponent(){const t=this.createComponentInstance();return this.components.push(t),t}deleteComponent(t){for(let e=0;e<t.nodes.length;e++)this.modifyNodes.push(t.nodes[e]),this.setComponentRefs(t.nodes[e].obj,null),t.nodes[e].component=null;this.removeFromArray(this.components,t)}createNode(t){const e=new Ao(t);return this.getObjNodeList(t).push(e),this.modifyNodes.push(e),e}deleteNode(t){const e=t.obj;this.setComponentRefs(e,null),this.removeFromArray(this.getObjNodeList(e),t),this.removeFromArray(this.modifyNodes,t);const s=t.component;s!==null&&(this.removeFromArray(s.nodes,t),this.resetExtraData(e),s.nodes.length===0&&this.deleteComponent(s))}createNodeIfEmpty(t){this.getObjNodeList(t).length===0&&this.createNode(t)}deleteNodeIfEmpty(t){const e=this.getObjNodeList(t);e[0].nodes.length===0&&!this.isnodevalid(t)&&this.deleteNode(e[0])}addEdge(t,e){t.nodes.indexOf(e)>=0||(t.nodes.push(e),e.nodes.push(t),this.rebuildmode||(this.modifyNodes.indexOf(t)<0&&this.modifyNodes.push(t),this.modifyNodes.indexOf(e)<0&&this.modifyNodes.push(e)))}removeEdge(t,e){t.nodes.indexOf(e)<0||(this.removeFromArray(t.nodes,e),this.removeFromArray(e.nodes,t),this.rebuildmode||(this.modifyNodes.indexOf(t)<0&&this.modifyNodes.push(t),this.modifyNodes.indexOf(e)<0&&this.modifyNodes.push(e)))}getSideObjByLinkObj(t){return t.sideobj}getSideObjByNodeObj(t){const e=t.getdir4clist(),s=[];for(let n=0;n<e.length;n++){const r=e[n][0];this.isnodevalid(r)&&s.push(r)}return s}getSideNodesByLinkObj(t){const e=[],s=this.getSideObjByLinkObj(t);for(let n=0;n<s.length;n++){const r=s[n],o=this.getObjNodeList(r);let l=o[0];o[1]&&t.isvert&&(l=o[1]),e.push(l)}return e}getSideNodesBySeparator(t){const e=[],s=t.sideobj;for(let n=0;n<s.length;n++){const r=this.getObjNodeList(s[n]);r&&r[0]&&e.push(r[0])}return e.length>=2?e:null}modifyInfo(t,e){if(!this.enabled)return;const s=this.relation[e];if(s){switch(this.modifyNodes=[],s){case"node":this.setEdgeByNodeObj(t);break;case"link":this.setEdgeByLinkObj(t);break;case"separator":this.setEdgeBySeparator(t);break;default:this.modifyOtherInfo(t,s);break}this.modifyNodes.length>0&&this.remakeComponent()}}setEdgeByLinkObj(t){}modifyOtherInfo(t,e){}setEdgeBySeparator(t){const e=this.isedgevalidbylinkobj(t);e!==this.isedgeexistsbylinkobj(t)&&(this.incdecBorderCount&&this.incdecBorderCount(t,!e),e?this.addEdgeBySeparator(t):this.removeEdgeBySeparator(t))}incdecBorderCount(t,e){}addEdgeBySeparator(t){const e=this.getSideNodesBySeparator(t);e&&this.addEdge(e[0],e[1])}removeEdgeBySeparator(t){const e=this.getSideNodesBySeparator(t);e&&(this.removeEdge(e[0],e[1]),this.linkgroup&&this.setComponentRefs(t,null))}attachNode(t,e){t.component=e,e.nodes.push(t),this.setComponentInfo(e)}remakeComponent(){const t=this.getAffectedComponents();t.length===1&&this.checkDividedComponent(t[0]),this.modifyNodes&&this.modifyNodes.length>0&&this.remakeMaximalComonents(t)}getAffectedComponents(){const t=[];for(let e=0;e<this.modifyNodes.length;e++){const s=this.modifyNodes[e].component;s!==null&&(s.isremake||(t.push(s),s.isremake=!0))}return t}checkDividedComponent(t){for(let s=0,n=this.modifyNodes.length;s<n;s++){const r=this.modifyNodes[s];r.component=null,this.setComponentRefs(r.obj,null),this.removeFromArray(t.nodes,r)}const e=new Di(this.puzzle);if(this.searchSingle(this.modifyNodes[0],e),e.nodes.length===this.modifyNodes.length){for(let s=0;s<this.modifyNodes.length;s++){const n=this.modifyNodes[s];n.component=t,t.nodes.push(n)}this.modifyNodes=[],this.setComponentInfo(t),t.isremake=!1}}remakeMaximalComonents(t){const e=this.coloring?this.getLongColor(t):null;for(let n=0;n<t.length;n++)this.deleteComponent(t[n]);const s=this.searchGraph();this.coloring&&this.setLongColor(s,e)}searchGraph(){const t=this.modifyNodes,e=[];for(let s=0,n=t.length;s<n;s++)t[s].component=null;for(let s=0,n=t.length;s<n;s++){if(t[s].component!==null)continue;const r=this.createComponent();this.searchSingle(t[s],r),this.setComponentInfo(r),e.push(r)}return this.modifyNodes=[],e}searchSingle(t,e){const s=[t];for(;s.length>0;){const n=s.pop();if(n.component===null){n.component=e,e.nodes.push(n);for(let r=0;r<n.nodes.length;r++)s.push(n.nodes[r])}}}setComponentInfo(t){let e=0;for(let s=0;s<t.nodes.length;s++){const n=t.nodes[s];e+=n.nodes.length,this.setComponentRefs(n.obj,t)}t.circuits=(e>>1)-t.nodes.length+1,this.setExtraData(t)}resetExtraData(t){}setExtraData(t){}getLongColor(t){let e=t[0];for(let s=1;s<t.length;s++)e.nodes.length<t[s].nodes.length&&(e=t[s]);return e?e.color:null}setLongColor(t,e){if(t.length===0)return;const s=this.puzzle;let n=null;if(e){n=t[0];for(let r=1;r<t.length;r++)n.nodes.length<t[r].nodes.length&&(n=t[r])}for(let r=0;r<t.length;r++){const o=t[r];o.color=o===n?e:o.color}this.coloring&&(s.execConfig("irowake")||s.execConfig("irowakeblk"))&&this.repaintNodes(t)}repaintNodes(t){}newIrowake(){const t=this.components;for(let e=0;e<t.length;e++)t[e].color=this.puzzle.painter.getNewLineColor()}}class Di{constructor(t,e){this.cmp=!1,this.clist=null,this.departure=null,this.destination=null,this.movevalid=!1,this.top=null,this.isremake=!1,this.id=null,this.puzzle=t,this.nodes=[],this.color="",this.circuits=-1,Object.assign(this,e)}get board(){return this.puzzle.board}getLinkObjByNodes(t,e){const s=t.obj.bx,n=t.obj.by,r=e.obj.bx,o=e.obj.by;return s>r||s===r&&n>o?null:this.puzzle.board.getobj(s+r>>1,n+o>>1)}getnodeobjs(){const t=this.puzzle.board.getGroup(this.nodes[0].obj.group).clone();for(let e=0;e<this.nodes.length;e++)t.add(this.nodes[e].obj);return t}getedgeobjs(){const t=[];for(let e=0;e<this.nodes.length;e++){const s=this.nodes[e];for(let n=0;n<s.nodes.length;n++){const r=this.getLinkObjByNodes(s,s.nodes[n]);r&&t.push(r)}}return t}checkAutoCmp(){const t=this.checkCmp();this.cmp!==t&&(this.cmp=t,this.puzzle.execConfig("autocmp")&&this.puzzle.painter.repaintBlocks(this.clist))}checkCmp(){return!1}setedgeerr(t){const e=this.getedgeobjs();for(let s=0;s<e.length;s++)e[s].seterr(t)}setedgeinfo(t){const e=this.getedgeobjs();for(let s=0;s<e.length;s++)e[s].setinfo(t)}}class Ao{constructor(t){this.obj=t,this.nodes=[],this.component=null}}class Lo extends $n{constructor(t,e,s){super(t,s),this.enabled=!1,this.relation={"border.line":"link"},this.pointgroup="cell",this.linkgroup="border",this.isLineCross=!1,this.makeClist=!1,this.moveline=!1,this.coloring=!0,this.ltotal=[],Object.assign(this,e),this.moveline&&(this.relation["cell.qnum"]="move")}setComponentRefs(t,e){t.path=e}isedgeexistsbylinkobj(t){return t.path!==null}getObjNodeList(t){return t.pathnodes}resetObjNodeList(t){t.pathnodes=[],this.moveline&&this.resetExtraData(t)}isnodevalid(t){return t.lcnt>0||this.moveline&&t.isNum()}isedgevalidbylinkobj(t){return t.isLine()}iscrossing(t){return this.isLineCross}rebuild(){this.puzzle.board.borderAsLine&&(this.pointgroup="cross"),super.rebuild()}rebuild2(){this.incdecLineCount&&this.resetLineCount(),super.rebuild2()}resetLineCount(){const t=this.puzzle.board[this.pointgroup],e=this.puzzle.board[this.linkgroup];this.ltotal=[t.length];for(let s=0;s<t.length;s++)t[s].lcnt=0;for(let s=0;s<e.length;s++)this.isedgevalidbylinkobj(e[s])&&this.incdecLineCount(e[s],!0)}incdecLineCount(t,e){if(t.group===this.linkgroup)for(let s=0;s<2;s++){const n=t.sideobj[s];n.isnull||(this.ltotal[n.lcnt]--,e?n.lcnt++:n.lcnt--,this.ltotal[n.lcnt]=(this.ltotal[n.lcnt]||0)+1)}}setEdgeByLinkObj(t){const e=this.isedgevalidbylinkobj(t);e!==this.isedgeexistsbylinkobj(t)&&(this.incdecLineCount&&this.incdecLineCount(t,e),e?this.addEdgeByLinkObj(t):this.removeEdgeByLinkObj(t))}addEdgeByLinkObj(t){const e=this.modifyNodes.length===0,s=this.getSideObjByLinkObj(t);this.createNodeIfEmpty(s[0]),this.createNodeIfEmpty(s[1]);const n=this.getSideNodesByLinkObj(t);if(this.addEdge(n[0],n[1]),this.rebuildmode||!e)return;let r=null;const o=n[0],l=n[1],h=o.obj.lcnt,a=l.obj.lcnt;h===1&&(a===2||!this.isLineCross&&a>2)&&o.component===null&&l.component!==null?r=[n[0],n[1]]:a===1&&(h===2||!this.isLineCross&&h>2)&&l.component===null&&o.component!==null&&(r=[n[1],n[0]]),r&&(this.attachNode(r[0],r[1].component),this.modifyNodes=[])}removeEdgeByLinkObj(t){const e=this.modifyNodes.length===0,s=this.getSideNodesByLinkObj(t);if(this.removeEdge(s[0],s[1]),this.deleteNodeIfEmpty(s[0].obj),this.deleteNodeIfEmpty(s[1].obj),this.setComponentRefs(t,null),!e)return;let n=null;const r=s[0],o=s[1],l=r.obj.lcnt,h=o.obj.lcnt;l===0&&(h===1||!this.isLineCross&&h>1)&&o.component!==null?n=[s[0],s[1]]:h===0&&(l===1||!this.isLineCross&&l>1)&&r.component!==null&&(n=[s[1],s[0]]),n&&(this.setComponentInfo(n[1].component),this.modifyNodes=[])}modifyOtherInfo(t,e){const s=!!t.path;s!==this.isnodevalid(t)?s?this.deleteNodeIfEmpty(t):this.createNodeIfEmpty(t):s?this.setComponentInfo(t.path):this.resetExtraData(t)}createNodeIfEmpty(t){const e=this.getObjNodeList(t);if(e.length===0)this.createNode(t);else if(!e[1]&&e[0].nodes.length===2&&this.iscrossing(t)){this.createNode(t);const s=e[0].nodes,n=[t.getvert(s[0].obj,2),t.getvert(s[1].obj,2)];if(n[0]!==n[1]){const r=s[n[0]?1:0];this.removeEdge(e[0],r),this.addEdge(e[1],r)}else!n[0]&&!n[1]&&e.push(e.shift())}}deleteNodeIfEmpty(t){const e=this.getObjNodeList(t);if(e.length===1&&e[0].nodes.length===0&&!this.isnodevalid(t))this.deleteNode(e[0]);else if(e[1]&&e[0].nodes.length+e[1].nodes.length===2&&this.iscrossing(t)){if(e[1].nodes.length===1){const s=e[1].nodes[0];this.removeEdge(e[1],s),this.addEdge(e[0],s)}else e[1].nodes.length===2&&e.push(e.shift());this.deleteNode(e[1])}}resetExtraData(t){this.moveline&&(t.base=t.isNum()?t:this.puzzle.board.emptycell)}setExtraData(t){this.coloring&&!t.color&&(t.color=this.puzzle.painter.getNewLineColor());const e=t.getedgeobjs();for(let s=0;s<e.length;s++)this.setComponentRefs(e[s],t);(this.makeClist||this.moveline)&&(t.clist=new A(t.getnodeobjs()),this.moveline&&this.setMovedBase(t))}repaintNodes(t){const e=new oe;for(let s=0;s<t.length;s++)e.extend(t[s].getedgeobjs());this.puzzle.painter.repaintLines(e)}setMovedBase(t){const e=this.puzzle.board.emptycell;t.departure=t.destination=e,t.movevalid=!1;const s=t.clist;if(s.length<1)return;for(let l=0;l<s.length;l++){const h=s[l];h.base=h.isNum()?h:e}let n=null,r=null,o=0;if(s.length===1)n=r=s[0],o=2;else for(let l=0;l<s.length;l++){const h=s[l];h.lcnt===1&&(o++,h.isNum()?n=h:r=h)}n!==null&&r!==null&&o===2&&(n.base=e,t.departure=r.base=n,t.destination=r,t.movevalid=!0)}}class Wt extends $n{constructor(){super(...arguments),this.pointgroup="cell",this.linkgroup=null}isedgevalidbynodeobj(t,e){return this.isedgevalidbylinkobj(this.puzzle.board.getb(t.bx+e.bx>>1,t.by+e.by>>1))}setEdgeByNodeObj(t){this.getObjNodeList(t).length>0&&this.removeEdgeByNodeObj(t),this.calcNodeCount(t)>0&&this.addEdgeByNodeObj(t)}removeEdgeByNodeObj(t){const e=this.getSideObjByNodeObj(t),s=this.getObjNodeList(t)[0],n=s.nodes.length,r=s.component,o=this.modifyNodes.length===0;for(let l=0;l<e.length;l++){const h=this.getObjNodeList(e[l])[0];s&&h&&(this.removeEdge(s,h),this.incdecBorderCount&&this.incdecBorderCount(this.puzzle.board.getb(s.obj.bx+h.obj.bx>>1,s.obj.by+h.obj.by>>1),!0))}s&&this.deleteNode(s),!this.rebuildmode&&n===1&&o&&(this.setComponentInfo(r),this.modifyNodes=[])}addEdgeByNodeObj(t){for(let r=0,o=this.calcNodeCount(t);r<o;r++)this.createNode(t);const e=this.getSideObjByNodeObj(t),s=this.getObjNodeList(t)[0],n=this.modifyNodes.length===0;for(let r=0;r<e.length;r++){if(!this.isedgevalidbynodeobj(t,e[r]))continue;const o=this.getObjNodeList(e[r])[0];s&&o&&(this.addEdge(s,o),this.incdecBorderCount&&this.incdecBorderCount(this.puzzle.board.getb(s.obj.bx+o.obj.bx>>1,s.obj.by+o.obj.by>>1),!1))}!this.rebuildmode&&s.nodes.length===1&&n&&(this.attachNode(s,s.nodes[0].component),this.modifyNodes=[])}setExtraData(t){t.clist=new A(t.getnodeobjs())}}class Gn extends Wt{constructor(t,e,s){super(t,s),this.relation={"cell.qans":"node"},this.enabled=(e==null?void 0:e.enabled)||!1}setComponentRefs(t,e){t.sblk=e}getObjNodeList(t){return t.sblknodes}resetObjNodeList(t){t.sblknodes=[]}isnodevalid(t){return t.isShade()}setExtraData(t){t.clist=new A(t.getnodeobjs()),this.coloring&&!t.color&&(t.color=this.puzzle.painter.getNewLineColor())}repaintNodes(t){const e=new A;for(let s=0;s<t.length;s++)e.extend(t[s].getnodeobjs());this.puzzle.painter.repaintBlocks(e)}}class jo extends Wt{constructor(t,e,s){super(t,s),this.relation={"cell.qans":"node"},this.enabled=(e==null?void 0:e.enabled)||!1}setComponentRefs(t,e){t.ublk=e}getObjNodeList(t){return t.ublknodes}resetObjNodeList(t){t.ublknodes=[]}isnodevalid(t){return t.isUnshade()}}class Qn extends Wt{constructor(){super(...arguments),this.relation={"cell.qnum":"node","cell.anum":"node","cell.qsub":"node"}}setComponentRefs(t,e){t.nblk=e}getObjNodeList(t){return t.nblknodes}resetObjNodeList(t){t.nblknodes=[]}isnodevalid(t){return t.isNumberObj()}getComponentRefs(t){return t.nblk}getSideAreaInfo(){const t=[],e=this.components.length,s={},n=this.puzzle.board;for(let r=0;r<this.components.length;r++)this.components[r].id=r;for(let r=0;r<n.border.length;r++){const o=this.getComponentRefs(n.border[r].sidecell[0]),l=this.getComponentRefs(n.border[r].sidecell[1]);if(o===l||!o||!l)continue;const h=o.id<l.id?o.id*e+l.id:l.id*e+o.id;s[h]||(s[h]=!0,t.push([o,l]))}return t}}class Mn extends Wt{constructor(t,e,s){super(t,s),this.relation={"cell.ques":"node","border.ques":"separator","border.qans":"separator"},this.hastop=!1,Object.assign(this,e)}getComponentRefs(t){return t.room}setComponentRefs(t,e){t.room=e}getObjNodeList(t){return t.roomnodes}resetObjNodeList(t){t.roomnodes=[]}isnodevalid(t){return t.ques!==7}isedgevalidbylinkobj(t){return!t.isBorder()}rebuild2(){super.rebuild2(),this.resetBorderCount()}resetBorderCount(){const t=this.puzzle.board,e=t.border;for(let s=0;s<t.cross.length;s++){const n=t.cross[s],r=n.bx,o=n.by,l=t.hasborder===1?r===0||r===t.cols*2||o===0||o===t.rows*2:!1;n.lcnt=l?2:0}for(let s=0;s<e.length;s++)this.isedgevalidbylinkobj(e[s])||this.incdecBorderCount(e[s],!0)}incdecBorderCount(t,e){for(let s=0;s<2;s++){const n=t.sidecross[s];n.isnull||(e?n.lcnt++:n.lcnt--)}}addEdgeBySeparator(t){const e=this.getSideNodesBySeparator(t);e&&(this.addEdge(e[0],e[1]),t.sidecross[0].lcnt===0||t.sidecross[1].lcnt===0?this.modifyNodes=[]:this.hastop&&e.length>=2&&this.setTopOfRoom_combine(e[0].obj,e[1].obj))}removeEdgeBySeparator(t){const e=this.getSideNodesBySeparator(t);e&&(this.removeEdge(e[0],e[1]),(t.sidecross[0].lcnt===1||t.sidecross[1].lcnt===1)&&(this.modifyNodes=[]))}setTopOfRoom_combine(t,e){if(!t.room||!e.room||t.room===e.room)return;let s,n;const r=t.room.top,o=e.room.top;r.bx>o.bx||r.bx===o.bx&&r.by>o.by?(s=r,n=o):(s=o,n=r),s.isNum()&&(n.noNum()&&(n.setQnum(s.qnum),n.draw()),s.setQnum(-1),s.draw())}setExtraData(t){t.clist=new A(t.getnodeobjs());const e=t.clist;if(this.hastop&&(t.top=e.getTopCell(),this.rebuildmode)){let s=-1;const n=t.top;for(let r=0,o=e.length;r<o;r++){const l=e[r];l.room===t&&l.qnum!==-1&&(s===-1&&(s=l.qnum),n!==l&&(l.qnum=-1))}s!==-1&&n.qnum===-1&&(n.qnum=s)}this.puzzle.validConfig("autocmp")&&t.checkAutoCmp()}getSideAreaInfo(){const t=[],e=this.components.length,s={},n=this.puzzle.board;for(let r=0;r<this.components.length;r++)this.components[r].id=r;for(let r=0;r<n.border.length;r++){const o=this.getComponentRefs(n.border[r].sidecell[0]),l=this.getComponentRefs(n.border[r].sidecell[1]);if(o===l||!o||!l)continue;const h=o.id<l.id?o.id*e+l.id:l.id*e+o.id;s[h]||(s[h]=!0,t.push([o,l]))}return t}}const bt=1,ft=2,pt=3,mt=4,I=16,D=32,gt=64,At=128,Re=gt|At,Oi=I|bt,Ei=I|ft,Ri=I|pt,Pi=I|mt,Ii=D|bt,$i=D|ft,Gi=D|pt,Qi=D|mt,pe=gt|1,me=gt|2,ie=At|1,ne=At|2;class To{constructor(t,e){this.boardtype={expandup:[D|bt,I|bt],expanddn:[D|ft,I|ft],expandlt:[D|pt,I|pt],expandrt:[D|mt,I|mt],reduceup:[I|bt,D|bt],reducedn:[I|ft,D|ft],reducelt:[I|pt,D|pt],reducert:[I|mt,D|mt],turnl:[gt|2,gt|1],turnr:[gt|1,gt|2],flipy:[At|2,At|2],flipx:[At|1,At|1]},this.qnumw=[],this.qnumh=[],this.insex={cell:{1:!0},cross:{},border:{1:!0,2:!0},excell:{1:!0}},this.puzzle=t,Object.assign(this,e)}get board(){return this.puzzle.board}execadjust(t){if(!this.boardtype[t])return;const e=this.puzzle,s=this.board;if(t.indexOf("reduce")===0){if(t==="reduceup"||t==="reducedn"){if(s.rows<=1)return}else if((t==="reducelt"||t==="reducert")&&s.cols<=1)return}e.opemgr.newOperation(),e.painter.suspendAll();const n={x1:0,y1:0,x2:2*s.cols,y2:2*s.rows};this.execadjust_main(this.boardtype[t][1],n),this.addOpe(n,t),s.setminmax(),s.rebuildInfo(),e.painter.resizeCanvas(),e.emit("adjust"),e.painter.unsuspend()}execadjust_main(t,e){const s=this.board;if(this.adjustBoardData(t,e),s.roommgr.hastop&&t&D&&this.reduceRoomNumber(t,e),t&gt){const n=s.cols;s.cols=s.rows,s.rows=n,e={x1:0,y1:0,x2:2*s.cols,y2:2*s.rows}}else t&I&&(t===Oi||t===Ei?s.rows++:(t===Ri||t===Pi)&&s.cols++);["cell","cross","border","excell"].forEach(function(n){t&I?s.exec.expandGroup(n,t):t&D?s.exec.reduceGroup(n,t):s.exec.turnflipGroup(n,t,e)}),t&D&&(t===Ii||t===$i?s.rows--:(t===Gi||t===Qi)&&s.cols--),s.setposAll(),this.adjustBoardData2(t,e)}addOpe(t,e){const s=this.boardtype[e][1],n=this.puzzle;let r;s&Re?r=new En(this.puzzle,t,e):r=new On(this.puzzle,e),n.opemgr.add(r)}expandGroup(t,e){const s=this.board;let n=s.initGroup(t,s.cols,s.rows);const r=s.getGroup(t),o=r.clone();s.setposGroup(t);for(let l=r.length-1;l>=0;l--){let h=r[l];this.isdel(e,h)?(h=s.newObject(t,l),r[l]=h,o.add(h),n--):n>0&&(r[l]=r[l-n])}o.allclear(!1),t==="border"&&this.expandborder(e)}reduceGroup(t,e){const s=this.board;t==="border"&&this.reduceborder(e);let n=0;const r=s.getGroup(t),o=r.clone();for(let h=0;h<r.length;h++){const a=r[h];this.isdel(e,a)?(a.id=h,o.add(a),n++):n>0&&(r[h-n]=r[h])}const l=this.puzzle.opemgr;!l.undoExec&&!l.redoExec&&(l.forceRecord=!0,o.allclear(!0),l.forceRecord=!1);for(let h=0;h<n;h++)r.pop()}isdel(t,e){return!!this.insex[e.group][this.distObj(t,e)]}turnflipGroup(t,e,s){const n=this.board;if(t==="excell")if(n.hasexcell===1&&e&At){const c={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2};e===ne?c.x1=c.x2=-1:e===ie&&(c.y1=c.y2=-1),s=c}else n.hasexcell===2&&(s={x1:-1,y1:-1,x2:s.x2+1,y2:s.y2+1});const r=n.objectinside(t,s.x1,s.y1,s.x2,s.y2),o={},l=s.x1+s.x2,h=s.y1+s.y2;for(let c=0;c<r.length;c++){const u=r[c];let d=-1;switch(e){case ne:d=n.getObjectPos(t,u.bx,h-u.by).id;break;case ie:d=n.getObjectPos(t,l-u.bx,u.by).id;break;case pe:d=n.getObjectPos(t,u.by,h-u.bx).id;break;case me:d=n.getObjectPos(t,l-u.by,u.bx).id;break}o[d]=u}const a=n.getGroup(t);for(const c in o)a[+c]=o[c]}distObj(t,e){const s=this.board;return e.isnull?-1:(t&=15,t===bt?e.by:t===ft?2*s.rows-e.by:t===pt?e.bx:t===mt?2*s.cols-e.bx:-1)}expandborder(t){const e=this.board,s=e.borderAsLine;if(s||!e.puzzle.opemgr.undoExec){const n=new oe;e.setposBorders();const r=s?2:1;for(let o=0;o<e.border.length;o++){const l=e.border[o];if(this.distObj(t,l)!==r)continue;const h=s?this.outerBorder(o,t):this.innerBorder(o,t);this.copyBorder(l,h),n.add(h)}s&&n.allclear(!1)}}reduceborder(t){const e=this.board;if(e.borderAsLine)for(let s=0;s<e.border.length;s++){const n=e.border[s];if(this.distObj(t,n)!==0)continue;const r=this.innerBorder(s,t);this.copyBorder(n,r)}}copyBorder(t,e){t.ques=e.ques,t.qans=e.qans,this.board.borderAsLine&&(t.line=e.line,t.qsub=e.qsub)}innerBorder(t,e){const s=this.board.border[t];if(e&=15,e===bt)return s.relbd(0,2);if(e===ft)return s.relbd(0,-2);if(e===pt)return s.relbd(2,0);if(e===mt)return s.relbd(-2,0);throw new Error("key is invalid")}outerBorder(t,e){const s=this.board.border[t];if(e&=15,e===bt)return s.relbd(0,-2);if(e===ft)return s.relbd(0,2);if(e===pt)return s.relbd(-2,0);if(e===mt)return s.relbd(2,0);throw new Error("key is invalid")}reduceRoomNumber(t,e){const s=[],n=this.board;for(let r=0;r<n.cell.length;r++){const o=n.cell[r];this.insex.cell[this.distObj(t,o)]&&(o.qnum!==-1&&(s.push({cell:o,area:o.room,pos:[o.bx,o.by],val:o.qnum}),o.qnum=-1),o.room.clist.remove(o))}for(let r=0;r<s.length;r++){const o=s[r],l=o.area.clist.getTopCell();if(l.isnull){const h=this.puzzle.opemgr;!h.undoExec&&!h.redoExec&&(h.forceRecord=!0,o.cell.addOpe("qnum",o.val,-1),h.forceRecord=!1)}else l.qnum=o.val}}adjustBoardData(t,e){}adjustBoardData2(t,e){}adjustNumberArrow(t,e){t&Re&&this.adjustCellQdirArrow(t,e)}adjustCellArrow(t,e){t&Re&&(this.board.createCell().numberAsObject?this.adjustCellQnumArrow(t,e):this.adjustCellQdirArrow(t,e))}adjustCellQdirArrow(t,e){const s=this.getTranslateDir(t),n=this.board.cellinside(e.x1,e.y1,e.x2,e.y2);for(let r=0;r<n.length;r++){const o=n[r],l=s[o.qdir];l&&o.setQdir(l)}}adjustCellQnumArrow(t,e){const s=this.getTranslateDir(t),n=this.board.cellinside(e.x1,e.y1,e.x2,e.y2);for(let r=0;r<n.length;r++){const o=n[r],l=s[o.qnum];l&&o.setQnum(l);const h=s[o.anum];h&&o.setAnum(h)}}adjustBorderArrow(t,e){if(t&Re){const s=this.getTranslateDir(t),n=this.board.borderinside(e.x1,e.y1,e.x2,e.y2);for(let r=0;r<n.length;r++){const o=n[r];let l;l=s[o.qdir],l&&o.setQdir(l)}}}getTranslateDir(t){let e={};switch(t){case ne:e={1:2,2:1};break;case ie:e={3:4,4:3};break;case me:e={1:4,2:3,3:1,4:2};break;case pe:e={1:3,2:4,3:2,4:1};break}return e}adjustQues51_1(t,e){const s=e.x1|1,n=e.y1|1;this.qnumw=[],this.qnumh=[];const r=this.board;for(let o=n;o<=e.y2;o+=2){this.qnumw[o]=[r.getex(-1,o).qnum];for(let l=s;l<=e.x2;l+=2){const h=r.getc(l,o);h.is51cell()&&this.qnumw[o].push(h.qnum)}}for(let o=s;o<=e.x2;o+=2){this.qnumh[o]=[r.getex(o,-1).qnum2];for(let l=n;l<=e.y2;l+=2){const h=r.getc(o,l);h.is51cell()&&this.qnumh[o].push(h.qnum2)}}}adjustQues51_2(t,e){const s=e.x1+e.x2,n=e.y1+e.y2,r=e.x1|1,o=e.y1|1;let l;const h=this.board;switch(h.disableInfo(),t){case ne:for(let a=r;a<=e.x2;a+=2){l=1,this.qnumh[a]=this.qnumh[a].reverse(),h.getex(a,-1).setQnum2(this.qnumh[a][0]);for(let c=o;c<=e.y2;c+=2){const u=h.getc(a,c);u.is51cell()&&(u.setQnum2(this.qnumh[a][l]),l++)}}break;case ie:for(let a=o;a<=e.y2;a+=2){l=1,this.qnumw[a]=this.qnumw[a].reverse(),h.getex(-1,a).setQnum(this.qnumw[a][0]);for(let c=r;c<=e.x2;c+=2){const u=h.getc(c,a);u.is51cell()&&(u.setQnum(this.qnumw[a][l]),l++)}}break;case me:for(let a=o;a<=e.y2;a+=2){l=1,this.qnumh[a]=this.qnumh[a].reverse(),h.getex(-1,a).setQnum(this.qnumh[a][0]);for(let c=r;c<=e.x2;c+=2){const u=h.getc(c,a);u.is51cell()&&(u.setQnum(this.qnumh[a][l]),l++)}}for(let a=r;a<=e.x2;a+=2){l=1,h.getex(a,-1).setQnum2(this.qnumw[s-a][0]);for(let c=o;c<=e.y2;c+=2){const u=h.getc(a,c);u.is51cell()&&(u.setQnum2(this.qnumw[s-a][l]),l++)}}break;case pe:for(let a=o;a<=e.y2;a+=2){l=1,h.getex(-1,a).setQnum(this.qnumh[n-a][0]);for(let c=r;c<=e.x2;c+=2){const u=h.getc(c,a);u.is51cell()&&(u.setQnum(this.qnumh[n-a][l]),l++)}}for(let a=r;a<=e.x2;a+=2){l=1,this.qnumw[a]=this.qnumw[a].reverse(),h.getex(a,-1).setQnum2(this.qnumw[a][0]);for(let c=o;c<=e.y2;c+=2){const u=h.getc(a,c);u.is51cell()&&(u.setQnum2(this.qnumw[a][l]),l++)}}break}h.enableInfo()}getAfterPos(t,e,s){const n=this.puzzle.board,r=e.x1+e.x2,o=e.y1+e.y2,l=s.bx,h=s.by;let a,c;switch(t){case ne:a=l,c=o-h;break;case ie:a=r-l,c=h;break;case me:a=o-h,c=l;break;case pe:a=h,c=r-l;break;case Oi:a=l,c=h+(h===n.minby?0:2);break;case Ei:a=l,c=h+(h===n.maxby?2:0);break;case Ri:a=l+(l===n.minbx?0:2),c=h;break;case Pi:a=l+(l===n.maxbx?2:0),c=h;break;case Ii:a=l,c=h-(h<=n.minby+2?0:2);break;case $i:a=l,c=h-(h>=n.maxby-2?2:0);break;case Gi:a=l-(l<=n.minbx+2?0:2),c=h;break;case Qi:a=l-(l>=n.maxbx-2?2:0),c=h;break;default:a=l,c=h;break}return{pos:new Z(this.puzzle,a,c),isdel:this.isdel(t,s)}}}class ai{constructor(t,e){this.falling=!1,this.cols=10,this.rows=10,this.hascross=2,this.hasborder=0,this.hasexcell=0,this.borderAsLine=!1,this.disable_subclear=!1,this.subclearmode=!1,this.puzzle=t,this.minbx=0,this.minby=0,this.maxbx=0,this.maxby=0,this.rows=10,this.cols=10,this.hasexcell=0,this.diserror=0,this.hasborder=0,this.borderAsLine=!1,this.haserror=!1,this.hasinfo=!1,this.celloption=e==null?void 0:e.cell,Object.assign(this,e==null?void 0:e.board),this.celloption=(e==null?void 0:e.cell)||void 0,this.borderoption=(e==null?void 0:e.border)||void 0,this.excelloption=(e==null?void 0:e.excell)||void 0,this.cell=new A,this.cross=new _e,this.border=new oe,this.excell=new Is,this.nullobj=new he(this.puzzle),this.emptycell=this.createCell(),this.emptycross=this.createCross(),this.emptyborder=this.createBorder(),this.emptyexcell=this.createEXCell(),this.createExtraObject(),this.disrecinfo=0,this.infolist=[],this.linegraph=this.addInfoListInstance(this.createLineGraph(e==null?void 0:e.lineGraph,e==null?void 0:e.graphComponent)),this.roommgr=this.addInfoListInstance(this.createAreaRoomGraph(e==null?void 0:e.areaRoomGraph,e==null?void 0:e.graphComponent)),this.sblkmgr=this.addInfoListInstance(this.createAreaShadeGraph(e==null?void 0:e.areaShadeGraph,e==null?void 0:e.graphComponent)),this.ublkmgr=this.addInfoListInstance(this.createAreaUnshadeGraph(e==null?void 0:e.areaUnshadeGraph,e==null?void 0:e.graphComponent)),this.nblkmgr=this.addInfoList(Qn),this.addExtraInfo(),this.exec=this.createBoardExec(e==null?void 0:e.boardExec),this.exec.insex.cross=this.hascross===1?{2:!0}:{0:!0},this.trialstage=0}createLineGraph(t,e){return t&&(t.enabled=!0),new Lo(this.puzzle,t,e)}createAreaRoomGraph(t,e){return t&&(t.enabled=!0),new Mn(this.puzzle,t,e)}createAreaShadeGraph(t,e){return t&&(t.enabled=!0),new Gn(this.puzzle,t,e)}createAreaUnshadeGraph(t,e){return t&&(t.enabled=!0),new jo(this.puzzle,t,e)}createBoardExec(t){return new To(this.puzzle,t)}addInfoListInstance(t,e){return(t.enabled||e)&&(t.enabled=!0,this.infolist.push(t)),t}addInfoList(t){const e=new t(this.puzzle);return e.enabled&&this.infolist.push(e),e}addExtraInfo(){}initBoardSize(t,e){(t===void 0||Number.isNaN(t))&&(t=this.cols),(e===void 0||Number.isNaN(e))&&(e=this.rows),this.allclear(!1),this.initGroup("cell",t,e),this.initGroup("cross",t,e),this.initGroup("border",t,e),this.initGroup("excell",t,e),this.cols=t,this.rows=e,this.setminmax(),this.setposAll(),this.initExtraObject(t,e),this.rebuildInfo(),this.puzzle.cursor.initCursor(),this.puzzle.opemgr.allerase()}createCell(){return new hi(this.puzzle,this.celloption)}createCross(){return new So(this.puzzle)}createBorder(){return new _o(this.puzzle,this.borderoption)}createEXCell(){return new Rn(this.puzzle,this.excelloption)}createExtraObject(){}initExtraObject(t,e){}initGroup(t,e,s){const n=this.getGroup(t),r=this.estimateSize(t,e,s),o=n.length;if(o>r)for(let l=o-1;l>=r;l--)n.pop();else if(o<r){const l=n.clone();for(let h=o;h<r;h++){const a=this.newObject(t,h);n.add(a),l.add(a)}l.allclear(!1)}return r-o}getGroup(t){return t==="cell"?this.cell:t==="cross"?this.cross:t==="border"?this.border:t==="excell"?this.excell:new Gt}estimateSize(t,e,s){if(t==="cell")return e*s;if(t==="cross")return(e+1)*(s+1);if(t==="border"){if(this.hasborder===1)return 2*e*s-(e+s);if(this.hasborder===2)return 2*e*s+(e+s)}else if(t==="excell"){if(this.hasexcell===1)return e+s+(this.emptyexcell.ques===51?1:0);if(this.hasexcell===2)return 2*(e+s)}return 0}newObject(t,e){let s=this.nullobj;return t==="cell"?s=this.createCell():t==="cross"?s=this.createCross():t==="border"?s=this.createBorder():t==="excell"&&(s=this.createEXCell()),s!==this.nullobj&&e!==void 0&&(s.id=e),s}setposAll(){this.setposCells(),this.setposCrosses(),this.setposBorders(),this.setposEXcells()}setposGroup(t){t==="cell"?this.setposCells():t==="cross"?this.setposCrosses():t==="border"?this.setposBorders():t==="excell"&&this.setposEXcells()}setposCells(){const t=this.cols;for(let e=0;e<this.cell.length;e++){const s=this.cell[e];s.id=e,s.isnull=!1,s.bx=e%t*2+1,s.by=(e/t<<1)+1,s.initAdjacent(),s.initAdjBorder()}}setposCrosses(){const t=this.cols;for(let e=0;e<this.cross.length;e++){const s=this.cross[e];s.id=e,s.isnull=!1,s.bx=e%(t+1)*2,s.by=e/(t+1)<<1,s.initAdjBorder()}}setposBorders(){const t=this.cols,e=this.rows,s=2*t*e-t-e;for(let n=0;n<this.border.length;n++){const r=this.border[n];let o=n;r.id=n,r.isnull=!1,o>=0&&o<(t-1)*e&&(r.bx=o%(t-1)*2+2,r.by=(o/(t-1)<<1)+1),o-=(t-1)*e,o>=0&&o<t*(e-1)&&(r.bx=o%t*2+1,r.by=(o/t<<1)+2),o-=t*(e-1),this.hasborder===2&&(o>=0&&o<t&&(r.bx=o*2+1,r.by=0),o-=t,o>=0&&o<t&&(r.bx=o*2+1,r.by=2*e),o-=t,o>=0&&o<e&&(r.bx=0,r.by=o*2+1),o-=e,o>=0&&o<e&&(r.bx=2*t,r.by=o*2+1),o-=e),r.isvert=!(r.bx&1),r.inside=n<s,r.initSideObject()}}setposEXcells(){const t=this.cols,e=this.rows;for(let s=0;s<this.excell.length;s++){const n=this.excell[s];let r=s;n.id=s,n.isnull=!1,this.hasexcell===1?(r>=0&&r<t&&(n.bx=r*2+1,n.by=-1),r-=t,r>=0&&r<e&&(n.bx=-1,n.by=r*2+1),r-=e,r===0&&n.ques===51&&(n.bx=-1,n.by=-1),r--):this.hasexcell===2&&(r>=0&&r<t&&(n.bx=r*2+1,n.by=-1),r-=t,r>=0&&r<t&&(n.bx=r*2+1,n.by=2*e+1),r-=t,r>=0&&r<e&&(n.bx=-1,n.by=r*2+1),r-=e,r>=0&&r<e&&(n.bx=2*t+1,n.by=r*2+1),r-=e),n.initAdjacent()}}setminmax(){const t=this.hasexcell>0,e=this.hasexcell===2;this.minbx=t?-2:0,this.minby=t?-2:0,this.maxbx=e?2*this.cols+2:2*this.cols,this.maxby=e?2*this.rows+2:2*this.rows,this.puzzle.cursor.setminmax()}allclear(t){this.cell.allclear(t),this.cross.allclear(t),this.border.allclear(t),this.excell.allclear(t),t&&this.puzzle.opemgr.rejectTrial(!0)}ansclear(){const t=this.puzzle.opemgr;t.newOperation(),t.add(new Dn(this.puzzle)),this.cell.ansclear(),this.cross.ansclear(),this.border.ansclear(),this.excell.ansclear(),t.rejectTrial(!0),t.history[t.history.length-1].length===1&&(t.puzzle.undo(),t.removeDescendant()),this.rebuildInfo()}subclear(){this.puzzle.opemgr.newOperation(),this.subclearmode=!0,this.cell.subclear(),this.cross.subclear(),this.border.subclear(),this.excell.subclear(),this.subclearmode=!1}errclear(){const t=this.haserror||this.hasinfo;return t&&(this.cell.errclear(),this.cross.errclear(),this.border.errclear(),this.excell.errclear(),this.haserror=!1,this.hasinfo=!1),t}trialclear(t=!1){(this.trialstage>0||t)&&(this.cell.trialclear(),this.cross.trialclear(),this.border.trialclear(),this.excell.trialclear(),this.puzzle.redraw(),this.trialstage=0)}getObjectPos(t,e,s){let n=this.nullobj;return t==="cell"?n=this.getc(e,s):t==="cross"?n=this.getx(e,s):t==="border"?n=this.getb(e,s):t==="excell"?n=this.getex(e,s):t==="obj"&&(n=this.getobj(e,s)),n}getc(t,e){let s=null;const n=this.cols,r=this.rows;return t<0||t>n<<1||e<0||e>r<<1||!(t&1)||!(e&1)||(s=(t>>1)+(e>>1)*n),s!==null?this.cell[s]:this.emptycell}getx(t,e){let s=null;const n=this.cols,r=this.rows;return t<0||t>n<<1||e<0||e>r<<1||t&1||e&1||(s=(t>>1)+(e>>1)*(n+1)),this.hascross!==0?s!==null?this.cross[s]:this.emptycross:this.emptycross}getb(t,e){let s=null;const n=this.cols,r=this.rows;return this.hasborder&&t>=1&&t<=2*n-1&&e>=1&&e<=2*r-1?!(t&1)&&e&1?s=(t>>1)-1+(e>>1)*(n-1):t&1&&!(e&1)&&(s=(t>>1)+((e>>1)-1)*n+(n-1)*r):this.hasborder===2&&(e===0&&t&1&&t>=1&&t<=2*n-1?s=(n-1)*r+n*(r-1)+(t>>1):e===2*r&&t&1&&t>=1&&t<=2*n-1?s=(n-1)*r+n*(r-1)+n+(t>>1):t===0&&e&1&&e>=1&&e<=2*r-1?s=(n-1)*r+n*(r-1)+2*n+(e>>1):t===2*n&&e&1&&e>=1&&e<=2*r-1&&(s=(n-1)*r+n*(r-1)+2*n+r+(e>>1))),s!==null?this.border[s]:this.emptyborder}getex(t,e){let s=null;const n=this.cols,r=this.rows;return this.hasexcell===1?this.emptyexcell.ques===51&&t===-1&&e===-1?s=n+r:e===-1&&t>0&&t<2*n?s=t>>1:t===-1&&e>0&&e<2*r&&(s=n+(e>>1)):this.hasexcell===2&&(e===-1&&t>0&&t<2*n?s=t>>1:e===2*r+1&&t>0&&t<2*n?s=n+(t>>1):t===-1&&e>0&&e<2*r?s=2*n+(e>>1):t===2*n+1&&e>0&&e<2*r&&(s=2*n+r+(e>>1))),s!==null?this.excell[s]:this.emptyexcell}getobj(t,e){if(t+e&1)return this.getb(t,e);if(!(t&1)&&!(e&1))return this.getx(t,e);const s=this.getc(t,e);return s!==this.emptycell||!this.hasexcell?s:this.getex(t,e)}operate(t){this.exec.execadjust(t)}objectinside(t,e,s,n,r){return t==="cell"?this.cellinside(e,s,n,r):t==="cross"?this.crossinside(e,s,n,r):t==="border"?this.borderinside(e,s,n,r):t==="excell"?this.excellinside(e,s,n,r):new Gt}cellinside(t,e,s,n){const r=new A;for(let o=e|1;o<=n;o+=2)for(let l=t|1;l<=s;l+=2){const h=this.getc(l,o);h.isnull||r.add(h)}return r}crossinside(t,e,s,n){const r=new _e;if(this.hascross)for(let o=e+(e&1);o<=n;o+=2)for(let l=t+(t&1);l<=s;l+=2){const h=this.getx(l,o);h.isnull||r.add(h)}return r}borderinside(t,e,s,n){const r=new oe;if(this.hasborder)for(let o=e;o<=n;o++)for(let l=t+(t+o&1^1);l<=s;l+=2){const h=this.getb(l,o);h.isnull||r.add(h)}return r}excellinside(t,e,s,n){const r=new Is;if(this.hasexcell){e<-1&&(e=-1);for(let o=e|1;o<=n;o+=2)for(let l=t|1;l<=s;l+=2){const h=this.getex(l,o);h.isnull||r.add(h)}}return r}disableInfo(){this.puzzle.opemgr.disableRecord(),this.disrecinfo++}enableInfo(){this.puzzle.opemgr.enableRecord(),this.disrecinfo>0&&this.disrecinfo--}isenableInfo(){return this.disrecinfo===0}rebuildInfo(){this.infolist.forEach(function(t){t.rebuild()})}modifyInfo(t,e){if(this.isenableInfo())for(let s=0;s<this.infolist.length;++s){const n=this.infolist[s];n.relation[e]&&n.modifyInfo(t,e)}}irowakeRemake(){for(let t=0;t<this.infolist.length;++t){const e=this.infolist[t];e.coloring&&e.newIrowake()}}disableSetError(){this.diserror++}enableSetError(){this.diserror--}isenableSetError(){return this.diserror<=0}freezecopy(){const t={cell:[],cross:[],border:[],excell:[]};for(const e in t){const s=e;for(let n=0;n<this[s].length;n++)t[s].push(this[s][n].getprops())}return t}compareData(t,e){for(const s in t){const n=s;if(this[n])for(let r=0;r<t[n].length;r++)this[n][r]&&this[n][r].compare(t[n][r],e)}}}class Bo{constructor(t,e){this.allowempty=!1,this.multierr=!1,this.forceallcell=!1,this.failcodemode=!1,this.failcode=null,this._info=null,this.checklist=[],this.checklist_normal=[],this.checklist_auto=[],this.board=t,this.inCheck=!1,this.checkOnly=!1,Object.assign(this,e),this.checklist.push(...this.getCheckList()),this.makeCheckList()}getCheckList(){return[]}makeCheckList(){const t=this.checklist;let e=[];for(let s=0;s<t.length;s++){let n=t[s],r=0;r=(n.match(/\+/)||[]).length,n=n.replace(/\+/g,""),this[n]||console.warn(`anscheck warning: ${n} is null!`),e.push([this[n],r])}this.checklist_normal=[];for(let s=0;s<e.length;s++)this.checklist_normal.push(e[s][0]);e=e.sort(function(s,n){return n[1]-s[1]}),this.checklist_auto=[];for(let s=0;s<e.length;s++)this.checklist_auto.push(e[s][0])}check(t){const e=this.board;return this.inCheck=!0,t?(this.checkOnly=!1,this.checkAns(!1),this.failcode.complete||(e.haserror=!0,this.failcode.shouldForceRedraw=!0)):(this.failcode===void 0||this.failcodemode!==t)&&(e.disableSetError(),this.checkOnly=!0,this.checkAns(t===!1),this.failcodemode=t,e.enableSetError()),this.inCheck=!1,this.failcode}checkAns(t){this.failcode=new Do;const e=!this.multierr||t,s=this.checkOnly&&e?this.checklist_auto:this.checklist_normal;for(let n=0;n<s.length&&(s[n].call(this),!(e&&this.failcode.list.length>0));n++);}resetCache(){this.failcode=null,this.failcodemode=!1,this._info={}}checkAllCell(t,e){for(let s=0;s<this.board.cell.length;s++){const n=this.board.cell[s];if(t(n)){if(this.failcode.add(e),this.checkOnly)break;n.seterr(1)}}}checkNoNumCell(){this.checkAllCell(function(t){return t.ques===0&&t.noNum()},"ceNoNum")}checkIceLines(){this.checkAllCell(function(t){return t.ice()&&t.isLineCurve()},"lnCurveOnIce")}checkNotCrossOnMark(){this.checkAllCell(function(t){return t.lcnt!==4&&t.ques===11},"lnNotCrossMk")}checkLineOnShadeCell(){this.checkAllCell(function(t){return(t.ques===1||t.qans===1)&&t.lcnt>0},"lnOnShade")}checkNoLineObject(){this.checkAllCell(function(t){return t.lcnt===0&&t.isNum()},"nmNoLine")}checkLineOverLetter(){this.checkAllCell(function(t){return t.lcnt>=2&&t.isNum()},this.board.linegraph.moveline?"laOnNum":"lcOnNum")}checkDir4Cell(t,e,s){for(let n=0;n<this.board.cell.length;n++){const r=this.board.cell[n];if(!r.isValidNum())continue;const o=r.getNum(),l=r.countDir4Cell(t);if(!(e===0&&o===l||e===1&&o<=l||e===2&&o>=l)){if(this.failcode.add(s),this.checkOnly)break;r.seterr(1)}}}checkSideCell(t,e){let s=!0;const n=this.board;for(let r=0;r<n.cell.length;r++){const o=n.cell[r];let l=o.adjacent.right;if(o.bx<n.maxbx-1&&t(o,l)){if(s=!1,this.checkOnly)break;o.seterr(1),l.seterr(1)}if(l=o.adjacent.bottom,o.by<n.maxby-1&&t(o,l)){if(s=!1,this.checkOnly)break;o.seterr(1),l.seterr(1)}}s||this.failcode.add(e)}checkAdjacentShadeCell(){this.checkSideCell(function(t,e){return t.isShade()&&e.isShade()},"csAdjacent")}checkAdjacentDiffNumber(){this.checkSideCell(function(t,e){return t.sameNumber(e)},"nmAdjacent")}check2x2Block(t,e){const s=this.board;for(let n=0;n<s.cell.length;n++){const r=s.cell[n];if(r.bx>=s.maxbx-1||r.by>=s.maxby-1)continue;const o=r.bx,l=r.by,h=s.cellinside(o,l,o+2,l+2).filter(t);if(!(h.length<4)){if(this.failcode.add(e),this.checkOnly)break;h.seterr(1)}}}check2x2ShadeCell(){this.check2x2Block(function(t){return t.isShade()},"cs2x2")}check2x2UnshadeCell(){this.check2x2Block(function(t){return t.isUnshade()},"cu2x2")}checkSameColorTile(){this.checkSameObjectInRoom(this.board.roommgr,function(t){return t.isShade()?1:2},"bkMixed")}checkConnectShade(){this.checkOneArea(this.board.sblkmgr,"csDivide")}checkConnectUnshade(){this.checkOneArea(this.board.ublkmgr,"cuDivide")}checkConnectNumber(){this.checkOneArea(this.board.nblkmgr,"nmDivide")}checkOneArea(t,e){t.components.length>1&&(this.failcode.add(e),t.components[0].getnodeobjs().seterr(1))}checkConnectUnshadeRB(){if(this.board.ublkmgr.components.length>1){this.failcode.add("cuDivideRB");const t=new A,e=this.board.cell.filter(function(s){return s.isShade()});for(let s=0;s<e.length;s++){const n=e[s],r=n.getdir4clist();let o=null;for(let l=0;l<r.length;l++){const h=r[l][0];if(o===null)o=h.ublk;else if(o!==h.ublk){t.add(n);break}}}t.seterr(1)}}checkShadeCellExist(){if(!this.allowempty){const t=this.board;if(t.sblkmgr.enabled){if(t.sblkmgr.components.length>0)return}else if(t.ublkmgr.enabled){if(t.ublkmgr.components.length===0||t.ublkmgr.components[0].nodes.length!==t.cell.length)return}else if(t.cell.some(function(e){return e.isShade()}))return;this.failcode.add("brNoShade")}}checkOneLoop(){const t=this.board,e=t.linegraph.components;e.length>1&&(this.failcode.add("lnPlLoop"),t.border.setnoerr(),e[0].setedgeerr(1))}checkNumberExist(){if(!this.allowempty){if(this.board.cell.some(function(t){return t.isValidNum()}))return;this.failcode.add("brNoValidNum")}}checkConnectAllNumber(){const t=this.board,e=t.linegraph.components;e.length>1&&(this.failcode.add("lcDivided"),t.border.setnoerr(),e[0].setedgeerr(1),e[0].clist.seterr(4))}checkLineExist(){if(!this.allowempty){const t=this.board;if(t.linegraph.ltotal[0]!==(t.borderAsLine?t.cross:t.cell).length)return;this.failcode.add("brNoLine")}}checkCrossLine(){this.checkLineCount(4,"lnCross")}checkBranchLine(){this.checkLineCount(3,"lnBranch")}checkDeadendLine(){this.checkLineCount(1,"lnDeadEnd")}checkNoLine(){this.checkLineCount(0,"ceNoLine")}checkLineCount(t,e){let s=!0;const n=this.board;if(n.linegraph.ltotal[t])if(!n.borderAsLine)this.checkAllCell(function(r){return r.lcnt===t},e);else{const r=n.cross;for(let o=0;o<r.length;o++){const l=r[o];if(l.lcnt===t){if(s=!1,this.checkOnly)break;l.seterr(1),n.borderinside(l.bx-1,l.by-1,l.bx+1,l.by+1).seterr(1)}}s||(this.failcode.add(e),n.border.setnoerr())}}checkCrossConnectLine(){this.checkConnectLineCount(4,"lnCross")}checkBranchConnectLine(){this.checkConnectLineCount(3,"lnBranch")}checkDeadendConnectLine(){this.checkConnectLineCount(1,"lnDeadEnd")}checkConnectLineCount(t,e){this.board.linegraph.ltotal[t]&&this.checkAllCell(function(s){return s.noNum()&&s.lcnt===t},e)}checkenableLineParts(){const t=this.board;for(let e=0;e<t.cell.length;e++){const s=t.cell[e],n=s.adjborder;if(!((!n.top.isLine()||!s.noLP(b.UP))&&(!n.bottom.isLine()||!s.noLP(b.DN))&&(!n.left.isLine()||!s.noLP(b.LT))&&(!n.right.isLine()||!s.noLP(b.RT)))){if(this.failcode.add("ceAddLine"),this.checkOnly)break;s.seterr(1)}}}checkAllArea(t,e,s){this.checkAllBlock(t,null,e,s)}checkAllBlock(t,e,s,n,r=1){const o=t.components;for(let l=0;l<o.length;l++){const h=o[l],a=h.clist,c=h.top?h.top:a.getQnumCell(),u=a.getRectSize(),d=(e?a.filter(e):a).length,f=c&&!c.isnull?c.qnum:-1;if(!s(u.cols,u.rows,d,f)){if(this.failcode.add(n),this.checkOnly)break;o!==this.board.linegraph?a.seterr(r):(this.board.border.setnoerr(),h.objs.seterr(1))}}}checkNumberAndSize(){this.checkAllArea(this.board.roommgr,function(t,e,s,n){return n<=0||n===s},"bkSizeNe")}checkRoomRect(){this.checkAllArea(this.board.roommgr,function(t,e,s,n){return t*e===s},"bkNotRect")}checkNoNumber(){this.checkAllBlock(this.board.roommgr,function(t){return t.isNum()},function(t,e,s,n){return s!==0},"bkNoNum")}checkDoubleNumber(){this.checkAllBlock(this.board.roommgr,function(t){return t.isNum()},function(t,e,s,n){return s<2},"bkNumGe2")}checkShadeCellCount(){this.checkAllBlock(this.board.roommgr,function(t){return t.isShade()},function(t,e,s,n){return n<0||n===s},"bkShadeNe")}checkNoShadeCellInArea(){this.checkAllBlock(this.board.roommgr,function(t){return t.isShade()},function(t,e,s,n){return s>0},"bkNoShade")}checkLinesInArea(t,e,s){this.checkAllBlock(t,function(n){return n.lcnt>0},e,s)}checkNoMovedObjectInRoom(t){this.checkAllBlock(t,function(e){return e.base.qnum!==-1},function(e,s,n,r){return n!==0},"bkNoNum")}checkDisconnectLine(){this.checkConnectObjectCount(function(t){return t>0},this.board.linegraph.moveline?"laIsolate":"lcIsolate")}checkConnectObject(){this.checkConnectObjectCount(function(t){return t<2},"nmConnected")}checkTripleObject(){this.checkConnectObjectCount(function(t){return t<3},"lcTripleNum")}checkConnectObjectCount(t,e){let s=!0;const n=this.board.linegraph.components;for(let r=0;r<n.length;r++){const o=n[r].clist;if(!t(o.filter(function(l){return l.isNum()}).length)){if(s=!1,this.checkOnly)break;this.board.border.setnoerr(),n[r].setedgeerr(1),n[r].clist.seterr(4)}}s||(this.failcode.add(e),this.board.border.setnoerr())}checkSideAreaSize(t,e,s){const n=t.getSideAreaInfo();for(let r=0;r<n.length;r++){const o=e(n[r][0]),l=e(n[r][1]);if(!(o<=0||l<=0||o!==l)){if(this.failcode.add(s),this.checkOnly)break;n[r][0].clist.seterr(1),n[r][1].clist.seterr(1)}}}checkSideAreaCell(t,e,s){for(let n=0;n<this.board.border.length;n++){const r=this.board.border[n];if(!r.isBorder())continue;const o=r.sidecell[0],l=r.sidecell[1];if(!(o.isnull||l.isnull||!t(o,l))){if(this.failcode.add(s),this.checkOnly)break;e?(o.room.clist.seterr(1),l.room.clist.seterr(1)):(o.seterr(1),l.seterr(1))}}}checkSameObjectInRoom(t,e,s){const n=t.components;t:for(let r=0;r<n.length;r++){const o=n[r].clist;let l=-1;for(let h=0;h<o.length;h++){const a=o[h],c=e(a);if(!(c===-1||l===c))if(l===-1)l=c;else{if(this.failcode.add(s),this.checkOnly)break t;n!==this.board.linegraph.components?o.seterr(1):(this.board.border.setnoerr(),n[r].setedgeerr(1))}}}}checkDifferentNumberInRoom(){this.checkDifferentNumberInRoom_main(this.board.roommgr,this.isDifferentNumberInClist)}checkDifferentNumberInRoom_main(t,e){const s=t.components;for(let n=0;n<s.length;n++){const r=s[n].clist;if(!e.call(this,r)){if(this.failcode.add("bkDupNum"),this.checkOnly)break;r.seterr(1)}}}isDifferentNumberInClist(t){return this.isIndividualObject(t,function(e){return e.getNum()})}isDifferentAnsNumberInClist(t){return this.isIndividualObject(t,function(e){return e.anum})}isIndividualObject(t,e){if(t.length<=0)return!0;let s=!0;const n=[],r=[];let o=-1;const l=t[0].getminnum();for(let a=0;a<t.length;a++)o<e(t[a])&&(o=e(t[a]));for(let a=l;a<=o;a++)n[a]=0;for(let a=0;a<t.length;a++)r[t[a].id]=e(t[a]);for(let a=0;a<t.length;a++)r[t[a].id]>=l&&n[r[t[a].id]]++;const h=t.filter(function(a){return r[a.id]>=l&&n[r[a.id]]>=2});return h.length>0&&(h.seterr(1),s=!1),s}checkRowsCols(t,e){let s=!0;const n=this.board;t:do{for(let r=1;r<=n.maxby;r+=2){const o=n.cellinside(n.minbx+1,r,n.maxbx-1,r);if(!t.call(this,o)&&(s=!1,this.checkOnly))break t}for(let r=1;r<=n.maxbx;r+=2){const o=n.cellinside(r,n.minby+1,r,n.maxby-1);if(!t.call(this,o)&&(s=!1,this.checkOnly))break t}}while(!1);s||this.failcode.add(e)}checkDifferentNumberInLine(){this.checkRowsCols(this.isDifferentNumberInClist,"nmDupRow")}checkRowsColsPartly(t,e,s){let n=!0;const r=this.board;let o={keycell:null,key51num:0,isvert:!1};t:do{o={keycell:null,key51num:-1,isvert:!1};for(let l=1;l<=r.maxby;l+=2)for(let h=1;h<=r.maxbx;h+=2){let a;for(a=h;a<=r.maxbx&&!e(r.getc(a,l));a+=2);if(o.keycell=r.getobj(h-2,l),o.key51num=o.keycell.qnum,a>h&&!t.call(this,r.cellinside(h,l,a-2,l),o,r)&&(n=!1,this.checkOnly))break t;h=a}o={keycell:null,key51num:-1,isvert:!0};for(let l=1;l<=r.maxbx;l+=2)for(let h=1;h<=r.maxby;h+=2){let a;for(a=h;a<=r.maxby&&!e(r.getc(l,a));a+=2);if(o.keycell=r.getobj(l,h-2),o.key51num=o.keycell.qnum2,a>h&&!t.call(this,r.cellinside(l,h,l,a-2),o,r)&&(n=!1,this.checkOnly))break t;h=a}}while(!1);n||this.failcode.add(s)}checkRowsColsFor51cell(t,e){this.checkRowsColsPartly(t,function(s){return s.is51cell()},e)}checkBorderCross(){this.checkBorderCount(4,0,"bdCross")}checkBorderDeadend(){this.checkBorderCount(1,0,"bdDeadEnd")}checkBorderCount(t,e,s){let n=!0;const r=this.board,o=r.hascross===2?r.cross:r.crossinside(r.minbx+2,r.minby+2,r.maxbx-2,r.maxby-2);for(let l=0;l<o.length;l++){const h=o[l];if(!(h.lcnt!==t||e===1&&h.qnum!==1||e===2&&h.qnum===1)){if(n=!1,this.checkOnly)break;h.setCrossBorderError()}}n||(this.failcode.add(s),r.border.setnoerr())}checkLineShape(t,e){let s=!0;const n=this.getLineShapeInfo();for(let r=0;r<n.length;r++){const o=n[r];if(!o||!t(o))continue;if(s=!1,this.checkOnly)break;const l=o.cells;l[0]&&l[0]!==null&&l[0].seterr(1),l[1]&&l[1]!==null&&l[1].seterr(1),o.objs.seterr(1)}s||(this.failcode.add(e),this.board.border.setnoerr())}checkLineShapeDeadend(){this.checkLineShape(function(t){return t.cells[1].isnull},"lcDeadEnd")}getLineShapeInfo(){if(this._info.num)return this._info.num;const t=this.board,e=[],s=[];for(let r=0;r<t.border.length;r++)s[r]=!1;const n=t.cell.filter(function(r){return r.isNum()});for(let r=0;r<n.length;r++){const o=n[r],l=o.adjborder,h=[l.top,l.bottom,l.left,l.right];for(let a=0;a<4;a++){if(h[a].isnull)continue;const c=this.serachLineShapeInfo(o,a+1,s);c&&e.push(c)}}return this._info.num=e,e}serachLineShapeInfo(t,e,s){const n={objs:new oe,cells:[t,null],ccnt:0,length:[],dir1:e,dir2:0},r=t.getaddr();for(;;)if(r.movedir(e,1),r.oncell()){const o=r.getc(),l=o.adjborder;if(o.isnull||t===o||o.isNum())break;this.board.linegraph.iscrossing(o)&&o.lcnt>=3||(e!==1&&l.bottom.isLine()?(e!==2&&n.ccnt++,e=2):e!==2&&l.top.isLine()?(e!==1&&n.ccnt++,e=1):e!==3&&l.right.isLine()?(e!==4&&n.ccnt++,e=4):e!==4&&l.left.isLine()&&(e!==3&&n.ccnt++,e=3))}else{const o=r.getb();if(o.isnull||!o.isLine()||s[o.id])break;n.objs.add(o),s[o.id]=!0,Number.isNaN(n.length[n.ccnt])?n.length[n.ccnt]=1:n.length[n.ccnt]++}return n.objs.length>0?(n.cells[1]=r.getc(),n.dir2=[0,2,1,4,3][e],n):null}}class Do{constructor(){this.complete=!0,this.text="",this.shouldForceRedraw=!1,this.lastcode=null,this.list=[]}add(t){t&&(t!==this.lastcode&&(this.list.push(t),this.lastcode=t),this.complete=!1)}gettext(t,e){const s=[],n=(e||jt.lang)==="ja"?0:1;if(this.list.length===0)return t.get("complete")[n];for(let r=0;r<this.list.length;r++){const o=t.get(this.list[r])||t.get("invalid");s.push(o[n])}return s.join(`
`)}}const Oo=()=>{const i={complete:["正解です！","Complete!"],invalid:["不明なエラーです","Invalid Error"],cs2x2:["2x2の黒マスのかたまりがあります。","There is a 2x2 block of shaded cells."],cu2x2:["2x2の白マスのかたまりがあります。","There is a 2x2 block of unshaded cells."],csNotSquare:["正方形でない黒マスのカタマリがあります。","A mass of shaded cells is not regular rectangle."],csAdjacent:["黒マスがタテヨコに連続しています。","Shaded cells are adjacent."],csDivide:["黒マスが分断されています。","Shaded cells are divided,"],cuDivide:["白マスが分断されています。","Unshaded cells are divided."],cuDivideRB:["白マスが分断されています。","Unshaded cells are divided."],brNoShade:["盤面に黒マスがありません。","There are no shaded cells on the board."],bkNoNum:["数字のないブロックがあります。","A block has no number."],bkNumGe2:["1つのブロックに2つ以上の数字が入っています。","A block has plural numbers."],bkDupNum:["同じブロックに同じ数字が入っています。","There are same numbers in a block."],bkPlNum:["複数種類の数字が入っているブロックがあります。","A block has two or more kinds of numbers."],bkSepNum:["同じ数字が異なるブロックに入っています。","One kind of numbers is included in dirrerent blocks."],bkSizeNe:["数字とブロックの大きさが違います。","The size of the block is not equal to the number."],bkShadeNe:["部屋の数字と黒マスの数が一致していません。","The number of shaded cells in the room and The number written in the room is different."],bkShadeDivide:["1つの部屋に入る黒マスが2つ以上に分裂しています。","Shaded cells are divided in one room."],bkNoShade:["黒マスがない部屋があります。","A room has no shaded cell."],bkMixed:["白マスと黒マスの混在したタイルがあります。","A tile includes both shaded and unshaded cells."],bkWidthGt1:["幅が１マスではないタタミがあります。","The width of the tatami is not one."],brNoValidNum:["盤面に数字がありません。","There are no numbers on the board."],brNoLine:["線が引かれていません。","There is no line on the board."],bkNotRect:["四角形ではない部屋があります。","There is a room whose shape is not square."],bdDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],bdCross:["十字の交差点があります。","There is a crossing border line."],lnDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],lnBranch:["分岐している線があります。","There is a branch line."],lnCross:["線が交差しています。","There is a crossing line."],lnNotCrossMk:["十字の場所で線が交差していません。","A cross-joint cell doesn't have four-way lines."],lnCrossExIce:["氷の部分以外で線が交差しています。","A Line is crossed outside of ice."],lnCurveOnIce:["氷の部分で線が曲がっています。","A Line curve on ice."],lnPlLoop:["輪っかが一つではありません。","There are plural loops."],lnOnShade:["黒マスの上に線が引かれています。","There is a line on the shaded cell."],lcDeadEnd:["線が途中で途切れています。","There is a dead-end line."],lcDivided:["線が全体で一つながりになっていません。","All lines and numbers are not connected each other."],lcTripleNum:["3つ以上の数字がつながっています。","Three or more numbers are connected."],lcIsolate:["数字につながっていない線があります。","A line doesn't connect any number."],lcOnNum:["数字の上を線が通過しています。","A line goes through a number."],nmNoLine:["どこにもつながっていない数字があります。","A number is not connected another number."],nmConnected:["アルファベットが繋がっています。","There are connected letters."],laIsolate:["アルファベットにつながっていない線があります。","A line doesn't connect any letter."],laOnNum:["アルファベットの上を線が通過しています。","A line goes through a letter."],laCurve:["曲がっている線があります。","A line has curve."],laLenNe:["数字と線の長さが違います。","The length of a line is wrong."],ceNoNum:["数字の入っていないマスがあります。","There is an empty cell."],ceNoLine:["線が引かれていないマスがあります。","There is an empty cell."],ceAddLine:["最初から引かれている線があるマスに線が足されています。","Lines are added to the cell that the mark lie in by the question."],anShadeNe:["矢印の方向にある黒マスの数が正しくありません。","The number of shaded cells are not correct."],nmAdjacent:["同じ数字がタテヨコに連続しています。","Same numbers are adjacent."],nmDupRow:["同じ列に同じ数字が入っています。","There are same numbers in a row."],nmDivide:["タテヨコにつながっていない数字があります。","Numbers are divided."]};return new Map(Object.entries(i))},ci=ys(),vs=ci.API;let ve=["mousedown"],xe=["mousemove"],we=["mouseup"],We=[""];ci.bz.AndroidBrowser&&(ve=[""],xe=[""],we=[""]);vs.pointerevent?(ve=["pointerdown"],xe=["pointermove"],we=["pointerup"],We=["pointercancel"]):vs.mspointerevent?(ve=["MSPointerDown"],xe=["MSPointerMove"],we=["MSPointerUp"],We=["MSPointerCancel"]):vs.touchevent&&(ve.push("touchstart"),xe.push("touchmove"),we.push("touchend"),We.push("touchcancel"));const Mi=function(){return new Date().getTime()},Eo=function(i){return i.style.userSelect="none",i},Ro=function(i,t,e,s,n=!1){let r=[t];return t==="mousedown"?r=ve:t==="mousemove"?r=xe:t==="mouseup"?r=we:t==="mousecancel"&&(r=We),r.forEach(function(o){i.addEventListener(o,s,{passive:!!n})}),function(){r.forEach(function(o){i.removeEventListener(o,s,!!n)})}},Po=function(i){return ui(i)?i.touches.length===1?"left":"":Io(i)&&i.pointerType!=="mouse"?i.isPrimary?"left":"":["left","middle","right"][i.button!==void 0?i.button:i.which-1]||""},ui=function(i){return i.touches!==void 0},Io=function(i){return!!i.pointerType},$o=function(i){return{px:Go(i),py:Qo(i)}},Go=function(i){if(ui(i)){if(i.touches.length>0){const t=i.touches.length;let e=0;if(t>0){for(let s=0;s<t;s++)e+=i.touches[s].pageX;return e/t}}return 0}return i.pageX||0},Qo=function(i){if(ui(i)){if(i.touches.length>0){const t=i.touches.length;let e=0;if(t>0){for(let s=0;s<t;s++)e+=i.touches[s].pageY;return e/t}}return 0}return i.pageY||0},di=function(i){if(!ci.browser)return{top:0,bottom:0,left:0,right:0,height:0,width:0};const t=i.getBoundingClientRect();let e,s;if(window.scrollX!==void 0)e=window.scrollX,s=window.scrollY;else{const u=document.documentElement;e=u.scrollLeft,s=u.scrollTop}const n=t.left+e,r=t.top+s,o=t.right+e,l=t.bottom+s,h=getComputedStyle(i),a=Number.parseFloat(h.paddingLeft)+Number.parseFloat(h.paddingRight),c=Number.parseFloat(h.paddingTop)+Number.parseFloat(h.paddingBottom);return{top:r,bottom:l,left:n,right:o,height:l-r-c,width:o-n-a}};class Qt{constructor(t,e){this.RBShadeCell=!1,this.use=!1,this.bgcolor=!1,this.inputMode="auto",this.savedInputMode={edit:null,play:null},this.inputModes={edit:[],play:[]},this.inversion=!1,this.puzzle=t,this.cursor=t.cursor,this.pid=t.pid,this.enableMouse=!0,this.mouseCell=null,this.firstCell=null,this.inputPoint=new ji(t),this.firstPoint=new ji(t),this.prevPos=new Z(t),this.btn="",this.inputData=null,this.bordermode=!1,this.mousestart=!1,this.mousemove=!1,this.mouseend=!1,this.cancelEvent=!1,this.inputMode="auto",this.savedInputMode={edit:"auto",play:"auto"},Object.assign(this,e),this.mousereset()}get board(){return this.board}mousereset(){const t=this.mouseCell;this.mouseCell=this.firstCell=this.puzzle.board.emptycell,this.firstPoint.reset(),this.prevPos.reset(),this.btn="",this.inputData=null,this.bordermode=!1,this.mousestart=!1,this.mousemove=!1,this.mouseend=!1,this.puzzle.execConfig("dispmove")&&t&&!t.isnull&&t.draw()}modechange(){this.mousereset(),this.inputMode=this.savedInputMode[this.puzzle.editmode?"edit":"play"]}e_mousedown(t){if(!this.enableMouse)return!0;if(this.setMouseButton(t),!this.btn){this.mousereset();return}const e=this.getBoardAddress(t);this.moveTo(e.bx,e.by),t.stopPropagation()}e_mouseup(t){if(!this.enableMouse||!this.btn)return!0;this.inputEnd(),t.stopPropagation()}e_mousemove(t){if(!this.enableMouse||!this.btn)return!0;if(t.touches!==void 0||t.which===void 0||t.which!==0||t.type.match(/pointermove/i)&&t.buttons>0){const e=this.getBoardAddress(t);this.lineTo(e.bx,e.by)}else this.mousereset();t.stopPropagation()}e_mousecancel(t){this.mousereset()}setMouseButton(t){this.btn=Po(t);const e=this.puzzle.key;e.checkmodifiers(t),((e.isSHIFT||e.isMETA)!==this.inversion||this.inputMode==="number-")&&(this.btn==="left"?this.btn="right":this.btn==="right"&&(this.btn="left"))}getBoardAddress(t){const e=this.puzzle.painter;let s={px:Number.NaN,py:Number.NaN};if(!e.context)throw new Error("context is null");if(this.puzzle.canvas.children[0]instanceof SVGSVGElement){const n=this.puzzle.canvas.children[0],r=n.createSVGPoint();r.x=t.clientX,r.y=t.clientY;const o=r.matrixTransform(n.getScreenCTM().inverse());s={px:o.x+e.x0,py:o.y+e.y0}}else if(!jt.env.API.touchevent||jt.env.API.pointerevent||jt.env.OS.iOS)Number.isNaN(t.offsetX)?s={px:t.layerX,py:t.layerY}:s={px:t.offsetX,py:t.offsetY};else{const n=$o(t),r=di(e.context.child);s={px:n.px-r.left,py:n.py-r.top}}return{bx:(s.px-e.x0)/e.bw,by:(s.py-e.y0)/e.bh}}moveTo(t,e){this.inputPoint.init(t,e),this.mouseevent(0)}lineTo(t,e){const s=t-this.inputPoint.bx,n=e-this.inputPoint.by,r=((s>=0?s:-s)+(n>=0?n:-n))*2+.9|0,o=s/r,l=n/r;for(let h=0;h<r-1;h++)this.inputPoint.move(o,l),this.mouseevent(1);this.inputPoint.init(t,e),this.mouseevent(1)}inputEnd(){this.mouseevent(2),this.mousereset()}inputPath(...t){this.mousereset(),this.btn=typeof t[0]=="string"?t.shift():"left",this.moveTo(t[0],t[1]);for(let e=2;e<t.length-1;e+=2)this.lineTo(t[e],t[e+1]);this.inputEnd()}mouseevent(t){this.cancelEvent=!1,this.mousestart=t===0,this.mousemove=t===1,this.mouseend=t===2;const e=this.puzzle;e.emit("mouse"),!this.cancelEvent&&(this.btn==="left"||this.btn==="right")&&(this.mousestart?(e.opemgr.newOperation(),e.errclear()):e.opemgr.newChain(),this.mouseinput())}mouseinput(){let t=this.inputMode;switch(this.puzzle.key.isZ&&this.inputMode.indexOf("info-")===-1&&(this.inputModes.play.indexOf("info-line")>=0?t="info-line":this.inputModes.play.indexOf("info-blk")>=0&&(t="info-blk")),t){case"auto":this.mouseinput_auto();break;case"number":case"number-":this.mouseinput_number();break;case"clear":this.mouseinput_clear();break;case"cell51":this.input51_fixed();break;case"circle-unshade":this.inputFixedNumber(1);break;case"circle-shade":this.inputFixedNumber(2);break;case"undef":this.inputFixedNumber(-2);break;case"ice":this.inputIcebarn();break;case"numexist":this.inputFixedNumber(-2);break;case"numblank":this.inputFixedNumber(-3);break;case"bgcolor":this.inputBGcolor(!0);break;case"subcircle":case"bgcolor1":this.inputFixedQsub(1);break;case"subcross":case"bgcolor2":this.inputFixedQsub(2);break;case"completion":this.mousestart&&this.inputqcmp();break;case"objblank":this.inputDot();break;case"direc":this.inputdirec();break;case"arrow":this.inputarrow_cell();break;case"crossdot":this.mousestart&&this.inputcrossMark();break;case"border":this.inputborder();break;case"subline":this.inputQsubLine();break;case"shade":case"unshade":this.inputcell();break;case"line":this.inputLine();break;case"peke":this.inputpeke();break;case"bar":this.inputTateyoko();break;case"info-line":this.mousestart&&this.dispInfoLine();break;case"info-blk":this.mousestart&&this.dispInfoBlk();break;default:this.mouseinput_other();break}}mouseinput_number(){this.mousestart&&this.inputqnum()}mouseinput_clear(){this.inputclean_cell()}mouseinput_auto(){}mouseinput_other(){}notInputted(){return!this.puzzle.opemgr.changeflag}setInputMode(t){if(t=t||"auto",this.getInputModeList().indexOf(t==="number-"?"number":t)>=0)this.inputMode=t,this.savedInputMode[this.puzzle.editmode?"edit":"play"]=t;else throw`Invalid input mode :${t}`}getInputModeList(t){if(this.puzzle.instancetype==="viewer")return[];t=t||(this.puzzle.editmode?"edit":"play");let e=["auto"];return e=e.concat(this.inputModes[t]),e.indexOf("number")>=0&&e.splice(e.indexOf("number")+1,0,"number-"),e}setInversion(t){this.inversion=!!t}getcell(){return this.getpos(0).getc()}getcell_excell(){const t=this.getpos(0),e=t.getex();return e.isnull?t.getc():e}getcross(){return this.getpos(.5).getx()}getpos(t){const e=this.inputPoint,s=2*t,n=2*(1-t);let r=e.bx+4,o=e.by+4;const l=r%2,h=o%2;return r=(r&-2)+ +(l>=s)+ +(l>=n)-4,o=(o&-2)+ +(h>=s)+ +(h>=n)-4,new Z(this.puzzle,r,o)}getborder(t){const e=this.inputPoint,s=(e.bx&-2)+1,n=(e.by&-2)+1,r=e.bx+1-s,o=e.by+1-n,l=this.puzzle.board;if(l.linegraph.isLineCross)if(l.borderAsLine){const h=2*(.5-t),a=2*(.5+t);if(h<r&&r<a&&h<o&&o<a)return l.emptyborder}else{const h=2*t,a=2*(1-t);if((r<h||a<r)&&(o<h||a<o))return l.emptyborder}return r<2-o?r>o?l.getb(s,n-1):l.getb(s-1,n):r>o?l.getb(s+1,n):l.getb(s,n+1)}isBorderMode(){return this.mousestart&&(this.bordermode=!this.getpos(.25).oncell()),this.bordermode}setcursor(t){const e=this.cursor.getaddr();this.cursor.setaddr(t),e.draw(),t.draw()}setcursorsnum(t){const e=this.cursor.getaddr();this.cursor.setaddr(t);let s=this.inputPoint.bx,n=this.inputPoint.by;s=(s+12)%2*1.5|0,n=(n+12)%2*1.5|0;let r;this.pid!=="factors"?r=[5,0,4,0,0,0,2,0,3][n*3+s]:r=[0,0,4,0,0,0,2,0,3][n*3+s],this.cursor.targetdir!==r&&(this.cursor.targetdir=r),e.draw(),t.draw()}inputcell(){const t=this.getcell();if(!(t.isnull||t===this.mouseCell)&&(this.inputData===null&&this.decIC(t),this.mouseCell=t,!(t.numberRemainsUnshaded&&t.qnum!==-1&&(this.inputData===1||this.inputData===2&&!this.puzzle.painter.enablebcolor)))){if(this.RBShadeCell&&this.inputData===1){this.firstCell.isnull&&(this.firstCell=t);const e=this.firstCell;if((e.bx&2^e.by&2)!==(t.bx&2^t.by&2))return}this.inputData===1?t.setShade():t.clrShade(),t.setQsub(this.inputData===2?1:0),t.draw()}}decIC(t){this.inputMode==="shade"?this.inputData=t.qans!==1?1:0:this.inputMode==="unshade"?this.inputData=t.qsub!==1?2:0:this.puzzle.getConfig("use")===1?this.btn==="left"?this.inputData=t.isUnshade()?1:0:this.btn==="right"&&(this.inputData=t.qsub!==1?2:0):this.puzzle.getConfig("use")===2&&(t.numberRemainsUnshaded&&t.qnum!==-1?this.inputData=t.qsub!==1?2:0:this.btn==="left"?t.isShade()?this.inputData=2:t.qsub===1?this.inputData=0:this.inputData=1:this.btn==="right"&&(t.isShade()?this.inputData=0:t.qsub===1?this.inputData=1:this.inputData=2))}inputclean_cell(){const t=this.getcell();if(t.isnull||t===this.mouseCell)return;this.mouseCell=t;const e=new A([t]);this.puzzle.playmode?e.ansclear():e.allclear(),t.draw()}inputqnum(t){t||(t=this.getcell()),!(t.isnull||t===this.mouseCell)&&(this.cursor.modesnum&&this.puzzle.playmode&&!this.cursor.checksnum(this.inputPoint)&&t.noNum()?this.setcursorsnum(t):t!==this.cursor.getc()?this.setcursor(t):this.inputqnum_main(t),this.mouseCell=t)}inputqnum_main(t){let e=t;const s=this.puzzle;if(!(s.playmode&&t.qnum!==t.pureObject.qnum&&s.pid!=="factors")){if(s.editmode&&s.board.roommgr.hastop)e=t=t.room.top;else if(s.execConfig("dispmove")){if(t.isDestination())t=t.base;else if(t.lcnt>0)return}if(t.enableSubNumberArray&&s.playmode&&this.cursor.targetdir>=2){const n=[-1,-1,2,3,1,0][this.cursor.targetdir];if(n===-1)return;t.setSnum(n,this.getNewNumber(t,t.snum[n]))}else if(s.editmode&&t.ques===51){const n=s.cursor.detectTarget(t);s.key.setnum51(t,n,this.getNewNumber(t,s.key.getnum51(t,n)))}else t.setNum(this.getNewNumber(t,t.getNum()));s.execConfig("dispmove")&&t.noNum()&&t.eraseMovedLines(),e.draw()}}getNewNumber(t,e){const s=this.puzzle,n=s.editmode&&!t.disInputHatena,r=t.getmaxnum(),o=t.getminnum();let l=-1,h=t.qsub,a=0;return s.editmode?a=-1:this.cursor.targetdir>=2?(a=0,h=0):t.numberWithMB?(a=2,h=t.qsub):s.pid==="roma"||s.pid==="yinyang"?a=0:(t.numberAsObject||s.pid==="hebi")&&(a=1),this.btn==="left"?e>=r?l=a>=1?-2:-1:h===1?l=a>=2?-3:-1:h===2?l=-1:e===-1?l=n?-2:o:e<o?l=o:l=e+1:this.btn==="right"&&(h===1?l=r:h===2?l=-2:e===-1?a===1?l=-2:a===2?l=-3:l=r:e>r?l=r:e<=o?l=n?-2:-1:e===-2?l=-1:l=e-1),l}inputFixedNumber(t){const e=this.getcell();if(e.isnull||e===this.mouseCell)return;let s=e.getNum();s===-1&&e.qsub>0&&(s=-1-e.qsub),this.inputData===null&&(this.inputData=s===t?-1:t),(s!==t||this.inputData===-1)&&(e.setNum(this.inputData),e.draw()),this.mouseCell=e}inputQues(t){const e=this.getcell();e.isnull||(e!==this.cursor.getc()&&this.inputMode==="auto"?this.setcursor(e):this.inputQues_main(t,e))}inputQues_main(t,e){const s=e.ques,n=t.length;if((this.inputMode==="quesmark"||this.inputMode==="auto")==(this.btn==="left")){for(let r=0;r<=n-1;r++)if(s===t[r]){e.setQues(t[r<n-1?r+1:0]);break}}else for(let r=n-1;r>=0;r--)if(s===t[r]){e.setQues(t[r>0?r-1:n-1]);break}e.draw()}inputMB(){const t=this.getcell();t.isnull||(t.setQsub((this.btn==="left"?[1,2,0]:[2,0,1])[t.qsub]),t.draw())}inputFixedQsub(t){const e=this.getcell();e.isnull||e.is51cell()||e===this.mouseCell||(this.inputData===null&&(this.inputData=e.qsub!==t?t:0),e.setQsub(this.inputData),e.draw(),this.mouseCell=e)}inputBGcolor(t=!1){const e=this.getcell();e.isnull||e.is51cell()||e===this.mouseCell||(this.inputData!==null||(this.inputMode==="bgcolor1"?this.inputMode=e.qsub!==1?"11":"10":this.inputMode==="bgcolor2"?this.inputMode=e.qsub!==2?"12":"10":t||this.btn==="left"?e.qsub===0?this.inputData=11:e.qsub===1?this.inputData=12:this.inputData=10:e.qsub===0?this.inputData=12:e.qsub===1?this.inputData=10:this.inputData=11),e.setQsub(this.inputData-10),e.draw(),this.mouseCell=e)}inputdirec(){const t=this.getpos(0);if(this.prevPos.equals(t))return;const e=this.prevPos.getc();if(!e.isnull&&e.qnum!==-1){const s=this.prevPos.getdir(t,2);s!==b.NDIR&&(e.setQdir(e.qdir!==s?s:0),e.draw())}this.prevPos=t}inputarrow_cell(){const t=this.getpos(0);if(this.prevPos.equals(t)&&this.inputData===1)return;const e=this.prevPos.getc();if(!e.isnull){const s=this.prevPos.getdir(t,2);if(s!==b.NDIR){this.inputarrow_cell_main(e,s),e.draw(),this.mousereset();return}}this.prevPos=t}inputarrow_cell_main(t,e){t.numberAsObject&&t.setNum(e)}inputtile(){const t=this.getcell();if(t.isnull||t.is51cell()||t===this.mouseCell)return;this.inputData===null&&this.decIC(t),this.mouseCell=t;const e=t.room.clist;for(let s=0;s<e.length;s++){const n=e[s];(this.inputData===1||n.qsub!==3)&&((this.inputData===1?n.setShade:n.clrShade).call(n),n.setQsub(this.inputData===2?1:0))}this.puzzle.painter.repaintBlocks(e)}inputIcebarn(){const t=this.getcell();t.isnull||t===this.mouseCell||(this.inputData===null&&(this.inputData=t.ice()?0:6),t.setQues(this.inputData),t.drawaround(),this.mouseCell=t)}input51(){const t=this.getcell_excell();if(t.isnull)return;const e=t.group;e==="excell"||e==="cell"&&t!==this.cursor.getc()?this.setcursor(t):e==="cell"&&this.input51_main(t)}input51_main(t){this.btn==="right"?t.remove51cell():this.btn==="left"&&(t.is51cell()?this.cursor.chtarget():t.set51cell()),t.drawaround()}input51_fixed(){const t=this.getcell();t.isnull||t===this.mouseCell||(this.inputMode==="clear"?(t.remove51cell(),this.inputData=0):this.inputMode==="cell51"&&!t.is51cell()&&(t.set51cell(),this.inputData=51),t.drawaround(),this.mouseCell=t)}inputqnum_cell51(){const t=this.getcell_excell();t.isnull||this.mouseCell===t&&!this.mouseend||(this.mousestart&&(t!==this.cursor.getobj()||t.ques!==51)?(this.setcursor(t),this.mousereset()):this.mousestart&&this.cursor.getNumOfTarget(t)<2||this.mouseend?(this.inputqnum_main(t),this.mousereset()):(this.mouseCell=t,this.inputselect_cell51(t)))}inputselect_cell51(t){if(this.mousestart)this.prevPos=this.getpos(0);else if(this.mousemove){const e=this.prevPos.getdir(this.getpos(0),2);(e===t.RT||e===t.DN)&&e!==this.cursor.targetdir&&(this.cursor.targetdir=e,this.cursor.draw()),e!==t.NDIR&&this.mousereset()}}inputqnum_cross(){const t=this.getcross();t.isnull||t===this.mouseCell||(t!==this.cursor.getx()?this.setcursor(t):this.inputqnum_main(t),this.mouseCell=t)}inputcross_main(t){this.btn==="left"?t.setQnum(t.qnum!==4?t.qnum+1:-2):this.btn==="right"&&t.setQnum(t.qnum!==-2?t.qnum-1:4),t.draw()}inputcrossMark(){const t=this.getpos(.24);if(!t.oncross())return;const e=this.puzzle.board,s=e.hascross===2?0:2;if(t.bx<e.minbx+s||t.bx>e.maxbx-s||t.by<e.minby+s||t.by>e.maxby-s)return;const n=t.getx();n.isnull||(this.puzzle.opemgr.disCombine=!0,n.setQnum(n.qnum===1?-1:1),this.puzzle.opemgr.disCombine=!1,n.draw())}inputclean_cross(){const t=this.getcross();if(t.isnull||t===this.mouseCell)return;this.mouseCell=t;const e=new _e([t]);this.puzzle.playmode?e.ansclear():e.allclear(),t.draw()}inputborder(){const t=this.getpos(.35);if(this.prevPos.equals(t))return;const e=this.prevPos.getborderobj(t);e.isnull||(this.inputData===null&&(this.inputData=e.isBorder()?0:1),this.inputData===1?e.setBorder():this.inputData===0&&e.removeBorder(),e.draw()),this.prevPos=t}inputQsubLine(){const t=this.getpos(0);if(this.prevPos.equals(t))return;const e=this.prevPos.getnb(t);e.isnull||(this.inputData===null&&(this.inputData=e.qsub===0?1:0),this.inputData===1?e.setQsub(1):this.inputData===0&&e.setQsub(0),e.draw()),this.prevPos=t}inputLine(){if(this.puzzle.execConfig("dispmove")){this.inputMoveLine();return}let t,e;if(this.puzzle.board.borderAsLine){if(t=this.getpos(.35),this.prevPos.equals(t))return;e=this.prevPos.getborderobj(t)}else{if(t=this.getpos(0),this.prevPos.equals(t))return;e=this.prevPos.getnb(t)}e.isnull||(this.inputData===null&&(this.inputData=e.isLine()?0:1),this.inputData===1?e.setLine():this.inputData===0&&e.removeLine(),e.draw()),this.prevPos=t}inputMoveLine(){const t=this.getcell();if(t.isnull)return;const e=this.mouseCell,s=t.getaddr();if(this.mousestart&&t.isDestination())this.mouseCell=t,this.prevPos=s,t.draw();else if(this.mousemove&&!e.isnull&&!t.isDestination()){const n=this.prevPos.getnb(s);if(!n.isnull&&(!n.isLine()&&t.lcnt===0||n.isLine()&&e.lcnt===1)){this.mouseCell=t,this.prevPos=s;const r=n.isLine();if(r?n.removeLine():n.setLine(),r===n.isLine()){this.mousereset(),e.draw();return}n.draw()}}}inputpeke(){const t=this.getpos(.22);if(this.prevPos.equals(t))return;const e=t.getb();e.isnull||(this.inputData===null&&(this.inputData=e.qsub===0?2:3),this.inputData===2&&e.isLine()&&this.puzzle.execConfig("dispmove")||(this.inputData===2?e.setPeke():this.inputData===3&&e.removeLine()),e.draw()),this.prevPos=t}inputpeke_onend(){const t=this.getpos(.22).getb();return t.group==="border"&&!t.isnull?(this.inputpeke(),!0):!1}inputTateyoko(){if(this.mouseend&&this.notInputted()&&this.clickTateyoko){this.clickTateyoko();return}const t=this.getcell();if(!t.isnull){if(!(this.pid!=="amibo"&&t.ques===1)&&!(this.pid==="amibo"&&t.isNum())){if(this.mouseCell!==t)this.firstPoint.set(this.inputPoint);else if(this.firstPoint.bx!==null){let e=null;const s=this.inputPoint.bx-this.firstPoint.bx,n=this.inputPoint.by-this.firstPoint.by;if(n<=-.5||.5<=n?e=1:(s<=-.5||.5<=s)&&(e=2),e!==null){const r=this.pid==="amibo"||this.pid==="tatamibari";let o=0;this.puzzle.playmode?o={0:0,11:3,12:1,13:2}[t.qans]:o={"-1":0,1:3,2:1,3:2}[t.qnum],(this.inputData===null?o&e:this.inputData<=0)&&(e=r?-e:0),r?e>0?o|=e:o&=~-e:o=e,this.puzzle.playmode?t.setQans([0,12,13,11][o]):t.setQnum([-1,2,3,1][o]),t.draw(),this.inputData=+(e>0),this.firstPoint.reset(),this.pid==="tatamibari"&&this.mousereset()}}}this.mouseCell=t}}clickTateyoko(){}dispInfoBlk(){const t=this.getcell();this.mousereset(),!(t.isnull||!t.isShade())&&(this.RBShadeCell?this.dispInfoBlk8(t):t.sblk.clist.setinfo(1),this.puzzle.board.hasinfo=!0,this.puzzle.redraw())}dispInfoBlk8(t){const e=[t];for(;e.length>0;){const s=e.pop();if(s.qinfo!==0)continue;s.setinfo(1);const n=s.bx,r=s.by,o=this.puzzle.board.cellinside(n-2,r-2,n+2,r+2);for(let l=0;l<o.length;l++){const h=o[l];h.qinfo===0&&h.isShade()&&e.push(h)}}}dispInfoLine(){const t=this.puzzle.board;let e=this.getborder(.15);if(this.mousereset(),!e.isnull){if(!e.isLine()){const s=t.borderAsLine?this.getcross():this.getcell();if(s.isnull||t.linegraph.isLineCross&&(s.lcnt===3||s.lcnt===4))return;const n=s.adjborder;if(n.left.isLine())e=n.left;else if(n.right.isLine())e=n.right;else if(n.top.isLine())e=n.top;else if(n.bottom.isLine())e=n.bottom;else return}e.isnull||(t.border.setinfo(-1),e.path.setedgeinfo(1),t.hasinfo=!0,this.puzzle.redraw())}}inputDot(){}inputqcmp(){}}class Mo{constructor(t,e){this.enablemake=!0,this.enableplay=!0,this.keyup_event=!1,this.cancelDefault=!1,this.cancelEvent=!1,this.puzzle=t,Object.assign(this,e),this.pid=t.pid,this.cursor=this.puzzle.cursor,this.enableKey=!0,this.isCTRL=!1,this.isMETA=!1,this.isALT=!1,this.isSHIFT=!1,this.isZ=!1,this.isX=!1,this.isY=!1,this.keydown=!1,this.keyup=!1,this.ca="",this.prev=null}get board(){return this.board}keyreset(){this.isCTRL=!1,this.isMETA=!1,this.isALT=!1,this.isSHIFT=!1,this.isZ=!1,this.isX=!1,this.isY=!1,this.keydown=!1,this.keyup=!1,this.ca="",this.prev=null}isenablemode(){return this.puzzle.editmode&&this.enablemake||this.puzzle.playmode&&this.enableplay}e_keydown(t){if(!this.enableKey)return;const e=this.getchar(t);this.checkbutton(e,0),e&&this.keyevent(e,0),(t.target===this.puzzle.canvas||this.cancelDefault)&&(t.stopPropagation(),t.preventDefault())}e_keyup(t){if(!this.enableKey)return;const e=this.getchar(t);this.checkbutton(e,1),e&&this.keyevent(e,1),(t.target===this.puzzle.canvas||this.cancelDefault)&&(t.stopPropagation(),t.preventDefault())}checkmodifiers(t){this.isSHIFT=t.shiftKey,this.isCTRL=t.ctrlKey,this.isMETA=t.metaKey,this.isALT=t.altKey}checkbutton(t,e){const s=t.split(/\+/).pop();s==="z"&&(this.isZ=e===0),s==="x"&&(this.isX=e===0),s==="y"&&(this.isY=e===0)}getchar(t){this.checkmodifiers(t);let e="";const s=t.keyCode?t.keyCode:t.charCode;s===38?e="up":s===40?e="down":s===37?e="left":s===39?e="right":48<=s&&s<=57?e=(s-48).toString(36):65<=s&&s<=90?e=(s-55).toString(36):96<=s&&s<=105?e=(s-96).toString(36):112<=s&&s<=123?e=`F${(s-111).toString(10)}`:s===32||s===46?e=" ":s===8?e="BS":(s===109||s===189||s===173)&&(e="-");const n=e?[e]:[];return this.isMETA&&n.unshift("meta"),this.isALT&&n.unshift("alt"),this.isCTRL&&n.unshift("ctrl"),this.isSHIFT&&n.unshift("shift"),e=n.join("+"),e==="alt+h"?e="left":e==="alt+k"?e="up":e==="alt+j"?e="down":e==="alt+l"&&(e="right"),e}inputKeys(...t){for(let e=0;e<t.length;e++)this.keyevent(t[e],0),this.keyevent(t[e],1)}keyevent(t,e){const s=this.puzzle;if(this.cancelEvent=!1,this.cancelDefault=!1,this.keydown=e===0,this.keyup=e===1,this.keydown?s.opemgr.newOperation():s.opemgr.newChain(),this.keydown&&!this.isZ&&s.errclear(),s.emit("key",t),!this.cancelEvent&&this.keyexec(t)&&this.keyDispInfo(t)&&this.isenablemode()){if(this.keydown&&this.moveTarget(t)){this.cancelDefault=!0;return}(this.keydown||this.keyup&&this.keyup_event)&&this.keyinput(t)}}keyexec(t){const e=this.puzzle;return this.keydown&&t==="alt+c"&&!e.playeronly?(e.setMode(e.playmode?1:3),!1):!0}keyDispInfo(t){return!0}keyinput(t){this.key_inputqnum(t)}moveTarget(t){return this.moveTCell(t)}moveTCell(t){return this.moveTC(t,2)}moveTCross(t){return this.moveTC(t,2)}moveTBorder(t){return this.moveTC(t,1)}moveTC(t,e){const s=this.cursor,n=s.getaddr();let r=!0,o=b.NDIR;switch(t){case"up":s.by-e>=s.miny&&(o=b.UP);break;case"down":s.by+e<=s.maxy&&(o=b.DN);break;case"left":s.bx-e>=s.minx&&(o=b.LT);break;case"right":s.bx+e<=s.maxx&&(o=b.RT);break;default:r=!1;break}return r&&(s.movedir(o,e),n.draw(),s.draw()),r}moveEXCell(t){const e=this.cursor,s=e.getaddr();let n=!0,r=b.NDIR;switch(t){case"up":e.by===e.maxy&&e.minx<e.bx&&e.bx<e.maxx?e.by=e.miny:e.by>e.miny||this.pid==="easyasabc"&&e.by===-1?r=b.UP:n=!1;break;case"down":e.by===e.miny&&e.minx<e.bx&&e.bx<e.maxx?e.by=e.maxy:e.by<e.maxy||this.pid==="easyasabc"&&e.by===-3?r=b.DN:n=!1;break;case"left":e.bx===e.maxx&&e.miny<e.by&&e.by<e.maxy?e.bx=e.minx:e.bx>e.minx?r=b.LT:n=!1;break;case"right":e.bx===e.minx&&e.miny<e.by&&e.by<e.maxy?e.bx=e.maxx:e.bx<e.maxx?r=b.RT:n=!1;break;default:n=!1;break}return n&&(r!==b.NDIR&&e.movedir(r,2),s.draw(),e.draw()),n}key_inputcross(t){const e=this.cursor.getx(),s=e.getmaxnum();let n=-1;if("0"<=t&&t<="9"){const r=+t;let o=e.qnum;if((o<=0||o*10+r>s)&&(o=0),n=o*10+r,n>s)return}else if(t==="-")e.setQnum(e.qnum!==-2?-2:-1);else if(t===" ")e.setQnum(-1);else return;e.setQnum(n),e.draw()}key_inputqnum(t){const e=this.cursor.getc();e.enableSubNumberArray&&this.puzzle.playmode&&t==="shift"&&e.noNum()?this.cursor.chtarget():this.key_inputqnum_main(e,t)}key_inputqnum_main(t,e){let s=t;const n=this.puzzle,r=n.board;if(n.editmode&&r.roommgr.hastop)s=t=t.room.top;else if(n.execConfig("dispmove")){if(t.isDestination())t=t.base;else if(t.lcnt>0)return}if(t.enableSubNumberArray&&this.cursor.targetdir>=2){const o=[-1,-1,2,3,1,0][this.cursor.targetdir];if(o===-1)return;const l=this.getNewNumber(t,e,t.snum[o]);if(l===null)return;t.setSnum(o,l)}else{const o=this.getNewNumber(t,e,t.getNum());if(o===null)return;t.setNum(o),t.numberWithMB&&t.enableSubNumberArray&&e===" "&&t.clrSnum()}n.execConfig("dispmove")&&t.noNum()&&t.eraseMovedLines(),s.draw(),this.prev=t}getNewNumber(t,e,s){const n=t.getmaxnum(),r=t.getminnum();let o=null;if("0"<=e&&e<="9"&&!t.numberAsLetter){const l=+e;(s<=0||s*10+l>n||this.prev!==t)&&(s=0),o=s*10+l,(o>n||r>0&&o===0)&&(o=null)}else if("a"<=e&&e<="z"&&e.length===1&&t.numberAsLetter){if(e.length>1&&e!=="BS")return null;const l=Number.parseInt(e,36)-10;s>0&&(s-1)%26===l?o=s<=26?s+26:-1:o=l+1,(o>n||r>0&&o===0)&&(o=null)}else e==="BS"?s<10||t.numberAsLetter?o=-1:o=s/10|0:e==="-"?o=this.puzzle.editmode&&!t.disInputHatena?-2:-1:e===" "?o=-1:e==="s1"?o=-2:e==="s2"?o=-3:o=null;return o}key_inputarrow(t){return this.key_inputdirec_common(t,!1)}key_inputdirec(t){return this.key_inputdirec_common(t,!0)}key_inputdirec_common(t,e){const s=this.cursor.getc();if(e&&s.qnum===-1)return!1;let n=b.NDIR;switch(t){case"shift+up":n=b.UP;break;case"shift+down":n=b.DN;break;case"shift+left":n=b.LT;break;case"shift+right":n=b.RT;break}return n!==b.NDIR?(s.setQdir(s.qdir!==n?n:b.NDIR),e||s.setQnum(-1),this.cursor.draw(),!0):!1}inputnumber51(t,e){const s=this.cursor;if(t==="shift"){s.chtarget();return}const n=s.getobj(),r=s.detectTarget(n);if((r===0||n.group==="cell"&&n.is51cell())&&t==="q"&&!n.isnull){n.is51cell()?n.remove51cell():n.set51cell(),s.drawaround();return}if(r===0)return;const o=hi.prototype[r===b.RT?"qnum":"qnum2"],l=n.getmaxnum();let h=o;if("0"<=t&&t<="9"){const a=+t;let c=this.getnum51(n,r);if((c<=0||c*10+a>l||this.prev!==n)&&(c=0),h=c*10+a,h>l)return}else if(t==="-"||t===" ")h=o;else return;this.setnum51(n,r,h),this.prev=n,s.draw()}setnum51(t,e,s){e===b.RT?t.setQnum(s):t.setQnum2(s)}getnum51(t,e){return e===b.RT?t.qnum:t.qnum2}}class Uo extends Z{constructor(t,e){super(t),this.minx=null,this.miny=null,this.maxx=null,this.maxy=null,this.crosstype=!1,this.targetdir=0,Object.assign(this,e),this.pid=t.pid,this.bx=1,this.by=1,this.mode51=Rn.prototype.ques===51,this.modesnum=hi.prototype.enableSubNumberArray,this.mode51&&this.puzzle.editmode&&(this.targetdir=4)}init(t,e){return this.bx=t,this.by=e,this.mode51||(this.targetdir=0),this}initCursor(){this.crosstype?this.init(0,0):this.init(1,1),this.adjust_init()}setminmax(){const t=this.board,e=this.crosstype?0:1;this.minx=t.minbx+e,this.miny=t.minby+e,this.maxx=t.maxbx-e,this.maxy=t.maxby-e,this.setminmax_customize(),this.adjust_init()}setminmax_customize(){}adjust_init(){this.bx<this.minx&&(this.bx=this.minx),this.by<this.miny&&(this.by=this.miny),this.bx>this.maxx&&(this.bx=this.maxx),this.by>this.maxy&&(this.by=this.maxy)}adjust_modechange(){this.setminmax(),this.mode51&&this.puzzle.editmode?this.targetdir=4:this.modesnum&&this.puzzle.playmode&&(this.targetdir=0)}adjust_cell_to_excell(){const t=this.board,e=Math.min(this.bx,t.cols*2-this.bx,this.by,t.rows*2-this.by);e<=0||(this.by===e?this.by=this.miny:t.rows*2-this.by===e?this.by=this.maxy:this.bx===e?this.bx=this.minx:t.cols*2-this.bx===e&&(this.bx=this.maxx))}checksnum(t){const e=(((t.bx+12)/2|0)-6)*2+1,s=(((t.by+12)/2|0)-6)*2+1;let n=this.bx===e&&this.by===s;if(n&&this.modesnum&&this.puzzle.playmode){const r=(t.bx+12)%2*1.5|0,o=(t.by+12)%2*1.5|0;this.pid!=="factors"?n=[5,0,4,0,0,0,2,0,3][o*3+r]===this.targetdir:n=[0,0,4,0,0,0,2,0,3][o*3+r]===this.targetdir}return n}movedir(t,e){return super.movedir(t,e),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0),this}setaddr(t){t.bx<this.minx||this.maxx<t.bx||t.by<this.miny-(this.pid==="easyasabc"?2:0)||this.maxy<t.by||(this.set(t),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0))}moveTo(t,e){this.init(t,e),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0)}chtarget(){this.oncell()&&this.modesnum&&this.puzzle.playmode?this.pid!=="factors"?this.targetdir=[5,1,3,0,2,4][this.targetdir]:this.targetdir=[4,1,3,0,2,0][this.targetdir]:this.targetdir=this.targetdir===2?4:2,this.draw()}detectTarget(t){t=t||this.getobj();const e=this.board;if(t.isnull)return 0;if(t.group==="cell"){const s=t.adjacent;if(t.ques!==51||t.id===e.cell.length-1)return 0;const n=s.right.isnull||s.right.ques===51,r=s.bottom.isnull||s.bottom.ques===51;if(n&&r)return 0;if(r)return b.RT;if(n)return b.DN}else if(t.group==="excell"){const s=t.adjacent;if(t.id===e.cols+e.rows||t.by===-1&&s.bottom.ques===51||t.bx===-1&&s.right.ques===51)return 0;if(t.by===-1)return b.DN;if(t.bx===-1)return b.RT}else return 0;return this.targetdir}getNumOfTarget(t){let e=1;if(t.isnull)e=0;else if(t.group==="cell"){if(this.modesnum&&this.puzzle.playmode)e=4-(this.pid==="factors"?1:0);else if(t.ques===51){const s=t.adjacent;e=(!s.right.isnull&&s.right.ques!==51?1:0)+(!s.bottom.isnull&&s.bottom.ques!==51?1:0)}}return e}}const Pe=1,xs=2,ws=3,Cs=4,qs=5;class bi{constructor(t,e){this.context=null,this.subcontext=null,this.fgcellcolor_func="ques",this.bgcellcolor_func="error1",this.bordercolor_func="ques",this.numbercolor_func="mixed",this.circlefillcolor_func="qnum",this.circlestrokecolor_func="qnum",this.quescolor="black",this.qanscolor="rgb(0, 160, 0)",this.qcmpcolor="silver",this.qcmpbgcolor="rgb(224, 224, 255)",this.trialcolor="rgb(160, 160, 160)",this.subcolor="rgb(127, 127, 255)",this.shadecolor="black",this.errcolor1="rgb(192, 0, 0)",this.errcolor2="rgb(32, 32, 255)",this.fontShadecolor="rgb(224, 224, 224)",this.enablebcolor=!1,this.bcolor="rgb(160, 255, 160)",this.errbcolor1="rgb(255, 160, 160)",this.errbcolor2="rgb(64, 255, 64)",this.qsubcolor1="rgb(160,255,160)",this.qsubcolor2="rgb(255,255,127)",this.qsubcolor3="rgb(192,192,192)",this.icecolor="rgb(192, 224, 255)",this.erricecolor="rgb(224,  96, 160)",this.circlebasecolor="white",this.mbcolor="rgb(0, 160, 0)",this.linecolor="rgb(0, 160, 0)",this.errlinecolor="rgb(255, 0, 0)",this.noerrcolor="rgb(160, 160, 160)",this.movelinecolor="silver",this.movetrialcolor="rgb(255, 160, 0)",this.pekecolor="rgb(0, 127, 0)",this.bbcolor="rgb(160, 160, 160)",this.targetColor1="rgb(255, 64,  64)",this.targetColor3="rgb(64,  64, 255)",this.ttcolor="rgb(127,255,127)",this.movecolor="red",this.gridcolor="black",this.gridcolor_type="DARK",this.gridcolor_list={DARK:"rgb( 48,  48,  48)",LIGHT:"rgb(127, 127, 127)",DLIGHT:"rgb(160, 160, 160)",SLIGHT:"rgb(191, 191, 191)",THIN:"rgb(224, 224, 224)"},this.bgcolor="white",this.textoption=null,this.fontsizeratio=.8,this.fontwidth=[.5,.4,.33],this.fontfamily="",this.isSupportMaxWidth=!0,this.crosssize=.4,this.circleratio=[.4,.35],this.margin=.25,this.canvasWidth=null,this.canvasHeight=null,this.x0=0,this.y0=0,this.cw=36,this.ch=36,this.bw=18,this.bh=18,this.lw=1,this.lm=1,this.lwratio=10,this.addlw=0,this.lastHdeg=0,this.lastYdeg=0,this.minYdeg=.18,this.maxYdeg=.7,this.range=null,this.useBuffer=!1,this.outputImage=!1,this.pendingResize=!1,this.suspended=!0,this.suspendedAll=!0,this.hideHatena=!1,this.autocmp="",this.irowake=!1,this.irowakeblk=!1,this.CENTER=Pe,this.BOTTOMLEFT=xs,this.BOTTOMRIGHT=ws,this.TOPRIGHT=Cs,this.TOPLEFT=qs,this.puzzle=t,Object.assign(this,e),this.gridcolor=this.gridcolor_list[this.gridcolor_type]||this.gridcolor,this.resetRange(),this.initColor(),this.initFont()}get board(){return this.puzzle.board}initCanvas(){const t=this.puzzle;this.context=t.canvas?t.canvas.getContext("2d"):null,this.context.use.canvas&&(this.subcontext=t.subcanvas?t.subcanvas.getContext("2d"):null,this.useBuffer=!!this.subcontext),(this.canvasWidth===null||this.canvasHeight===null)&&this.resizeCanvasByCellSize(),this.pendingResize=!0,this.resize_canvas_main(),t.emit("canvasReady"),this.unsuspend()}initColor(){const t=this.puzzle.config.list;for(const e in t)e.substr(0,6)==="color_"&&this.setColor(e.substr(6),t[e].val)}setColor(t,e){e&&(t==="bgcolor"?e=typeof e=="string"&&e!=="white"?e:this.constructor.prototype[t]:e=e||this.constructor.prototype[t],this[t]=e,this.suspended||this.paintAll())}initFont(){const t=this.puzzle.getConfig("font")===1;ys().OS.Android?this.fontfamily=t?"Helvetica, Verdana, Arial, ":'"Times New Roman", ':this.fontfamily="",this.fontfamily+=t?"sans-serif":"serif"}resizeCanvas(t=null,e=null){const s=this.suspended;this.suspendAll(),this.canvasWidth=t||this.canvasWidth,this.canvasHeight=e||this.canvasHeight,this.pendingResize=!0,s||this.unsuspend()}resizeCanvasByCellSize(t=null){const e=this.suspended;this.suspendAll(),this.cw=t||this.cw,this.ch=t||this.ch,this.canvasWidth=this.cw*this.getCanvasCols(),this.canvasHeight=this.ch*this.getCanvasRows(),this.pendingResize=!0,e||this.unsuspend()}resize_canvas_main(){this.pendingResize&&(this.pendingResize=!1,this.setParameter(),this.setOffset(),this.puzzle.emit("resize"),this.clearObject())}setParameter(){const t=this.canvasWidth,e=this.canvasHeight,s=this.getCanvasCols(),n=this.getCanvasRows(),r=t/s|0,o=e/n|0;this.puzzle.getConfig("squarecell")?this.cw=this.ch=Math.min(r,o):(this.cw=r,this.ch=o),this.bw=this.cw/2,this.bh=this.ch/2,this.lw=Math.max(this.cw/this.lwratio,3),this.lm=this.lw/2}setOffset(){const t=this.context,e=this.subcontext,s=this.canvasWidth,n=this.canvasHeight;t.changeSize(s|0,n|0),e&&e.changeSize(s|0,n|0),this.x0=((s-this.cw*this.getBoardCols())/2+this.cw*this.getOffsetCols()|0)+.5,this.y0=((n-this.ch*this.getBoardRows())/2+this.ch*this.getOffsetRows()|0)+.5;const r=this.x0,o=this.y0;t.use.canvas?(t.translate(r,o),e&&e.translate(r,o)):(di(t.canvas),t.translate(r,o))}clearObject(){this.context.clear()}getCanvasCols(){return this.getBoardCols()+2*this.margin}getCanvasRows(){return this.getBoardRows()+2*this.margin}getBoardCols(){const t=this.puzzle.board;return(t.maxbx-t.minbx)/2}getBoardRows(){const t=this.puzzle.board;return(t.maxby-t.minby)/2}getOffsetCols(){return(0-this.puzzle.board.minbx)/2}getOffsetRows(){return(0-this.puzzle.board.minby)/2}suspend(){this.suspended=!0}suspendAll(){this.suspendedAll=!0,this.suspended=!0}unsuspend(){if(this.context){if(this.resize_canvas_main(),this.suspendedAll){const t=this.puzzle.board;this.setRange(t.minbx-2,t.minby-2,t.maxbx+2,t.maxby+2),this.suspendedAll=!1}this.suspended&&(this.suspended=!1,this.prepaint())}}prepaint(t=null){if(this.suspended||!this.context)return;this.isSupportMaxWidth=this.context.use.svg&&jt.env.API.svgTextLength||this.context.use.canvas&&jt.env.API.maxWidth;const e=this.puzzle.board,s=2*this.margin,n=this.range.x1,r=this.range.y1,o=this.range.x2,l=this.range.y2;if(!(n>o||r>l||n>=e.maxbx+s||r>=e.maxby+s||o<=e.minbx-s||l<=e.minby-(s+((t==null?void 0:t.y1margin)||0))))if(!this.useBuffer)this.setRangeObject(n,r,o,l),this.flushCanvas(),this.paint();else{const h=this.context,a=this.subcontext;this.context=a,this.setRangeObject(n-1,r-1,o+1,l+1),this.flushCanvas(),this.paint(),this.context=h,this.copyBufferData(h,a,n,r,o,l)}this.resetRange()}paint(){}setRange(t,e,s,n){this.range.x1>t&&(this.range.x1=t),this.range.y1>e&&(this.range.y1=e),this.range.x2<s&&(this.range.x2=s),this.range.y2<n&&(this.range.y2=n)}setRangeObject(t,e,s,n){const r=this.puzzle.board;this.range.cells=r.cellinside(t,e,s,n),this.range.crosses=r.crossinside(t,e,s,n),this.range.borders=r.borderinside(t,e,s,n),this.range.excells=r.excellinside(t,e,s,n)}resetRange(){const t=this.puzzle.board;this.range={x1:t.maxbx+1,y1:t.maxby+1,x2:t.minbx-1,y2:t.minby-1,cells:new A,crosses:new _e,borders:new oe,excells:new Is}}copyBufferData(t,e,s,n,r,o){let l=this.x0+s*this.bw-1,h=this.y0+n*this.bh-1,a=this.x0+r*this.bw+2,c=this.y0+o*this.bh+2;l<0&&(l=0),a>e.child.width&&(a=e.child.width),h<0&&(h=0),c>e.child.height&&(c=e.child.height),t.drawImage(e.child,l,h,a-l,c-h,l-this.x0,h-this.y0,a-l,c-h)}paintRange(t,e,s,n){this.setRange(t,e,s,n),this.prepaint()}paintAll(){this.suspended&&(this.suspendedAll=!0);const t=this.puzzle.board;this.paintRange(t.minbx-2,t.minby-2,t.maxbx+2,t.maxby+2)}getNewLineColor(){let t=0;for(;;){let e=(Math.random()*384|0)-64;e<0&&(e=0),e>255&&(e=255);let s=(Math.random()*384|0)-64;s<0&&(s=0),s>255&&(s=255);let n=(Math.random()*384|0)-64;n<0&&(n=0),n>255&&(n=255);const r=Math.max(e,Math.max(s,n)),o=Math.min(e,Math.min(s,n));let l=0;const h=(r+o)*.5/255,a=r===o?0:(r-o)/(h<=.5?r+o:2*255-r-o);r===o?l=0:e>=s&&e>=n?l=(60*(s-n)/(r-o)+360)%360:s>=e&&s>=n?l=(120+60*(n-e)/(r-o)+360)%360:n>=s&&n>=e&&(l=(240+60*(e-s)/(r-o)+360)%360);const c=(.29891*e+.58661*s+.11448*n)/255;if(this.minYdeg<c&&c<this.maxYdeg&&Math.abs(this.lastYdeg-c)>.15&&(a<.02||.4<a)&&(360+this.lastHdeg-l)%360>=45&&(360+this.lastHdeg-l)%360<=315)return this.lastHdeg=l,this.lastYdeg=c,`rgb(${e},${s},${n})`;if(t++,t>100)return`rgb(${e},${s},${n})`}}repaintBlocks(t){const e=t.getRectSize();this.puzzle.painter.paintRange(e.x1-1,e.y1-1,e.x2+1,e.y2+1)}repaintLines(t){this.range.borders=t,this.drawLines(),this.context.use.canvas&&this.repaintParts(t)}repaintParts(t){}flushCanvas(){const t=this.vinc("background","crispEdges",!0),e=this.bw,s=this.bh,n=this.margin>.15?this.margin:0,r=this.puzzle.board,o=r.minbx-n,l=r.minby-n,h=r.maxbx+n-o,a=r.maxby+n-l;t.vid="BG",t.fillStyle=this.bgcolor,t.fillRect(o*e-.5,l*s-.5,h*e+1,a*s+1)}vinc(t,e,s=!1){const n=this.context,r={freeze:!!s,rendering:null};return r.rendering=e,n.setLayer(t,r),n}disptext(t,e,s,n=null){n=n||{};const r=this.context;let o=this.cw*(n.ratio||this.fontsizeratio)|0,l=null;const h=n.width||this.fontwidth,a=t.length<=h.length+1?t.length-2:h.length-1,c=a>=0?h[a]*t.length:null;this.isSupportMaxWidth?l=c?o*c:null:c&&(o=o*c*1.5/t.length|0);const u=n.style?`${n.style} `:"";r.font=`${u+o}px ${this.fontfamily}`;const d=this.bw*(n.hoffset||.9),f=this.bh*(n.voffset||.82),p=n.position||Pe;switch(p){case Pe:r.textAlign="center";break;case xs:case qs:r.textAlign="left",e-=d;break;case ws:case Cs:r.textAlign="right",e+=d;break}switch(p){case Pe:r.textBaseline="middle";break;case Cs:case qs:r.textBaseline="candle-top",s-=f;break;case ws:case xs:r.textBaseline="alphabetic",s+=f;break}r.fillText(t,e,s,l)}drawQuesCells(){this.vinc("cell_front","crispEdges",!0),this.drawCells_common("c_fullf_",t=>this.getQuesCellColor(t))}getQuesCellColor(t){switch(this.fgcellcolor_func){case"ques":return this.getQuesCellColor_ques(t);case"qnum":return this.getQuesCellColor_qnum(t);default:throw new Error("invalid fgcellcolor_func")}}getQuesCellColor_ques(t){return t.ques!==1?null:(t.error||t.qinfo)===1?this.errcolor1:this.quescolor}getQuesCellColor_qnum(t){return t.qnum===-1?null:(t.error||t.qinfo)===1?this.errcolor1:this.quescolor}drawShadedCells(){this.vinc("cell_shaded","crispEdges",!0),this.drawCells_common("c_fulls_",t=>this.getShadedCellColor(t))}getShadedCellColor(t){if(t.qans!==1)return null;const e=t.error||t.qinfo;return e===1?this.errcolor1:e===2?this.errcolor2:t.trial?this.trialcolor:this.puzzle.execConfig("irowakeblk")?t.sblk.color:this.shadecolor}drawBGCells(){this.vinc("cell_back","crispEdges",!0),this.drawCells_common("c_fullb_",t=>this.getBGCellColor(t))}getBGCellColor(t){switch(this.bgcellcolor_func){case"error1":return this.getBGCellColor_error1(t);case"error2":return this.getBGCellColor_error2(t);case"qcmp":return this.getBGCellColor_qcmp(t);case"qcmp1":return this.getBGCellColor_qcmp1(t);case"qsub1":return this.getBGCellColor_qsub1(t);case"qsub2":return this.getBGCellColor_qsub2(t);case"qsub3":return this.getBGCellColor_qsub3(t);case"icebarn":return this.getBGCellColor_icebarn(t);default:return console.warn(`bgcellcolor_func(${this.bgcellcolor_func}) is invalid`),this.getBGCellColor_error1(t)}}getBGCellColor_error1(t){return t.error===1||t.qinfo===1?this.errbcolor1:null}getBGCellColor_error2(t){const e=t.error||t.qinfo;return e===1?this.errbcolor1:e===2?this.errbcolor2:null}getBGCellColor_qcmp(t){return t.error===1||t.qinfo===1?this.errbcolor1:this.puzzle.execConfig("autocmp")&&t.room&&t.room.cmp?this.qcmpbgcolor:null}getBGCellColor_qcmp1(t){return t.error===1||t.qinfo===1?this.errbcolor1:t.qsub===1?this.bcolor:this.puzzle.execConfig("autocmp")&&t.room&&t.room.cmp?this.qcmpbgcolor:null}getBGCellColor_qsub1(t){return(t.error||t.qinfo)===1?this.errbcolor1:t.qsub===1?this.bcolor:null}getBGCellColor_qsub2(t){return this.bcolor="silver",(t.error||t.qinfo)===1?this.errbcolor1:t.qsub===1?this.qsubcolor1:t.qsub===2?this.qsubcolor2:null}getBGCellColor_qsub3(t){return(t.error||t.qinfo)===1?this.errbcolor1:t.qsub===1?this.qsubcolor1:t.qsub===2?this.qsubcolor2:t.qsub===3?this.qsubcolor3:null}getBGCellColor_icebarn(t){return t.error===1||t.qinfo===1?t.ques===6?this.erricecolor:this.errbcolor1:t.ques===6?this.icecolor:null}drawCells_common(t,e){const s=this.context,n=this.range.cells;for(let r=0;r<n.length;r++){const o=n[r],l=e(o);s.vid=t+o.id,l?(s.fillStyle=l,s.fillRectCenter(o.bx*this.bw,o.by*this.bh,this.bw+.5,this.bh+.5)):s.vhide()}}drawBGEXcells(){const t=this.vinc("excell_back","crispEdges",!0),e=this.range.excells;for(let s=0;s<e.length;s++){const n=e[s],r=this.getBGEXcellColor(n);t.vid=`ex_full_${n.id}`,r?(t.fillStyle=r,t.fillRectCenter(n.bx*this.bw,n.by*this.bh,this.bw+.5,this.bh+.5)):t.vhide()}}getBGEXcellColor(t){if(t.error===1||t.qinfo===1)return this.errbcolor1}drawDotCells(){const t=this.vinc("cell_dot","auto",!0),e=Math.max(this.cw*.06,2),s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n];t.vid=`c_dot_${r.id}`,r.qsub===1?(t.fillStyle=r.trial?this.trialcolor:this.qanscolor,t.fillCircle(r.bx*this.bw,r.by*this.bh,e)):t.vhide()}}getAllowParameter(){return{al:this.cw*.35,aw:this.cw*.12,tl:0,tw:this.cw*.35}}drawCellArrows(){const t=this.vinc("cell_arrow","auto");let{al:e,aw:s,tl:n,tw:r}=this.getAllowParameter();s=s>=1?s:1,r=r>=5?r:5;const o=this.range.cells;for(let l=0;l<o.length;l++){const h=o[l],a=h.numberAsObject?h.getNum():h.qdir,c=a>=1&&a<=4?this.getCellArrowColor(h):null;if(t.vid=`c_arrow_${h.id}`,c){t.fillStyle=c,t.beginPath();const u=h.bx*this.bw,d=h.by*this.bh;switch(a){case b.UP:t.setOffsetLinePath(u,d,0,-e,-r,-n,-s,-n,-s,e,s,e,s,-n,r,-n,!0);break;case b.DN:t.setOffsetLinePath(u,d,0,e,-r,n,-s,n,-s,-e,s,-e,s,n,r,n,!0);break;case b.LT:t.setOffsetLinePath(u,d,-e,0,-n,-r,-n,-s,e,-s,e,s,-n,s,-n,r,!0);break;case b.RT:t.setOffsetLinePath(u,d,e,0,n,-r,n,-s,-e,-s,-e,s,n,s,n,r,!0);break}t.fill()}else t.vhide()}}getCellArrowColor(t){const e=t.numberAsObject?t.getNum():t.qdir;return e>=1&&e<=4?!t.numberAsObject||t.qnum!==-1?this.quescolor:t.trial?this.trialcolor:this.qanscolor:null}slashWidth(){return Math.max(this.bw/4,2)}drawSlashes(){const t=this.vinc("cell_slash","auto"),e=this.slashWidth(),s=this.puzzle.execConfig("irowake"),n=this.range.cells;for(let r=0;r<n.length;r++){const o=n[r];if(t.vid=`c_slash_${o.id}`,o.qans!==0){const l=o.error||o.qinfo;let h;l===1?h=this.errcolor1:l===2?h=this.errcolor2:l===-1?h=this.noerrcolor:s&&o.path.color?h=o.path.color:o.trial?h=this.trialcolor:h="black",t.lineWidth=e,t.strokeStyle=h,t.beginPath();const a=o.bx*this.bw,c=o.by*this.bh;o.qans===31?t.setOffsetLinePath(a,c,-this.bw,-this.bh,this.bw,this.bh,!0):o.qans===32&&t.setOffsetLinePath(a,c,this.bw,-this.bh,-this.bw,this.bh,!0),t.stroke()}else t.vhide()}}drawQuesNumbers(){this.vinc("cell_number","auto"),this.drawNumbers_com(t=>this.getQuesNumberText(t),t=>this.getQuesNumberColor(t),"cell_text_",this.textoption)}drawAnsNumbers(){this.vinc("cell_ans_number","auto"),this.drawNumbers_com(t=>this.getNumberText(t,t.anum),t=>this.getAnsNumberColor(t),"cell_ans_text_",{})}drawHatenas(){function t(e){return e.ques===-2||e.qnum===-2?"?":""}this.vinc("cell_number","auto"),this.drawNumbers_com(t,this.getQuesNumberColor_qnum,"cell_text_",this.textoption)}drawNumbers_com(t,e,s,n){const r=this.context,o=this.range.cells;for(let l=0;l<o.length;l++){const h=o[l],a=t(h);r.vid=s+h.id,a?(r.fillStyle=e(h),this.disptext(a,h.bx*this.bw,h.by*this.bh,n)):r.vhide()}}getQuesNumberText(t){return this.getNumberText(t,(this.puzzle.execConfig("dispmove")?t.base:t).qnum)}getNumberText(t,e){return t.numberAsLetter?this.getNumberTextCore_letter(e):this.getNumberTextCore(e)}getNumberTextCore(t,e=!1){const s=this.hideHatena||e;return t>=0?`${t}`:!s&&t===-2?"?":""}getNumberTextCore_letter(t){let e=`${t}`;return t===-1?e="":t===-2?e="?":t>0&&t<=26?e=(t+9).toString(36).toUpperCase():t>26&&t<=52&&(e=(t-17).toString(36).toLowerCase()),e}getQuesNumberColor(t){switch(this.numbercolor_func){case"fixed":return this.getQuesNumberColor_fixed(t);case"fixed_shaded":return this.getQuesNumberColor_fixed_shaded(t);case"qnum":return this.getQuesNumberColor_qnum(t);case"move":return this.getQuesNumberColor_move(t);case"mixed":return this.getQuesNumberColor_mixed(t);default:return console.warn(`numbercolor_func(${this.numbercolor_func}) is invalid`),this.getQuesNumberColor_mixed(t)}}getQuesNumberColor_fixed(t){return this.quescolor}getQuesNumberColor_fixed_shaded(t){return this.fontShadecolor}getQuesNumberColor_qnum(t){return(t.error||t.qinfo)===1?this.errcolor1:this.quescolor}getQuesNumberColor_move(t){const e=this.puzzle,s=t.error||t.qinfo;return s===1||s===4?this.errcolor1:e.execConfig("dispmove")&&e.mouse.mouseCell===t?this.movecolor:this.quescolor}getQuesNumberColor_mixed(t){const e=t.error||t.qinfo;return t.ques>=1&&t.ques<=5||t.qans===1?this.fontShadecolor:e===1||e===4?this.errcolor1:this.quescolor}getAnsNumberColor(t){return(t.error||t.qinfo)===1?this.errcolor1:t.trial?this.trialcolor:this.qanscolor}drawNumbersEXcell(){const t=this.vinc("excell_number","auto"),e=this.range.excells;for(let s=0;s<e.length;s++){const n=e[s],r=this.getQuesNumberText(n);t.vid=`excell_text_${n.id}`,r?(t.fillStyle=this.getQuesNumberColor(n),this.disptext(r,n.bx*this.bw,n.by*this.bh)):t.vhide()}}drawSubNumbers(){const t=this.vinc("cell_subnumber","auto"),e=[5,4,2,3],s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n];for(let o=0;o<4;o++){const l=r.numberAsLetter?this.getNumberTextCore_letter(r.snum[o]):this.getNumberTextCore(r.snum[o]);t.vid=`cell_subtext_${r.id}_${o}`,l?(t.fillStyle=r.trial?this.trialcolor:this.subcolor,this.disptext(l,r.bx*this.bw,r.by*this.bh,{position:e[o],ratio:.33,hoffset:.8})):t.vhide()}}}drawArrowNumbers(){const t=this.vinc("cell_arrownumber","auto"),e=this.cw*.4,s=this.cw*.03,n=this.cw*.16,r=this.cw*.12,o=-this.bh*.6,l=[this.bw*.6,this.bw*.7,this.bw*.8,this.bw*.85],h=this.range.cells;for(let a=0;a<h.length;a++){const c=h[a],u=c.qdir,d=this.getQuesNumberText(c);let f=c.bx*this.bw,p=c.by*this.bh;const k=d.length-1;if(d&&(t.fillStyle=this.getQuesNumberColor(c)),t.vid=`cell_arrow_${c.id}`,d&&u!==b.NDIR){switch(t.beginPath(),u){case b.UP:t.setOffsetLinePath(f+l[k],p,0,-e,-r,-n,-s,-n,-s,e,s,e,s,-n,r,-n,!0);break;case b.DN:t.setOffsetLinePath(f+l[k],p,0,e,-r,n,-s,n,-s,-e,s,-e,s,n,r,n,!0);break;case b.LT:t.setOffsetLinePath(f,p+o,-e,0,-n,-r,-n,-s,e,-s,e,s,-n,s,-n,r,!0);break;case b.RT:t.setOffsetLinePath(f,p+o,e,0,n,-r,n,-s,-e,-s,-e,s,n,s,n,r,!0);break}t.fill()}else t.vhide();if(t.vid=`cell_arnum_${c.id}`,d){const g={ratio:.8};u!==b.NDIR&&(g.ratio=.7),u===b.UP||u===b.DN?f-=this.cw*.1:(u===b.LT||u===b.RT)&&(p+=this.ch*.1),this.disptext(d,f,p,g)}else t.vhide()}}drawCircledNumbers(){this.drawCircles(),this.vinc("cell_number","auto"),this.drawNumbers_com(t=>this.getQuesNumberText(t),t=>this.getQuesNumberColor(t),"cell_text_",{ratio:.65})}drawCrosses(){const t=this.vinc("cross_base","auto",!0),e=this.cw*this.crosssize+1;t.lineWidth=1;const s={ratio:.6},n=this.range.crosses;for(let r=0;r<n.length;r++){const o=n[r],l=o.bx*this.bw,h=o.by*this.bh;t.vid=`x_cp_${o.id}`,o.qnum!==-1?(t.fillStyle=o.error===1||o.qinfo===1?this.errcolor1:"white",t.strokeStyle="black",t.shapeCircle(l,h,e)):t.vhide(),t.vid=`cross_text_${o.id}`,o.qnum>=0?(t.fillStyle=this.quescolor,this.disptext(`${o.qnum}`,l,h,s)):t.vhide()}}drawCrossMarks(){const t=this.vinc("cross_mark","auto",!0),e=this.cw*this.crosssize,s=this.range.crosses;for(let n=0;n<s.length;n++){const r=s[n];t.vid=`x_cm_${r.id}`,r.qnum===1?(t.fillStyle=r.error===1||r.qinfo===1?this.errcolor1:this.quescolor,t.fillCircle(r.bx*this.bw,r.by*this.bh,e)):t.vhide()}}drawBorders(){this.vinc("border","crispEdges",!0),this.drawBorders_common("b_bd_")}drawBorders_common(t){const e=this.context,s=this.range.borders;for(let n=0;n<s.length;n++){const r=s[n],o=this.getBorderColor(r);if(e.vid=t+r.id,o){const l=r.bx*this.bw,h=r.by*this.bh,a=(this.lw+this.addlw)/2;e.fillStyle=o,r.isVert()?e.fillRectCenter(l,h,a,this.bh+a):e.fillRectCenter(l,h,this.bw+a,a)}else e.vhide()}}getBorderColor(t){switch(this.bordercolor_func){case"ques":return this.getBorderColor_ques(t);case"qans":return this.getBorderColor_qans(t);case"ice":return this.getBorderColor_ice(t)}}getBorderColor_ques(t){return t.isBorder()?this.quescolor:null}getBorderColor_qans(t){const e=t.error||t.qinfo;return t.isBorder()?e===1?this.errcolor1:e===-1?this.noerrcolor:t.trial?this.trialcolor:this.qanscolor:null}getBorderColor_ice(t){const e=t.sidecell[0],s=t.sidecell[1];return t.inside&&!e.isnull&&!s.isnull&&(e.ice()?1:0)^(s.ice()?1:0)?this.quescolor:null}drawQansBorders(){this.vinc("border_answer","crispEdges",!0),this.getBorderColor=this.getQansBorderColor,this.drawBorders_common("b_bdans_")}drawQuesBorders(){this.vinc("border_question","crispEdges",!0),this.getBorderColor=this.getQuesBorderColor,this.drawBorders_common("b_bdques_")}getQuesBorderColor(t){return t.ques===1?this.quescolor:null}getQansBorderColor(t){return t.qans===1?t.trial?this.trialcolor:this.qanscolor:null}drawBorderQsubs(){const t=this.vinc("border_qsub","crispEdges",!0),e=this.cw*.15,s=this.range.borders;for(let n=0;n<s.length;n++){const r=s[n];if(t.vid=`b_qsub1_${r.id}`,r.qsub===1){const o=r.bx*this.bw,l=r.by*this.bh;t.fillStyle=r.trial?this.trialcolor:this.pekecolor,r.isHorz()?t.fillRectCenter(o,l,.5,this.bh-e):t.fillRectCenter(o,l,this.bw-e,.5)}else t.vhide()}}drawBoxBorders(t){const e=this.vinc("boxborder","crispEdges"),s=this.lm,n=this.cw,r=this.ch;e.strokeStyle=this.bbcolor,e.lineWidth=1;const o=this.range.cells;for(let l=0;l<o.length;l++){const h=o[l],a=h.qans===1;if(e.vid=`c_bb_${h.id}`,a){const c=(h.bx-1)*this.bw,u=(h.by-1)*this.bh,d=c-.5,f=c+s+.5,p=c+n-s-.5,k=c+n+.5,g=u-.5,m=u+s+.5,y=u+r-s-.5,w=u+r+.5,N=h.adjborder,v=h.by>2,O=h.by<2*this.puzzle.board.rows-2,R=h.bx>2,K=h.bx<2*this.puzzle.board.cols-2,ht=!v||N.top.ques===1,tt=!O||N.bottom.ques===1,Ct=!R||N.left.ques===1,Kt=!K||N.right.ques===1,Ot=!v||!R||h.relbd(-2,-1).ques===1||h.relbd(-1,-2).ques===1,Vt=!v||!K||h.relbd(2,-1).ques===1||h.relbd(1,-2).ques===1,Xt=!O||!R||h.relbd(-2,1).ques===1||h.relbd(-1,2).ques===1,Yt=!O||!K||h.relbd(2,1).ques===1||h.relbd(1,2).ques===1;e.beginPath(),(ht||Ot)&&e.moveTo(f,m),!ht&&Ot&&e.lineTo(f,g),!ht&&Vt&&e.moveTo(p,g),ht||Vt?e.lineTo(p,m):(Kt||Vt)&&e.moveTo(p,m),!Kt&&Vt&&e.lineTo(k,m),!Kt&&Yt&&e.moveTo(k,y),Kt||Yt?e.lineTo(p,y):(tt||Yt)&&e.moveTo(p,y),!tt&&Yt&&e.lineTo(p,w),!tt&&Xt&&e.moveTo(f,w),tt||Xt?e.lineTo(f,y):(Ct||Xt)&&e.moveTo(f,y),!Ct&&Xt&&e.lineTo(d,y),!Ct&&Ot&&e.moveTo(d,m),(Ct||Ot)&&e.lineTo(f,m),e.stroke()}else e.vhide()}}drawLines(){const t=this.vinc("line","crispEdges"),e=this.range.borders;for(let s=0;s<e.length;s++){const n=e[s],r=this.getLineColor(n);if(t.vid=`b_line_${n.id}`,r){const o=n.bx*this.bw,l=n.by*this.bh,h=this.puzzle.board.borderAsLine===n.isVert(),a=this.lm+this.addlw/2;t.fillStyle=r,h?t.fillRectCenter(o,l,a,this.bh+a):t.fillRectCenter(o,l,this.bw+a,a)}else t.vhide()}this.addlw=0}getLineColor(t){if(this.addlw=0,t!=null&&t.isLine()){const e=t.error||t.qinfo,s=this.puzzle,n=s.execConfig("irowake")&&t.path&&t.path.color,r=s.execConfig("dispmove");return t.trial&&s.execConfig("irowake")?this.addlw=-this.lm:e===1&&(this.addlw=1),e===1?this.errlinecolor:e===-1?this.noerrcolor:r?t.trial?this.movetrialcolor:this.movelinecolor:n?t.path.color:t.trial?this.trialcolor:this.linecolor}return null}drawTip(){const t=this.vinc("cell_linetip","auto"),e=this.cw*.3,s=this.cw*.05,n=this.range.cells;for(let r=0;r<n.length;r++){const o=n[r];let l=0,h=null;if(o.lcnt===1&&o.qnum===-1&&!this.puzzle.execConfig("dispmove")){const a=o.adjborder;a.top.isLine()?(l=2,h=a.top):a.bottom.isLine()?(l=1,h=a.bottom):a.left.isLine()?(l=4,h=a.left):a.right.isLine()&&(l=3,h=a.right)}if(t.vid=`c_tip_${o.id}`,l!==0){t.strokeStyle=this.getLineColor(h)||this.linecolor,t.lineWidth=this.lw+this.addlw,t.beginPath();const a=o.bx*this.bw+1,c=o.by*this.bh+1;l===1?t.setOffsetLinePath(a,c,-e,e,0,-s,e,e,!1):l===2?t.setOffsetLinePath(a,c,-e,-e,0,s,e,-e,!1):l===3?t.setOffsetLinePath(a,c,e,-e,-s,0,e,e,!1):l===4&&t.setOffsetLinePath(a,c,-e,-e,s,0,-e,e,!1),t.stroke()}else t.vhide()}}drawPekes(){const t=this.vinc("border_peke","auto",!0);let e=this.cw*.15+1;e<4&&(e=4),t.lineWidth=1+this.cw/40|0;const s=this.range.borders;for(let n=0;n<s.length;n++){const r=s[n];t.vid=`b_peke_${r.id}`,r.qsub===2?(t.strokeStyle=r.trial?this.trialcolor:this.pekecolor,t.strokeCross(r.bx*this.bw,r.by*this.bh,e-1)):t.vhide()}}drawBaseMarks(){const t=this.vinc("cross_mark","auto",!0);t.fillStyle=this.quescolor;const e=this.cw/10,s=this.range.crosses;for(let n=0;n<s.length;n++){const r=s[n];t.vid=`x_cm_${r.id}`,t.fillCircle(r.bx*this.bw,r.by*this.bh,e/2)}}drawTriangle(){const t=this.vinc("cell_triangle","auto"),e=this.range.cells;for(let s=0;s<e.length;s++){const n=e[s],r=n.ques!==0?n.ques:n.qans;t.vid=`c_tri_${n.id}`,r>=2&&r<=5?(t.fillStyle=this.getTriangleColor(n),this.drawTriangle1(n.bx*this.bw,n.by*this.bh,r)):t.vhide()}}getTriangleColor(t){return this.quescolor}drawTriangle1(t,e,s,n=0){const r=this.context,o=this.bw+1-n,l=this.bh+1-n;switch(r.beginPath(),s){case 2:r.setOffsetLinePath(t,e,-o,-l,-o,l,o,l,!0);break;case 3:r.setOffsetLinePath(t,e,o,-l,-o,l,o,l,!0);break;case 4:r.setOffsetLinePath(t,e,-o,-l,o,-l,o,l,!0);break;case 5:r.setOffsetLinePath(t,e,-o,-l,o,-l,-o,l,!0);break}r.fill()}drawMBs(){const t=this.vinc("cell_mb","auto",!0);t.lineWidth=1;const e=this.cw*.35,s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n];let o=0,l=0;r.qsub>0&&(o=r.bx*this.bw,l=r.by*this.bh,t.strokeStyle=r.trial?"rgb(192, 192, 192)":this.mbcolor),t.vid=`c_MB1_${r.id}`,r.qsub===1?t.strokeCircle(o,l,e):t.vhide(),t.vid=`c_MB2_${r.id}`,r.qsub===2?t.strokeCross(o,l,e):t.vhide()}}drawCircles(t=0){let e=this.vinc("cell_circle","auto",!0);const s=this.circleratio,n=this.cw*(s[0]+s[1])/2,r=this.cw*(s[0]-t),o=this.range.cells;for(let l=0;l<o.length;l++){const h=o[l],a=this.getCircleFillColor(h);e.vid=`c_cirb_${h.id}`,a?(e.fillStyle=a,e.fillCircle(h.bx*this.bw,h.by*this.bh,r)):e.vhide()}e=this.vinc("cell_circle_stroke","auto",!0),e.lineWidth=Math.max(this.cw*(s[0]-s[1]),1);for(let l=0;l<o.length;l++){const h=o[l],a=this.getCircleStrokeColor(h);e.vid=`c_cira_${h.id}`,a?(e.strokeStyle=a,e.strokeCircle(h.bx*this.bw,h.by*this.bh,n)):e.vhide()}}getCircleStrokeColor(t){switch(this.circlestrokecolor_func){case"qnum":return this.getCircleStrokeColor_qnum(t);case"qnum2":return this.getCircleStrokeColor_qnum2(t)}}getCircleStrokeColor_qnum(t){const e=this.puzzle,s=t.error||t.qinfo,n=e.execConfig("dispmove");return(n?t.base:t).qnum!==-1?n&&e.mouse.mouseCell===t?this.movecolor:s===1||s===4?this.errcolor1:this.quescolor:null}getCircleStrokeColor_qnum2(t){return t.qnum===1?t.error===1?this.errcolor1:this.quescolor:null}getCircleFillColor(t){switch(this.circlefillcolor_func){case"qnum":return this.getCircleFillColor_qnum(t);case"qnum2":return this.getCircleFillColor_qnum2(t);case"qcmp":return this.getCircleFillColor_qcmp(t);default:throw new Error("circlefillcolor_func is invalid.")}}getCircleFillColor_qnum(t){if(t.qnum!==-1){const e=t.error||t.qinfo;return e===1||e===4?this.errbcolor1:this.circlebasecolor}return null}getCircleFillColor_qnum2(t){return t.qnum===1?t.error===1?this.errbcolor1:"white":t.qnum===2?t.error===1?this.errcolor1:this.quescolor:null}getCircleFillColor_qcmp(t){const e=this.puzzle,s=t.error||t.qinfo;return(e.execConfig("dispmove")?t.base:t).qnum!==-1?s===1||s===4?this.errbcolor1:t.isCmp()?this.qcmpcolor:this.circlebasecolor:null}drawDepartures(){const t=this.vinc("cell_depart","auto",!0);t.fillStyle=this.movelinecolor;const e=this.cw*.15,s=this.puzzle.execConfig("dispmove"),n=this.range.cells;for(let r=0;r<n.length;r++){const o=n[r];if(t.vid=`c_dcir_${o.id}`,s&&o.isDeparture()){const l=o.bx*this.bw,h=o.by*this.bh;t.fillCircle(l,h,e)}else t.vhide()}}drawLineParts(){const t=this.vinc("cell_lineparts","crispEdges");t.fillStyle=this.quescolor;const e=this.lm,s=this.bw,n=this.bh,r=this.range.cells;for(let o=0;o<r.length;o++){const l=r[o],h=l.ques;if(t.vid=`c_lp_${l.id}`,h>=11&&h<=17){const a=l.bx*this.bw,c=l.by*this.bh,u=a-s-.5,d=a-e,f=a+e,p=a+s+.5,k=c-n-.5,g=c-e,m=c+e,y=c+n+.5,w={11:15,12:3,13:12,14:9,15:5,16:6,17:10}[h];t.beginPath(),t.moveTo(d,g),w&1&&(t.lineTo(d,k),t.lineTo(f,k)),t.lineTo(f,g),w&8&&(t.lineTo(p,g),t.lineTo(p,m)),t.lineTo(f,m),w&2&&(t.lineTo(f,y),t.lineTo(d,y)),t.lineTo(d,m),w&4&&(t.lineTo(u,m),t.lineTo(u,g)),t.closePath(),t.fill()}else t.vhide()}}drawTateyokos(){const t=this.vinc("cell_tateyoko","crispEdges"),e=Math.max(this.cw/6,3)/2,s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n],o=r.bx*this.bw,l=r.by*this.bh,h=r.qans;t.vid=`c_bar1_${r.id}`,h===11||h===12?(t.fillStyle=this.getBarColor(r,!0),t.fillRectCenter(o,l,e+this.addlw/2,this.bh)):t.vhide(),t.vid=`c_bar2_${r.id}`,h===11||h===13?(t.fillStyle=this.getBarColor(r,!1),t.fillRectCenter(o,l,this.bw,e+this.addlw/2)):t.vhide()}this.addlw=0}getBarColor(t,e){const s=t.error,n=s===1||s===4||s===5&&e||s===6&&!e;let r="";return this.addlw=0,n?(r=this.errlinecolor,this.addlw=1):s!==0?r=this.noerrcolor:t.trial?r=this.trialcolor:r=this.linecolor,r}drawQues51(){this.drawEXCellGrid(),this.drawSlash51Cells(),this.drawSlash51EXcells(),this.drawTargetTriangle()}drawSlash51Cells(){const t=this.vinc("cell_ques51","crispEdges",!0);t.strokeStyle=this.quescolor,t.lineWidth=1;const e=this.range.cells;for(let s=0;s<e.length;s++){const n=e[s];if(t.vid=`c_slash51_${n.id}`,n.ques===51){const r=n.bx*this.bw,o=n.by*this.bh;t.strokeLine(r-this.bw,o-this.bh,r+this.bw,o+this.bh)}else t.vhide()}}drawSlash51EXcells(){const t=this.vinc("excell_ques51","crispEdges",!0);t.strokeStyle=this.quescolor,t.lineWidth=1;const e=this.range.excells;for(let s=0;s<e.length;s++){const n=e[s],r=n.bx*this.bw,o=n.by*this.bh;t.vid=`ex_slash51_${n.id}`,t.strokeLine(r-this.bw,o-this.bh,r+this.bw,o+this.bh)}}drawEXCellGrid(){const t=this.vinc("grid_excell","crispEdges",!0);t.fillStyle=this.quescolor;const e=this.range.excells;for(let s=0;s<e.length;s++){const n=e[s],r=n.bx*this.bw,o=n.by*this.bh;t.vid=`ex_bdx_${n.id}`,n.by===-1&&n.bx<this.puzzle.board.maxbx?t.fillRectCenter(r+this.bw,o,.5,this.bh):t.vhide(),t.vid=`ex_bdy_${n.id}`,n.bx===-1&&n.by<this.puzzle.board.maxby?t.fillRectCenter(r,o+this.bh,this.bw,.5):t.vhide()}}drawQuesNumbersOn51(){this.vinc("cell_number51","auto");const t=this.range;for(let e=t.x1|1;e<=t.x2;e+=2)for(let s=t.y1|1;s<=t.y2;s+=2){const n=this.puzzle.board.getobj(e,s);n.isnull||this.drawQuesNumbersOn51_1(n)}}drawQuesNumbersOn51_1(t){const e=this.context;let s,n;const r=t.bx*this.bw,o=t.by*this.bh,l={ratio:.45,position:null};e.fillStyle=t.error===1||t.qinfo===1?this.errcolor1:this.quescolor,n=t.relcell(2,0),s=t.ques===51?t.qnum:-1,e.vid=[t.group,t.id,"text_ques51_rt"].join("_"),s>=0&&!n.isnull&&n.ques!==51?(l.position=this.TOPRIGHT,this.disptext(`${s}`,r,o,l)):e.vhide(),n=t.relcell(0,2),s=t.ques===51?t.qnum2:-1,e.vid=[t.group,t.id,"text_ques51_dn"].join("_"),s>=0&&!n.isnull&&n.ques!==51?(l.position=this.BOTTOMLEFT,this.disptext(`${s}`,r,o,l)):e.vhide()}drawTarget(){this.drawCursor(!0,this.puzzle.editmode)}drawCursor(t=!0,e=!0){const s=this.vinc("target_cursor","crispEdges"),n=this.range,r=this.puzzle.cursor;if(r.bx<n.x1-1||n.x2+1<r.bx||r.by<n.y1-1||n.y2+1<r.by)return;const o=r.bx*this.bw,l=r.by*this.bh;let h,a;t!==!1?(h=Math.max(this.cw/16,2)|0,a=this.bw-.5):(h=Math.max(this.cw/24,1)|0,a=this.bw*.56),e=e!==!1&&this.puzzle.getConfig("cursor")&&!this.outputImage,s.fillStyle=this.puzzle.editmode?this.targetColor1:this.targetColor3,s.vid="ti1_",e?s.fillRect(o-a,l-a,a*2,h):s.vhide(),s.vid="ti2_",e?s.fillRect(o-a,l-a,h,a*2):s.vhide(),s.vid="ti3_",e?s.fillRect(o-a,l+a-h,a*2,h):s.vhide(),s.vid="ti4_",e?s.fillRect(o+a-h,l-a,h,a*2):s.vhide()}drawTargetSubNumber(){const t=this.vinc("target_subnum","crispEdges"),e=this.range,s=this.puzzle.cursor;if(s.bx<e.x1||e.x2<s.bx||s.by<e.y1||e.y2<s.by)return;const n=s.targetdir;if(t.vid="target_subnum",t.fillStyle=this.ttcolor,this.puzzle.playmode&&n!==0){const r=this.bw,o=this.bh,l=s.bx*r+.5,h=s.by*o+.5,a=r*.8,c=o*.8;n===5?t.fillRect(l-r,h-o,a,c):n===4?t.fillRect(l+r-a,h-o,a,c):n===2?t.fillRect(l-r,h+o-c,a,c):n===3&&t.fillRect(l+r-a,h+o-c,a,c)}else t.vhide()}drawTargetTriangle(){const t=this.vinc("target_triangle","auto"),e=this.range,s=this.puzzle.cursor;if(s.bx<e.x1||e.x2<s.bx||s.by<e.y1||e.y2<s.by)return;const n=s.detectTarget();t.vid="target_triangle",t.fillStyle=this.ttcolor,this.puzzle.editmode&&n!==0?this.drawTriangle1(s.bx*this.bw,s.by*this.bh,n===4?4:2):t.vhide()}drawDashedCenterLines(){const t=this.vinc("centerline","crispEdges",!0),e=this.puzzle.board;let s=this.range.x1,n=this.range.y1,r=this.range.x2,o=this.range.y2;s<e.minbx+1&&(s=e.minbx+1),r>e.maxbx-1&&(r=e.maxbx-1),n<e.minby+1&&(n=e.minby+1),o>e.maxby-1&&(o=e.maxby-1),s-=~s&1,n-=~n&1,r+=~r&1,o+=~o&1;const l=Math.max(this.cw/(this.cw/10+3),1)|0,h=this.cw/(l*2);t.lineWidth=1,t.strokeStyle=this.gridcolor;for(let a=s;a<=r;a+=2){const c=a*this.bw,u=n*this.bh,d=o*this.bh;t.vid=`cliney_${a}`,t.strokeDashedLine(c,u,c,d,[h])}for(let a=n;a<=o;a+=2){const c=a*this.bh,u=s*this.bw,d=r*this.bw;t.vid=`clinex_${a}`,t.strokeDashedLine(u,c,d,c,[h])}}drawGrid(t=!0,e=!0){const s=this.vinc("grid","crispEdges",!0),n=this.puzzle.board;let r=this.range.x1,o=this.range.y1,l=this.range.x2,h=this.range.y2;if(r<0&&(r=0),l>2*n.cols&&(l=2*n.cols),o<0&&(o=0),h>2*n.rows&&(h=2*n.rows),r-=r&1,o-=o&1,r>=l||o>=h)return;const a=n.hasborder!==2&&t!==!1?2:0,c=this.bw,u=this.bh,d=Math.max(r,0+a),f=Math.min(l,2*n.cols-a),p=Math.max(o,0+a),k=Math.min(h,2*n.rows-a);s.lineWidth=1,s.strokeStyle=this.gridcolor;for(let g=d;g<=f;g+=2)if(s.vid=`bdy_${g}`,e!==!1){const m=g*c,y=o*u,w=h*u;s.strokeLine(m,y,m,w)}else s.vhide();for(let g=p;g<=k;g+=2)if(s.vid=`bdx_${g}`,e!==!1){const m=g*u,y=r*c,w=l*c;s.strokeLine(y,m,w,m)}else s.vhide()}drawDashedGrid(t){const e=this.vinc("grid","crispEdges",!0),s=this.puzzle.board;let n=this.range.x1,r=this.range.y1,o=this.range.x2,l=this.range.y2;n<0&&(n=0),o>2*s.cols&&(o=2*s.cols),r<0&&(r=0),l>2*s.rows&&(l=2*s.rows),n-=n&1,r-=r&1,o+=o&1,l+=l&1;const h=Math.max(this.cw/(this.cw/10+3),1)|0,a=this.cw/(h*2),c=t!==!1?2:0,u=this.bw,d=this.bh,f=Math.max(n,s.minbx+c),p=Math.min(o,s.maxbx-c),k=Math.max(r,s.minby+c),g=Math.min(l,s.maxby-c);e.lineWidth=1,e.strokeStyle=this.gridcolor;for(let m=f;m<=p;m+=2){const y=m*u,w=r*d,N=l*d;e.vid=`bdy_${m}`,e.strokeDashedLine(y,w,y,N,[a])}for(let m=k;m<=g;m+=2){const y=m*d,w=n*u,N=o*u;e.vid=`bdx_${m}`,e.strokeDashedLine(w,y,N,y,[a])}}drawChassis(t=null){const e=this.vinc("chassis","crispEdges",!0),s=this.puzzle.board;this.range.x1,this.range.y1;let n=this.range.x2,r=this.range.y2;n>2*s.cols&&(n=2*s.cols),r>2*s.rows&&(r=2*s.rows);const o=s.cols*this.cw,l=s.rows*this.ch,{lw:h,lm:a}=t||{lw:this.lw,lm:this.lm};e.fillStyle=this.quescolor,e.vid="chs1_",e.fillRect(-a,-a,h,l+h),e.vid="chs2_",e.fillRect(o-a,-a,h,l+h),e.vid="chs3_",e.fillRect(-a,-a,o+h,h),e.vid="chs4_",e.fillRect(-a,l-a,o+h,h)}drawChassis_ex1(t){const e=this.vinc("chassis_ex1","crispEdges",!0),s=this.puzzle.board;let n=this.range.x1,r=this.range.y1,o=this.range.x2,l=this.range.y2;n<=0&&(n=s.minbx),o>s.maxbx&&(o=s.maxbx),r<=0&&(r=s.minby),l>s.maxby&&(l=s.maxby);const h=this.lw,a=this.lm,c=s.cols*this.cw,u=s.rows*this.ch;if(e.fillStyle=this.quescolor,e.vid="chsex1_1_",e.fillRect(-this.cw-a,-this.ch-a,h,u+this.ch+h),e.vid="chsex1_2_",e.fillRect(c-a,-this.ch-a,h,u+this.ch+h),e.vid="chsex1_3_",e.fillRect(-this.cw-a,-this.ch-a,c+this.cw+h,h),e.vid="chsex1_4_",e.fillRect(-this.cw-a,u-a,c+this.cw+h,h),t)e.vid="chs1_",e.fillRect(-a,-a,h,u+h-1),e.vid="chs2_",e.fillRect(-a,-a,c+h-1,h);else{e.vid="chs1_",e.fillRect(-.5,-.5,1,u),e.vid="chs2_",e.fillRect(-.5,-.5,c,1);const d=this.range.cells;for(let f=0;f<d.length;f++){const p=d[f],k=(p.bx-1)*this.bw,g=(p.by-1)*this.bh;p.bx===1&&(e.vid=`chs1_sub_${p.by}`,p.ques!==51?e.fillRect(-a,g-a,h,this.ch+h):e.vhide()),p.by===1&&(e.vid=`chs2_sub_${p.bx}`,p.ques!==51?e.fillRect(k-a,-a,this.cw+h,h):e.vhide())}}}}const Fo=0,nt=1,ls=2,ae=3,Ui=4,te=5,Ho=0,H=1,Ce=2,ge=3,Qs=(i,t)=>t?{...i,...t}:i,Wo=i=>i,Un=()=>({author:"",source:"",hard:"",comment:""}),Ko=i=>!!i.author||!!i.comment||!!i.hard||!!i.source;class Ms{constructor(t,e){this.pid="",this.type=Ho,this.filever=0,this.cols=0,this.rows=0,this.body="",this.isurl=!1,this.isfile=!0,this.pid=e||"",this.metadata=Un()}parse(t){const e=this.parseFileType(t);if(!e)return null;const s=this.parseFileData(e);return s&&this.changeProperPid(),s?this:null}generate(){return this.outputFileType()+this.outputFileData()}parseFileType(t){const e=t.split(`
`),s=e.shift();let n="";return s.match(/^pzprv3/)?(this.type=H,s.match(/pzprv3\.(\d+)/)&&(this.filever=+RegExp.$1),this.pid=e.shift(),n=e.join(`
`)):s.match(/^\<\?xml/)||s.match(/^\d+$/)||(this.pid=""),n}outputFileType(){return this.type===H?[this.filever===0?"pzprv3":`pzprv3.${this.filever}`,this.pid,""].join(`
`):""}parseFileData(t){const e=t.split(`
`);let s=0,n=0;if(this.type===ge||(this.type===Ce&&this.pid==="kakuro"?(n=+e.shift()-1,s=+e.shift()-1):this.pid==="sudoku"?n=s=+e.shift():(n=+e.shift(),s=+e.shift())),n<=0||s<=0)return!1;if(this.rows=n,this.cols=s,this.type===H){let r=null,o="";const l=[];let h=!1;for(let a=0;a<e.length&&!e[a].match(/^http\:\/\//);a++){if(e[a].match(/info:\{/)){r=a,h=!0;break}if(e[a].match(/history:\{|__HISTORY__/)){r=a;break}l.push(e[a])}if(this.body+=l.join(`
`),r!==null&&JSON){let a=0,c;for(let u=r;u<e.length&&(o+=e[u],c=a,a+=(e[u].match(/\{/g)||[]).length,a-=(e[u].match(/\}/g)||[]).length,!(c>0&&a===0));u++);}if(JSON)if(h&&o.substr(0,5)==="info:"){const a=JSON.parse(o.substr(5));this.metadata=Qs(this.metadata,a.metadata),this.history=a.history||""}else o.substr(0,8)==="history:"&&(this.history=JSON.parse(o.substr(8)))}else this.type===Ce||this.type;return!0}outputFileData(){const t=this.cols,e=this.rows,s=[];if(this.type===ge||(this.type===Ce&&this.pid==="kakuro"?(s.push(e+1),s.push(t+1)):(this.pid==="sudoku"||s.push(e),s.push(t))),this.type!==ge&&s.push(this.body),this.type===H&&JSON)if(Ko(this.metadata))this.history&&s.push(`history:${JSON.stringify(this.history,null,1)}`);else{const r={metadata:Wo(this.metadata),history:this.history||void 0};s.push(`info:${JSON.stringify(r,null,1)}`)}else this.type;let n;return this.type!==ge?n=s.join(`
`):n="",n}changeProperPid(){if(this.type===H)switch(this.pid){case"ichimaga":{const t=this.body.split(`
`)[0];t==="mag"?this.pid="ichimagam":t==="cross"&&(this.pid="ichimagax");break}case"icelom":{this.body.split(`
`)[2]==="skipwhite"&&(this.pid="icelom2");break}case"pipelink":{const t=this.body.split(`
`),e=1,s=this.rows;t.slice(e,e+s).join("").match(/o/)&&(this.pid="pipelinkr");break}case"bonsan":{const t=this.body.split(`
`),e=2*this.rows,s=2*this.rows-1;t.slice(e,e+s).join("").match(/1/)&&(this.pid="heyabon");break}case"kramma":{const t=this.body.split(`
`),e=this.rows,s=this.rows+1;t.slice(e,e+s).join("").match(/1/)&&(this.pid="kramman");break}}}}class hs{constructor(){this.pid="",this.type=Fo,this.pflag=null,this.cols=0,this.rows=0,this.body="",this.isurl=!0,this.isfile=!1}parse(t){const e=this.parseURLType(t);return this.parseURLData(e),this.changeProperPid(),this}generate(){return this.outputURLType()+this.outputURLData()}parseURLType(t){let e="";if(t.match(/www\.kanpen\.net/)||t.match(/www\.geocities(\.co)?\.jp\/pencil_applet/))t.match(/([0-9a-z]+)\.html/),this.pid=RegExp.$1,t.indexOf("?heyawake=")>=0?(e=t.substr(t.indexOf("?heyawake=")+10),this.type=te):t.indexOf("?pzpr=")>=0?(e=t.substr(t.indexOf("?pzpr=")+6),this.type=Ui):(e=t.substr(t.indexOf("?problem=")+9),this.type=ae);else if(t.match(/www\.geocities(\.co)?\.jp\/heyawake/))this.pid="heyawake",e=t.substr(t.indexOf("?problem=")+9),this.type=te;else if(t.match(/indi\.s58\.xrea\.com\/(.+)\/(sa|sc)\//))this.pid=RegExp.$1,e=t.substr(t.indexOf("?")),this.type=ls;else{const s=t.indexOf("/",t.indexOf("?"));s>-1?(this.pid=t.substring(t.indexOf("?")+1,s),e=t.substr(s+1)):this.pid=t.substr(t.indexOf("?")+1),this.type=nt}return e}outputURLType(){if(typeof window<"u"&&window.location){const{protocol:t,host:e,pathname:s}=window.location;return`${t}//${e}${s}?${this.pid}/`}else return`http://pzv.jp/p.html?${this.pid}/`}parseURLData(t){var e;const s=t.split("/");let n=0,r=0;if(this.type!==ae&&this.type!==te&&(s[0]&&!Number.isNaN(+s[0])&&s.unshift(""),this.pflag=s.shift()??null),this.type===ae)this.pid==="kakuro"?(r=+s.shift()-1,n=+s.shift()-1):this.pid==="sudoku"?r=n=+s.shift():(r=+s.shift(),n=+s.shift());else if(this.type===te){const o=(e=s.shift())==null?void 0:e.split("x");n=+o[0],r=+o[1]}else n=+s.shift()||Number.NaN,r=+s.shift()||Number.NaN;this.rows=r,this.cols=n,s[s.length-1]||s.pop(),this.body=s.join("/")}outputURLData(){const t=this.cols,e=this.rows,s=[];this.type!==ae&&this.type!==te&&(this.type===Ui||this.pflag)&&s.push(this.pflag),this.type===ae?this.pid==="kakuro"?(s.push(e+1),s.push(t+1)):(this.pid==="sudoku"||s.push(e),s.push(t)):this.type===te?s.push([t,e].join("x")):(s.push(t),s.push(e)),s.push(this.body);let n=s.join("/");return n.charAt(n.length-1).match(/[a-zA-Z0-9]/)||(n+="/"),n}changeProperPid(){if(!(!this.body||this.type!==nt&&this.type!==ls))switch(this.pflag=this.pflag||"",this.pid){case"ichimaga":this.pflag.indexOf("m")>=0?this.pid="ichimagam":this.pflag.indexOf("x")>=0?this.pid="ichimagax":this.pid="ichimaga";break;case"icelom":this.pflag.indexOf("a")<0&&(this.pid="icelom2");break;case"pipelink":this.body.match(/[0-9]/)&&(this.pid="pipelinkr");break;case"bonsan":if(this.pflag.indexOf("c")<0){const t=this.cols,e=this.rows;this.body.substr(0,(((t-1)*e+4)/5|0)+((t*(e-1)+4)/5|0)||0).match(/[^0]/)&&(this.pid="heyabon")}break;case"kramma":if(this.pflag.indexOf("c")<0){const t=(this.cols-1)*(this.rows-1);let e=0;for(let s=0;s<this.body.length;s++){const n=this.body.charAt(s);if(n.match(/\w/)){if(e+=Number.parseInt(n,36),e<t){this.pid="kramman";break}}else n==="."&&(e+=36);if(e>=t)break}}break}}}const Fn=i=>i instanceof hs?i:(i=i.replace(/(\r|\n)/g,""),new hs().parse(i)),Vo=(i,t)=>i instanceof Ms?i:(i.match(/^\<\?xml/)||(i=i.replace(/[\t\r]*\n/g,`
`).replace(/\//g,`
`)),new Ms(i,t).parse(i)),Xo=(i,t,e)=>{const s=Fn(t),n=i.board;n.initBoardSize(s.cols,s.rows);let r=s.body;for(const o of e)r=o.decode(i,r);n.rebuildInfo()},Yo=(i,t)=>{const e=i.pid,s=i.board,n=new hs;let r="";for(const o of t)r+=o.encode(i);return n.pid=e,n.type=nt,n.cols=s.cols,n.rows=s.rows,n.body=r,n.generate()};class Jo{constructor(t,e){this.filever=0,this.lineseek=0,this.dataarray=null,this.datastr="",this.currentType=0,this.puzzle=t,Object.assign(this,e)}get board(){return this.puzzle.board}filedecode(t){const e=this.puzzle,s=e.board,n=Vo(t,e.pid);if(!n)throw new Error("Invalid File Data.");this.currentType=n.type;const r=this.currentType;switch(s.initBoardSize(n.cols,n.rows),this.filever=n.filever,r!==ge&&(this.lineseek=0,this.dataarray=n.body.split(`
`)),r){case H:this.decodeData(),(this.readLine()||"").match(/TrialData/)&&(this.lineseek--,this.decodeTrial());break}e.metadata=Qs(e.metadata,n.metadata),n.history&&r===H&&e.opemgr.decodeHistory(n.history),s.rebuildInfo(),this.dataarray=null}fileencode(t,e){const s=this.puzzle,n=s.board,r=new Ms("",s.pid);switch(this.currentType=t=t||H,e=e||{},this.filever=0,this.datastr="",t){case H:this.encodeData(),!e.history&&e.trial&&n.trialstage>0&&this.encodeTrial();break;default:throw"invalid File Type"}return r.type=t,r.filever=this.filever,r.cols=n.cols,r.rows=n.rows,r.body=this.datastr,r.metadata=Qs(r.metadata,s.metadata),e.history&&t===H&&(r.history=s.opemgr.encodeHistory({time:!!e.time})),this.datastr="",r.generate()}decodeData(){}encodeData(){}decodeTrial(){const t=this.puzzle.opemgr,e=this.puzzle.board,s=+this.readLine().match(/TrialData\((\d+)\)/)[1];for(let n=s-1;n>=0;n--){const r=[],o=e.freezecopy();e.allclear(!1),this.decodeData(),e.compareData(o,(l,h,a)=>{const c=e[l][h],u=c[a],d=o[l][h][a];r.push(new li(this.puzzle,c,a,u,d))}),t.history.unshift(r),t.history.unshift([new $s(this.puzzle,n,n+1)]),t.trialpos.unshift(n*2),this.readLine()}t.position=t.history.length,t.resumeTrial()}encodeTrial(){const t=this.puzzle.opemgr,e=t.position;t.disableRecord();for(let s=this.puzzle.board.trialstage;s>0;s--)this.writeLine(`TrialData(${s})`),t.resumeGoto(t.trialpos[s-1]),this.encodeData();t.resumeGoto(e),t.resumeTrial(),t.enableRecord()}readLine(){return this.lineseek++,this.dataarray[this.lineseek-1]}getItemList(t){const e=[];for(let s=0;s<t;s++){const n=this.readLine();if(!n)continue;const r=n.split(" ");for(let o=0;o<r.length;o++)r[o]!==""&&e.push(r[o])}return e}writeLine(t){typeof t=="number"?t=`${t}`:t=t||"",this.datastr+=`${t}
`}decodeObj(t,e,s,n,r,o){let l=s,h=n;const a=2,c=this.getItemList((o-n)/a+1);for(let u=0;u<c.length&&(t.call(this,this.puzzle.board.getObjectPos(e,l,h),c[u]),l+=a,l>r&&(l=s,h+=a),!(h>o));u++);}decodeCell(t){this.decodeObj(t,"cell",1,1,2*this.puzzle.board.cols-1,2*this.puzzle.board.rows-1)}decodeCross(t){this.decodeObj(t,"cross",0,0,2*this.puzzle.board.cols,2*this.puzzle.board.rows)}decodeBorder(t){const e=this.puzzle,s=e.board;s.hasborder===1||e.pid==="bosanowa"||e.pid==="fourcells"&&this.filever===0?(this.decodeObj(t,"border",2,1,2*s.cols-2,2*s.rows-1),this.decodeObj(t,"border",1,2,2*s.cols-1,2*s.rows-2)):s.hasborder===2&&(this.currentType===H?(this.decodeObj(t,"border",0,1,2*s.cols,2*s.rows-1),this.decodeObj(t,"border",1,0,2*s.cols-1,2*s.rows)):this.currentType===Ce&&(this.decodeObj(t,"border",1,0,2*s.cols-1,2*s.rows),this.decodeObj(t,"border",0,1,2*s.cols,2*s.rows-1)))}decodeCellExcell(t){this.decodeObj(t,"obj",-1,-1,this.puzzle.board.maxbx-1,this.puzzle.board.maxby-1)}encodeObj(t,e,s,n,r,o){for(let l=n;l<=o;l+=2){let h="";for(let a=s;a<=r;a+=2)h+=t.call(this,this.puzzle.board.getObjectPos(e,a,l));this.writeLine(h)}}encodeCell(t){this.encodeObj(t,"cell",1,1,2*this.puzzle.board.cols-1,2*this.puzzle.board.rows-1)}encodeCross(t){this.encodeObj(t,"cross",0,0,2*this.puzzle.board.cols,2*this.puzzle.board.rows)}encodeBorder(t){const e=this.puzzle,s=e.board;s.hasborder===1||e.pid==="bosanowa"?(this.encodeObj(t,"border",2,1,2*s.cols-2,2*s.rows-1),this.encodeObj(t,"border",1,2,2*s.cols-1,2*s.rows-2)):s.hasborder===2&&(this.currentType===H?(this.encodeObj(t,"border",0,1,2*s.cols,2*s.rows-1),this.encodeObj(t,"border",1,0,2*s.cols-1,2*s.rows)):this.currentType===Ce&&(this.encodeObj(t,"border",1,0,2*s.cols-1,2*s.rows),this.encodeObj(t,"border",0,1,2*s.cols,2*s.rows-1)))}encodeCellExcell(t){this.encodeObj(t,"obj",-1,-1,this.puzzle.board.maxbx-1,this.puzzle.board.maxby-1)}decodeCellQnum(){this.decodeCell(function(t,e){e==="-"?t.qnum=-2:e!=="."&&(t.qnum=+e)})}encodeCellQnum(){this.encodeCell(function(t){return t.qnum>=0?`${t.qnum} `:t.qnum===-2?"- ":". "})}decodeCellQnumb(){this.decodeCell(function(t,e){e==="5"?t.qnum=-2:e!=="."&&(t.qnum=+e)})}encodeCellQnumb(){this.encodeCell(function(t){return t.qnum>=0?`${t.qnum} `:t.qnum===-2?"5 ":". "})}decodeCellQnumAns(){this.decodeCell(function(t,e){e==="#"?t.qans=1:e==="+"?t.qsub=1:e==="-"?t.qnum=-2:e!=="."&&(t.qnum=+e)})}encodeCellQnumAns(){this.encodeCell(function(t){return t.qnum>=0?`${t.qnum} `:t.qnum===-2?"- ":t.qans===1?"# ":t.qsub===1?"+ ":". "})}decodeCellDirecQnum(){this.decodeCell(function(t,e){if(e!=="."){const s=e.split(",");t.qdir=s[0]!=="0"?+s[0]:0,t.qnum=s[1]!=="-"?+s[1]:-2}})}encodeCellDirecQnum(){this.encodeCell(function(t){if(t.qnum!==-1){const e=t.qdir!==0?`${t.qdir}`:"0",s=t.qnum!==-2?`${t.qnum}`:"-";return[e,",",s," "].join("")}return". "})}decodeCellAns(){this.decodeCell(function(t,e){e==="#"?t.qans=1:e==="+"&&(t.qsub=1)})}encodeCellAns(){this.encodeCell(function(t){return t.qans===1?"# ":t.qsub===1?"+ ":". "})}decodeCellQanssub(){this.decodeCell(function(t,e){e==="+"?t.qsub=1:e==="-"?t.qsub=2:e==="="?t.qsub=3:e==="%"?t.qsub=4:e!=="."&&(t.qans=+e)})}encodeCellQanssub(){this.encodeCell(function(t){return t.qans!==0?`${t.qans} `:t.qsub===1?"+ ":t.qsub===2?"- ":t.qsub===3?"= ":t.qsub===4?"% ":". "})}decodeCellAnumsub(){this.decodeCell((t,e)=>{const s=t;s.enableSubNumberArray&&e.indexOf("[")>=0&&(e=this.setCellSnum(s,e)),e==="+"?s.qsub=1:e==="-"?s.qsub=2:e==="="?s.qsub=3:e==="%"?s.qsub=4:e!=="."&&(s.anum=+e)})}encodeCellAnumsub(){this.encodeCell(t=>{const e=t;let s=".";return e.anum!==-1?s=`${e.anum}`:e.qsub===1?s="+":e.qsub===2?s="-":e.qsub===3?s="=":e.qsub===4?s="%":s=".",e.enableSubNumberArray&&e.anum===-1&&(s+=this.getCellSnum(e)),`${s} `})}setCellSnum(t,e){const s=e.substring(e.indexOf("[")+1,e.indexOf("]")).split(/,/);for(let n=0;n<s.length;++n)t.snum[n]=s[n]?+s[n]:-1;return e.substr(0,e.indexOf("["))}getCellSnum(t){const e=[];for(let n=0;n<t.snum.length;++n)e[n]=t.snum[n]!==-1?""+t.snum[n]:"";const s=e.join(",");return s!==",,,"?`[${s}]`:""}decodeCellQsub(){this.decodeCell(function(t,e){e!=="0"&&(t.qsub=+e)})}encodeCellQsub(){this.encodeCell(function(t){return t.qsub>0?`${t.qsub} `:"0 "})}decodeCrossNum(){this.decodeCross(function(t,e){e==="-"?t.qnum=-2:e!=="."&&(t.qnum=+e)})}encodeCrossNum(){this.encodeCross(function(t){return t.qnum>=0?`${t.qnum} `:t.qnum===-2?"- ":". "})}decodeBorderQues(){this.decodeBorder(function(t,e){e==="1"&&(t.ques=1)})}encodeBorderQues(){this.encodeBorder(function(t){return`${t.ques===1?"1":"0"} `})}decodeBorderAns(){this.decodeBorder(function(t,e){e==="2"?(t.qans=1,t.qsub=1):e==="1"?t.qans=1:e==="-1"&&(t.qsub=1)})}encodeBorderAns(){this.encodeBorder(function(t){return t.qans===1&&t.qsub===1?"2 ":t.qans===1?"1 ":t.qsub===1?"-1 ":"0 "})}decodeBorderLine(){this.decodeBorder(function(t,e){e==="-1"?t.qsub=2:e!=="0"&&(t.line=+e)})}encodeBorderLine(){this.encodeBorder(function(t){return t.line>0?`${t.line} `:t.qsub===2?"-1 ":"0 "})}decodeAreaRoom(){this.decodeAreaRoom_com(!0)}encodeAreaRoom(){this.encodeAreaRoom_com(!0)}decodeAreaRoom_com(t){this.readLine(),this.rdata2Border(t,this.getItemList(this.puzzle.board.rows)),this.puzzle.board.roommgr.rebuild()}encodeAreaRoom_com(t){const e=this.puzzle.board;e.roommgr.rebuild();const s=e.roommgr.components;this.writeLine(s.length);let n="";for(let r=0;r<e.cell.length;r++){const o=s.indexOf(e.cell[r].room);n+=`${o>=0?o:"."} `,(r+1)%e.cols===0&&(this.writeLine(n),n="")}}rdata2Border(t,e){const s=this.puzzle.board;for(let n=0;n<s.border.length;n++){const r=s.border[n],o=r.sidecell[0],l=r.sidecell[1],h=!o.isnull&&!l.isnull&&e[o.id]!==e[l.id];r[t?"ques":"qans"]=h?1:0}}decodeCellQnum51(){const t=this.puzzle.board;t.disableInfo(),this.decodeCellExcell(function(e,s){if(s!=="."){if(e.group==="excell")e.bx!==-1&&e.by===-1?e.qnum2=+s:e.bx===-1&&e.by!==-1&&(e.qnum=+s);else if(e.group==="cell"){const n=s.split(",");e.set51cell(),e.qnum=+n[0],e.qnum2=+n[1]}}}),t.enableInfo()}encodeCellQnum51(){this.encodeCellExcell(function(t){return t.group==="excell"?t.bx===-1&&t.by===-1?"0 ":`${t.by===-1?t.qnum2:t.qnum} `:t.group==="cell"&&t.ques===51?`${t.qnum},${t.qnum2} `:". "})}}class Zo{constructor(t,e){this.pflag="",this.outpflag="",this.outcols=null,this.outrows=null,this.outbstr="",this.puzzle=t,Object.assign(this,e)}get board(){return this.puzzle.board}checkpflag(t){return this.pflag.indexOf(t)>=0}decodeURL(t){const e=Fn(t),s=this.puzzle.board;s.initBoardSize(e.cols,e.rows),e.body&&(this.pflag=e.pflag,this.outbstr=e.body,this.decodePzpr(nt)),s.rebuildInfo()}encodeURL(t){const e=this.puzzle,s=e.pid,n=e.board,r=new hs;return t=nt,this.outpflag=null,this.outcols=n.cols,this.outrows=n.rows,this.outbstr="",this.encodePzpr(nt),r.pid=s,r.type=t,r.pflag=this.outpflag,r.cols=this.outcols,r.rows=this.outrows,r.body=this.outbstr,r.generate()}decodePzpr(t){throw"no Implemention"}encodePzpr(t){throw"no Implemention"}decodeKanpen(){throw"no Implemention"}encodeKanpen(){throw"no Implemention"}decodeHeyaApp(){throw"no Implemention"}encodeHeyaApp(){throw"no Implemention"}include(t,e,s){return e<=t&&t<=s}decode4Cell(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(e=0;e<s.length;e++){const r=n.cell[t],o=s.charAt(e);if(this.include(o,"0","4")?r.qnum=Number.parseInt(o,16):this.include(o,"5","9")?(r.qnum=Number.parseInt(o,16)-5,t++):this.include(o,"a","e")?(r.qnum=Number.parseInt(o,16)-10,t+=2):this.include(o,"g","z")?t+=Number.parseInt(o,36)-16:o==="."&&(r.qnum=-2),t++,!n.cell[t])break}this.outbstr=s.substr(e+1)}encode4Cell(){let t=0,e="";const s=this.puzzle.board;for(let n=0;n<s.cell.length;n++){let r="";const o=s.cell[n].qnum;o>=0?s.cell[n+1]&&s.cell[n+1].qnum!==-1?r=`${o.toString(16)}`:s.cell[n+2]&&s.cell[n+2].qnum!==-1?(r=`${(5+o).toString(16)}`,n++):(r=`${(10+o).toString(16)}`,n+=2):o===-2?r=".":t++,t===0?e+=r:(r||t===20)&&(e+=(t+15).toString(36)+r,t=0)}t>0&&(e+=(t+15).toString(36)),this.outbstr+=e}decode4Cross(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(e=0;e<s.length;e++){const r=n.cross[t],o=s.charAt(e);if(this.include(o,"0","4")?r.qnum=Number.parseInt(o,16):this.include(o,"5","9")?(r.qnum=Number.parseInt(o,16)-5,t++):this.include(o,"a","e")?(r.qnum=Number.parseInt(o,16)-10,t+=2):this.include(o,"g","z")?t+=Number.parseInt(o,36)-16:o==="."&&(r.qnum=-2),t++,!n.cross[t])break}this.outbstr=s.substr(e+1)}encode4Cross(){let t=0,e="";const s=this.puzzle.board;for(let n=0;n<s.cross.length;n++){let r="";const o=s.cross[n].qnum;o>=0?s.cross[n+1]&&s.cross[n+1].qnum!==-1?r=`${o.toString(16)}`:s.cross[n+2]&&s.cross[n+2].qnum!==-1?(r=`${(5+o).toString(16)}`,n++):(r=`${(10+o).toString(16)}`,n+=2):o===-2?r=".":t++,t===0?e+=r:(r||t===20)&&(e+=(t+15).toString(36)+r,t=0)}t>0&&(e+=(t+15).toString(36)),this.outbstr+=e}decodeNumber10(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(e=0;e<s.length;e++){const r=n.cell[t],o=s.charAt(e);if(o==="."?r.qnum=-2:this.include(o,"0","9")?r.qnum=Number.parseInt(o,10):this.include(o,"a","z")&&(t+=Number.parseInt(o,36)-10),t++,!n.cell[t])break}this.outbstr=s.substr(e+1)}encodeNumber10(){let t="",e=0;const s=this.puzzle.board;for(let n=0;n<s.cell.length;n++){let r="";const o=s.cell[n].qnum;o===-2?r=".":o>=0&&o<10?r=o.toString(10):e++,e===0?t+=r:(r||e===26)&&(t+=(9+e).toString(36)+r,e=0)}e>0&&(t+=(9+e).toString(36)),this.outbstr+=t}decodeNumber16(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(e=0;e<s.length;e++){const r=n.cell[t],o=s.charAt(e);if(this.include(o,"0","9")||this.include(o,"a","f")?r.qnum=Number.parseInt(o,16):o==="-"?(r.qnum=Number.parseInt(s.substr(e+1,2),16),e+=2):o==="+"?(r.qnum=Number.parseInt(s.substr(e+1,3),16),e+=3):o==="="?(r.qnum=Number.parseInt(s.substr(e+1,3),16)+4096,e+=3):o==="%"?(r.qnum=Number.parseInt(s.substr(e+1,3),16)+8192,e+=3):o==="."?r.qnum=-2:o>="g"&&o<="z"&&(t+=Number.parseInt(o,36)-16),t++,!n.cell[t])break}this.outbstr=s.substr(e+1)}encodeNumber16(){let t=0,e="";const s=this.puzzle.board;for(let n=0;n<s.cell.length;n++){let r="";const o=s.cell[n].qnum;o===-2?r=".":o>=0&&o<16?r=o.toString(16):o>=16&&o<256?r=`-${o.toString(16)}`:o>=256&&o<4096?r=`+${o.toString(16)}`:o>=4096&&o<8192?r=`=${(o-4096).toString(16)}`:o>=8192?r=`%${(o-8192).toString(16)}`:t++,t===0?e+=r:(r||t===20)&&(e+=(15+t).toString(36)+r,t=0)}t>0&&(e+=(15+t).toString(36)),this.outbstr+=e}decodeRoomNumber16(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(n.roommgr.rebuild(),e=0;e<s.length;e++){const r=s.charAt(e),o=n.roommgr.components[t].top;if(this.include(r,"0","9")||this.include(r,"a","f")?o.qnum=Number.parseInt(r,16):r==="-"?(o.qnum=Number.parseInt(s.substr(e+1,2),16),e+=2):r==="+"?(o.qnum=Number.parseInt(s.substr(e+1,3),16),e+=3):r==="="?(o.qnum=Number.parseInt(s.substr(e+1,3),16)+4096,e+=3):r==="%"?(o.qnum=Number.parseInt(s.substr(e+1,3),16)+8192,e+=3):r==="*"?(o.qnum=Number.parseInt(s.substr(e+1,4),16)+12240,e+=4):r==="$"?(o.qnum=Number.parseInt(s.substr(e+1,5),16)+77776,e+=5):r>="g"&&r<="z"&&(t+=Number.parseInt(r,36)-16),t++,t>=n.roommgr.components.length)break}this.outbstr=s.substr(e+1)}encodeRoomNumber16(){let t=0,e="";const s=this.puzzle.board;s.roommgr.rebuild();for(let n=0;n<s.roommgr.components.length;n++){let r="";const o=s.roommgr.components[n].top.qnum;o>=0&&o<16?r=o.toString(16):o>=16&&o<256?r=`-${o.toString(16)}`:o>=256&&o<4096?r=`+${o.toString(16)}`:o>=4096&&o<8192?r=`=${(o-4096).toString(16)}`:o>=8192&&o<12240?r=`%${(o-8192).toString(16)}`:o>=12240&&o<77776?r=`*${(o-12240).toString(16)}`:o>=77776?r=`$${(o-77776).toString(16)}`:t++,t===0?e+=r:(r||t===20)&&(e+=(15+t).toString(36)+r,t=0)}t>0&&(e+=(15+t).toString(36)),this.outbstr+=e}decodeArrowNumber16(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board;for(e=0;e<s.length;e++){const r=s.charAt(e),o=n.cell[t];if(this.include(r,"0","4")){const l=s.charAt(e+1);o.qdir=Number.parseInt(r,16),o.qnum=l!=="."?Number.parseInt(l,16):-2,e++}else this.include(r,"5","9")?(o.qdir=Number.parseInt(r,16)-5,o.qnum=Number.parseInt(s.substr(e+1,2),16),e+=2):r==="-"?(o.qdir=Number.parseInt(s.substr(e+1,1),16),o.qnum=Number.parseInt(s.substr(e+2,3),16),e+=4):r>="a"&&r<="z"&&(t+=Number.parseInt(r,36)-10);if(t++,!n.cell[t])break}this.outbstr=s.substr(e+1)}encodeArrowNumber16(){let t="",e=0;const s=this.puzzle.board;for(let n=0;n<s.cell.length;n++){let r="";const o=s.cell[n].qdir,l=s.cell[n].qnum;l===-2?r=`${o}.`:l>=0&&l<16?r=o+l.toString(16):l>=16&&l<256?r=o+5+l.toString(16):l>=256&&l<4096?r=`-${o}${l.toString(16)}`:e++,e===0?t+=r:(r||e===26)&&(t+=(e+9).toString(36)+r,e=0)}e>0&&(t+=(e+9).toString(36)),this.outbstr+=t}decodeBorder(){let t,e;const s=this.outbstr;let n;const r=[16,8,4,2,1],o=this.puzzle.board;s?(t=Math.min(((o.cols-1)*o.rows+4)/5|0,s.length),e=Math.min(((o.cols*(o.rows-1)+4)/5|0)+t,s.length)):(t=0,e=0),n=0;for(let l=0;l<t;l++){const h=Number.parseInt(s.charAt(l),32);for(let a=0;a<5;a++)n<(o.cols-1)*o.rows&&(o.border[n].ques=h&r[a]?1:0,n++)}n=(o.cols-1)*o.rows;for(let l=t;l<e;l++){const h=Number.parseInt(s.charAt(l),32);for(let a=0;a<5;a++){const c=o.border[n];c&&c.inside&&(c.ques=h&r[a]?1:0,n++)}}o.roommgr.rebuild(),this.outbstr=s.substr(e)}encodeBorder(){let t="";const e=[16,8,4,2,1];let s=0,n=0;const r=this.puzzle.board;for(let o=0;o<(r.cols-1)*r.rows;o++)n+=r.border[o].ques*e[s],s++,s===5&&(t+=n.toString(32),s=0,n=0);s>0&&(t+=n.toString(32)),s=0,n=0;for(let o=(r.cols-1)*r.rows;o<2*r.cols*r.rows-r.cols-r.rows;o++)n+=r.border[o].ques*e[s],s++,s===5&&(t+=n.toString(32),s=0,n=0);s>0&&(t+=n.toString(32)),this.outbstr+=t}decodeCrossMark(){let t=0,e=0;const s=this.outbstr,n=this.puzzle.board,r=n.hascross===2?1:0,o=r<<1,l=n.rows-1+o,h=n.cols-1+o;for(e=0;e<s.length;e++){const a=s.charAt(e);if(this.include(a,"0","9")||this.include(a,"a","z")){t+=Number.parseInt(a,36);const c=t%h+(1-r)<<1,u=(t/h|0)+(1-r)<<1;if(u>n.maxby-2*(1-r)){e++;break}n.getx(c,u).qnum=1}else a==="."&&(t+=35);if(t++,t>=h*l){e++;break}}this.outbstr=s.substr(e)}encodeCrossMark(){let t="",e=0;const s=this.puzzle.board,n=s.hascross===2?1:0,r=n<<1,o=s.rows-1+r,l=s.cols-1+r;for(let h=0,a=l*o;h<a;h++){let c="";const u=h%l+(1-n)<<1,d=(h/l|0)+(1-n)<<1;s.getx(u,d).qnum===1?c=".":e++,c?(t+=e.toString(36),e=0):e===36&&(t+=".",e=0)}e>0&&(t+=e.toString(36)),this.outbstr+=t}decodeCircle(){const t=this.puzzle.board,e=this.outbstr;let s=0;const n=[9,3,1],r=e?Math.min((t.cols*t.rows+2)/3|0,e.length):0;for(let o=0;o<r;o++){const l=Number.parseInt(e.charAt(o),27);for(let h=0;h<3;h++)if(t.cell[s]){const a=(l/n[h]|0)%3;a>0&&(t.cell[s].qnum=a),s++}}this.outbstr=e.substr(r)}encodeCircle(){const t=this.puzzle.board;let e="",s=0,n=0;const r=[9,3,1];for(let o=0;o<t.cell.length;o++)t.cell[o].qnum>0&&(n+=t.cell[o].qnum*r[s]),s++,s===3&&(e+=n.toString(27),s=0,n=0);s>0&&(e+=n.toString(27)),this.outbstr+=e}decodeIce(){const t=this.outbstr,e=this.puzzle.board;let s=0;const n=[16,8,4,2,1];let r;for(r=0;r<t.length;r++){const o=Number.parseInt(t.charAt(r),32);for(let l=0;l<5;l++)e.cell[s]&&(e.cell[s].ques=o&n[l]?6:0,s++);if(!e.cell[s])break}this.outbstr=t.substr(r+1)}encodeIce(){let t="",e=0,s=0;const n=[16,8,4,2,1],r=this.puzzle.board;for(let o=0;o<r.cell.length;o++)r.cell[o].ques===6&&(s+=n[e]),e++,e===5&&(t+=s.toString(32),e=0,s=0);e>0&&(t+=s.toString(32)),this.outbstr+=t}decodecross_old(){const t=this.outbstr;let e=0;const s=this.puzzle.board;let n;for(n=0;n<t.length;n++){const r=t.charAt(n);if(this.include(r,"0","4")&&(s.cross[e].qnum=Number.parseInt(r,10)),e++,!s.cross[e]){n++;break}}this.outbstr=t.substr(n)}}var Fi;const Ie=(Fi=globalThis.window)==null?void 0:Fi.document;let $e=null;const rt={document:Ie,init(){if($e||typeof window>"u")return;const i=Ie.createElement("div");i.style.display="inline",i.style.position="absolute",i.style.top="0px",i.style.left="-9000px",i.innerHTML="",Ie.body.appendChild(i),i.offsetHeight!==void 0?$e=i:Ie.body.removeChild(i)},getoffsetHeight(i,t){let e=0;if(t.match(/(.+\s)?([0-9]+)px (.+)$/))e=+RegExp.$2;else if($e){const s=$e;s.style.font=t,s.style.lineHeight="100%",s.innerHTML=i,e=s.offsetHeight}return e},getRectSize(i){return{width:i.offsetWidth||i.clientWidth||0,height:i.offsetHeight||i.clientHeight||0}}};let tl=-1;class Hn{constructor(t){this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.font="14px system",this.textAlign="center",this.textBaseline="middle",this.canvasid="",this.enableTextLengthWA=!1,this.canvas=t,this.canvasid=`_candle_${++tl}`,this.child=null,this.enableTextLengthWA=!1,this.canvas.getContext=e=>this,this.use={},this.vid=""}init(){this.initElement(),this.initFunction(),this.initLayer()}rectcenter(t,e,s,n){this.rect(t-s,e-n,2*s,2*n)}fillRectCenter(t,e,s,n){this.fillRect(t-s,e-n,2*s,2*n)}strokeRectCenter(t,e,s,n){this.strokeRect(t-s,e-n,2*s,2*n)}shapeRectCenter(t,e,s,n){this.shapeRect(t-s,e-n,2*s,2*n)}vhide(t){}}const Rt=rt.document,Wn=gs.browser,el="svg",sl=!(typeof Rt>"u"||!Rt.createElementNS),re="http://www.w3.org/2000/svg",ee="http://www.w3.org/1999/xlink",Hi=function(i){return i.match(/Trident\//)||i.match(/Safari\//)&&i.match(/Edge\//)}(Wn&&navigator.userAgent||"");function ce(i){return Rt.createElementNS(re,i)}const ue=2*Math.PI,ct="M",ut="L",Wi="A",dt="z",Ki="d",de="fill",zs="stroke",Vi="stroke-width",il="shape-rendering",Ge="none",nl={left:"start",center:"middle",right:"end"},rl=(()=>{const i=typeof navigator<"u"&&navigator.userAgent||"";return i.match(/Chrome/)?{"candle-top":-.72,top:-.95,hanging:-.72,middle:-.35,alphabetic:0,bottom:.25}:i.match(/AppleWebKit/)?{"candle-top":-.7,top:-.9,hanging:-.9,middle:-.35,alphabetic:0,bottom:.25}:i.match(/Trident/)?{"candle-top":-.74,top:-1.02,hanging:-1.02,middle:-.32,alphabetic:0,bottom:.45}:i.match(/Win/)?{"candle-top":-.7,top:-.85,hanging:-.85,middle:-.34,alphabetic:0,bottom:.15}:{"candle-top":-.76,top:-.9,hanging:-.9,middle:-.38,alphabetic:0,bottom:.08}})();class ol extends Hn{constructor(t){super(t),this.use=this.getTypeList(),this.vid="",this.elements={},this._textcache={},this.target=null,this.layers={},this.cpath=[],this.lastpath="",this.freezepath=!1,this.enableTextLengthWA=!!Hi}getTypeList(){return{}}initElement(){Wn&&(this.canvas.style.overflow="hidden"),rt.getRectSize(this.canvas),this.child=Rt.createElementNS(re,"svg");const t=this.child;t.setAttribute("xmlns",re),t.setAttribute("xmlns:xlink",ee),t.setAttribute("font-size","10px"),t.setAttribute("font-family","sans-serif"),t.setAttribute("viewBox",[0,0,500,500].join(" ")),this.canvas.appendChild&&this.canvas.appendChild(t)}initFunction(){function t(r){return window.btoa(r)}const e=`<?xml version="1.0" encoding="UTF-8"?>
`;function s(r){return r.outerHTML}const n=this.child;this.canvas.toDataURL=function(r,o){return`data:image/svg+xml;base64,${t(s(n))}`},this.canvas.toBlob=function(r,o,l){r(new Blob([e+s(n)],{type:"image/svg+xml"}))},this.canvas.toBuffer=function(r,o){return e+s(n)}}initLayer(){this.setLayer();const t=rt.getRectSize(this.canvas);this.rect(0,0,t.width,t.height),this.addVectorElement(!1,!1)}clear(){const t=this.child;let e=t.firstChild;for(;e;)t.removeChild(e),e=t.firstChild;this.vid="",this.elements={},this.layers={},this.target=this.child,this.setLayer(),this._textcache={}}setLayer(t=null,e=null){if(e=e||{},this.vid="",t){let s=this.layers[t];s||(s=this.layers[t]=ce("g"),this.child.appendChild(s)),this.target=s}else this.target=this.child;e.rendering&&this.setRendering(e.rendering),this.freezepath=!!e&&e.freeze}setRendering(t){this.target.setAttribute(il,t)}changeSize(t,e){const s=this.child,n=s.getAttribute("viewBox").split(/ /);s.setAttribute("viewBox",[n[0],n[1],t,e].join(" "))}translate(t,e){const s=this.child.getAttribute("viewBox").split(/ /);s[0]=(-t).toString(),s[1]=(-e).toString(),this.child.setAttribute("viewBox",s.join(" "))}beginPath(){this.cpath=[],this.lastpath=""}closePath(){this.cpath.push(dt),this.lastpath=dt}moveTo(t,e){this.cpath.push(ct,t,e),this.lastpath=ct}lineTo(t,e){this.lastpath!==ut&&this.cpath.push(ut),this.cpath.push(t,e),this.lastpath=ut}rect(t,e,s,n){this.cpath.push(ct,t,e,ut,t+s,e,t+s,e+n,t,e+n,dt),this.lastpath=dt}arc(t,e,s,n,r,o){let l,h,a,c;r-n>=ue?(l=t+s,h=e,a=t+s,c=e):(l=t+s*Math.cos(n),h=e+s*Math.sin(n),a=t+s*Math.cos(r),c=e+s*Math.sin(r)),r-n>=ue&&(h+=.125);const u=n>r!=Math.abs(r-n)>Math.PI,d=(o?1:0)^(u?1:0)?1:0,f=(d===0?1:0)^(u?1:0)?1:0;this.cpath.push(ct,l,h,Wi,s,s,0,d,f,a,c),this.lastpath=Wi}fill(){this.addVectorElement(!0,!1)}stroke(){this.addVectorElement(!1,!0)}shape(){this.addVectorElement(!0,!0)}fillRect(t,e,s,n){const r=this.cpath;this.cpath=[],this.rect(t,e,s,n),this.addVectorElement(!0,!1),this.cpath=r}strokeRect(t,e,s,n){const r=this.cpath;this.cpath=[],this.rect(t,e,s,n),this.addVectorElement(!1,!0),this.cpath=r}shapeRect(t,e,s,n){const r=this.cpath;this.cpath=[],this.rect(t,e,s,n),this.addVectorElement(!0,!0),this.cpath=r}setLinePath(...t){const e=t.length,s=e-(e|1?1:2),n=[];for(let r=0;r<s;r+=2)n[r>>1]=[t[r],t[r+1]];this.beginPath(),this.setLinePath_com.call(this,n),t[e-1]&&this.cpath.push(dt)}setOffsetLinePath(...t){const e=t.length,s=e-(e|1?1:2),n=[];for(let r=0;r<s-2;r+=2)n[r>>1]=[t[r+2]+t[0],t[r+3]+t[1]];this.beginPath(),this.setLinePath_com.call(this,n),t[e-1]&&this.cpath.push(dt)}setLinePath_com(t){for(let e=0,s=t.length;e<s;e++)this.cpath.push(e===0?ct:ut),this.cpath.push(t[e][0],t[e][1])}strokeLine(t,e,s,n){const r=this.cpath;this.cpath=[ct,t,e,ut,s,n],this.addVectorElement(!1,!0),this.cpath=r}strokeDashedLine(t,e,s,n,r){const o=this.cpath;this.cpath=[ct,t,e,ut,s,n];const l=this.addVectorElement(!1,!0);l==null||l.setAttribute("stroke-dasharray",r.join(" ")),this.cpath=o}strokeCross(t,e,s){const n=this.cpath;this.cpath=[ct,t-s,e-s,ut,t+s,e+s,ct,t-s,e+s,ut,t+s,e-s],this.addVectorElement(!1,!0),this.cpath=n}fillCircle(t,e,s){const n=this.cpath;this.cpath=[],this.arc(t,e,s,0,ue,!1),this.cpath.push(dt),this.addVectorElement(!0,!1),this.cpath=n}strokeCircle(t,e,s){const n=this.cpath;this.cpath=[],this.arc(t,e,s,0,ue,!1),this.cpath.push(dt),this.addVectorElement(!1,!0),this.cpath=n}shapeCircle(t,e,s){const n=this.cpath;this.cpath=[],this.arc(t,e,s,0,ue,!1),this.cpath.push(dt),this.addVectorElement(!0,!0),this.cpath=n}getDefsElement(){let t=this.child.querySelector("defs");return t||(t=Rt.createElementNS(re,"defs"),this.child.insertBefore(t,this.child.firstChild||null)),t}getImageElement(t){const e=this.getDefsElement();let s=null;const n=e.querySelectorAll("image");for(let r=0;r<n.length;r++)if(n[r].getAttributeNS(ee,"href")===t.src){s=n[r];break}return s||(s=ce("image"),s.setAttribute("id",`${s.ownerDocument?`${this.canvasid}_`:""}img${n.length}`),s.setAttribute("width",t.width.toString()),s.setAttribute("height",t.height.toString()),s.setAttributeNS(ee,"xlink:href",t.src),e.appendChild(s)),s}getImageSymbol(t,e,s,n,r){const o=this.getDefsElement(),l=[e,s,n,r].join(" ");let h=null;const a=o.querySelectorAll("symbol");for(let c=0;c<a.length;c++)if(a[c].getAttribute("viewBox")===l){h=a[c];break}if(!h){h=Rt.createElementNS(re,"symbol"),h.setAttribute("id",`${h.ownerDocument?`${this.canvasid}_`:""}symimg${a.length}`),h.setAttribute("viewBox",l);const c=Rt.createElementNS(re,"use");c.setAttributeNS(ee,"xlink:href",`#${this.getImageElement(t).getAttribute("id")}`),h.appendChild(c),o.appendChild(h)}return h}fillText(t,e,s,n){const r=this.vid?this.elements[this.vid]:null;if(t&&this.fillStyle&&this.fillStyle!=="none"){const o=this.fillText_main(r,t,e,s,n);!r&&this.vid&&(this.elements[this.vid]=o)}else r&&this.hide(r);this.vid=""}fillText_main(t,e,s,n,r){const o=(h=>!h)(t),l=this.vid?this._textcache[this.vid]||{}:{};if(t?this.show(t):t=ce("text"),t.getAttribute(de)!==this.fillStyle&&t.setAttribute(de,this.fillStyle),l.x!==s||l.y!==n||l.ml!==r||l.ta!==this.textAlign||l.tb!==this.textBaseline||l.font!==this.font){const h=n-rt.getoffsetHeight(e,this.font)*rl[this.textBaseline.toLowerCase()],a=nl[this.textAlign.toLowerCase()];t.getAttribute("x")!==s.toString()&&t.setAttribute("x",s.toString()),t.getAttribute("y")!==h.toString()&&t.setAttribute("y",h.toString()),t.getAttribute("text-anchor")!==a&&t.setAttribute("text-anchor",a),(t.getAttribute("textLength")||"")!==(r==null?void 0:r.toString())&&(r?(t.setAttribute("textLength",r==null?void 0:r.toString()),t.setAttribute("lengthAdjust","spacingAndGlyphs")):(t.removeAttribute("textLength"),t.removeAttribute("lengthAdjust"))),l.x=s,l.y=n,l.ml=r,l.ta=this.textAlign,l.tb=this.textBaseline}if(l.font!==this.font){if(this.font.match(/(.+\s)?([0-9]+)px (.+)$/)){const h=RegExp.$1,a=RegExp.$2,c=RegExp.$3;t.setAttribute("font-size",a),c.match(/^sans\-serif$/i)?t.removeAttribute("font-family"):t.setAttribute("font-family",c),h.match(/(italic|oblique)/)?t.setAttribute("font-style",RegExp.$1):t.removeAttribute("font-style"),h.match(/(bold|bolder|lighter|[1-9]00)/)?t.setAttribute("font-weight",RegExp.$1):t.removeAttribute("font-weight")}else t.setAttribute("font",this.font);l.font=this.font}if(t.textContent!==e&&(t.textContent=e),this.vid&&(this._textcache[this.vid]=l),o&&this.target.appendChild(t),Hi&&this.enableTextLengthWA&&(l.ta==="center"||l.ta==="right")&&r){t.removeAttribute("textLength");const h=t.getBoundingClientRect();t.setAttribute("x",l.x+(h.width-r)/(l.ta==="center"?2:1)),t.setAttribute("textLength",r.toString())}return t}drawImage(t,e,s,n,r,o,l,h,a){const c=this.vid?this.elements[this.vid]:null;if(t){n===void 0&&(n=t.width,r=t.height),o===void 0&&(o=e,e=0,l=s,s=0,h=n,a=r);const u=this.drawImage_main(c,t,e,s,n,r,o,l,h,a);!c&&this.vid&&(this.elements[this.vid]=u)}else c&&this.hide(c);this.vid=""}drawImage_main(t,e,s,n,r,o,l,h,a,c){const u=!t;t?this.show(t):t=ce("use");const d=this.getImageSymbol(e,s,n,r,o).getAttribute("id");return t.getAttribute("x")!==l.toString()&&t.setAttribute("x",l.toString()),t.getAttribute("y")!==h.toString()&&t.setAttribute("y",h.toString()),t.getAttribute("width")!==a.toString()&&t.setAttribute("width",a.toString()),t.getAttribute("height")!==c.toString()&&t.setAttribute("height",c.toString()),t.getAttributeNS(ee,"xlink:href")!==`#${d}`&&t.setAttributeNS(ee,"xlink:href",`#${d}`),u&&this.target.appendChild(t),t}addVectorElement(t,e){t=t&&!!this.fillStyle&&this.fillStyle!=="none",e=e&&!!this.strokeStyle&&this.strokeStyle!=="none";const s=this.vid?this.elements[this.vid]:null;let n=null;return t||e?(n=this.addVectorElement_main(s,t,e),!s&&this.vid&&(this.elements[this.vid]=n)):s&&this.hide(s),this.vid="",n}addVectorElement_main(t,e,s){const n=!t;if(t?this.show(t):(t=ce("path"),t.setAttribute(de,Ge),t.setAttribute(zs,Ge)),!this.freezepath||n){const l=this.cpath.join(" "),h=s?this.lineWidth:null;t.getAttribute(Ki)!==l&&t.setAttribute(Ki,l),t.getAttribute(Vi)!==(h==null?void 0:h.toString())&&t.setAttribute(Vi,h==null?void 0:h.toString())}const r=e?this.fillStyle:Ge,o=s?this.strokeStyle:Ge;return t.getAttribute(de)!==r&&t.setAttribute(de,r),t.getAttribute(zs)!==o&&t.setAttribute(zs,o),n&&this.target.appendChild(t),t}vhide(t){const e=this.elements[this.vid];e&&this.hide(e)}show(t){t.removeAttribute("display")}hide(t){t.setAttribute("display","none")}}const ll={WrapperClass:ol,wrapperType:el,isWrapperEnable:sl},hl=rt.document,se=gs.browser,al="canvas",cl=!0,Ns=2*Math.PI,ul=(()=>{const i=typeof navigator<"u"&&navigator.userAgent||"";return i.match(/Chrome/)?-.72:i.match(/AppleWebKit/)?-.7:i.match(/Trident/)?-.74:i.match(/Win/)?-.7:-.76})();class dl extends Hn{constructor(t){super(t),this.context=null,this.use=this.getTypeList(),this.currentLayerId="_empty",this.isedgearray={_empty:!1},this.isedge=!1,this.x0=0,this.y0=0}getTypeList(){return{}}setkey(t){return this}hidekey(t){return this}release(t){return this}initElement(){this.child=hl.createElement("canvas");const t=this.child;se&&(this.canvas.style.overflow="hidden");const e=rt.getRectSize(this.canvas);t.width=e.width,t.height=e.height,se&&(t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,this.canvas.appendChild(t)),this.context=t.getContext("2d")}initFunction(){function t(s){return window.atob(s)}const e=this.child;this.canvas.toDataURL=function(s,n){return e.toDataURL(s||void 0,n)},this.canvas.toBlob=function(s,n,r){if(typeof e.toBlob=="function")e.toBlob(s,n,r);else{e.toDataURL(n||void 0,r).match(/data:(.*);base64,(.*)/);const o=t(RegExp.$2),l=o.length,h=new Uint8Array(l);for(let a=0;a<l;a++)h[a]=o.charCodeAt(a);s(new Blob([h.buffer],{type:RegExp.$1}))}},this.canvas.toBuffer=function(s,n){const r=e.toDataURL(s||void 0,n).replace(/^data:image\/\w+?;base64,/,"");let o;if(typeof Uint8Array<"u"){const l=t(r);o=new Uint8Array(l.length);for(let h=0;h<l.length;h++)o[h]=l.charCodeAt(h)}else o=t(r);return o}}initLayer(){this.setLayer()}clear(){if(this.setProperties(!0,!0),this.context.setTransform(1,0,0,1,0,0),this.context.translate(this.x0,this.y0),se){const t=rt.getRectSize(this.canvas);this.context.clearRect(0,0,t.width,t.height)}}setLayer(t=null,e=null){this.currentLayerId=t||"_empty";const s=this.currentLayerId;this.isedge=this.isedgearray[this.isedgearray[s]!==void 0?s:"_empty"],this.setEdgeStyle(),e=e||{},e.rendering&&this.setRendering(e.rendering)}setEdgeStyle(){if(!se)return;const t=this.canvas.style;"imageRendering"in t&&(t.imageRendering="",this.isedge&&(t.imageRendering="pixelated",t.imageRendering||(t.imageRendering="-webkit-optimize-contrast"),t.imageRendering||(t.imageRendering="-moz-crisp-edges"),t.imageRendering||(t.imageRendering="-o-crisp-edges")))}setRendering(t){this.isedge=this.isedgearray[this.currentLayerId]=t==="crispEdges",this.setEdgeStyle()}changeSize(t,e){if(se){const n=this.canvas;n.style.width=`${t}px`,n.style.height=`${e}px`}const s=this.child;if(se){const n=Number.parseInt(s.style.left),r=Number.parseInt(s.style.top);t+=n<0?-n:0,e+=r<0?-r:0,s.style.width=`${t}px`,s.style.height=`${e}px`}}translate(t,e){this.x0=t,this.y0=e,this.context.translate(t,e)}setProperties(t,e){t=t&&!!this.fillStyle&&this.fillStyle!=="none",e=e&&!!this.strokeStyle&&this.strokeStyle!=="none";const s=this.context;return t&&(s.fillStyle=this.fillStyle),e&&(s.strokeStyle=this.strokeStyle),s.lineWidth=this.lineWidth,s.font=this.font,s.textAlign=this.textAlign,s.textBaseline=this.textBaseline,t||e}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}moveTo(t,e){this.context.moveTo(t,e)}lineTo(t,e){this.context.lineTo(t,e)}rect(t,e,s,n){this.context.rect(t,e,s,n)}arc(t,e,s,n,r,o){this.context.arc(t,e,s,n,r,o)}fill(){this.setProperties(!0,!1)&&this.context.fill()}stroke(){this.setProperties(!1,!0)&&this.context.stroke()}shape(){if(this.setProperties(!0,!0)){const t=this.context;this.fillStyle&&this.fillStyle!=="none"&&t.fill(),this.strokeStyle&&this.strokeStyle!=="none"&&t.stroke()}}fillRect(t,e,s,n){this.setProperties(!0,!1)&&this.context.fillRect(t,e,s,n)}strokeRect(t,e,s,n){this.setProperties(!1,!0)&&this.context.strokeRect(t,e,s,n)}shapeRect(t,e,s,n){if(this.setProperties(!0,!0)){const r=this.context;this.fillStyle&&this.fillStyle!=="none"&&r.fillRect(t,e,s,n),this.strokeStyle&&this.strokeStyle!=="none"&&r.strokeRect(t,e,s,n)}}setLinePath(...t){const e=t.length,s=e-(e|1?1:2),n=[];for(let r=0;r<s;r+=2)n[r>>1]=[t[r],t[r+1]];this.context.beginPath(),this.setLinePath_com.call(this,n),t[e-1]&&this.context.closePath()}setOffsetLinePath(...t){const e=t.length,s=e-(e|1?1:2)-2,n=[];for(let r=0;r<s;r+=2)n[r>>1]=[t[r+2]+t[0],t[r+3]+t[1]];this.context.beginPath(),this.setLinePath_com.call(this,n),t[e-1]&&this.context.closePath()}setLinePath_com(t){for(let e=0,s=t.length;e<s;e++){const n=t[e];e===0?this.context.moveTo(n[0],n[1]):this.context.lineTo(n[0],n[1])}}strokeLine(t,e,s,n){if(this.setProperties(!1,!0)){const r=this.context;r.beginPath(),r.moveTo(t,e),r.lineTo(s,n),r.stroke()}}strokeDashedLine(t,e,s,n,r){const o=this.context;this.setProperties(!1,!0)&&(o.beginPath(),o.moveTo(t,e),o.lineTo(s,n),o.setLineDash(r),o.stroke(),o.setLineDash([]))}strokeCross(t,e,s){if(this.setProperties(!1,!0)){const n=this.context;n.beginPath(),n.moveTo(t-s,e-s),n.lineTo(t+s,e+s),n.moveTo(t-s,e+s),n.lineTo(t+s,e-s),n.stroke()}}fillCircle(t,e,s){if(this.setProperties(!0,!1)){const n=this.context;n.beginPath(),n.arc(t,e,s,0,Ns,!1),n.fill()}}strokeCircle(t,e,s){if(this.setProperties(!1,!0)){const n=this.context;n.beginPath(),n.arc(t,e,s,0,Ns,!1),n.stroke()}}shapeCircle(t,e,s){if(this.setProperties(!0,!0)){const n=this.context;n.beginPath(),n.arc(t,e,s,0,Ns,!1),this.fillStyle&&this.fillStyle!=="none"&&n.fill(),this.strokeStyle&&this.strokeStyle!=="none"&&n.stroke()}}fillText(t,e,s,n){t&&this.setProperties(!0,!1)&&(this.textBaseline==="candle-top"&&(s-=rt.getoffsetHeight(t,this.font)*ul,this.context.textBaseline="alphabetic"),n?this.context.fillText(t,e,s,n):this.context.fillText(t,e,s))}drawImage(t,e,s){t&&this.context.drawImage(t,e,s)}}const bl={WrapperClass:dl,wrapperType:al,isWrapperEnable:cl},Qe={},Kn=[],Vn={},Ss=function(){const i={};for(let t=256;t<512;t++)i[(t-256).toString()]=t.toString(16).substr(1);return i}(),Tt={version:"",env:gs,document:rt.document,enable:{},current:"",select:function(i){return this.enable[i]?(this.current=i,!0):!1},parse:function(i){if(!Qe[i])if(i.substr(0,4)==="rgb("){const t=i.match(/\d+/g);Qe[i]=["#",Ss[t[0]],Ss[t[1]],Ss[t[2]]].join("")}else Qe[i]=i;return Qe[i]},start:function(i,t,e){rt.init();let s;if(fl(i))s=i.getContext("2d");else{let n=t;if(this.enable[n]||(n=this.current),!n||!this.enable[n])throw"No canvas environment is installed";const r=new Vn[n](i);r.init(),s=r}e&&e(s)}},fl=i=>!!i.getContext&&!!i.toBuffer;class pl{constructor(t){for(const e of Kn)this[e]=e===t}}for(const i of[ll,bl])if(i.isWrapperEnable){const t=i.wrapperType;Kn.push(t),Tt.enable[t]=!0,Tt.current||(Tt.current=t),Vn[t]=i.WrapperClass,i.WrapperClass.prototype.getTypeList=()=>new pl(t)}const ml=1;class gl{constructor(t,e){this.pid=null,this.info={},this.ready=!1,this.editmode=!1,this.playmode=!1,this.playeronly=!1,this.starttime=0,this.canvas=null,this.subcanvas=null,this.listeners={},this.config=null,t=t||{},t.pid,this.pid=(t==null?void 0:t.pid)??"",this.instancetype=t.type||"editor";const s={editor:0,player:1,viewer:2}[this.instancetype];this.playeronly=!!s,this.editmode=!this.playeronly,this.playmode=!this.editmode,this.resetTime(),this.preInitCanvasInfo={type:t.graphic||"",width:t.width||null,height:t.height||null,cellsize:t.cellsize||null},this.listeners={},this.metadata=Un(),this.config=new zo(this),Array.isArray(e==null?void 0:e.Encode)||(e==null?void 0:e.Encode)===void 0?(this.converters=[],this.initConverters(),this.converters.push(...(e==null?void 0:e.Encode)??[]),this.encode=null):(this.converters=null,this.encode=this.createEncode(e==null?void 0:e.Encode)),this.board=this.createBoard({board:e==null?void 0:e.Board,boardExec:e==null?void 0:e.BoardExec,areaRoomGraph:e==null?void 0:e.AreaRoomGraph,areaShadeGraph:e==null?void 0:e.AreaShadeGraph,areaUnshadeGraph:e==null?void 0:e.AreaUnshadeGraph,graphComponent:e==null?void 0:e.GraphComponent,lineGraph:e==null?void 0:e.LineGraph,cell:e==null?void 0:e.Cell,border:e==null?void 0:e.Border,excell:e==null?void 0:e.EXCell}),this.checker=this.createAnsCheck(e==null?void 0:e.AnsCheck),this.painter=this.createGraphic(e==null?void 0:e.Graphic),this.cursor=this.createTargetCursor(e==null?void 0:e.TargetCursor),this.mouse=this.createMouseEvent(e==null?void 0:e.MouseEvent),this.key=this.createKeyEvent(e==null?void 0:e.KeyEvent),this.fio=this.createFileIO(e==null?void 0:e.FileIO),this.opemgr=new No(this),this.faillist=this.createFailCode(e==null?void 0:e.FailCode),(t==null?void 0:t.config)!==void 0&&this.config.setAll(t.config),(t==null?void 0:t.mode)!==void 0&&this.setMode(t.mode),this.ready=!0,this.emit("ready")}mount(t){this.clear(),this.setCanvas(t),this.canvas.addEventListener("keydown",e=>{this.key.e_keydown(e)}),this.canvas.addEventListener("keyup",e=>{this.key.e_keyup(e)})}createKeyEvent(t){return new Mo(this,t)}createMouseEvent(t){return new Qt(this,t)}createBoard(t){return new ai(this,t)}createGraphic(t){return new bi(this,t)}createAnsCheck(t){return new Bo(this.board,t)}createEncode(t){return new Zo(this,t)}createFailCode(t){let e=Oo();if(t)for(const[n,r]of Object.entries(t))e.set(n,r);const s=this.getAdditionalFailCode();if(s instanceof Map)e=new Map([...e,...s]);else for(const[n,r]of Object.entries(s))e.set(n,r);return e}getAdditionalFailCode(){return{}}createFileIO(t){return new Jo(this,t)}initConverters(){this.converters.push(...this.getConverters())}getConverters(){return[]}createTargetCursor(t){return new Uo(this,t)}on(t,e){this.addListener(t,e,!1)}once(t,e){this.addListener(t,e,!0)}addListener(t,e,s){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({func:e,once:!!s})}emit(t,...e){const s=this.listeners[t];if(s)for(let n=0;n<s.length;n++){const r=s[n];s[n].once&&(s.splice(n,1),n--),r.func(this,...e)}}setCanvas(t,e){if(!t)return;di(t);const s=document.createElement("div");s.setAttribute("tabindex","1"),t.appendChild(s),this.canvas=s,yl(this,e||this.preInitCanvasInfo.type)}setCanvasSize(t,e){this.preInitCanvasInfo?(this.preInitCanvasInfo.width=t,this.preInitCanvasInfo.height=e):this.painter.resizeCanvas(t,e)}setCanvasSizeByCellSize(t=null){this.preInitCanvasInfo?this.preInitCanvasInfo.cellsize=t:this.painter.resizeCanvasByCellSize(t)}redraw(t=!1){t?this.painter.resizeCanvas():this.painter.paintAll()}irowake(){this.board.irowakeRemake(),(this.execConfig("irowake")||this.execConfig("irowakeblk"))&&this.redraw()}toDataURL(t,e,s){const n=As(t,e,s),r=_s(this,n),o=r.toDataURL(n.mimetype,n.quality);return r.parentNode&&r.parentNode.removeChild(r),o}toBlob(t,e,s,n){const r=As(e,s,n),o=_s(this,r);o.toBlob(function(l){t(l),o.parentNode&&o.parentNode.removeChild(o)},r.mimetype,r.quality)}toBuffer(t,e,s){const n=As(t,e,s),r=_s(this,n),o=r.toBuffer(n.mimetype,n.quality);return r.parentNode&&r.parentNode.removeChild(r),o}getURL(){if(this.converters!=null)return Yo(this,this.converters);if(this.encode!=null)return this.encode.encodeURL(nt)}getFileData(t,e){return this.fio.fileencode(t,e)}readURL(t){if(this.converters!=null)return Xo(this,t,this.converters);if(this.encode!=null)return this.encode.decodeURL(t)}readFile(t){this.fio.filedecode(t)}resetTime(){this.starttime=Mi()}getTime(){return Mi()-this.starttime}undo(){return this.opemgr.undo()}redo(){return this.opemgr.redo()}undoall(){for(;this.opemgr.undo(););}redoall(){for(;this.opemgr.redo(););}ismodified(){return this.opemgr.isModified()}saved(){return this.opemgr.resetModifiedState()}enterTrial(){this.opemgr.enterTrial()}acceptTrial(){this.opemgr.acceptTrial()}rejectTrial(){this.opemgr.rejectTrial(!0)}rejectCurrentTrial(){this.opemgr.rejectTrial(!1)}check(t=!0){t&&(this.key.keyreset(),this.mouse.mousereset());const e=this.checker.check(t);return e.shouldForceRedraw&&this.redraw(!0),e.text=e.gettext(this.faillist),e}ansclear(){this.board.ansclear(),this.board.rebuildInfo(),this.redraw()}subclear(){this.board.subclear(),this.redraw()}errclear(){const t=this.board.errclear();return t&&this.redraw(!0),t}clear(){this.playeronly?(this.ansclear(),this.opemgr.allerase()):(this.board.initBoardSize(),this.redraw())}setMode(t){this.playeronly||typeof t=="string"&&(t={edit:1,play:3}[t.substring(0,4)],t===void 0)||(this.editmode=t===ml,this.playmode=!this.editmode,this.cursor.adjust_modechange(),this.key.keyreset(),this.mouse.modechange(),this.board.errclear(),this.redraw(),this.emit("config","mode",t),this.emit("mode"))}getConfig(t){return this.config.get(t)}setConfig(t,e){return this.config.set(t,e)}resetConfig(t){return this.config.reset(t)}validConfig(t){return this.config.getexec(t)}execConfig(t){return this.config.get(t)&&this.config.getexec(t)}getCurrentConfig(){return this.config.getList()}saveConfig(){return this.config.getAll()}restoreConfig(t){this.config.setAll(t)}}function yl(i,t){t==="canvas"&&Tt.enable.canvas&&!CanvasRenderingContext2D.prototype.fillText&&(t="svg"),Tt.start(i.canvas,t,function(e){const s=e;if(Eo(s.canvas),s.child.style.pointerEvents="none",s.use.canvas&&!i.subcanvas){i.subcanvas=Xn("canvas");const n=i.subcanvas;document.body&&(n.id=`_${new Date().getTime()}${t}`,n.style.position="absolute",n.style.left="-10000px",n.style.top="0px",document.body.appendChild(n))}i.ready&&kl(i)})}function Xn(i){if(!Tt.enable[i])throw new Error("type is invalid");const t=document.createElement("div");return Tt.start(t,i),t}function kl(i){const t=i.painter,e=i.preInitCanvasInfo;i.preInitCanvasInfo&&(i.instancetype!=="viewer"?vl(i):t.outputImage=!0,(!t.canvasWidth||!t.canvasHeight)&&(e.width&&e.height?t.resizeCanvas(e.width,e.height):e.cellsize&&t.resizeCanvasByCellSize(e.cellsize))),t.initCanvas()}function vl(i){function t(e,s){Ro(i.canvas,e,i,s)}t("mousedown",e=>{i.mouse&&i.mouse.e_mousedown(e)}),t("mousemove",e=>{i.mouse&&i.mouse.e_mousemove(e)}),t("mouseup",e=>{i.mouse&&i.mouse.e_mouseup(e)}),t("mousecancel",e=>{i.mouse&&i.mouse.e_mousecancel(e)}),i.canvas.addEventListener("touchmove",e=>{e.cancelable&&e.preventDefault()},{passive:!1}),i.canvas.oncontextmenu=function(){return!1}}function _s(i,t){const e=Xn(t.type),s=new bi(i);return s.context=e.getContext("2d"),s.context.enableTextLengthWA=!1,s.outputImage=!0,"bgcolor"in t&&(s.bgcolor=t.bgcolor),i.pid==="kramma"&&(s.imgtile=i.painter.imgtile),s.resizeCanvasByCellSize(t.cellsize),s.unsuspend(),e}function As(i,t,e){const s={};let n=null,r=null;return t&&t>1.01&&(n=t,t=null),"cellsize"in e&&(n=e.cellsize),"bgcolor"in e&&(r=e.bgcolor),s.type=(i||Tt.current).match(/svg/)?"svg":"canvas",s.mimetype=s.type!=="svg"?`image/${i}`:"image/svg+xml",t!=null&&(s.quality=t),n!==null&&(s.cellsize=n),r!==null&&(s.bgcolor=r),s}const _=i=>class extends gl{constructor(t){super({...t,pid:i.pid},i)}},xl=_({pid:"slither",MouseEvent:{inputModes:{edit:["number","clear","info-line"],play:["line","peke","bgcolor","bgcolor1","bgcolor2","clear","info-line"]},mouseinput_auto:function(){const i=this.puzzle;i.playmode?this.checkInputBGcolor()?this.inputBGcolor():this.btn==="left"?this.mousestart||this.mousemove?this.inputLine():this.pid==="slither"&&this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputpeke()):this.btn==="right"&&(this.pid==="slither"&&(this.mousestart||this.mousemove)?this.inputpeke():this.pid==="bag"&&this.inputBGcolor(!0)):i.editmode&&this.mousestart&&this.inputqnum()},checkInputBGcolor:function(){let i=this.puzzle.execConfig("bgcolor");return i&&(this.mousestart?i=this.getpos(.25).oncell():this.mousemove?i=this.inputData>=10:i=!1),i}},KeyEvent:{enablemake:!0},Cell:{maxnum:3,minnum:0,getdir4BorderLine1:function(){const i=this.adjborder;let t=0;return i.top.isLine()&&t++,i.bottom.isLine()&&t++,i.left.isLine()&&t++,i.right.isLine()&&t++,t}},Board:{hasborder:2,borderAsLine:!0},LineGraph:{enabled:!0},Graphic:{irowake:!0,bgcellcolor_func:"qsub2",numbercolor_func:"qnum",margin:.5,paint:function(){this.drawBGCells(),this.drawLines(),this.drawBaseMarks(),this.drawQuesNumbers(),this.drawPekes(),this.drawTarget()},repaintParts:function(i){this.range.crosses=i.crossinside(),this.drawBaseMarks()}},Encode:{decodePzpr:function(i){this.decode4Cell()},encodePzpr:function(i){this.encode4Cell()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine()},encodeData:function(){this.filever=1,this.encodeCellQnum(),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkdir4BorderLine","checkOneLoop","checkDeadendLine+"],checkdir4BorderLine:function(){this.checkAllCell(function(i){return i.qnum>=0&&i.getdir4BorderLine1()!==i.qnum},"nmLineNe")}},FailCode:{nmLineNe:["数字の周りにある線の本数が違います。","The number is not equal to the number of lines around it."]}}),wl=_({pid:"sudoku",MouseEvent:{inputModes:{edit:["number","clear"],play:["number","clear"]},mouseinput_auto:function(){this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0,enableplay:!0},Cell:{enableSubNumberArray:!0,maxnum:function(){return Math.max(this.board.cols,this.board.rows)}},Board:{cols:9,rows:9,hasborder:1,initBoardSize:function(i,t){ai.prototype.initBoardSize.call(this,i,t);let e,s;e=s=(Math.sqrt(this.cols)|0)*2,this.cols===6&&(e=6);for(let n=0;n<this.border.length;n++){const r=this.border[n];(r.bx%e===0||r.by%s===0)&&(r.ques=1)}this.rebuildInfo()}},AreaRoomGraph:{enabled:!0},Graphic:{paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawBorders(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbers(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkDifferentNumberInRoom","checkDifferentNumberInLine","checkNoNumCell+"]}}),Cl=_({pid:"kakkuro",MouseEvent:{inputModes:{edit:["cell51","clear","number"],play:["number","clear"]},mouseinput_clear:function(){this.input51_fixed()},mouseinput_number:function(){this.mousestart&&this.inputqnum_cell51()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart&&this.inputqnum():this.puzzle.editmode&&this.mousestart&&this.input51()}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(i){this.puzzle.editmode?this.inputnumber51(i):this.puzzle.playmode&&this.key_inputqnum(i)}},TargetCursor:{setminmax_customize:function(){this.puzzle.editmode||(this.minx+=2,this.miny+=2)}},Cell:{qnum:0,qnum2:0,noNum:function(){return!this.isnull&&this.qnum===0&&this.qnum2===0&&this.anum===-1},disInputHatena:!0,enableSubNumberArray:!0,getmaxnum:function(){return this.puzzle.editmode?45:9},getNum:function(){return this.anum},setNum:function(i){this.setAnum(i>0?i:-1),this.clrSnum()},prehook:{qnum:function(i){return!1},qnum2:function(i){return!1}}},EXCell:{ques:51,qnum:0,qnum2:0,maxnum:45,minnum:1,disInputHatena:!0},Board:{cols:11,rows:11,hasborder:1,hasexcell:1},BoardExec:{adjustBoardData:function(i,t){this.adjustQues51_1(i,t)},adjustBoardData2:function(i,t){this.adjustQues51_2(i,t)}},Graphic:{ttcolor:"rgb(255,255,127)",numbercolor_func:"anum",paint:function(){this.drawBGCells(),this.drawBGEXcells(),this.drawTargetSubNumber(),this.drawQues51(),this.drawGrid(),this.drawBorders(),this.drawChassis_ex1(!1),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbersOn51(),this.drawCursor()},getBGCellColor:function(i){return i.error===1?this.errbcolor1:i.ques===51?"rgb(192,192,192)":null},getBGEXcellColor:function(i){return i.error?this.errbcolor1:"rgb(192,192,192)"},getBorderColor:function(i){const t=i.sidecell[0],e=i.sidecell[1];return!t.isnull&&!e.isnull&&t.ques===51!=(e.ques===51)?this.quescolor:null},getAnsNumberText:function(i){return!i.is51cell()&&i.anum>0?`${i.anum}`:""}},Encode:{decodePzpr:function(i){this.decodeKakuro()},encodePzpr:function(i){this.encodeKakuro(i)},decodeKakuro:function(){let i=0,t=0;const e=this.outbstr,s=this.puzzle.board;for(let r=0;r<e.length;r++){const o=e.charAt(r),l=s.cell[i];if(o>="k"&&o<="z"?i+=Number.parseInt(o,36)-19:(l.ques=51,o!=="."&&(l.qnum2=Me(o),l.qnum=Me(e.charAt(r+1)),r++),i++),!s.cell[i]){t=r+1;break}}let n=t;for(let r=1;r<s.maxbx;r+=2)s.getc(r,1).is51cell()||(s.getex(r,-1).qnum2=Me(e.charAt(n)),n++);for(let r=1;r<s.maxby;r+=2)s.getc(1,r).is51cell()||(s.getex(-1,r).qnum=Me(e.charAt(n)),n++);this.outbstr=e.substr(t)},encodeKakuro:function(i){let t="";const e=this.puzzle.board;let s=0;for(let n=0;n<e.cell.length;n++){let r="";const o=e.cell[n];o.ques===51?o.qnum<=0&&o.qnum2<=0?r=".":r=`${Ue(o.qnum2)}${Ue(o.qnum)}`:s++,s===0?t+=r:(r||s===16)&&(t+=(s+19).toString(36)+r,s=0)}s>0&&(t+=(s+19).toString(36));for(let n=1;n<e.maxbx;n+=2)e.getc(n,1).is51cell()||(t+=Ue(e.getex(n,-1).qnum2));for(let n=1;n<e.maxby;n+=2)e.getc(1,n).is51cell()||(t+=Ue(e.getex(-1,n).qnum));this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCellQnum51(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellQnum51(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkSameNumberInLine","checkSumOfNumberInLine","checkNoNumCell+"],checkSameNumberInLine:function(){this.checkRowsColsPartly(this.isSameNumber,function(i){return i.is51cell()},"nmDupRow")},isSameNumber:function(i,t){const e=this.isDifferentAnsNumberInClist(i);return e||t.keycell.seterr(1),e},checkSumOfNumberInLine:function(){this.checkRowsColsPartly(this.isTotalNumber,function(i){return i.is51cell()},"nmSumRowNe")},isTotalNumber:function(i,t){const e=t.key51num;let s=0;for(let r=0;r<i.length;r++)if(i[r].anum>0)s+=i[r].anum;else return!0;const n=e<=0||s===e;return n||(t.keycell.seterr(1),i.seterr(1)),n}},FailCode:{nmSumRowNe:["数字の下か右にある数字の合計が間違っています。","The sum of the cells is not correct."],ceNoNum:["すべてのマスに数字が入っていません。","There is an empty cell."]}}),Me=function(i){return i>="0"&&i<="9"||i>="a"&&i<="j"?Number.parseInt(i,36):i>="A"&&i<="Z"?Number.parseInt(i,36)+10:0},Ue=function(i){return i>=1&&i<=19?i.toString(36).toLowerCase():i>=20&&i<=45?(i-10).toString(36).toUpperCase():"0"},ql=_({pid:"mashu",MouseEvent:{inputModes:{edit:["circle-shade","circle-unshade","undef","clear","info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?this.btn==="left"?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Cell:{numberAsObject:!0,maxnum:2,setErrorPearl:function(){this.setCellLineError(1);const i=this.adjacent,t=this.adjborder;t.top.isLine()&&i.top.setCellLineError(0),t.bottom.isLine()&&i.bottom.setCellLineError(0),t.left.isLine()&&i.left.setCellLineError(0),t.right.isLine()&&i.right.setCellLineError(0)},setCellLineError:function(i){const t=this.bx,e=this.by;i&&this.seterr(1),this.board.borderinside(t-1,e-1,t+1,e+1).seterr(1)}},Board:{hasborder:1,uramashu:!1,revCircle:function(){this.uramashu&&this.revCircleMain()},revCircleConfig:function(i){this.uramashu!==i&&(this.uramashu=i,this.revCircleMain())},revCircleMain:function(){for(let i=0;i<this.cell.length;i++){const t=this.cell[i];t.qnum===1?t.setQnum(2):t.qnum===2&&t.setQnum(1)}}},LineGraph:{enabled:!0},Graphic:{irowake:!0,gridcolor_type:"LIGHT",circlefillcolor_func:"qnum2",circlestrokecolor_func:"qnum2",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawCircles(),this.drawHatenas(),this.drawPekes(),this.drawLines(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeCircle(),this.puzzle.board.revCircle()},encodePzpr:function(i){this.puzzle.board.revCircle(),this.encodeCircle(),this.puzzle.board.revCircle()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine(),this.puzzle.board.revCircle()},encodeData:function(){this.puzzle.board.revCircle(),this.encodeCellQnum(),this.encodeBorderLine(),this.puzzle.board.revCircle()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkWhitePearl1","checkBlackPearl1","checkBlackPearl2","checkWhitePearl2","checkNoLinePearl","checkDeadendLine+","checkOneLoop"],checkNoLinePearl:function(){this.checkAllCell(function(i){return i.isNum()&&i.lcnt===0},"mashuOnLine")},checkWhitePearl1:function(){let i=!0;const t=this.board;for(let e=0;e<t.cell.length;e++){const s=t.cell[e];if(s.qnum===1&&s.isLineCurve()){if(i=!1,this.checkOnly)break;s.setCellLineError(1)}}i||(this.failcode.add("mashuWCurve"),t.border.setnoerr())},checkBlackPearl1:function(){let i=!0;const t=this.board;for(let e=0;e<t.cell.length;e++){const s=t.cell[e];if(s.qnum===2&&s.isLineStraight()){if(i=!1,this.checkOnly)break;s.setCellLineError(1)}}i||(this.failcode.add("mashuBStrig"),t.border.setnoerr())},checkWhitePearl2:function(){let i=!0;const t=this.board;for(let e=0;e<t.cell.length;e++){const s=t.cell[e];if(s.qnum!==1||s.lcnt!==2)continue;const n=s.adjacent,r=s.adjborder;let o=0;if(r.top.isLine()&&n.top.isLineStraight()&&o++,r.bottom.isLine()&&n.bottom.isLineStraight()&&o++,r.left.isLine()&&n.left.isLineStraight()&&o++,r.right.isLine()&&n.right.isLineStraight()&&o++,!(o<2)){if(i=!1,this.checkOnly)break;s.setErrorPearl()}}i||(this.failcode.add("mashuWStNbr"),t.border.setnoerr())},checkBlackPearl2:function(){let i=!0;const t=this.board;for(let e=0;e<t.cell.length;e++){const s=t.cell[e],n=s.adjacent,r=s.adjborder;if(!(s.qnum!==2||s.lcnt!==2)&&!(!(r.top.isLine()&&n.top.isLineCurve())&&!(r.bottom.isLine()&&n.bottom.isLineCurve())&&!(r.left.isLine()&&n.left.isLineCurve())&&!(r.right.isLine()&&n.right.isLineCurve()))){if(i=!1,this.checkOnly)break;s.setErrorPearl()}}i||(this.failcode.add("mashuBCvNbr"),t.border.setnoerr())}},FailCode:{mashuOnLine:["線が上を通っていない丸があります。","Lines don't pass some pearls."],mashuWCurve:["白丸の上で線が曲がっています。","Lines curve on white pearl."],mashuWStNbr:["白丸の隣で線が曲がっていません。","Lines go straight next to white pearl on each side."],mashuBStrig:["黒丸の上で線が直進しています。","Lines go straight on black pearl."],mashuBCvNbr:["黒丸の隣で線が曲がっています。","Lines curve next to black pearl."]}}),zl=_({pid:"hitori",MouseEvent:{RBShadeCell:!0,use:!0,inputModes:{edit:["number","clear","info-blk"],play:["shade","unshade","info-blk"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Cell:{disInputHatena:!0,maxnum:function(){return Math.max(this.board.cols,this.board.rows)},redDisp:function(){const i=this.puzzle,t=i.board;i.getConfig("autoerr")&&(i.painter.paintRange(t.minbx-1,this.by-1,t.maxbx+1,this.by+1),i.painter.paintRange(this.bx-1,t.minby-1,this.bx+1,t.maxby+1))}},Board:{cols:8,rows:8},AreaUnshadeGraph:{enabled:!0},Graphic:{gridcolor_type:"LIGHT",enablebcolor:!0,bgcellcolor_func:"qsub1",errcolor1:"red",fontShadecolor:"rgb(96,96,96)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawShadedCells(),this.drawQuesNumbers_hitori(),this.drawChassis(),this.drawTarget()},drawQuesNumbers_hitori:function(){this.drawQuesNumbers()}},Encode:{decodePzpr:function(i){this.decodeHitori()},encodePzpr:function(i){this.encodeHitori()},decodeHitori:function(){let i=0,t=0;const e=this.outbstr,s=this.puzzle.board;for(t=0;t<e.length;t++){const n=s.cell[i],r=e.charAt(t);if(this.include(r,"0","9")||this.include(r,"a","z")?n.qnum=Number.parseInt(r,36):r==="-"?(n.qnum=Number.parseInt(e.substr(t+1,2),36),t+=2):r==="%"&&(n.qnum=-2),i++,!s.cell[i])break}this.outbstr=e.substr(t)},encodeHitori:function(){let i=0,t="";const e=this.puzzle.board;for(let s=0;s<e.cell.length;s++){let n="";const r=e.cell[s].qnum;r===-2?n="%":r>=0&&r<16?n=r.toString(36):r>=16&&r<256?n=`-${r.toString(36)}`:i++,i===0?t+=n:(t+=".",i=0)}i>0&&(t+="."),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAns()}},AnsCheck:{checklist:["checkShadeCellExist","checkAdjacentShadeCell","checkConnectUnshadeRB","checkRowsColsSameQuesNumber"],checkRowsColsSameQuesNumber:function(){this.checkRowsCols(i=>{const t=i.filter(function(e){return e.isUnshade()&&e.isNum()});return this.isIndividualObject(t,function(e){return e.qnum})},"nmDupRow")}}}),Nl=_({pid:"fillomino",MouseEvent:{inputModes:{edit:["number","clear"],play:["copynum","number","clear","border","subline"]},mouseinput_other:function(){this.inputMode==="copynum"&&this.dragnumber_fillomino()},mouseinput_auto:function(){this.puzzle.playmode&&(this.mousestart||this.mousemove)&&(this.btn==="left"?this.isBorderMode()?this.inputborder():this.dragnumber_fillomino():this.btn==="right"&&this.inputQsubLine()),this.mouseend&&this.notInputted()&&(this.mouseCell=this.puzzle.board.emptycell,this.inputqnum())},dragnumber_fillomino:function(){const i=this.getcell();if(!(i.isnull||i===this.mouseCell)){if(this.inputData===null){this.inputData=i.getNum(),this.inputData===-1&&(this.inputData=-2),this.mouseCell=i;return}if(this.inputData===-2&&(this.inputData=i.getNum()===-1?-3:-1),this.inputData>=-1&&i.qnum===-1)i.setAnum(this.inputData),i.draw();else if(this.inputData<=-3){const t=this.mouseCell,e=this.puzzle.board.getb(i.bx+t.bx>>1,i.by+t.by>>1);this.inputData===-3&&(this.inputData=e.qsub===1?-5:-4),e.isnull||(e.setQsub(this.inputData===-4?1:0),e.draw())}this.mouseCell=i}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(i){return this.puzzle.playmode&&(this.isCTRL||this.isX||this.isZ)?this.move_fillomino(i):this.moveTCell(i)},move_fillomino:function(i){const t=this.cursor.getc();if(t.isnull)return!1;const e=t.adjacent,s=t.adjborder;let n,r;switch(i){case"up":n=e.top,r=s.top;break;case"down":n=e.bottom,r=s.bottom;break;case"left":n=e.left,r=s.left;break;case"right":n=e.right,r=s.right;break;default:return!1}return n.isnull?!1:this.isCTRL||this.isX||this.isZ?(this.isCTRL?r.isnull||(r.setQsub(r.qsub===0?1:0),this.cursor.setaddr(n)):this.isZ?r.isnull||r.setQans(r.isBorder()?0:1):this.isX&&(n.isnull||(n.setAnum(t.getNum()),this.cursor.setaddr(n))),t.draw(),!0):!1}},Cell:{enableSubNumberArray:!0},Board:{hasborder:1,numblkgraph:null,addExtraInfo:function(){this.numblkgraph=this.addInfoList(Sl)}},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawDashedGrid(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbers(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAnumsub(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAnumsub(),this.encodeBorderAns()}},AnsCheck:{checklist:["checkSmallArea","checkSideAreaNumberSize","checkLargeArea","checkNumKinds","checkNoNumArea","checkNoNumCell_fillomino+"],checkSideAreaNumberSize:function(){this.checkSideAreaSize(this.board.numblkgraph,function(i){return i.number},"bsSameNum")},checkSmallArea:function(){this.checkAllErrorRoom(function(i){return!(i.number>i.clist.length&&i.number>0)},"bkSizeLt")},checkLargeArea:function(){this.checkAllErrorRoom(function(i){return!(i.number<i.clist.length&&i.number>0)},"bkSizeGt")},checkNumKinds:function(){this.checkAllErrorRoom(function(i){return i.numkind<=1},"bkMixedNum")},checkNoNumArea:function(){this.checkAllErrorRoom(function(i){return i.numkind>=1},"bkNoNum")},checkAllErrorRoom:function(i,t){const e=this.board.numblkgraph.components;for(let s=0;s<e.length;s++){const n=e[s];if(!(!n||i(n))){if(this.failcode.add(t),this.checkOnly)break;n.clist.seterr(1)}}},checkNoNumCell_fillomino:function(){this.forceallcell&&this.checkAllCell(function(i){return i.noNum()},"ceNoNum")}},FailCode:{bkSizeLt:["ブロックの大きさより数字のほうが大きいです。","A number is bigger than the size of block."],bkSizeGt:["ブロックの大きさよりも数字が小さいです。","A number is smaller than the size of block."],bkMixedNum:["1つのブロックに2種類以上の数字が入っています。","A room has two or more kinds of numbers."],bsSameNum:["同じ数字のブロックが辺を共有しています。","Adjacent blocks have the same number."]}});class Sl extends Qn{constructor(){super(...arguments),this.enabled=!0,this.relation={"cell.qnum":"node","cell.anum":"node","border.qans":"separator"}}isnodevalid(t){return!0}isedgevalidbylinkobj(t){if(t.isBorder())return!1;const e=t.sidecell[0].getNum(),s=t.sidecell[1].getNum();return e===s||e<0||s<0}setExtraData(t){t.clist=new A(t.getnodeobjs());const e=t.clist,s={};let n=0,r=-1;for(let o=0;o<e.length;o++){const l=e[o].getNum();l===-1||(s[l]?s[l]++:(n++,s[l]=1,(r===-1||l!==-2)&&(r=l)))}n>1&&s[-2]&&--n,t.numkind=n,t.number=n===1?r:-1}getComponentRefs(t){return t.nblk}getSideAreaInfo(){return super.getSideAreaInfo()}}const _l=_({pid:"numberlink",MouseEvent:{inputModes:{edit:["number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?this.btn==="left"?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Board:{hasborder:1},LineGraph:{enabled:!0,makeClist:!0},Graphic:{gridcolor_type:"LIGHT",numbercolor_func:"qnum",irowake:!0,paint:function(){this.drawBGCells(),this.drawGrid(),this.drawPekes(),this.drawLines(),this.drawCellSquare(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()},drawCellSquare:function(){const i=this.vinc("cell_number_base","crispEdges",!0),t=this.bw*.5-1,e=this.bh*.5-1,s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n];i.vid=`c_sq_${r.id}`,r.qnum!==-1?(i.fillStyle=r.error===1?this.errbcolor1:this.bgcolor,i.fillRectCenter(r.bx*this.bw,r.by*this.bh,t,e)):i.vhide()}}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkTripleObject","checkLinkSameNumber","checkLineOverLetter","checkDeadendConnectLine+","checkDisconnectLine","checkNoLineObject+"],checkLinkSameNumber:function(){this.checkSameObjectInRoom(this.board.linegraph,function(i){return i.qnum},"nmConnDiff")}},FailCode:{nmConnDiff:["異なる数字がつながっています。","Different numbers are connected."]}}),Al=_({pid:"nurikabe",MouseEvent:{use:!0,inputModes:{edit:["number","clear","info-blk"],play:["shade","unshade","info-blk"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0},AreaShadeGraph:{enabled:!0},AreaUnshadeGraph:{enabled:!0},Graphic:{numbercolor_func:"qnum",qanscolor:"black",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnumAns()},encodeData:function(){this.encodeCellQnumAns()}},AnsCheck:{checklist:["check2x2ShadeCell","checkNoNumberInUnshade","checkConnectShade","checkDoubleNumberInUnshade","checkNumberAndUnshadeSize"],checkDoubleNumberInUnshade:function(){this.checkAllBlock(this.board.ublkmgr,function(i){return i.isNum()},function(i,t,e,s){return e<2},"bkNumGe2")},checkNumberAndUnshadeSize:function(){this.checkAllArea(this.board.ublkmgr,function(i,t,e,s){return s<=0||s===e},"bkSizeNe")},checkNoNumberInUnshade:function(){this.checkAllBlock(this.board.ublkmgr,function(i){return i.isNum()},function(i,t,e,s){return e!==0},"bkNoNum")}},FailCode:{bkNoNum:["数字の入っていないシマがあります。","An area of unshaded cells has no numbers."],bkNumGe2:["1つのシマに2つ以上の数字が入っています。","An area of unshaded cells has plural numbers."],bkSizeNe:["数字とシマの面積が違います。","The number is not equal to the number of the size of the area."]}}),Ll=_({pid:"shikaku",MouseEvent:{inputModes:{edit:["number","clear"],play:["border","subline"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&(this.btn==="left"&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Board:{hasborder:1},AreaRoomGraph:{enabled:!0},Graphic:{hideHatena:!0,gridcolor_type:"DLIGHT",bordercolor_func:"qans",fontShadecolor:"white",numbercolor_func:"fixed_shaded",circleratio:[.4,.4],paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawCircledNumbers(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},circlestrokecolor_func:"null",getCircleFillColor:function(i){return i.qnum!==-1?i.error===1?this.errcolor1:this.quescolor:null}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderAns()}},AnsCheck:{checklist:["checkNoNumber","checkDoubleNumber","checkRoomRect","checkNumberAndSize","checkBorderDeadend+"],checkAhoSquare:function(){this.checkAllArea(this.board.roommgr,function(i,t,e,s){return s<0||s%3===0||i*t===e},"bkNotRect3")},checkLshapeArea:function(){const i=this.board.roommgr.components;for(let t=0;t<i.length;t++){const e=i[t],s=e.clist,n=s.getQnumCell();if(n.isnull)continue;const r=n.qnum;if(r<0||r%3!==0)continue;const o=s.getRectSize(),l=this.board.cellinside(o.x1,o.y1,o.x2,o.y2).filter(function(a){return a.room!==e}),h=l.getRectSize();if(!(l.length>0&&h.cols*h.rows===h.cnt&&(o.x1===h.x1||o.x2===h.x2)&&(o.y1===h.y1||o.y2===h.y2))){if(this.failcode.add("bkNotLshape3"),this.checkOnly)break;s.seterr(1)}}}},FailCode:{bkNoNum:["数字の入っていない領域があります。","An area has no numbers."],bkNumGe2:["1つの領域に2つ以上の数字が入っています。","An area has plural numbers."],bkSizeNe:["数字と領域の大きさが違います。","The size of the area is not equal to the number."],bkNotRect:["四角形ではない領域があります。","An area is not rectangle."],bkNotRect3:["大きさが3の倍数ではないのに四角形ではない領域があります。","An area whose size is not multiples of three is not rectangle."],bkNotLshape3:["大きさが3の倍数である領域がL字型になっていません。","An area whose size is multiples of three is not L-shape."]}}),Yn=_({pid:"heyawake",MouseEvent:{RBShadeCell:!0,use:!0,inputModes:{edit:["border","number","clear","info-blk"],play:["shade","unshade","info-blk"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())}},KeyEvent:{enablemake:!0},Cell:{maxnum:function(){const i=this.room.clist.getRectSize();let t=i.cols,e=i.rows;if(t>e){const s=t;t=e,e=s}return t===1?e+1>>1:t===2?e:t===3?e%4===0?e/4*5:e%4===1?(e-1)/4*5+2:e%4===2?(e-2)/4*5+3:(e+1)/4*5:Math.log(t+1)/Math.log(2)%1===0&&t===e?(t*e+t+e)/3:t&1&&e&1?(t*e+t+e-1)/3|0:(t*e+t+e-2)/3|0},minnum:0},Board:{hasborder:1},AreaUnshadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0,hastop:!0},Graphic:{gridcolor_type:"LIGHT",enablebcolor:!0,bgcellcolor_func:"qsub1",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawShadedCells(),this.drawQuesNumbers(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!1),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(i){this.encodeBorder(),this.encodeRoomNumber16()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAns()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAns()}},AnsCheck:{checklist:["checkShadeCellExist","checkAdjacentShadeCell","checkConnectUnshadeRB","checkShadeCellCount","checkCountinuousUnshadeCell"],checkFractal:function(){const i=this.board.roommgr.components;t:for(let t=0;t<i.length;t++){const e=i[t].clist,s=e.getRectSize(),n=s.x1+s.x2,r=s.y1+s.y2;for(let o=0;o<e.length;o++){const l=e[o],h=this.board.getc(n-l.bx,r-l.by);if(l.isShade()!==h.isShade()){if(this.failcode.add("bkNotSymShade"),this.checkOnly)break t;e.seterr(1)}}}},checkCountinuousUnshadeCell:function(){const i=this.checkOnly;this.checkOnly=!0,this.checkRowsColsPartly(jl,function(t){return t.isShade()},"bkUnshadeConsecGt3"),this.checkOnly=i}},FailCode:{bkUnshadeConsecGt3:["白マスが3部屋連続で続いています。","Unshaded cells are continued for three consecutive room."],bkNotSymShade:["部屋の中の黒マスが点対称に配置されていません。","Position of shaded cells in the room is not point symmetric."]}}),jl=(i,t,e)=>{const s=i.getRectSize();let n=0,r,o;if(s.x1===s.x2)for(r=s.x1,o=s.y1+1;o<=s.y2-1;o+=2)e.getb(r,o).isBorder()&&n++;else if(s.y1===s.y2)for(o=s.y1,r=s.x1+1;r<=s.x2-1;r+=2)e.getb(r,o).isBorder()&&n++;const l=n<=1;return l||i.seterr(1),l};class Tl extends Yn{constructor(t){super(t),this.checker.checklist=["checkShadeCellExist","checkAdjacentShadeCell","checkConnectUnshadeRB","checkFractal","checkShadeCellCount","checkCountinuousUnshadeCell"],this.checker.makeCheckList()}}const Bl=_({pid:"shakashaka",MouseEvent:{inputModes:{edit:["number","clear"],play:["objblank","completion"]},mouseinput_auto:function(){if(this.puzzle.playmode){const i=+this.puzzle.getConfig("use_tri");i===1?this.btn==="left"?this.mousestart?this.inputTriangle_corner_start():this.mousemove&&this.inputData!==null&&this.inputMove():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputDot():i===2?this.btn==="left"?this.mousestart?this.inputTriangle_pull_start():this.mousemove&&this.inputData===null?this.inputTriangle_pull_move():this.mousemove&&this.inputData!==null?this.inputMove():this.mouseend&&this.notInputted()&&this.inputTriangle_pull_end():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputDot():i===3&&this.mousestart&&this.inputTriangle_onebtn(),this.mouseend&&this.notInputted()&&this.inputqcmp()}else this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputMove:function(){this.inputData>=2&&this.inputData<=5?this.inputTriangle_drag():(this.inputData===0||this.inputData===-1)&&this.inputDot()},inputTriangle_corner_start:function(){const i=this.getcell();i.isnull||(this.inputData=this.checkCornerData(i),i.setAnswer(this.inputData),this.mouseCell=i,i.draw())},checkCornerData:function(i){if(i.isNum())return-1;let t=null;if(this.puzzle.getConfig("support_tri")){const e=i.adjacent,s={count:0,top:!1,bottom:!1,left:!1,right:!1},n={top:[2,3],bottom:[4,5],left:[3,4],right:[2,5]};for(const r in e){const o=r,l=e[o];s[o]=l.isWall()||l.qans===n[o][0]||l.qans===n[o][1],s[o]&&++s.count}if(s.count>2||s.count===2&&(s.top&&s.bottom||s.left&&s.right))return i.qsub===0?-1:0;s.count===2&&(s.bottom&&s.left?t=2:s.bottom&&s.right?t=3:s.top&&s.right?t=4:s.top&&s.left?t=5:t=0)}if(t===null){const e=this.inputPoint.bx-i.bx,s=this.inputPoint.by-i.by;e<=0?t=s<=0?5:2:t=s<=0?4:3}return t===i.qans?t=-1:i.qsub===1&&(t=0),t},inputTriangle_pull_start:function(){const i=this.getcell();if(i.isnull||i.isNum()){this.mousereset();return}this.firstPoint.set(this.inputPoint),this.mouseCell=i},inputTriangle_pull_move:function(){const i=this.mouseCell,t=this.inputPoint.bx-this.firstPoint.bx,e=this.inputPoint.by-this.firstPoint.by,s=.33;t<=-.33&&e>=s?this.inputData=2:t<=-.33&&e<=-.33?this.inputData=5:t>=s&&e>=s?this.inputData=3:t>=s&&e<=-.33&&(this.inputData=4),this.inputData!==null&&(this.inputData===i.qans&&(this.inputData=0),i.setAnswer(this.inputData)),i.draw()},inputTriangle_pull_end:function(){const i=this.inputPoint.bx-this.firstPoint.bx,t=this.inputPoint.by-this.firstPoint.by;if(Math.abs(i)<=.1&&Math.abs(t)<=.1){const e=this.mouseCell;e.setAnswer(e.qsub!==1?-1:0),e.draw()}},inputTriangle_drag:function(){if(this.inputData===null||this.inputData<=0)return;const i=this.getcell();if(i.isnull||i.isNum())return;const t=i.bx-this.mouseCell.bx,e=i.by-this.mouseCell.by,s=this.checkCornerData(i);let n=null;const r=this.inputData;t===2&&e===2||t===-2&&e===-2?(r===2||r===4)&&(n=r):t===2&&e===-2||t===-2&&e===2?(r===3||r===5)&&(n=r):t===0&&e===-2?((r===2||r===3)&&s!==r||(r===4||r===5)&&s===r)&&(n=[null,null,5,4,3,2][r]):t===0&&e===2?((r===4||r===5)&&s!==r||(r===2||r===3)&&s===r)&&(n=[null,null,5,4,3,2][r]):t===-2&&e===0?((r===3||r===4)&&s!==r||(r===2||r===5)&&s===r)&&(n=[null,null,3,2,5,4][r]):t===2&&e===0&&((r===2||r===5)&&s!==r||(r===3||r===4)&&s===r)&&(n=[null,null,3,2,5,4][r]),n!==null&&(i.setAnswer(n),this.inputData=n,this.mouseCell=i,i.draw())},inputDot:function(){const i=this.getcell();i.isnull||i.isNum()||(this.inputData===null&&(this.inputData=i.qsub===1?0:-1),i.setAnswer(this.inputData),this.mouseCell=i,i.draw())},inputTriangle_onebtn:function(){const i=this.getcell();if(i.isnull||i.isNum())return;const t=i.getAnswer();this.btn==="left"?this.inputData=[0,2,1,3,4,5,-1][t+1]:this.btn==="right"&&(this.inputData=[5,-1,1,0,2,3,4][t+1]),i.setAnswer(this.inputData),this.mouseCell=i,i.draw()},inputqcmp:function(){const i=this.getcell();i.isnull||i.noNum()||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:4,minnum:0,getAnswer:function(){return this.isNum()?0:this.qans>0?this.qans:this.qsub===1?-1:0},setAnswer:function(i){this.isNum()||(this.setQans(i>=2&&i<=5?i:0),this.setQsub(i===-1?1:0))},isTri:function(){return this.qans!==0},isWall:function(){return this.qsub===1||this.isnull||this.isNum()}},Board:{wrectmgr:null,addExtraInfo:function(){this.wrectmgr=this.addInfoList(Dl)}},BoardExec:{adjustBoardData:function(i,t){let e=[];switch(i){case ne:e=[0,1,5,4,3,2];break;case ie:e=[0,1,3,2,5,4];break;case me:e=[0,1,5,2,3,4];break;case pe:e=[0,1,3,4,5,2];break;default:return}const s=this.board.cell;for(let n=0;n<s.length;n++){const r=s[n],o=e[r.qans];o&&(r.qans=o)}}},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",qanscolor:"black",fgcellcolor_func:"qnum",fontShadecolor:"white",qcmpcolor:"rgb(127,127,127)",paint:function(){this.drawBGCells(),this.drawDotCells(),this.drawDashedGrid(),this.drawQuesCells(),this.drawQuesNumbers(),this.drawTriangle(),this.drawChassis(),this.drawTarget()},getTriangleColor:function(i){return i.trial?this.trialcolor:this.shadecolor},getQuesNumberColor:function(i){return i.qcmp===1?this.qcmpcolor:this.fontShadecolor}},Encode:{decodePzpr:function(i){this.decode4Cell()},encodePzpr:function(i){this.encode4Cell()}},FileIO:{decodeData:function(){this.decodeCellQnumb(),this.decodeCellQanssubcmp()},encodeData:function(){this.encodeCellQnumb(),this.encodeCellQanssubcmp()},decodeCellQanssubcmp:function(){this.decodeCell(function(i,t){t==="+"?i.qsub=1:t==="-"?i.qcmp=1:t!=="."&&(i.qans=+t)})},encodeCellQanssubcmp:function(){this.encodeCell(function(i){return i.qans!==0?`${i.qans} `:i.qsub===1?"+ ":i.qcmp===1?"- ":". "})}},AnsCheck:{checklist:["checkTriangleExist","checkOverTriangle","checkWhiteArea","checkLessTriangle"],checkTriangleExist:function(){if(!this.allowempty){if(this.board.cell.some(function(i){return i.qans>0}))return;this.failcode.add("brNoTriangle")}},checkOverTriangle:function(){this.checkDir4Cell(function(i){return i.isTri()},2,"nmTriangleGt")},checkLessTriangle:function(){this.checkDir4Cell(function(i){return i.isTri()},1,"nmTriangleLt")},checkWhiteArea:function(){const i=this.board.wrectmgr.components;for(let t=0;t<i.length;t++){const e=i[t].clist,s=e.getRectSize(),n=e.filter(function(r){return r.qans===0}).length;if(!(s.cols*s.rows===n||this.isAreaRect_slope(i[t]))){if(this.failcode.add("cuNotRectx"),this.checkOnly)break;e.seterr(1)}}},isAreaRect_slope:function(i){const t=i.clist;for(let e=0;e<t.length;e++){const s=t[e],n=s.adjacent,r=s.qans;if((r===4||r===5)!=(n.top.wrect!==i)||(r===2||r===3)!=(n.bottom.wrect!==i)||(r===2||r===5)!=(n.left.wrect!==i)||(r===3||r===4)!=(n.right.wrect!==i))return!1}return!0}},FailCode:{brNoTriangle:["盤面に三角形がありません。","There are no triangles on the board."],cuNotRectx:["白マスが長方形(正方形)ではありません。","A white area is not rectangle."],nmTriangleGt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is bigger than it."],nmTriangleLt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is smaller than it."]}});class Dl extends Wt{constructor(){super(...arguments),this.enabled=!0,this.relation={"cell.qnum":"node","cell.qans":"node"},this.sldir=[[],[!0,!1,!0,!0,!1,!1],[!0,!1,!1,!1,!0,!0],[!0,!1,!1,!0,!0,!1],[!0,!1,!0,!1,!1,!0]]}setComponentRefs(t,e){t.wrect=e}getObjNodeList(t){return t.wrectnodes}resetObjNodeList(t){t.wrectnodes=[]}isnodevalid(t){return t.qnum===-1}isedgevalidbynodeobj(t,e){return this.sldir[t.getdir(e,2)][t.qans]&&this.sldir[e.getdir(t,2)][e.qans]}}const Ol=_({pid:"yajilin",MouseEvent:{RBShadeCell:!0,use:!0,inputModes:{edit:["number","direc","clear","info-line"],play:["line","peke","shade","unshade","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.btn==="left"?this.inputLine():this.btn==="right"&&this.inputcell():this.mouseend&&this.notInputted()&&this.inputcell():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.notInputted()&&this.inputqnum())}},KeyEvent:{enablemake:!0,moveTarget:function(i){return i.match(/shift/)?!1:this.moveTCell(i)},keyinput:function(i){this.key_inputdirec(i)||this.key_inputqnum(i)}},Cell:{minnum:0,numberRemainsUnshaded:!0,noLP:function(i){return this.isShade()||this.isNum()}},Border:{enableLineNG:!0,isBorder:function(){return this.sidecell[0].qnum===-1!=(this.sidecell[1].qnum===-1)}},Board:{hasborder:1},BoardExec:{adjustBoardData:function(i,t){this.adjustNumberArrow(i,t)}},LineGraph:{enabled:!0},Graphic:{irowake:!0,numbercolor_func:"qnum",paint:function(){this.drawBGCells(),this.drawDotCells(),this.drawGrid(),this.drawBorders(),this.drawArrowNumbers(),this.drawLines(),this.drawPekes(),this.drawChassis(),this.drawTarget()},getBGCellColor:function(i){const t=i.error||i.qinfo;return this.puzzle.getConfig("disptype_yajilin")===2&&i.qnum!==-1?"rgb(224,224,224)":i.qans===1?t===1?this.errcolor1:i.trial?this.trialcolor:this.shadecolor:t===1?this.errbcolor1:null},getBorderColor:function(i){return this.puzzle.getConfig("disptype_yajilin")===2&&i.isBorder()?this.quescolor:null}},Encode:{decodePzpr:function(i){this.decodeArrowNumber16(),this.puzzle.setConfig("disptype_yajilin",this.checkpflag("b")?2:1)},encodePzpr:function(i){this.encodeArrowNumber16(),this.outpflag=this.puzzle.getConfig("disptype_yajilin")===2?"b":null}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCellAns(),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkLineOnShadeCell","checkAdjacentShadeCell","checkDeadendLine+","checkArrowNumber","checkOneLoop","checkEmptyCell_yajirin+"],checkEmptyCell_yajirin:function(){this.checkAllCell(function(i){return i.lcnt===0&&!i.isShade()&&i.noNum()},"ceEmpty")},checkArrowNumber:function(){const i=this.board;for(let t=0;t<i.cell.length;t++){const e=i.cell[t];if(!e.isValidNum()||e.qdir===0||e.isShade())continue;const s=e.getaddr(),n=e.qdir,r=new A;for(;;){s.movedir(n,2);const o=s.getc();if(o.isnull)break;r.add(o)}if(e.qnum!==r.filter(function(o){return o.isShade()}).length){if(this.failcode.add("anShadeNe"),this.checkOnly)break;e.seterr(1),r.seterr(1)}}}},FailCode:{ceEmpty:["黒マスも線も引かれていないマスがあります。","There is an empty cell."]}}),El=_({pid:"ripple",MouseEvent:{inputModes:{edit:["border","number","clear"],play:["number","clear"]},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart&&this.inputqnum():this.puzzle.editmode&&(this.mousestart||this.mousemove&&this.btn==="left"?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())}},KeyEvent:{enablemake:!0,enableplay:!0},Cell:{enableSubNumberArray:!0,maxnum:function(){return this.room.clist.length}},Board:{hasborder:1},AreaRoomGraph:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbers(),this.drawBorders(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(i){this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(i){this.encodeBorder(),this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeBorderQues(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeBorderQues(),this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkDifferentNumberInRoom","checkRippleNumber","checkNoNumCell+"],checkRippleNumber:function(){let i=!0;const t=this.board;t:for(let e=0;e<t.cell.length;e++){const s=t.cell[e],n=s.getNum(),r=s.bx,o=s.by;if(!(n<=0)){for(let l=2;l<=n*2;l+=2){const h=t.getc(r+l,o);if(!h.isnull&&h.getNum()===n){if(i=!1,this.checkOnly)break t;s.seterr(1),h.seterr(1)}}for(let l=2;l<=n*2;l+=2){const h=t.getc(r,o+l);if(!h.isnull&&h.getNum()===n){if(i=!1,this.checkOnly)break t;s.seterr(1),h.seterr(1)}}}}i||this.failcode.add("nmSmallGap")},checkUpperNumber:function(){const i=this.board;for(let t=0;t<i.cell.length-i.cols;t++){const e=i.cell[t],s=e.adjacent.bottom;if(!(e.room!==s.room||!e.isNum()||!s.isNum())&&!(e.getNum()>=s.getNum())){if(this.failcode.add("bkSmallOnBig"),this.checkOnly)break;e.seterr(1),s.seterr(1)}}}},FailCode:{bkDupNum:["1つの部屋に同じ数字が複数入っています。","A room has two or more same numbers."],bkSmallOnBig:["同じ部屋で上に小さい数字が乗っています。","There is an small number on big number in a room."],nmSmallGap:["数字よりもその間隔が短いところがあります。","The gap of the same kind of number is smaller than the number."]}}),Rl=_({pid:"tentaisho",MouseEvent:{inputModes:{edit:["circle-unshade","circle-shade","bgpaint"],play:["border","subline"]},mouseinput:function(){this.puzzle.editmode&&this.inputMode!=="auto"?this.mousestart&&this.inputstar():Qt.prototype.mouseinput.call(this)},mouseinput_other:function(){this.inputMode==="bgpaint"&&this.inputBGcolor1()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.btn==="left"&&this.isBorderMode()?this.inputborder_tentaisho():this.inputQsubLine():this.mouseend&&this.notInputted()&&this.inputBGcolor3():this.puzzle.editmode&&(this.mousestart&&this.btn==="left"?this.inputstar():(this.mousestart||this.mousemove)&&this.btn==="right"&&this.inputBGcolor1())},inputBGcolor1:function(){const i=this.getcell();i.isnull||i===this.mouseCell||(this.inputData===null&&(this.inputData=i.qsub===0?3:0),i.setQsub(this.inputData),this.mouseCell=i,i.draw())},inputBGcolor3:function(){if(!this.puzzle.playeronly&&this.puzzle.getConfig("discolor"))return;const i=this.getpos(.34),t=this.puzzle.board.gets(i.bx,i.by);if(t===null||t.getStar()===0)return;const e=t.validcell();if(e!==null){const s=e.room.clist;this.puzzle.board.encolor(s)&&s.forEach(n=>n.draw())}},inputborder_tentaisho:function(){const i=this.getpos(.34);if(this.prevPos.equals(i))return;const t=this.prevPos.getborderobj(i);t.isnull||(this.inputData===null&&(this.inputData=t.qans===0?1:0),t.setQans(this.inputData),t.draw()),this.prevPos=i},inputstar:function(){const i=this.getpos(.25);if(this.prevPos.equals(i))return;const t=this.puzzle.board.gets(i.bx,i.by);t!==null&&(this.inputMode==="circle-unshade"?t.setStar(t.getStar()!==1?1:0):this.inputMode==="circle-shade"?t.setStar(t.getStar()!==2?2:0):this.btn==="left"?t.setStar({0:1,1:2,2:0}[t.getStar()]):this.btn==="right"&&t.setStar({0:2,1:0,2:1}[t.getStar()]),t.draw()),this.prevPos=i}},KeyEvent:{enablemake:!0,moveTarget:function(i){return this.moveTBorder(i)},keyinput:function(i){this.key_inputstar(i)},key_inputstar:function(i){const t=this.puzzle.board.gets(this.cursor.bx,this.cursor.by);t!==null&&(i==="1"?t.setStar(1):i==="2"?t.setStar(2):(i===" "||i==="-"||i==="0"||i==="3")&&t.setStar(0),t.draw())}},Cell:{qnum:0,minnum:0,disInputHatena:!0},Cross:{qnum:0,minnum:0},Border:{qnum:0,minnum:0},Board:{hascross:1,hasborder:1,createExtraObject:function(){this.star=[]},initExtraObject:function(i,t){this.initStar(this.cols,this.rows)},starmax:0,star:[],initStar:function(i,t){this.starmax=(2*i-1)*(2*t-1),this.star=[];for(let e=0;e<this.starmax;e++){this.star[e]=new Pl(this.puzzle);const s=this.star[e];s.id=e,s.isnull=!1,s.bx=e%(2*i-1)+1,s.by=(e/(2*i-1)|0)+1,s.piece=s.getaddr().getobj()}},gets:function(i,t){let e=null;const s=this.cols,n=this.rows;return i<=0||i>=s<<1||t<=0||t>=n<<1||(e=i-1+(t-1)*(2*s-1)),e!==null?this.star[e]:null},starinside:function(i,t,e,s){const n=new Gt;for(let r=t;r<=s;r++)for(let o=i;o<=e;o++){const l=this.gets(o,r);l&&n.add(l)}return n},encolorall:function(){const i=this.puzzle.board.roommgr.components;for(let t=0;t<i.length;t++)this.encolor(i[t].clist);this.puzzle.redraw()},encolor:function(i){const t=this.getAreaStarInfo(i).star;let e=!1;const s=t!==null?t.getStar():0;for(let n=0;n<i.length;n++){const r=i[n];!this.puzzle.playeronly&&r.qsub===3&&s!==2||r.qsub!==(s>0?s:0)&&(r.setQsub(s>0?s:0),e=!0)}return e},getAreaStarInfo:function(i){let t={star:null,err:-1};for(let e=0;e<i.length;e++){const s=i[e],n=this.starinside(s.bx,s.by,s.bx+1,s.by+1);for(let r=0;r<n.length;r++){const o=n[r];if(o.getStar()>0&&o.validcell()!==null){if(t.err===0)return{star:null,err:-2};t={star:o,err:0}}}}return t}},BoardExec:{adjustBoardData2:function(i,t){const e=this.board;e.initStar(e.cols,e.rows)}},AreaRoomGraph:{enabled:!0,setExtraData:function(i){i.clist=new A(i.getnodeobjs());const t=this.puzzle.board.getAreaStarInfo(i.clist);i.star=t.star,i.error=t.err}},GraphComponent:{error:0,star:null},Graphic:{gridcolor_type:"LIGHT",bgcellcolor_func:"qsub3",qsubcolor1:"rgb(176,255,176)",qsubcolor2:"rgb(108,108,108)",qanscolor:"rgb(72, 72, 72)",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawQansBorders(),this.drawBorderQsubs(),this.drawStars(),this.drawChassis(),this.drawTarget_tentaisho()},drawStars:function(){const i=this.vinc("star","auto",!0);i.lineWidth=Math.max(this.cw*.04,1);const t=this.range,e=this.puzzle.board.starinside(t.x1,t.y1,t.x2,t.y2);for(let s=0;s<e.length;s++){const n=e[s],r=n.bx,o=n.by;i.vid=`s_star1_${n.id}`,n.getStar()===1?(i.strokeStyle=n.iserror()?this.errcolor1:this.quescolor,i.fillStyle="white",i.shapeCircle(r*this.bw,o*this.bh,this.cw*.16)):i.vhide(),i.vid=`s_star2_${n.id}`,n.getStar()===2?(i.fillStyle=n.iserror()?this.errcolor1:this.quescolor,i.fillCircle(r*this.bw,o*this.bh,this.cw*.18)):i.vhide()}},drawTarget_tentaisho:function(){this.drawCursor(!1,this.puzzle.editmode)}},Encode:{decodePzpr:function(i){this.decodeStar()},encodePzpr:function(i){this.encodeStar()},decodeStar:function(){const i=this.puzzle.board;i.disableInfo();let t=0;const e=this.outbstr;let s;for(s=0;s<e.length;s++){const n=i.star[t],r=e.charAt(s);if(this.include(r,"0","f")){const o=Number.parseInt(r,16);n.setStar(o%2+1),t+=(o>>1)+1}else this.include(r,"g","z")&&(t+=Number.parseInt(r,36)-15);if(t>=i.starmax)break}i.enableInfo(),this.outbstr=e.substr(s+1)},encodeStar:function(){let i=0,t="";const e=this.puzzle.board;for(let s=0;s<e.starmax;s++){let n="";const r=e.star[s];if(r.getStar()>0){for(let o=1;o<=7;o++){const l=e.star[s+o];if(l&&l.getStar()>0){n=`${(2*(o-1)+(r.getStar()-1)).toString(16)}`,s+=o-1;break}}n===""&&(n=(13+r.getStar()).toString(16),s+=7)}else i++;i===0?t+=n:(n||i===20)&&(t+=(i+15).toString(36)+n,i=0)}i>0&&(t+=(i+15).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeStarFile(),this.decodeBorderAns(),this.decodeCellQsub()},encodeData:function(){this.encodeStarFile(),this.encodeBorderAns(),this.encodeCellQsub()},decodeStarFile:function(){const i=this.puzzle.board;let t="";for(let e=0,s=2*i.rows-1;e<s;e++){const n=this.readLine();n&&(t+=n.match(/[12\.]+/)[0])}i.disableInfo();for(let e=0;e<t.length;++e){const s=i.star[e],n=t.charAt(e);n==="1"?s.setStar(1):n==="2"&&s.setStar(2)}i.enableInfo()},encodeStarFile:function(){const i=this.puzzle.board;let t=0;for(let e=1;e<=2*i.rows-1;e++){let s="";for(let n=1;n<=2*i.cols-1;n++){const r=i.star[t];r.getStar()===1?s+="1":r.getStar()===2?s+="2":s+=".",t++}this.writeLine(s)}}},AnsCheck:{checklist:["checkStarOnLine","checkAvoidStar","checkFractal","checkStarRegion"],checkStarOnLine:function(){const i=this.board;for(let t=0;t<i.starmax;t++){const e=i.star[t];if(e.getStar()<=0||e.validcell()!==null)continue;if(this.failcode.add("bdPassStar"),this.checkOnly)break;const s=e.piece;In(s)?s.setCrossBorderError():Pn(s)&&e.piece.seterr(1)}},checkFractal:function(){const i=this.board.roommgr.components;t:for(let t=0;t<i.length;t++){const e=i[t].clist,s=i[t].star;if(s)for(let n=0;n<e.length;n++){const r=e[n],o=this.board.getc(s.bx*2-r.bx,s.by*2-r.by);if(!(!o.isnull&&r.room===o.room)){if(this.failcode.add("bkNotSymSt"),this.checkOnly)break t;e.seterr(1)}}}},checkAvoidStar:function(){this.checkErrorFlag(-1,"bkNoStar")},checkStarRegion:function(){this.checkErrorFlag(-2,"bkPlStar")},checkErrorFlag:function(i,t){const e=this.board.roommgr.components;for(let s=0;s<e.length;s++)if(e[s].error===i){if(this.failcode.add(t),this.checkOnly)break;e[s].clist.seterr(1)}}},FailCode:{bkNoStar:["星が含まれていない領域があります。","A block has no stars."],bdPassStar:["星を線が通過しています。","A line goes over the star."],bkNotSymSt:["領域が星を中心に点対称になっていません。","An area is not point symmetric about the star."],bkPlStar:["星が複数含まれる領域があります。","A block has two or more stars."]}});class Pl extends he{constructor(){super(...arguments),this.piece=null}shouldSkipPropClear(t){return this.board.subclearmode&&t==="qsub"&&this.qsub===3}getStar(){return this.piece.qnum}setStar(t){this.puzzle.opemgr.disCombine=!0,this.piece.setQnum(t),this.puzzle.opemgr.disCombine=!1}iserror(){return this.piece.error>0}validcell(){const t=this.piece;let e=null;return Gs(t)?e=t:In(t)&&t.lcnt===0?e=t.relcell(-1,-1):Pn(t)&&t.qans===0&&(e=t.sidecell[0]),e}draw(){this.puzzle.painter.paintRange(this.bx-1,this.by-1,this.bx+1,this.by+1)}getaddr(){return new Z(this.puzzle,this.bx,this.by)}}const Il=_({pid:"norinori",MouseEvent:{use:!0,mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputborder()},inputModes:{edit:["border"],play:["shade","unshade"]},shadeCount:0,mousereset:function(){this.shadeCount=0,Qt.prototype.mousereset.call(this)},inputcell:function(){const i=this.getcell();i.isnull||i===this.mouseCell||(Qt.prototype.inputcell.call(this),this.inputData===1&&(++this.shadeCount,this.shadeCount>=2&&this.mousereset()))}},Cell:{posthook:{qans:function(){this.room.checkAutoCmp()}}},Board:{hasborder:1},AreaShadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0},GraphComponent:{checkCmp(){return this.clist.filter(i=>i.qans===1).length===2}},Graphic:{autocmp:"room",gridcolor_type:"LIGHT",enablebcolor:!0,bcolor:"rgb(96, 224, 160)",qcmpbgcolor:"rgb(96, 255, 160)",bgcellcolor_func:"qcmp1",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawShadedCells(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!1)}},Encode:{decodePzpr:function(i){this.decodeBorder()},encodePzpr:function(i){this.encodeBorder()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellAns()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellAns()}},AnsCheck:{checklist:["checkOverShadeCell","checkOverShadeCellInArea","checkSingleShadeCell","checkSingleShadeCellInArea","checkNoShadeCellInArea"],checkOverShadeCell:function(){this.checkAllArea(this.board.sblkmgr,function(i,t,e,s){return e<=2},"csGt2")},checkSingleShadeCell:function(){this.checkAllArea(this.board.sblkmgr,function(i,t,e,s){return e>=2},"csLt2")},checkOverShadeCellInArea:function(){this.checkAllBlock(this.board.roommgr,function(i){return i.isShade()},function(i,t,e,s){return e<=2},"bkShadeGt2")},checkSingleShadeCellInArea:function(){this.checkAllBlock(this.board.roommgr,function(i){return i.isShade()},function(i,t,e,s){return e!==1},"bkShadeLt2")}},FailCode:{csLt2:["１マスだけの黒マスのカタマリがあります。","There is a single shaded cell."],csGt2:["２マスより大きい黒マスのカタマリがあります。","The size of a mass of shaded cells is over two."],bkShadeLt2:["１マスしか黒マスがない部屋があります。","A room has only one shaded cell."],bkShadeGt2:["２マス以上の黒マスがある部屋が存在します。","A room has three or mode shaded cells."]}}),$l=_({pid:"lits",MouseEvent:{use:!0,inputModes:{edit:["border","info-blk"],play:["shade","unshade","info-blk"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputborder()}},Cell:{tetro:null,posthook:{qans:function(){this.room.checkAutoCmp()}}},Board:{hasborder:1,tetrograph:null,addExtraInfo:function(){this.tetrograph=this.addInfoList(Gl)}},AreaShadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0},GraphComponent:{checkCmp:function(){let i=0,t=null;for(let e=0;e<this.clist.length;e++)if(this.clist[e].qans===1){if(i++,!t)t=this.clist[e].sblk;else if(t!==this.clist[e].sblk)return!1}return i===4}},Graphic:{autocmp:"room",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawBorders(),this.drawChassis()},gridcolor_type:"DARK",qanscolor:"black",shadecolor:"rgb(96, 96, 96)",qcmpbgcolor:"rgb(96, 255, 160)",bgcellcolor_func:"qcmp"},Encode:{decodePzpr:function(i){i===nt&&this.checkpflag("d")||i===ls&&!this.checkpflag("c")?this.decodeLITS_old():this.decodeBorder()},encodePzpr:function(i){i===ls&&(this.outpflag="c"),this.encodeBorder()},decodeLITS_old:function(){const i=this.outbstr,t=this.puzzle.board;for(let e=0;e<t.border.length;e++){const s=t.border[e],n=s.sidecell[0],r=s.sidecell[1];!n.isnull&&!r.isnull&&i.charAt(n.id)!==i.charAt(r.id)&&(s.ques=1)}this.outbstr=i.substr(t.cell.length)}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellAns()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellAns()}},AnsCheck:{checklist:["check2x2ShadeCell","checkOverShadeCellInArea","checkSeqBlocksInRoom","checkTetromino","checkConnectShade","checkNoShadeCellInArea","checkLessShadeCellInArea"],checkOverShadeCellInArea:function(){this.checkAllBlock(this.board.roommgr,function(i){return i.isShade()},function(i,t,e,s){return e<=4},"bkShadeGt4")},checkLessShadeCellInArea:function(){this.checkAllBlock(this.board.roommgr,function(i){return i.isShade()},function(i,t,e,s){return e>=4},"bkShadeLt4")},checkSeqBlocksInRoom:function(){const i=this.board.roommgr.components;for(let t=0;t<i.length;t++){const e=i[t].clist;let s=null,n=!0;for(let r=0;r<e.length;r++)if(e[r].tetro!==null&&e[r].tetro!==s)if(s===null)s=e[r].tetro;else{n=!1;break}if(!n){if(this.failcode.add("bkShadeDivide"),this.checkOnly)break;e.seterr(1)}}},checkTetromino:function(){let i=!0;const t=this.board;function e(s,n){const r=s.tetro,o=n.tetro;return r!==null&&o!==null&&r!==o&&r.shape!==null&&o.shape!==null&&r.shape===o.shape}for(let s=0;s<t.cell.length;s++){const n=t.cell[s];let r=n.adjacent.right;if(!r.isnull&&e(n,r)){if(i=!1,this.checkOnly)break;n.tetro.clist.seterr(2),r.tetro.clist.seterr(2)}if(r=n.adjacent.bottom,!r.isnull&&e(n,r)){if(i=!1,this.checkOnly)break;n.tetro.clist.seterr(2),r.tetro.clist.seterr(2)}}i||this.failcode.add("bsSameShape")}},FailCode:{bkShadeLt4:["黒マスのカタマリが４マス未満の部屋があります。","A room has three or less shaded cells."],bkShadeGt4:["５マス以上の黒マスがある部屋が存在します。","A room has five or more shaded cells."],bsSameShape:["同じ形のテトロミノが接しています。","Some Tetrominos that are the same shape are Adjacent."]}});class Gl extends Gn{constructor(){super(...arguments),this.enabled=!0,this.relation={"cell.qans":"node","border.ques":"separator"}}setComponentRefs(t,e){t.tetro=e}getObjNodeList(t){return t.tetronodes}resetObjNodeList(t){t.tetronodes=[]}isedgevalidbylinkobj(t){return!t.isBorder()}resetExtraData(t){t.shape=null}setExtraData(t){t.clist=new A(t.getnodeobjs());const e=t.clist,s=e.length;let n=null;if(s===4){const r=e.sort((a,c)=>a.id-c.id)[0],o=r.bx,l=r.by;let h=0;for(let a=0;a<s;a++)h+=(e[a].by-l>>1)*10+(e[a].bx-o>>1);switch(h){case 13:case 15:case 27:case 31:case 33:case 49:case 51:n="L";break;case 6:case 60:n="I";break;case 14:case 30:case 39:case 41:n="T";break;case 20:case 24:case 38:case 42:n="S";break}}t.shape=n}}const Ql=_({pid:"akari",MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["akari","unshade","completion"]},mouseinput_other:function(){this.inputMode==="akari"&&this.mousestart&&this.inputcell()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove&&this.inputData!==1?this.inputcell():this.mouseend&&this.notInputted()&&this.inputqcmp():this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputqcmp:function(){const i=this.getcell();i.isnull||i.noNum()||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},KeyEvent:{enablemake:!0},Cell:{akariinfo:0,qlight:0,numberRemainsUnshaded:!0,maxnum:4,minnum:0,posthook:{qnum:function(i){this.setAkariInfo(i)},qans:function(i){this.setAkariInfo(i)}},isAkari:function(){return this.qans===1},setAkariInfo:function(i){let t=0,e=this.akariinfo;this.qnum!==-1?t=2:this.qans===1&&(t=1),e!==t&&(this.akariinfo=t,this.setQlight(e,t))},setQlight:function(i,t){const e=this.akariRangeClist();if(i===0&&t===1)for(let n=0;n<e.length;n++)e[n].qlight=1;else{for(let n=0;n<e.length;n++){const r=e[n],o=r.qlight;o===0&&(i===1&&t===0||i===0&&t===2)||o===1&&i===2&&t===0||(r.qlight=r.akariRangeClist().some(function(l){return l.isAkari()})?1:0)}t===2&&(this.qlight=0)}const s=this.viewRange();this.puzzle.painter.paintRange(s.x1-1,this.by-1,s.x2+1,this.by+1),this.puzzle.painter.paintRange(this.bx-1,s.y1-1,this.bx+1,s.y2+1)},akariRangeClist:function(){let i,t=new A,e=this.adjacent;for(t.add(this),i=e.left;!i.isnull&&i.qnum===-1;)t.add(i),i=i.adjacent.left;for(i=e.right;!i.isnull&&i.qnum===-1;)t.add(i),i=i.adjacent.right;for(i=e.top;!i.isnull&&i.qnum===-1;)t.add(i),i=i.adjacent.top;for(i=e.bottom;!i.isnull&&i.qnum===-1;)t.add(i),i=i.adjacent.bottom;return t},viewRange:function(){let i,t,e={x1:0,x2:0,y1:0,y2:0},s=this.adjacent;for(i=this,t=s.left;!t.isnull&&t.qnum===-1;)i=t,t=i.adjacent.left;for(e.x1=i.bx,i=this,t=s.right;!t.isnull&&t.qnum===-1;)i=t,t=i.adjacent.right;for(e.x2=i.bx,i=this,t=s.top;!t.isnull&&t.qnum===-1;)i=t,t=i.adjacent.top;for(e.y1=i.by,i=this,t=s.bottom;!t.isnull&&t.qnum===-1;)i=t,t=i.adjacent.bottom;return e.y2=i.by,e}},Board:{rebuildInfo:function(){this.initQlight()},initQlight:function(){for(let i=0;i<this.cell.length;i++){const t=this.cell[i];t.qlight=0,t.akariinfo=0,t.qnum!==-1?t.akariinfo=2:t.qans===1&&(t.akariinfo=1)}for(let i=0;i<this.cell.length;i++){const t=this.cell[i];if(t.akariinfo!==1)continue;const e=t.akariRangeClist();for(let s=0;s<e.length;s++)e[s].qlight=1}}},Graphic:{hideHatena:!0,autocmp:"akari",gridcolor_type:"LIGHT",fgcellcolor_func:"qnum",fontShadecolor:"white",qcmpcolor:"rgb(127,127,127)",bgcellcolor_func:"light",lightcolor:"rgb(192, 255, 127)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawQuesCells(),this.drawQuesNumbers(),this.drawAkari(),this.drawDotCells(),this.drawChassis(),this.drawTarget()},getBGCellColor:function(i){if(i.qnum===-1){if(i.error===1)return this.errbcolor1;if(i.qlight===1&&this.puzzle.execConfig("autocmp"))return this.lightcolor}return null},drawAkari:function(){const i=this.vinc("cell_akari","auto"),t=this.cw*.4,e="rgb(0, 127, 96)",s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n];i.vid="c_AK_"+r.id,r.isAkari()?(i.fillStyle=r.error===4?this.errcolor1:r.trial?this.trialcolor:e,i.fillCircle(r.bx*this.bw,r.by*this.bh,t)):i.vhide()}},getQuesNumberColor:function(i){return i.qcmp===1?this.qcmpcolor:this.fontShadecolor}},Encode:{decodePzpr:function(i){this.decode4Cell()},encodePzpr:function(i){this.encode4Cell()}},FileIO:{decodeData:function(){this.decodeCellQnumAns(),this.decodeCellQcmp()},encodeData:function(){this.encodeCellQnumAns(),this.encodeCellQcmp()},decodeCellQcmp:function(){this.decodeCell(function(i,t){t==="-"&&(i.qcmp=1)})},encodeCellQcmp:function(){this.puzzle.board.cell.some(function(i){return i.qcmp===1})&&this.encodeCell(function(i){return i.qcmp===1?"- ":". "})}},AnsCheck:{checklist:["checkNotDuplicateAkari","checkDir4Akari","checkShinedCell"],checkDir4Akari:function(){this.checkDir4Cell(function(i){return i.isAkari()},0,"nmAkariNe")},checkShinedCell:function(){this.checkAllCell(function(i){return i.noNum()&&i.qlight!==1},"ceDark")},checkNotDuplicateAkari:function(){this.checkRowsColsPartly(function(i){const t=i.filter(function(s){return s.isAkari()}),e=t.length<=1;return e||t.forEach(s=>s.seterr(4)),e},function(i){return i.isNum()},"akariDup")}},FailCode:{nmAkariNe:["数字のまわりにある照明の数が間違っています。","The number is not equal to the number of Akari around it."],akariDup:["照明に別の照明の光が当たっています。","Akari is shined from another Akari."],ceDark:["照明に照らされていないセルがあります。","A cell is not shined."]}}),Ml=_({pid:"tilepaint",MouseEvent:{use:!0,inputModes:{edit:["cell51","clear","number","border","bgpaint"],play:["shade","unshade"]},mouseinput:function(){this.inputMode==="shade"||this.inputMode==="unshade"?this.inputtile():Qt.prototype.mouseinput.call(this)},mouseinput_clear:function(){this.input51_fixed()},mouseinput_number:function(){this.mousestart&&this.inputqnum_cell51()},mouseinput_other:function(){this.inputMode==="bgpaint"&&this.inputBGcolor1()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputtile():this.puzzle.editmode&&(this.btn==="left"?(this.mousestart||this.mousemove)&&this.inputborder():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputBGcolor1(),this.mouseend&&this.notInputted()&&this.input51())},inputBGcolor1:function(){const i=this.getcell();i.isnull||i===this.mouseCell||i.is51cell()||(this.inputData===null&&(this.inputData=i.qsub===0?3:0),i.setQsub(this.inputData),this.mouseCell=i,i.draw())}},KeyEvent:{enablemake:!0,keyinput:function(i){this.inputnumber51(i)}},Cell:{qnum:0,qnum2:0,disInputHatena:!0,getmaxnum:function(){const i=this.board;return this.puzzle.cursor.detectTarget(this)===b.RT?i.cols-(this.bx>>1)-1:i.rows-(this.by>>1)-1},minnum:0,shouldSkipPropClear(i){return this.board.subclearmode&&i==="qsub"&&this.qsub===3},set51cell:function(){this.setQues(51),this.setQnum(0),this.setQnum2(0),this.clrShade(),this.setQsub(0),this.set51aroundborder()},remove51cell:function(){this.setQues(0),this.setQnum(0),this.setQnum2(0),this.clrShade(),this.setQsub(0)},set51aroundborder:function(){const i=this.getdir4cblist();for(let t=0;t<i.length;t++){const e=i[t][0],s=i[t][1];s.isnull||s.setQues(this.is51cell()!==e.is51cell()?1:0)}}},EXCell:{ques:51,qnum:0,qnum2:0,disInputHatena:!0,getmaxnum:function(){const i=this.board;return this.by===-1?i.rows:i.cols},minnum:0},Board:{hasborder:1,hasexcell:1},BoardExec:{adjustBoardData:function(i,t){this.adjustQues51_1(i,t)},adjustBoardData2:function(i,t){this.adjustQues51_2(i,t)}},AreaRoomGraph:{enabled:!0,isnodevalid:function(i){return!i.is51cell()}},Graphic:{enablebcolor:!0,bgcellcolor_func:"qsub3",bbcolor:"rgb(96, 96, 96)",paint:function(){this.drawBGCells(),this.drawBGEXcells(),this.drawShadedCells(),this.drawQues51(),this.drawGrid(),this.drawBorders(),this.drawBoxBorders(!0),this.drawChassis_ex1(!0),this.drawQuesNumbersOn51(),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeBorder(),this.decodeTilePaint()},encodePzpr:function(i){this.encodeBorder(),this.encodeTilePaint()},decodeTilePaint:function(){let i=0,t=0,e=this.outbstr,s=this.puzzle.board;s.disableInfo();for(let n=0;n<e.length;n++){const r=e.charAt(n),o=s.cell[i];if(r>="g"&&r<="z"?i+=Number.parseInt(r,36)-16:(o.set51cell(),r==="-"?(o.qnum2=e.charAt(n+1)!=="."?Number.parseInt(e.charAt(n+1),16):-1,o.qnum=Number.parseInt(e.substr(n+2,2),16),n+=3):r==="+"?(o.qnum2=Number.parseInt(e.substr(n+1,2),16),o.qnum=e.charAt(n+3)!=="."?Number.parseInt(e.charAt(n+3),16):-1,n+=3):r==="="?(o.qnum2=Number.parseInt(e.substr(n+1,2),16),o.qnum=Number.parseInt(e.substr(n+3,2),16),n+=4):(o.qnum2=e.charAt(n)!=="."?Number.parseInt(e.charAt(n),16):-1,o.qnum=e.charAt(n+1)!=="."?Number.parseInt(e.charAt(n+1),16):-1,n+=1)),i++,!s.cell[i]){t=n+1;break}}s.enableInfo(),i=0;for(let n=t;n<e.length;n++){const r=e.charAt(n),o=s.excell[i];if(r==="."?o.qnum2=-1:r==="-"?(o.qnum2=Number.parseInt(e.substr(n+1,1),16),n+=2):o.qnum2=Number.parseInt(r,16),i++,i>=s.cols){t=n+1;break}}for(let n=t;n<e.length;n++){const r=e.charAt(n),o=s.excell[i];if(r==="."?o.qnum=-1:r==="-"?(o.qnum=Number.parseInt(e.substr(n+1,2),16),n+=2):o.qnum=Number.parseInt(r,16),i++,i>=s.cols+s.rows){t=n+1;break}}this.outbstr=e.substr(t)},encodeTilePaint:function(){let i="",t=this.puzzle.board,e=0;for(let s=0;s<t.cell.length;s++){let n="",r=t.cell[s];r.ques===51?(n+=r.qnum2.toString(16),n+=r.qnum.toString(16),r.qnum>=16&&r.qnum2>=16?n="="+n:r.qnum>=16?n="-"+n:r.qnum2>=16&&(n="+"+n)):e++,e===0?i+=n:(n||e===20)&&(i+=(e+15).toString(36)+n,e=0)}e>0&&(i+=(e+15).toString(36));for(let s=0;s<t.cols;s++){const n=t.excell[s].qnum2;n<0?i+=".":n<16?i+=n.toString(16):n<256&&(i+="-"+n.toString(16))}for(let s=t.cols;s<t.cols+t.rows;s++){const n=t.excell[s].qnum;n<0?i+=".":n<16?i+=n.toString(16):n<256&&(i+="-"+n.toString(16))}this.outbstr+=i}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum51(),this.decodeCell(function(i,t){t==="#"?i.qans=1:t==="+"?i.qsub=1:t==="-"&&(i.qsub=3)})},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum51(),this.encodeCell(function(i){return i.qans===1?"# ":i.qsub===1?"+ ":i.qsub===3?"- ":". "})}},AnsCheck:{checklist:["checkShadeCellExist","checkSameColorTile","checkRowsColsShadeCell"],checkRowsColsShadeCell:function(){this.checkRowsColsPartly(function(i,t){var e;const s=t.key51num,n=i.filter(function(o){return o.isShade()}).length,r=s<0||n===s;return r||((e=t.keycell)==null||e.seterr(1),i.seterr(1)),r},function(i){return i.is51cell()},"asShadeNe")}},FailCode:{asShadeNe:["数字の下か右にある黒マスの数が間違っています。","The number of shaded cells underward or rightward is not correct."]}}),Ul=_({pid:"nurimaze",MouseEvent:{use:!0,inputModes:{edit:["border","mark-circle","mark-triangle"],play:["shade","unshade"]},mouseinput:function(){this.inputMode==="shade"||this.inputMode==="unshade"?this.inputtile_nurimaze():Qt.prototype.mouseinput.call(this)},mouseinput_other:function(){this.inputMode.indexOf("mark-")===0&&this.inputmarks()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputtile_nurimaze():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputtile_nurimaze:function(){const i=this.getcell();if(i.isnull||i===this.mouseCell)return;this.inputData===null&&this.decIC(i);const t=this.puzzle.board,e=i.room.clist;if(this.inputData===1){for(let s=0;s<e.length;s++)if(e[s].ques!==0||t.startpos.equals(e[s])||t.goalpos.equals(e[s]))if(this.mousestart){this.inputData=i.qsub!==1?2:0;break}else return}this.mouseCell=i;for(let s=0;s<e.length;s++){const n=e[s];(this.inputData===1?n.setShade:n.clrShade).call(n),n.setQsub(this.inputData===2?1:0)}e.forEach(s=>s.draw())},inputEdit:function(){const i=this.getcell();i.isnull||(this.inputData===null&&this.inputEdit_first(),this.inputData===10?this.puzzle.board.startpos.input(i):this.inputData===11?this.puzzle.board.goalpos.input(i):this.inputData!==null&&this.inputborder())},inputEdit_first:function(){const i=this.getpos(.33),t=this.puzzle.board;t.startpos.equals(i)?this.inputData=10:t.goalpos.equals(i)?this.inputData=11:this.inputborder()},inputEdit_end:function(){const i=this.getcell();i.isnull||(this.inputData===10||this.inputData===11?(this.inputData=null,i.draw()):this.notInputted()&&(i!==this.cursor.getc()?this.setcursor(i):this.inputQuesMark(i)))},inputmarks:function(){const i=this.getcell();i.isnull||i===this.mouseCell||(this.inputQuesMark(i),this.mouseCell=i)},inputQuesMark:function(i){let t=this.puzzle.board,e=-1;this.inputMode==="mark-circle"?e=i.ques!==41?41:0:this.inputMode==="mark-triangle"?e=i.ques!==42?42:0:this.btn==="left"?e={0:41,41:42,42:0}[i.ques]:this.btn==="right"&&(e={0:42,42:41,41:0}[i.ques]),(e===0||!t.startpos.equals(i)&&!t.goalpos.equals(i))&&(i.setQues(e),i.draw())}},KeyEvent:{enablemake:!0,keyinput:function(i){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_nurimaze(i)},key_inputqnum_nurimaze:function(i){const t=this.cursor.getc(),e=this.puzzle.board;let s=t.ques,n=-1;i==="1"||i==="q"?n=s!==41?41:0:i==="2"||i==="w"?n=s!==42?42:0:i==="3"||i==="e"||i===" "||i==="BS"?n=0:i==="s"?e.startpos.input(t):i==="g"&&e.goalpos.input(t),n!==s&&(n===0||!e.startpos.equals(t)&&!e.goalpos.equals(t))&&(t.setQues(n),t.draw())}},Board:{hasborder:1,startpos:null,goalpos:null,createExtraObject:function(){this.startpos=new Fl(this.puzzle,1,1),this.goalpos=new Hl(this.puzzle,this.cols*2-1,this.rows*2-1),this.startpos.partner=this.goalpos,this.goalpos.partner=this.startpos},initExtraObject:function(i,t){this.disableInfo(),this.startpos.init(1,1),this.goalpos.init(i*2-1,t*2-1),this.enableInfo()},exchangestartgoal:function(){const i=this.startpos.getc(),t=this.goalpos.getc();this.startpos.set(t),this.goalpos.set(i),this.startpos.draw(),this.goalpos.draw()}},BoardExec:{posinfo:{},posinfo_start:null,posinfo_goal:null,adjustBoardData:function(i,t){const e=this.board;this.posinfo_start=this.getAfterPos(i,t,e.startpos.getc()),this.posinfo_goal=this.getAfterPos(i,t,e.goalpos.getc())},adjustBoardData2:function(i,t){const e=this.board,s=this.puzzle.opemgr,n=this.posinfo_start,r=this.posinfo_goal,o=i&D&&(n.isdel||r.isdel)&&!s.undoExec&&!s.redoExec;o&&(s.forceRecord=!0),e.startpos.set(n.pos.getc()),e.goalpos.set(r.pos.getc()),o&&(s.forceRecord=!1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(Zn)}},AreaUnshadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0},Graphic:{enablebcolor:!0,bgcellcolor_func:"qsub1",errbcolor2:"rgb(192, 192, 255)",bbcolor:"rgb(96, 96, 96)",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesMarks(),this.drawStartGoal(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!0),this.drawTarget()},drawStartGoal:function(){const i=this.vinc("cell_sg","auto"),t=this.puzzle.board,e=this.range;i.vid="text_stpos";let s=t.startpos.getc();s.bx>=e.x1&&e.x2>=s.bx&&s.by>=e.y1&&e.y2>=s.by&&(s.isnull?i.vhide():(i.fillStyle=this.puzzle.mouse.inputData===10?"red":s.qans===1?this.fontShadecolor:this.quescolor,this.disptext("S",s.bx*this.bw,s.by*this.bh))),i.vid="text_glpos",s=t.goalpos.getc(),s.bx>=e.x1&&e.x2>=s.bx&&s.by>=e.y1&&e.y2>=s.by&&(s.isnull?i.vhide():(i.fillStyle=this.puzzle.mouse.inputData===11?"red":s.qans===1?this.fontShadecolor:this.quescolor,this.disptext("G",s.bx*this.bw,s.by*this.bh)))},drawQuesMarks:function(){const i=this.vinc("cell_mark","auto",!0),t=this.cw*.3,e=this.cw*.26;i.lineWidth=2;const s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n],o=r.ques,l=r.bx*this.bw,h=r.by*this.bh;i.strokeStyle=this.getQuesNumberColor(r),i.vid="c_mk1_"+r.id,o===41?i.strokeCircle(l,h,t):i.vhide(),i.vid="c_mk2_"+r.id,o===42?(i.beginPath(),i.setOffsetLinePath(l,h,0,-e,-t,e,t,e,!0),i.stroke()):i.vhide()}}},Encode:{decodePzpr:function(i){this.decodeBorder(),this.decodeCell_nurimaze()},encodePzpr:function(i){this.encodeBorder(),this.encodeCell_nurimaze()},decodeCell_nurimaze:function(){let i=0,t=0,e=this.outbstr,s=this.puzzle.board;for(t=0;t<e.length;t++){const n=e.charAt(t),r=s.cell[i];if(n==="1"?s.startpos.set(r):n==="2"?s.goalpos.set(r):n==="3"?r.ques=41:n==="4"?r.ques=42:(this.include(n,"5","9")||this.include(n,"a","z"))&&(i+=Number.parseInt(n,36)-5),i++,!s.cell[i])break}this.outbstr=e.substr(t+1)},encodeCell_nurimaze:function(){let i="",t=0,e=this.puzzle.board;for(let s=0;s<e.cell.length;s++){let n="",r=e.cell[s];e.startpos.equals(r)?n="1":e.goalpos.equals(r)?n="2":r.ques===41?n="3":r.ques===42?n="4":t++,t===0?i+=n:(n||t===31)&&(i+=(4+t).toString(36)+n,t=0)}t>0&&(i+=(4+t).toString(36)),this.outbstr+=i}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQues_nurimaze(),this.decodeCellAns()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQues_nurimaze(),this.encodeCellAns()},decodeCellQues_nurimaze:function(){const i=this.puzzle.board;this.decodeCell(function(t,e){e==="s"?i.startpos.set(t):e==="g"?i.goalpos.set(t):e==="o"?t.ques=41:e==="t"&&(t.ques=42)})},encodeCellQues_nurimaze:function(){const i=this.puzzle.board;this.encodeCell(function(t){return i.startpos.equals(t)?"s ":i.goalpos.equals(t)?"g ":t.ques===41?"o ":t.ques===42?"t ":". "})}},AnsCheck:{checklist:["checkSameColorTile","checkShadedObject","checkConnectUnshade","check2x2ShadeCell+","check2x2UnshadeCell++","checkUnshadeLoop","checkRouteCheckPoint","checkRouteNoDeadEnd"],_info:null,checkShadedObject:function(){const i=this.board;this.checkAllCell(function(t){return t.qans===1&&(t.ques!==0||i.startpos.equals(t)||i.goalpos.equals(t))},"objShaded")},checkUnshadeLoop:function(){const i=this.board,t=i.ublkmgr.components;for(let e=0;e<t.length;e++)if(t[e].circuits!==0){if(this.failcode.add("cuLoop"),this.checkOnly)return;this.searchloop(t[e]).seterr(1)}},checkRouteCheckPoint:function(){const i=this.getMazeRouteInfo();if(i.outroute.filter(function(t){return t.ques===41}).length>0){if(this.failcode.add("routeIgnoreCP"),this.checkOnly)return;i.onroute.seterr(1)}},checkRouteNoDeadEnd:function(){const i=this.getMazeRouteInfo();if(i.onroute.filter(function(t){return t.ques===42}).length>0){if(this.failcode.add("routePassDeadEnd"),this.checkOnly)return;i.onroute.seterr(1)}},searchloop:function(i){if(i.circuits<=0)return new A;const t=this.board,e=new A;let s=[i.clist[0]],n=null;const r={},o=t.maxbx-t.minbx;for(;s.length>0;){let l=s[s.length-1],h=null,a=r[l.by*o+l.bx];if(a===void 0)a=r[l.by*o+l.bx]=s.length-1;else if(s.length-1>a)for(let c=s.length-2;c>=0;c--){const u=s[c];if(Gs(u)&&e.add(u),u===l)break}if(Gs(l)){n=l;for(let c=0;c<l.ublknodes[0].nodes.length;c++){const u=l.ublknodes[0].nodes[c].obj,d=t.getb(l.bx+u.bx>>1,l.by+u.by>>1);if(r[d.by*o+d.bx]===void 0){h=d;break}}}else for(let c=0;c<l.sidecell.length;c++){const u=l.sidecell[c];if(u!==n&&u!==s[s.length-2]){h=u;break}}h?s.push(h):s.pop()}return e},getMazeRouteInfo:function(){if(this._info.maze)return this._info.maze;const i=this.board,t=[i.startpos.getc()],e={},s={},n=i.maxbx-i.minbx;for(;t.length>0;){let o=t[t.length-1],l=null,h=e[o.by*n+o.bx];if(h===void 0&&(h=e[o.by*n+o.bx]=t.length-1),i.goalpos.equals(o))for(let c=t.length-1;c>=0;c--)s[t[c].by*n+t[c].bx]=!0;const a=o.ublknodes[0]?o.ublknodes[0].nodes:[];for(let c=0;c<a.length;c++){const u=a[c].obj;if(e[u.by*n+u.bx]===void 0){l=u;break}}l?t.push(l):t.pop()}const r={onroute:new A,outroute:new A};for(let o=0;o<i.cell.length;o++){const l=i.cell[o];l.isUnshade()&&(s[l.by*n+l.bx]?r.onroute.add(l):r.outroute.add(l))}return this._info.maze=r,r}},FailCode:{cuLoop:["白マスで輪っかができています。","There is a looped unshaded cells."],routeIgnoreCP:["○がSからGへの経路上にありません。","There is a circle out of the shortest route from S to G."],routePassDeadEnd:["△がSからGへの経路上にあります。","There is a triangle on the shortest route from S to G."],objShaded:["オブジェクトが黒マスになっています。","An object is shaded."]}});class Jn extends Z{constructor(){super(...arguments),this.type="",this.partner=null}input(t){this.partner.equals(t)?this.board.exchangestartgoal():this.equals(t)?this.draw():this.set(t)}set(t){const e=this.getaddr();return this.addOpe(t.bx,t.by),this.bx=t.bx,this.by=t.by,e.draw(),this.draw(),this}addOpe(t,e){this.bx===t&&this.by===e||this.puzzle.opemgr.add(new Zn(this.puzzle,this.type,this.bx,this.by,t,e))}}class Fl extends Jn{constructor(){super(...arguments),this.type="start"}}class Hl extends Jn{constructor(){super(...arguments),this.type="goal"}}class Zn extends Dt{constructor(t,e,s,n,r,o){super(t),this.property=e,this.bx1=s,this.by1=n,this.bx2=r,this.by2=o}decode(t){return t[0]!=="PS"&&t[0]!=="PG"?!1:(this.property=t[0]==="PS"?"start":"goal",this.bx1=+t[1],this.by1=+t[2],this.bx2=+t[3],this.by2=+t[4],!0)}toString(){return[this.property==="start"?"PS":"PG",this.bx1,this.by1,this.bx2,this.by2].join(",")}isModify(t){return this.manager.changeflag&&t.bx2===this.bx1&&t.by2===this.by1&&t.property===this.property?(t.bx2=this.bx2,t.by2=this.by2,!0):!1}undo(){this.exec_sg(this.bx1,this.by1)}redo(){this.exec_sg(this.bx2,this.by2)}exec_sg(t,e){const s=this.puzzle.board,n=s.getc(t,e);this.property==="start"?s.startpos.set(n):this.property==="goal"&&s.goalpos.set(n)}}const Wl=_({pid:"slalom",MouseEvent:{inputModes:{edit:["number","direc","clear","info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?this.btn==="left"?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn==="right"&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputEdit:function(){const i=this.getcell();i.isnull||(this.mouseCell.isnull&&this.inputEdit_first(i),this.inputData===10?this.board.startpos.input(i):this.inputData===2?this.inputdirec():this.inputGate(i),this.mouseCell=i)},inputEdit_first:function(i){i===this.board.startpos.getc()?this.inputData=10:i.ques===1&&i.isNum()?this.inputData=2:this.firstPoint.set(this.inputPoint)},inputGate:function(i){let t=i.getaddr(),e=!1;if(i.ques!==1){if(this.inputData===null){if(i===this.mouseCell){const s=Math.abs(this.inputPoint.bx-this.firstPoint.bx);Math.abs(this.inputPoint.by-this.firstPoint.by)>=.25?(this.inputData=21,e=!0):s>=.25&&(this.inputData=22,e=!0)}else{const s=this.prevPos.getvert(t,2);s!==void 0&&(this.inputData=s?21:22,e=!0)}e&&(i.ques===this.inputData&&(this.inputData=0),this.firstPoint.reset())}else if(i!==this.mouseCell)if(this.inputData===0)this.inputData=0,e=!0;else{const s=this.prevPos.getvert(t,2);s!==void 0&&(this.inputData=s?21:22,e=!0)}}if(this.prevPos=t,e){const s=this.board;i.setQues(this.inputData),s.gatemgr.rebuild(),i.draw(),s.startpos.draw()}},inputEdit_end:function(){const i=this.getcell();i.isnull||(this.inputData===10?(this.inputData=null,i.draw()):this.notInputted()&&(i!==this.cursor.getc()?this.setcursor(i):this.inputGateNumber(i)))},inputGateNumber:function(i){const t=this.board;this.btn==="left"?i.setQues({0:1,1:21,21:22,22:0}[i.ques]):this.btn==="right"&&i.setQues({0:22,22:21,21:1,1:0}[i.ques]),i.setNum(-1),t.gatemgr.rebuild(),i.draw(),t.startpos.draw()}},KeyEvent:{enablemake:!0,moveTarget:function(i){return i.match(/shift/)?!1:this.moveTCell(i)},keyDispInfo:function(i){return i==="x"?(this.puzzle.painter.drawNumbersOnGate(!!this.keydown),!1):!0},keyinput:function(i){this.key_inputdirec(i)||this.key_inputqnum_slalom(i)},key_inputqnum_slalom:function(i){const t=this.cursor.getc(),e=this.board;if(i==="q"||i==="w"||i==="e"||i==="r"||i==="s"||i===" "){let s=t.ques,n=-1;if(i==="q")n=s!==1?1:0;else if(i==="w")n=21;else if(i==="e")n=22;else if(i==="r"||i===" ")n=0;else if(i==="s")e.startpos.input(t);else return;if(s===n)return;n!==-1&&(t.setQues(n),n===0&&t.setNum(-1),(s===21||s===22||n===21||n===22)&&e.gatemgr.rebuild(),t.draw(),e.startpos.draw())}else t.ques===1&&this.key_inputqnum(i)}},Cell:{disInputHatena:!0,maxnum:function(){return Math.min(999,this.board.gatemgr.components.length)},posthook:{qnum:function(i){this.board.gatemgr.generateGateNumberAll()},qdir:function(i){this.board.gatemgr.generateGateNumberAll()}},gate:null,getConnectingGate:function(){let i=this.adjacent,t=this,e=[];return t=i.top,!t.isnull&&t.ques===21&&e.push(t.gate),t=i.bottom,!t.isnull&&t.ques===21&&e.push(t.gate),t=i.left,!t.isnull&&t.ques===22&&e.push(t.gate),t=i.right,!t.isnull&&t.ques===22&&e.push(t.gate),e}},Border:{enableLineNG:!0},Board:{hasborder:1,startpos:null,gatemgr:null,addExtraInfo:function(){this.gatemgr=this.addInfoList(Vl)},createExtraObject:function(){this.startpos=new Kl(this.puzzle,1,1)},initExtraObject:function(i,t){this.startpos.set(this.cell[0])},operate:function(i){switch(i){case"showgatenumber":this.puzzle.painter.drawNumbersOnGate(!0);break;case"hidegatenumber":this.puzzle.painter.drawNumbersOnGate(!1);break;default:ai.prototype.operate.call(this,i);break}}},BoardExec:{posinfo:{},adjustBoardData:function(i,t){const e=this.board;if(i&gt){const s={21:22,22:21},n=e.cellinside(t.x1,t.y1,t.x2,t.y2);for(let r=0;r<n.length;r++){const o=n[r],l=s[o.ques];l&&o.setQues(l)}}this.posinfo=this.getAfterPos(i,t,e.startpos.getc()),this.adjustNumberArrow(i,t)},adjustBoardData2:function(i,t){const e=this.board,s=this.puzzle.opemgr,n=this.posinfo,r=i&D&&n.isdel&&!s.undoExec&&!s.redoExec;r&&(s.forceRecord=!0),e.startpos.set(n.pos.getc()),r&&(s.forceRecord=!1),e.gatemgr.rebuild()}},OperationManager:{addExtraOperation:function(){this.operationlist.push(tr)}},LineGraph:{enabled:!0},Graphic:{irowake:!0,gridcolor_type:"LIGHT",fontShadecolor:"white",numbercolor_func:"fixed_shaded",linecolor:"rgb(32, 32, 255)",noerrcolor:"rgb(160, 150, 255)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawGates(),this.drawQuesCells(),this.drawArrowNumbers(),this.drawPekes(),this.drawLines(),this.drawStartpos(),this.drawChassis(),this.drawTarget()},drawGates:function(){const i=this.vinc("cell_gate","auto",!0),t=Math.max(this.cw/10,3),e=t/2,s=t*1.1,n=this.range.cells;for(let r=0;r<n.length;r++){const o=n[r];if(i.fillStyle=o.error===4?this.errcolor1:this.quescolor,i.vid="c_dl21_"+o.id,o.ques===21){let l=o.bx*this.bw-e+1,h,a=(o.by-1)*this.bh,c=a+this.ch;for(i.beginPath(),h=a;h<c;h+=s*2)i.rect(l,h,t,s);i.fill()}else i.vhide();if(i.vid="c_dl22_"+o.id,o.ques===22){let l,h=o.by*this.bh-e+1,a=(o.bx-1)*this.bw,c=a+this.cw;for(i.beginPath(),l=a;l<c;l+=s*2)i.rect(l,h,s,t);i.fill()}else i.vhide()}},drawStartpos:function(){const i=this.vinc("cell_circle","auto"),t=this.board,e=t.startpos.getc(),s=this.range;if(e.bx<s.x1||s.x2<e.bx||e.by<s.y1||s.y2<e.by)return;const n=e.bx*this.bw,r=e.by*this.bh,o=this.cw*.42;i.vid="c_stpos",i.lineWidth=Math.max(this.cw*.05,1),i.strokeStyle=this.quescolor,i.fillStyle=this.puzzle.mouse.inputData===10?this.errbcolor1:"white",i.shapeCircle(n,r,o),i.vid="text_stpos",i.fillStyle=this.quescolor,this.disptext(""+t.gatemgr.components.length,n,r,{ratio:.75})},repaintParts:function(i){const t=i.cellinside();for(let e=0;e<t.length;e++){const s=t[e];if(this.board.startpos.equals(s)){this.range={x1:s.bx,y1:s.by,x2:s.bx,y2:s.by},this.drawStartpos();break}}},drawNumbersOnGate:function(i){const t=this.context,e=this.board;i&&e.gatemgr.generateGateNumberAll();for(let s=0;s<e.cell.length;s++){const n=e.cell[s];if(n.ques!==21&&n.ques!==22)continue;const r=n.gate.number;t.vid="cell_text_"+s,i&&r>0?(t.fillStyle="tomato",this.disptext(""+r,n.bx*this.bw,n.by*this.bh)):t.vhide()}}},Encode:{decodePzpr:function(i){const t=this.checkpflag("d")?2:this.checkpflag("p")?1:0;this.decodeSlalom(t)},encodePzpr:function(i){i===nt&&(this.outpflag="d"),this.encodeSlalom(i===nt?2:0)},decodeSlalom:function(i){const t=this.outbstr,e=t.split("/");let s=0,n=0,r=this.board;for(n=0;n<e[0].length;n++){const o=e[0].charAt(n),l=r.cell[s];if(o==="1"?l.ques=1:o==="2"?l.ques=21:o==="3"?l.ques=22:(this.include(o,"4","9")||this.include(o,"a","z"))&&(s+=Number.parseInt(o,36)-4),s++,!r.cell[s])break}if(r.gatemgr.rebuild(),i===0){let o=0;for(n=n+1;n<e[0].length;n++){const l=e[0].charAt(n);if(this.include(l,"0","9")||this.include(l,"a","f")?r.gatemgr.components[o].number=Number.parseInt(l,16):l==="-"?(r.gatemgr.components[o].number=Number.parseInt(t.substr(n+1,2),16),n+=2):this.include(l,"g","z")&&(o+=Number.parseInt(l,36)-16),o++,o>r.gatemgr.components.length)break}for(let l=0;l<r.cell.length;l++){let h=r.cell[l].getConnectingGate(),a=1e3;for(let c=0;c<h.length;c++){const u=h[c].number;u>0&&(a=Math.min(a,u))}r.cell[l].qnum=a<1e3?a:-1}}else if(i===1||i===2){let o=0,l=0;for(n=n+1;n<e[0].length;n++){const h=r.cell[o];if(h.ques!==1)n--;else if(l>0)n--,l--;else{const a=e[0].charAt(n);i===1&&(this.include(a,"0","9")||this.include(a,"a","f"))?h.qnum=Number.parseInt(a,16):i===1&&a==="-"?(h.qnum=Number.parseInt(t.substr(n+1,2),16),n+=2):i===2&&this.include(a,"0","4")?(h.qdir=Number.parseInt(a,16),h.qnum=Number.parseInt(t.charAt(n+1),16),n++):i===2&&this.include(a,"5","9")?(h.qdir=Number.parseInt(a,16)-5,h.qnum=Number.parseInt(t.substr(n+1,2),16),n+=2):i===2&&a==="-"?(h.qdir=Number.parseInt(t.substr(n+1,1),16),h.qnum=Number.parseInt(t.substr(n+2,3),16),n+=4):a>="g"&&a<="z"&&(l=Number.parseInt(a,36)-15-1)}if(o++,!r.cell[o])break}}r.startpos.set(r.cell[+e[1]||0]),this.outbstr=e[0].substr(n)},encodeSlalom:function(i){let t="",e=0,s=this.board;for(let n=0;n<s.cell.length;n++){let r="",o=s.cell[n];o.ques===1?r="1":o.ques===21?r="2":o.ques===22?r="3":e++,e===0?t+=r:(r||e===32)&&(t+=(3+e).toString(36)+r,e=0)}if(e>0&&(t+=(3+e).toString(36)),e=0,i===0){for(let n=0;n<s.gatemgr.components.length;n++){let r="";const o=s.gatemgr.components[n].number;o>=0&&o<16?r=o.toString(16):o>=16&&o<256?r="-"+o.toString(16):e++,e===0?t+=r:(r||e===20)&&(t+=(15+e).toString(36)+r,e=0)}e>0&&(t+=(15+e).toString(36))}else if(i===1||i===2){for(let n=0;n<s.cell.length;n++){const r=s.cell[n];if(r.ques!==1)continue;let o="",l=r.qnum,h=r.qdir;l>=1&&l<16?o=(i===1?"":""+h)+l.toString(16):l>=16&&l<256?o=(i===1?"-":""+(h+5))+l.toString(16):l>=256&&l<4096?o="-"+h+l.toString(16):e++,e===0?t+=o:(o||e===20)&&(t+=(15+e).toString(36)+o,e=0)}e>0&&(t+=(15+e).toString(36))}t+="/"+s.startpos.getc().id,this.outbstr+=t}},FileIO:{decodeData:function(){this.filever===2?this.decodeBoard_pzpr2():this.filever===1?this.decodeBoard_pzpr1():this.filever===0&&this.decodeBoard_old(),this.decodeBorderLine()},encodeData:function(){this.filever=2,this.encodeBoard_pzpr2(),this.encodeBorderLine()},decodeBoard_pzpr1:function(){const i=this.board;this.decodeCell(function(t,e){e==="o"?i.startpos.set(t):e==="i"?t.ques=21:e==="-"?t.ques=22:e==="#"?t.ques=1:e!=="."&&(t.ques=1,t.qnum=+e)}),i.gatemgr.rebuild()},decodeBoard_pzpr2:function(){const i=this.board;this.decodeCell(function(t,e){if(e==="o")i.startpos.set(t);else if(e==="i")t.ques=21;else if(e==="-")t.ques=22;else if(e==="#")t.ques=1;else if(e!=="."){const s=e.split(",");t.ques=1,t.qdir=s[0]!=="0"?+s[0]:0,t.qnum=s[1]!=="-"?+s[1]:-2}}),i.gatemgr.rebuild()},encodeBoard_pzpr2:function(){const i=this.board;this.encodeCell(function(t){if(i.startpos.equals(t))return"o ";if(t.ques===21)return"i ";if(t.ques===22)return"- ";if(t.ques===1&&t.qnum<=0)return"# ";if(t.ques===1){const e=t.qdir!==0?""+t.qdir:"0",s=t.qnum!==-2?""+t.qnum:"-";return[e,",",s," "].join("")}else return". "})},decodeBoard_old:function(){const i=[],t=this.board;this.decodeCell(function(e,s){const n=e.id;i[n]=-1,s==="#"?e.ques=1:s==="o"?t.startpos.set(e):s!=="."&&(s.charAt(0)==="i"?e.ques=21:s.charAt(0)==="w"&&(e.ques=22),s.length>1&&(i[n]=+s.substr(1)))}),t.gatemgr.rebuild();for(let e=0;e<t.cell.length;e++)i[e]!==-1&&(t.cell[e].gate.number=i[e]);for(let e=0;e<t.cell.length;e++){let s=t.cell[e].getConnectingGate(),n=1e3;for(let r=0;r<s.length;r++){const o=s[r].number;o>0&&(n=Math.min(n,o))}t.cell[e].qnum=n<1e3?n:-1}}},AnsCheck:{checklist:["checkLineOnShadeCell","checkCrossLine","checkBranchLine","checkPassGateOnce","checkStartid","checkGateNumber","checkDeadendLine+","checkOneLoop","checkPassAllGate"],checkStartid:function(){const i=this.board.startpos.getc();i.lcnt!==2&&(i.seterr(1),this.failcode.add("stLineNe2"))},checkPassGateOnce:function(){return this.checkGateLine(1,"gateRedup")},checkPassAllGate:function(){return this.checkGateLine(2,"gateUnpass")},checkGateLine:function(i,t){const e=this.board,s=e.gatemgr.components;for(let n=0;n<s.length;n++){let r=0,o=s[n].clist;for(let l=0;l<o.length;l++)o[l].lcnt>0&&r++;if(!(i===1&&r<=1||i===2&&r>0)){if(this.failcode.add(t),this.checkOnly)break;o.seterr(4),e.gatemgr.setGateError(s[n],1)}}},checkGateNumber:function(){const i=this.getTraceInfo();i!==null&&(this.failcode.add("lrOrder"),i.clist.seterr(4),this.board.gatemgr.setGateError(i,1))},getTraceInfo:function(){return this.searchTraceInfo(this.board.startpos.getc())},searchTraceInfo:function(i){if(i.lcnt===0)return null;let t=null,e=i.getdir(i.pathnodes[0].nodes[0].obj,2),s=i.getaddr(),n=0,r=-1,o=this.board.gatemgr.components.length;for(;;)if(s.movedir(e,1),s.oncell()){const l=s.getc();if(i===l)break;if(l.ques===21||l.ques===22){const a=l.gate;n++;const c=a.number;if(!(c<=0)){if(r===-1){const u=o+1-c;if(c!==u)if(n===c)r=1;else if(n===u){if(i.lcnt<2)break;e=i.getdir(i.pathnodes[0].nodes[1].obj,2),s=i.getaddr(),n=0,r=1;continue}else{t=a;break}}else if(r===1&&n!==c){t=a;break}}}const h=l.adjborder;if(l.lcnt!==2)break;e!==1&&h.bottom.isLine()?e=2:e!==2&&h.top.isLine()?e=1:e!==3&&h.right.isLine()?e=4:e!==4&&h.left.isLine()&&(e=3)}else if(!s.getb().isLine())break;return t}},FailCode:{gateRedup:["線が２回以上通過している旗門があります。","A line goes through a gate twice or more."],gateUnpass:["線が通過していない旗門があります。","There is a gate that the line is not passing."],lrOrder:["旗門を通過する順番が間違っています。","The order of passing the gate is wrong."],stLineNe2:["○から線が２本出ていません。","Start/goal circle doesn't have two lines."]}});class Kl extends Z{input(t){const e=this.clone();this.equals(t)||(this.set(t),e.draw()),this.draw()}set(t){return this.addOpe(t.bx,t.by),this.bx=t.bx,this.by=t.by,this}addOpe(t,e){!this.puzzle.ready||this.bx===t&&this.by===e||this.puzzle.opemgr.add(new tr(this.puzzle,this.bx,this.by,t,e))}}class tr extends Dt{constructor(t,e,s,n,r){super(t),this.bx1=e,this.by1=s,this.bx2=n,this.by2=r}decode(t){return t[0]!=="PS"?!1:(this.bx1=+t[1],this.by1=+t[2],this.bx2=+t[3],this.by2=+t[4],!0)}toString(){return["PS",this.bx1,this.by1,this.bx2,this.by2].join(",")}isModify(t){return this.manager.changeflag&&t.bx2===this.bx1&&t.by2===this.by1?(t.bx2=this.bx2,t.by2=this.by2,!0):!1}undo(){this.exec_sp(this.bx1,this.by1)}redo(){this.exec_sp(this.bx2,this.by2)}exec_sp(t,e){const s=this.board,n=s.getc(t,e);s.startpos.input(n)}}class Vl extends Wt{constructor(){super(...arguments),this.enabled=!0,this.relation={"cell.ques":"node"}}setComponentRefs(t,e){t.gate=e}getObjNodeList(t){return t.gatenodes}resetObjNodeList(t){t.gatenodes=[]}isnodevalid(t){return t.ques===21||t.ques===22}isedgevalidbynodeobj(t,e){const s=t.getdir(e,2);return s===b.UP||s===b.DN?t.ques===21&&e.ques===21:s===b.LT||s===b.RT?t.ques===22&&e.ques===22:!1}rebuild(){super.rebuild(),this.generateGateNumberAll()}remakeComponent(){super.remakeComponent(),this.generateGateNumberAll()}resetExtraData(t){t.gate=null}setExtraData(t){t.clist=new A(t.getnodeobjs()),t.vert=t.clist[0].ques===21,t.number=-1}generateGateNumberAll(){const t=this.board,e=this.components;for(let r=0;r<e.length;r++)e[r].number=-1;const s={nums:[],done:[],erase:function(){const r=this.done;for(let o=0;o<e.length;o++)this.nums[o]=this.nums[o].filter(function(l){return!r[l]})}};for(let r=0;r<e.length;r++)s.nums[r]=[];for(let r=0;r<e.length;r++)s.done[r]=!1;for(let r=0;r<t.cell.length;r++){const o=t.cell[r];if(o.ques===1){const l=o.qnum,h=o.qdir,a=o.adjacent;if(l<=0)continue;(h===b.NDIR||h===b.UP)&&a.top.ques===21&&s.nums[e.indexOf(a.top.gate)].push(l),(h===b.NDIR||h===b.DN)&&a.bottom.ques===21&&s.nums[e.indexOf(a.bottom.gate)].push(l),(h===b.NDIR||h===b.LT)&&a.left.ques===22&&s.nums[e.indexOf(a.left.gate)].push(l),(h===b.NDIR||h===b.RT)&&a.right.ques===22&&s.nums[e.indexOf(a.right.gate)].push(l)}}for(let r=0;r<e.length;r++){const o=s.nums[r];o.length===2&&o[0]>0&&o[0]===o[1]&&(e[r].number=o[0],s.done[o[0]]=!0,s.nums[r]=[])}s.erase();let n=!0;for(;n;){n=!1;const r=[];for(let o=0;o<e.length;o++)r[o]=0;for(let o=0;o<e.length;o++){const l=s.nums[o];l.length===1&&r[l[0]]++}for(let o=0;o<e.length;o++){const l=e[o],h=s.nums[o];let a=h.length===1?h[0]:-1;a>0&&r[a]>1&&(a=-1),a>0&&(l.number=a,s.done[a]=!0,s.nums[o]=[],n=!0)}if(s.erase(),!n){for(let o=0;o<e.length;o++)r[o]=0;for(let o=0;o<e.length;o++)s.nums[o].forEach(function(l){r[l]++});for(let o=0;o<e.length;o++){let l=e[o],h=s.nums[o],a=-1;for(let c=0;c<h.length;c++)r[h[c]]===1&&(a=a===-1?h[c]:-1);a>0&&(l.number=a,s.done[a]=!0,s.nums[o]=[],n=!0)}s.erase()}}}setGateError(t,e){const s=this.board;let n=new A,r,o;const l=t.clist.getRectSize();t.vert?(r=s.getc(l.x1,l.y1-2),o=s.getc(l.x1,l.y2+2)):(r=s.getc(l.x1-2,l.y1),o=s.getc(l.x2+2,l.y1)),!r.isnull&&r.ques===1&&n.add(r),!o.isnull&&o.ques===1&&n.add(o),n.seterr(e)}}const Xl=_({pid:"dbchoco",MouseEvent:{inputModes:{edit:["shade","number","clear"],play:["border","subline"]},mouseinput_auto:function(){if(this.puzzle.playmode)(this.mousestart||this.mousemove)&&(this.btn==="left"&&this.isBorderMode()?this.inputborder():this.inputQsubLine());else if(this.puzzle.editmode){const i=this.getcell();if(i.isnull)return;this.mousestart&&(this.btn!=="right"||i===this.cursor.getc())&&(this.inputData=-1),this.mousestart&&i!==this.cursor.getc()&&this.btn==="right"||this.mousemove&&this.inputData>=0?this.inputShade():this.mouseend&&this.notInputted()&&(i!==this.cursor.getc()&&this.inputMode==="auto"&&this.btn==="left"?this.setcursor(i):this.inputqnum(i))}},inputShade:function(){this.inputIcebarn()}},KeyEvent:{enablemake:!0,keyinput:function(i){if(i==="q"){const t=this.cursor.getc();t.setQues(t.ques!==6?6:0),this.prev=t,t.draw()}else this.key_inputqnum(i)}},Board:{cols:10,rows:10,hascross:1,hasborder:1,blockgraph:null,tilegraph:null,addExtraInfo:function(){this.tilegraph=this.addInfoList(Yl),this.blockgraph=this.addInfoList(Jl)}},Cell:{maxnum:function(){const i=this.board;return i.cols*i.rows>>1}},Graphic:{gridcolor_type:"LIGHT",bgcellcolor_func:"icebarn",icecolor:"rgb(204,204,204)",bordercolor_func:"qans",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawPekes(),this.drawQuesNumbers(),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeDBChoco()},encodePzpr:function(i){this.encodeDBChoco()},decodeDBChoco:function(){this.decodeIce(),this.decodeNumber16()},encodeDBChoco:function(){this.encodeIce(),this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCell(function(i,t){t.charAt(0)==="-"&&(i.ques=6,t=t.substr(1)),t==="0"?i.qnum=-2:t!=="."&&+t>0&&(i.qnum=+t)}),this.decodeBorderAns()},encodeData:function(){this.encodeCell(function(i){let t="";return i.ques===6&&(t+="-"),i.qnum===-2?t+="0":i.qnum!==-1&&(t+=i.qnum.toString()),t===""&&(t="."),t+" "}),this.encodeBorderAns()}},AnsCheck:{checklist:["checkSingleBlock","checkSmallNumberArea","checkLargeBlock","checkEqualShapes","checkLargeNumberArea","checkBorderDeadend"],checkSingleBlock:function(){this.checkMiniBlockCount(1,"bkSubLt2")},checkLargeBlock:function(){this.checkMiniBlockCount(3,"bkSubGt2")},checkMiniBlockCount:function(i,t){const e=this.board.blockgraph.components;for(let s=0;s<e.length;s++){const n=e[s].dotcnt;if(!(i===1&&n>1||i===3&&n<=2)){if(this.failcode.add(t),this.checkOnly)break;e[s].clist.seterr(1)}}},checkSmallNumberArea:function(){return this.checkNumberArea(-1,"bkSizeLt")},checkLargeNumberArea:function(){return this.checkNumberArea(1,"bkSizeGt")},checkNumberArea:function(i,t){const e=this.board.tilegraph.components;for(let s=0;s<e.length;s++){const n=e[s].clist,r=n.length;for(let o=0;o<n.length;o++){const l=n[o].qnum;if(!(l<=0)&&(i<0&&r<l||i>0&&r>l)){if(this.failcode.add(t),this.checkOnly)return;n.seterr(1)}}}},checkEqualShapes:function(){const i=this.board.blockgraph.components;for(let t=0;t<i.length;t++){const e=i[t];if(e.dotcnt===2&&!this.isEqualShapes(e.clist)){if(this.failcode.add("bkDifferentShape"),this.checkOnly)break;e.clist.seterr(1)}}},isEqualShapes:function(i){for(let t=0;t<i.length;t++){const e=i[t],s=[e.adjborder.right,e.adjborder.bottom];for(let n=0;n<s.length;n++){const r=s[n];if(!r||r.isnull)continue;const o=r.sidecell[0],l=r.sidecell[1];if(r.qans===0&&!o.isnull&&!l.isnull&&o.ques!==l.ques)return!this.isDifferentShapeBlock(o.tile,l.tile)}}return!1},isDifferentShapeBlock:function(i,t){if(i.clist.length!==t.clist.length)return!0;const e=Xi(this.board,i.clist),s=Xi(this.board,t.clist);return e.canon!==s.canon}},FailCode:{bkDifferentShape:["ブロック内で、白マスと灰色マスのカタマリの形が異なっています。","The two shapes inside a block are different."],bkSubLt2:["1色のマスしか入っていないブロックがあります。",""],bkSubGt2:["同じ色のマスのカタマリが3個以上入っているブロックがあります。",""]}}),Xi=function(i,t){if(t.shape)return t.shape;const e=t.getRectSize(),s=e.x2-e.x1===e.cols-1?1:2,n=e.y2-e.y1===e.rows-1?1:2,r=[[],[],[],[],[],[],[],[]],o=[];for(let a=0;a<=e.y2-e.y1;a+=n)for(let c=0;c<=e.x2-e.x1;c+=s)r[0].push(t.includes(i.getc(e.x1+c,e.y1+a))?1:0),r[1].push(t.includes(i.getc(e.x1+c,e.y2-a))?1:0);for(let a=0;a<=e.x2-e.x1;a+=s)for(let c=0;c<=e.y2-e.y1;c+=n)r[4].push(t.includes(i.getc(e.x1+a,e.y1+c))?1:0),r[5].push(t.includes(i.getc(e.x1+a,e.y2-c))?1:0);r[2]=r[1].concat().reverse(),r[3]=r[0].concat().reverse(),r[6]=r[5].concat().reverse(),r[7]=r[4].concat().reverse();for(let a=0;a<8;a++)o[a]=(a<4?e.cols:e.rows)+":"+r[a].join("");const l=o[0];o.sort();const h={canon:o[0],id:l};return t.shape=h,h};class Yl extends Wt{constructor(){super(...arguments),this.enabled=!0,this.relation={"border.qans":"separator","cell.ques":"node"}}setComponentRefs(t,e){t.tile=e}getObjNodeList(t){return t.tilenodes}resetObjNodeList(t){t.tilenodes=[]}isnodevalid(t){return!0}setExtraData(t){if(super.setExtraData(t),this.rebuildmode||t.clist.length===0)return;const e=t.clist[0].block;e&&this.board.blockgraph.setComponentInfo(e)}isedgevalidbylinkobj(t){return t.sidecell[0].isnull||t.sidecell[1].isnull?!1:t.qans===0&&t.sidecell[0].ques===t.sidecell[1].ques}}class Jl extends Mn{constructor(){super(...arguments),this.enabled=!0}getComponentRefs(t){return t.block}setComponentRefs(t,e){t.block=e}getObjNodeList(t){return t.blocknodes}resetObjNodeList(t){t.blocknodes=[]}isedgevalidbylinkobj(t){return t.qans===0}setExtraData(t){let e=0;t.clist=new A(t.getnodeobjs());const s=t.clist;t.size=s.length;const n=this.board.tilegraph.components;for(let r=0;r<n.length;r++)n[r].count=0;for(let r=0;r<s.length;r++){if(!s[r].tile){t.dotcnt=0;return}s[r].tile.count++}for(let r=0;r<n.length;r++)n[r].count>0&&e++;t.dotcnt=e}}const Zl=_({pid:"pencils",MouseEvent:{inputModes:{edit:["arrow","number","undef","clear"],play:["border","line","arrow","peke","bgcolor","bgcolor1","bgcolor2"]},mouseinput_number:function(){this.mousestart&&this.inputqnum()},mouseinput:function(){this.inputMode==="undef"?this.mousestart&&this.inputqnum():Qt.prototype.mouseinput.call(this)},mouseinput_auto:function(){this.mousestart&&this.isBorderMode(),this.puzzle.playmode?this.mousestart||this.mousemove?this.btn==="left"?this.isBorderMode()?this.inputborder():this.inputLineOrArrow():this.inputpeke():this.mouseend&&this.notInputted()&&(this.isBorderMode()?this.inputArrow():this.inputBGcolor()):this.puzzle.editmode&&this.mouseend&&(this.isBorderMode()?this.inputArrow():this.inputqnum_pencils())},inputArrow:function(){const i=this.getpos(.22).getb();if(!i.inside)return;const t=i.sidecell[0],e=i.sidecell[1],s=t.qnum!==-1&&this.puzzle.playmode,n=i.getArrow();let r=0,o=0;if(i.isvert)switch(n){case 0:if(!s){r=b.LT,o=0;break}case b.LT:r=0,o=b.RT;break;default:r=0,o=0;break}else switch(n){case 0:if(!s){r=b.UP,o=0;break}case b.UP:r=0,o=b.DN;break;default:r=0,o=0;break}t.setArrow(r,this.puzzle.editmode),e.setArrow(o,this.puzzle.editmode),t.draw(),e.draw(),i.draw()},inputLineOrArrow:function(){const i=this.getpos(0);if(this.prevPos.equals(i))return;const t=this.prevPos.getnb(i),e=t.sidecell[0],s=t.sidecell[1];t.isnull||(this.inputData===null&&(t.isvert&&(e.qans===b.LT||s.qans===b.RT)&&(e.qans===b.LT&&e.setQans(0),s.qans===b.RT&&s.setQans(0),this.inputData=0),!t.isvert&&(e.qans===b.UP||s.qans===b.DN)&&(e.qans===b.UP&&e.setQans(0),s.qans===b.DN&&s.setQans(0),this.inputData=0)),this.inputData===null&&(this.inputData=t.isLine()?0:1),this.inputData===1&&!t.ques?t.qans===1?this.getDrawArrowDirection(t)>0?s.setArrow(t.isvert?b.RT:b.DN,!1):e.setArrow(t.isvert?b.LT:b.UP,!1):t.setLine():this.inputData===0&&t.removeLine(),t.draw()),this.prevPos=i},getDrawArrowDirection:function(i){if(i.sidecell[0].isnull)return 1;if(i.sidecell[1].isnull)return-1;if(i.sidecell[0].qnum>0)return 1;if(i.sidecell[1].qnum>0)return-1;if(i.sidecell[1].lcnt>0&&i.sidecell[0].lcnt===0)return 1;if(i.sidecell[0].lcnt>0&&i.sidecell[1].lcnt===0)return-1;if(i.sidecell[0].room.pencil)return 1;if(i.sidecell[1].room.pencil)return-1;const t=this.getpos(0),e=this.prevPos.getdir(t,2);return e===b.RT||e===b.DN?1:-1},mouseinput_clear:function(){const i=this.getcell();i.getPencilDir()?i.setArrow(0,!0):this.inputclean_cell()},inputarrow_cell_main:function(i,t){i.setArrow(t,this.puzzle.editmode)},inputqnum_pencils:function(){const i=this.getcell();i.isnull||(i!==this.cursor.getc()&&this.inputMode==="auto"?this.setcursor(i):this.inputqnum(i))}},KeyEvent:{enablemake:!0,moveTarget:function(i){return i.match(/shift/)?!1:this.moveTCell(i)},keyinput:function(i){const t=this.cursor.getc();if(t.isnull)return;let e=0;switch(i){case"shift+up":e=b.UP;break;case"shift+down":e=b.DN;break;case"shift+left":e=b.LT;break;case"shift+right":e=b.RT;break}e!==0?(t.setArrow(e,!0),this.cursor.draw()):this.key_inputqnum_pencils(i)},key_inputqnum_pencils:function(i){const t=this.cursor.getc();i==="q"||i==="-"?t.qnum!==-2?(t.setArrow(0,!0),t.setQnum(-2)):(t.setArrow(0,!0),t.setQnum(-1)):i===" "||i==="BS"?(t.setArrow(0,!0),t.setQnum(-1)):(this.key_inputqnum_main(t,i),t.isNum()&&t.setArrow(0,!0)),this.prev=t,t.draw()}},Cell:{maxnum:function(){const i=this.board;return Math.max(i.cols,i.rows)-1},minnum:1,setArrow:function(i,t){if(!(i>=0&&i<=4))return;const e={};e[b.UP]={inv:b.DN,border:this.adjborder.bottom,cell:this.adjacent.bottom},e[b.DN]={inv:b.UP,border:this.adjborder.top,cell:this.adjacent.top},e[b.LT]={inv:b.RT,border:this.adjborder.right,cell:this.adjacent.right},e[b.RT]={inv:b.LT,border:this.adjborder.left,cell:this.adjacent.left};const s=this.qans,n=this.qdir;this.setQans(0),s>0&&e[s].cell.qans!==e[s].inv&&e[s].border.setQans(0),t?(n>=1&&n<=4&&e[n].cell.qdir!==e[n].inv&&e[n].border.setQues(0),n===i&&(i=0),i&&this.setQnum(-1),i>0&&!e[i].border.isnull&&e[i].border.setQues(1),this.setQdir(i)):!(n>=1&&n<=4)&&this.qnum===-1&&(s===i&&(i=0),i>0&&!e[i].border.isnull&&e[i].border.setQans(1),this.setQans(i))},getPencilDir:function(){const i=this.qdir;if(i>=1&&i<=4)return i;const t=this.qans;return t>=1&&t<=4?t:0},isStart:function(i){if(!this.room)return console.warn("room is null!"),!1;const t=this.room.clist.getRectSize();if(t.cols>1&&t.rows>1)return!1;switch(i){case b.LT:return t.rows===1&&this.bx===t.x1&&this.by===t.y1;case b.RT:return t.rows===1&&this.bx===t.x2&&this.by===t.y1;case b.UP:return t.cols===1&&this.bx===t.x1&&this.by===t.y1;case b.DN:return t.cols===1&&this.bx===t.x1&&this.by===t.y2}return!1},getPencilStart:function(){const i=this.getPencilDir();return i===b.UP?this.adjacent.bottom:i===b.DN?this.adjacent.top:i===b.LT?this.adjacent.right:i===b.RT?this.adjacent.left:this.board.emptycell},isTip:function(){return this.getPencilDir()>0},isTipOfPencil:function(){const i=this.getPencilDir();return this.getPencilStart().isStart(i)},getPencilSize:function(){var i;return this.isTipOfPencil()?((i=this.getPencilStart())==null?void 0:i.room.clist.length)??0:0},insidePencil:function(){return this.room.isPencil()}},GraphComponent:{getPotentialTips:function(){const i=this.clist.getRectSize();if(i.cols>1&&i.rows>1)return[];const t=[];if(i.rows===1){const e=this.board.getc(i.x1,i.y1);t.push({dir:b.LT,start:e,tip:e.adjacent.left});const s=this.board.getc(i.x2,i.y1);t.push({dir:b.RT,start:s,tip:s.adjacent.right})}if(i.cols===1){const e=this.board.getc(i.x1,i.y1);t.push({dir:b.UP,start:e,tip:e.adjacent.top});const s=this.board.getc(i.x1,i.y2);t.push({dir:b.DN,start:s,tip:s.adjacent.bottom})}return t},getTips:function(){const i=this.getPotentialTips(),t=[];for(let e=0;e<i.length;e++){const s=i[e];s.tip.getPencilDir()===s.dir&&t.push(s.tip)}return t},isPencil:function(){return this.getTips().length>0},seterr:function(i){this.clist.each(function(t){i>t.error&&(t.error=i)})}},Board:{hasborder:1},Border:{getArrow:function(){const i=this.sidecell[0],t=this.sidecell[1];if(this.isvert){if(i.getPencilDir()===b.LT)return b.LT;if(t.getPencilDir()===b.RT)return b.RT}else{if(i.getPencilDir()===b.UP)return b.UP;if(t.getPencilDir()===b.DN)return b.DN}return 0},prehook:{qans:function(i){return this.ques!==0?!0:i?!1:this.getArrow()!==0}}},BoardExec:{adjustBoardData:function(i,t){const e=this.getTranslateDir(i),s=this.board.cellinside(t.x1,t.y1,t.x2,t.y2);for(let n=0;n<s.length;n++){const r=s[n],o=e[r.qdir];o&&(r.qdir=o);const l=e[r.qans];l&&(r.qans=l)}}},AreaRoomGraph:{enabled:!0},LineGraph:{enabled:!0,makeClist:!0},Graphic:{gridcolor_type:"DLIGHT",linecolor:"rgb(80, 80, 80)",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawLines(),this.drawCellArrows(),this.drawQuesNumbers(),this.drawPekes(),this.drawChassis(),this.drawTarget()},getQuesNumberColor:function(i){return i.error===2?this.errcolor1:i.error===1?this.quescolor:this.getQuesNumberColor_qnum(i)},getBGCellColor:function(i){return i.error===2?this.errbcolor1:this.getBGCellColor_qsub2(i)},getBorderColor:function(i){return i.ques===1?this.quescolor:i.qans===1?i.error?"red":i.trial?this.trialcolor:this.qanscolor:null},drawCellArrows:function(){const i=this.vinc("cell_arrow","crispEdges"),t=this.cw*.5,e=this.cw*.25,s=this.range.cells;for(let n=0;n<s.length;n++){const r=s[n],o=r.getPencilDir(),l=this.getCellArrowColor(r);if(i.lineWidth=(this.lw+this.addlw)/2,l){i.fillStyle=l,i.strokeStyle=l;const h=r.bx*this.bw,a=r.by*this.bh;let c=[0,0,0,0];switch(o){case b.UP:c=[1,1,-1,1];break;case b.DN:c=[1,-1,-1,-1];break;case b.LT:c=[1,-1,1,1];break;case b.RT:c=[-1,-1,-1,1];break}i.vid="c_arrow_"+r.id,i.setOffsetLinePath(h,a,0,0,c[0]*e,c[1]*e,c[2]*e,c[3]*e,!0),i.fill(),i.vid="c_arrow_outer_"+r.id,i.setOffsetLinePath(h,a,0,0,c[0]*t,c[1]*t,c[2]*t,c[3]*t,!0),i.stroke()}else i.vid="c_arrow_"+r.id,i.vhide(),i.vid="c_arrow_outer_"+r.id,i.vhide()}},getCellArrowColor:function(i){return i.getPencilDir()?i.qdir?this.quescolor:i.trial?this.trialcolor:this.qanscolor:null}},Encode:{decodePzpr:function(i){let t=0,e=0,s=this.outbstr,n=this.board;for(e=0;e<s.length;e++){const r=s.charAt(e),o=n.cell[t];if(this.include(r,"0","9")||this.include(r,"a","f")?o.qnum=Number.parseInt(r,16):r==="-"?(o.qnum=Number.parseInt(s.substr(e+1,2),16),e+=2):r==="."?o.qnum=-2:r>="g"&&r<="j"?o.setArrow(Number.parseInt(r,20)-15,!0):r>="k"&&r<="z"&&(t+=Number.parseInt(r,36)-20),t++,!n.cell[t])break}this.outbstr=s.substr(e+1)},encodePzpr:function(i){let t="",e=0,s=this.board;for(let n=0;n<s.cell.length;n++){let r="",o=s.cell[n].qdir,l=s.cell[n].qnum;l!==-1?l>=0&&l<16?r=l.toString(16):l>=16&&l<256?r="-"+l.toString(16):r=".":o!==0?r=(o+15).toString(20):e++,e===0?t+=r:(r||e===16)&&(t+=(e+19).toString(36)+r,e=0)}e>0&&(t+=(e+19).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCell(function(i,t){t.charAt(0)==="o"?(i.qdir=5,t.length>1&&(i.qnum=+t.substr(1))):t!=="."&&i.setArrow(+t,!0)}),this.decodeBorderAns(),this.decodeBorderLine(),this.decodeCell(function(i,t){t.charAt(0)==="+"?(i.qsub=1,t=t.substr(1)):t.charAt(0)==="-"&&(i.qsub=2,t=t.substr(1)),t!=="."&&+t<=4&&(i.qans=+t)})},encodeData:function(){this.encodeCell(function(i){return i.qnum!==-1?"o"+(i.qnum!==-1?i.qnum:"")+" ":i.qdir!==0?i.qdir+" ":". "}),this.encodeBorderAns(),this.encodeBorderLine(),this.encodeCell(function(i){let t="";return i.qsub===1?t+="+":i.qsub===2&&(t+="-"),i.qans!==0&&(t+=i.qans.toString()),t===""&&(t="."),t+" "})}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkOneTip","checkLineSingleTip","checkLineTooLong","checkNumberTooHigh","checkTipNotInsidePencil","checkLineOutsidePencil","checkNumberInPencil","checkTipHasLine","checkLineHasTip","checkNumberTooLow","checkLineTooShort","checkTipHasPencil","checkCellsUsed"],checkTipHasPencil:function(){this.checkAllCell(function(i){return i.isTip()&&!i.isTipOfPencil()},"ptNoPencil")},checkTipNotInsidePencil:function(){this.checkAllCell(function(i){return i.isTip()&&i.insidePencil()},"ptInPencil")},checkOneTip:function(){const i=this.board.roommgr.components;for(let t=0;t<i.length;t++){const e=i[t].getTips();if(e.length>1){if(this.failcode.add("pcMultipleTips"),this.checkOnly)return;e.forEach(function(s){s.seterr(1)}),i[t].clist.seterr(1)}}},checkNumberTooLow:function(){this.pencils_checkPencilSize(-1,"nmSizeLt")},checkNumberTooHigh:function(){this.pencils_checkPencilSize(1,"nmSizeGt")},pencils_checkPencilSize:function(i,t){const e=this.board.roommgr.components;for(let s=0;s<e.length;s++){const n=e[s];if(!n.isPencil())continue;const r=n.clist.length;for(let o=0;o<n.clist.length;o++){const l=n.clist[o],h=l.qnum;if(h>0&&(i<0&&h<r||i>0&&h>r)){if(this.failcode.add(t),this.checkOnly)return;l.seterr(2),n.seterr(1)}}}},checkNumberInPencil:function(){this.checkAllCell(function(i){return(i.qnum===-2||i.qnum>0)&&!i.insidePencil()},"nmOutsidePencil")},checkLineOutsidePencil:function(){this.checkAllCell(function(i){return i.lcnt>0&&i.insidePencil()},"lnCrossPencil")},checkTipHasLine:function(){this.checkAllCell(function(i){return i.isTip()&&i.lcnt!==1},"ptNoLine")},pencils_checkLines:function(i,t){const e=this.board.linegraph.components;for(let s=0;s<e.length;s++){const n=e[s],r=n.clist.filter(function(o){return o.isTip()&&o.lcnt===1});if(i(r)){if(this.failcode.add(t),this.checkOnly)return;r.forEach(function(o){o.seterr(1)}),n.setedgeerr(1)}}},checkLineHasTip:function(){this.pencils_checkLines(function(i){return i.length<1},"lnNoTip")},checkLineSingleTip:function(){this.pencils_checkLines(function(i){return i.length>1},"lnMultipleTips")},checkLineTooShort:function(){this.pencils_checkLineLength(-1,"lnLengthLt")},checkLineTooLong:function(){this.pencils_checkLineLength(1,"lnLengthGt")},pencils_checkLineLength:function(i,t){var e;const s=this.board.cell;for(let n=0;n<s.length;n++){const r=s[n];if(!r.isTip()||r.lcnt!==1)continue;const o=r.path.nodes.length-1,l=r.getPencilSize();if(l>0&&(i<0&&o<l||i>0&&o>l)){if(this.failcode.add(t),this.checkOnly)return;(e=r.getPencilStart())==null||e.room.seterr(1),r.path.setedgeerr(1)}}},checkCellsUsed:function(){this.checkAllCell(function(i){return i.lcnt===0&&!i.insidePencil()},"unusedCell")}}}),th=_({pid:"cbanana",MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["shade","unshade"]},mouseinput_auto:function(){this.puzzle.editmode?this.mousestart&&this.inputqnum():this.inputcell()},autoedit_func:"qnum",autoplay_func:"cell"},KeyEvent:{enablemake:!0},Cell:{ublk:null,maxnum:function(){return this.board.cols*this.board.rows}},AreaShadeGraph:{enabled:!0},AreaUnshadeGraph:{enabled:!0},Graphic:{gridcolor_type:"DARK",enablebcolor:!0,bgcellcolor_func:"qsub1",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAns()}},AnsCheck:{checklist:["checkShadeRect","checkUnshadeNotRect","checkNumberSize"],checkNumberSize:function(){for(let i=0;i<this.board.cell.length;i++){const t=this.board.cell[i],e=t.qnum;if(e<=0)continue;const s=t.isShade()?t.sblk:t.ublk;if(s.clist.length!==e){if(this.failcode.add("bkSizeNe"),this.checkOnly)return;s.clist.seterr(1)}}},checkShadeRect:function(){this.checkAllArea(this.board.sblkmgr,function(i,t,e,s){return i*t===e},"csNotRect")},checkUnshadeNotRect:function(){this.checkAllArea(this.board.ublkmgr,function(i,t,e,s){return i*t!==e},"cuRect")}}}),eh=_({pid:"nurimisaki",MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["shade","unshade"]},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputcell():this.mouseend&&this.notInputted()&&this.inputqcmp():this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputqcmp:function(){const i=this.getcell();i.isnull||i.noNum()||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:function(){const i=this.board,t=this.bx,e=this.by,s=((t<i.maxbx>>1?i.maxbx-t:t)>>1)+1,n=((e<i.maxby>>1?i.maxby-e:e)>>1)+1;return Math.max(s,n)},minnum:2,checkComplete:function(){if(!this.isValidNum())return!0;let i=0,t=this.getdir4clist(),e=null;for(let o=0;o<t.length;o++)t[o][0].isUnshade()&&(e=t[o][0],++i);if(i!==1)return!1;let s=this.getdir(e,2),n=e.getaddr(),r=2;for(;;){n.movedir(s,2);const o=n.getc();if(o.isnull||o.isShade())break;++r}return this.getNum()===r}},AreaUnshadeGraph:{enabled:!0},Graphic:{hideHatena:!0,qanscolor:"black",numbercolor_func:"qnum",circleratio:[.45,.4],paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawDashedGrid(),this.drawCircledNumbers(),this.drawChassis(),this.drawTarget()},getCircleFillColor:function(i){return i.isNum()?i.qcmp!==0?this.qcmpcolor:this.circlebasecolor:null}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellQanssubcmp_kurotto()},encodeData:function(){this.encodeCellQnum(),this.encodeCellQanssubcmp_kurotto()},decodeCellQanssubcmp_kurotto:function(){this.decodeCell(function(i,t){t==="+"?i.qsub=1:t==="-"?i.qcmp=1:t==="#"&&(i.qans=1)})},encodeCellQanssubcmp_kurotto:function(){this.encodeCell(function(i){return i.qans===1?"# ":i.qsub===1?"+ ":i.qcmp===1?"- ":". "})}},AnsCheck:{checklist:["checkShadeCellExist","checkConnectUnshade","check2x2ShadeCell+","checkNonCapePruralUnshaded","checkCapeSingleUnshaded","checkCellNumber_kurotto","check2x2UnshadeCell++"],checkCellNumber_kurotto:function(){const i=this.board;for(let t=0;t<i.cell.length;t++){const e=i.cell[t];if(!e.checkComplete()){if(this.failcode.add("nmSumSizeNe"),this.checkOnly)break;e.seterr(1)}}},checkCapeSingleUnshaded:function(){const i=this.board;for(let t=0;t<i.cell.length;t++){const e=i.cell[t];if(!(e.noNum()||e.countDir4Cell(function(s){return s.isUnshade()})===1)){if(this.failcode.add("nmUnshadeNe1"),this.checkOnly)break;e.seterr(1)}}},checkNonCapePruralUnshaded:function(){const i=this.board;for(let t=0;t<i.cell.length;t++){const e=i.cell[t];if(!(e.isNum()||e.isShade()||e.countDir4Cell(function(s){return s.isUnshade()})!==1)){if(this.failcode.add("nmUnshadeEq1"),this.checkOnly)break;e.seterr(1)}}}},FailCode:{nmSumSizeNe:["連続する白マスの長さが数字と違います。","The number is not equal to the length of unshaded cells from the circle."],nmUnshadeNe1:["〇の上下左右2マス以上が白マスになっています。","There are two or more unshaded cells around a circle."],nmUnshadeEq1:["〇でないセルが岬になっています。","There is an cape without circle."]}}),sh=_({pid:"kurotto",MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["shade","unshade"]},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputcell():this.mouseend&&this.notInputted()&&this.inputqcmp():this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputqcmp:function(){const i=this.getcell();i.isnull||i.noNum()||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:function(){const i=this.board.cell.length-1;return i<=999?i:999},minnum:0,checkComplete:function(){if(!this.isValidNum())return!0;let i=0,t=[],e=this.getdir4clist();for(let s=0;s<e.length;s++){let n=e[s][0].sblk;if(n!==null){for(let r=0;r<t.length;r++)if(t[r]===n){n=null;break}n!==null&&(i+=n.clist.length,t.push(n))}}return this.qnum===i}},AreaShadeGraph:{enabled:!0},Graphic:{hideHatena:!0,autocmp:"number",qanscolor:"black",numbercolor_func:"qnum",circleratio:[.45,.4],setRange:function(i,t,e,s){const n=this.puzzle,r=n.board;n.execConfig("autocmp")&&(i=r.minbx-2,t=r.minby-2,e=r.maxbx+2,s=r.maxby+2),bi.prototype.setRange.call(this,i,t,e,s)},paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawCircledNumbers(),this.drawChassis(),this.drawTarget()},getCircleFillColor:function(i){return this.puzzle.execConfig("autocmp")&&i.isValidNum()?i.checkComplete()?this.qcmpcolor:this.circlebasecolor:null}},Encode:{decodePzpr:function(i){this.decodeNumber16()},encodePzpr:function(i){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellQanssubcmp_kurotto()},encodeData:function(){this.encodeCellQnum(),this.encodeCellQanssubcmp_kurotto()},decodeCellQanssubcmp_kurotto:function(){this.decodeCell(function(i,t){t==="+"?i.qsub=1:t==="-"?i.qcmp=1:t==="#"&&(i.qans=1)})},encodeCellQanssubcmp_kurotto:function(){this.encodeCell(function(i){return i.qans===1?"# ":i.qsub===1?"+ ":i.qcmp===1?"- ":". "})}},AnsCheck:{checklist:["checkShadeCellExist","checkCellNumber_kurotto"],checkCellNumber_kurotto:function(){const i=this.board;for(let t=0;t<i.cell.length;t++){const e=i.cell[t];if(!e.checkComplete()){if(this.failcode.add("nmSumSizeNe"),this.checkOnly)break;e.seterr(1)}}}},FailCode:{nmSumSizeNe:["隣り合う黒マスの個数の合計が数字と違います。","The number is not equal to sum of adjacent masses of shaded cells."]}}),ih={auto:"自動",number:"数字","number-":"数字(逆順)",clear:"クリア",cell51:"＼","circle-unshade":"白まる","circle-shade":"黒まる",undef:"記号消去",ice:"氷",numexist:"数字",numblank:"数字消去",bgcolor:"背景色",subcircle:"マル(補助)",bgcolor1:"背景色1",subcross:"バツ(補助)",bgcolor2:"背景色2",completion:"確定数字",objblank:"空白",direc:"方向",arrow:"矢印",crossdot:"？？",border:"罫線",subline:"補助線",shade:"黒マス",unshade:"白マス",line:"線",peke:"バツ",bar:"棒","info-line":"線チェック","info-blk":"白マスチェック",akari:"照明"};var nh=ms("<div> </div>"),rh=ms('<div class="error"> </div>'),oh=ms('<div class="dialog svelte-1ehjjzy"><div class="message svelte-1ehjjzy"> </div></div>'),lh=ms('<div class="container svelte-1ehjjzy"><h1 class="svelte-1ehjjzy"> </h1> <div class="mode svelte-1ehjjzy"><div class="svelte-1ehjjzy">入力モード｜</div> <!></div> <div id="puzzle" class="svelte-1ehjjzy"></div> <div class="tool svelte-1ehjjzy"><button class="check-button svelte-1ehjjzy">チェック</button> <button class="svelte-1ehjjzy">戻</button> <button class="svelte-1ehjjzy">進</button> <button class="svelte-1ehjjzy">回</button></div> <!> <!></div>');const hh={hash:"svelte-1ehjjzy",code:`h1.svelte-1ehjjzy{font-size:150%;text-align:center;margin:.5em 0;font-weight:normal;}.container.svelte-1ehjjzy {max-width:100%;margin:0 auto;position:relative;}#puzzle.svelte-1ehjjzy {margin:0 auto;max-width:100%;\r
    /*border: 1px solid black;*/padding:4px;}#puzzle > div:focus {outline:none; /* デフォルトの枠を消す */box-shadow:0 0 10px 5px rgba(0, 123, 255, 0.6); /* 青くぼやっと光る */}svg {display:block;}.mode.svelte-1ehjjzy {display:flex;justify-content:center;flex-wrap:wrap;gap:2px;}.mode.svelte-1ehjjzy > div:where(.svelte-1ehjjzy){user-select:none;padding:2px;}.mode-item.svelte-1ehjjzy {cursor:pointer;}.active.svelte-1ehjjzy {background-color:#efefef;color:maroon;font-weight:bold;}button.svelte-1ehjjzy {border:1px solid #ccc;border-radius:0.5em;padding:.25em .5em;transition:all 0.2s;cursor:pointer;background:linear-gradient(to bottom, white, silver);}button.check-button.svelte-1ehjjzy{background:linear-gradient(to bottom, #83bdff, rgb(53, 56, 209)) ;color:white;}button.svelte-1ehjjzy:hover{filter:brightness(1.1); /* 1.1 = 少し明るく */}.tool.svelte-1ehjjzy {padding:0.5em 0;display:flex;gap:0.5em;justify-content:center;}.dialog.svelte-1ehjjzy{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.35);padding:.25em;display:flex;align-items:flex-start;justify-content:center;}.dialog.svelte-1ehjjzy .message:where(.svelte-1ehjjzy){background-color:white;border-radius:3px;padding:.5em;}`};function er(i,t){on(t,!1),co(i,hh);let e=Ai(t,"src",12),s=Ai(t,"puzzle",12),n=X(null),r=X([]),o=X("auto"),l=X(""),h=X(null),a=X(!1),c=X(!1),u=X(!1);xo(()=>{try{if(!e())throw new Error("URLが指定されていません。");s().on("history",()=>{B(c,s().opemgr.enableUndo),B(u,s().opemgr.enableRedo)}),s().readURL(e()),s().mount(x(n)),s().setMode("play"),s().mouse.setInputMode("auto"),s().setCanvasSizeByCellSize(36),x(n)&&Dr(n,x(n).style.maxWidth=`${s().painter.canvasWidth}px`),B(r,["auto",...s().mouse.inputModes.play]),s().redraw(!0)}catch(S){console.error(S),B(h,S.toString())}});const d=S=>{x(o)!==S&&(B(o,S),s()&&s().mouse.setInputMode(S))},f=()=>{const S=s().check(!0);B(l,S.text),S.complete,B(a,!0)},p=()=>s().undo(),k=()=>s().redo(),g=()=>{B(a,!1)},m=()=>s().board.operate("turnr");po();var y=lh(),w=Nt(y),N=Nt(w,!0);zt(w);var v=at(w,2),O=at(Nt(v),2);lo(O,1,()=>x(r),ro,(S,G)=>{var et=nh();let Te;var ir=Nt(et,!0);zt(et),Be(nr=>{Te=bo(et,1,"mode-item svelte-1ehjjzy",null,Te,nr),De(ir,ih[x(G)]??x(G))},[()=>({active:x(o)===x(G)})],Js),Jt("click",et,()=>d(x(G))),fe(S,et)}),zt(v);var R=at(v,2);fo(R,S=>B(n,S),()=>x(n));var K=at(R,2),ht=Nt(K),tt=at(ht,2),Ct=at(tt,2),Kt=at(Ct,2);zt(K);var Ot=at(K,2);{var Vt=S=>{var G=rh(),et=Nt(G,!0);zt(G),Be(()=>De(et,x(h))),fe(S,G)};Ci(Ot,S=>{x(h)!=null&&S(Vt)})}var Xt=at(Ot,2);{var Yt=S=>{var G=oh(),et=Nt(G),Te=Nt(et,!0);zt(et),zt(G),Be(()=>De(Te,x(l))),Jt("click",G,g),fe(S,G)};Ci(Xt,S=>{x(a)&&S(Yt)})}return zt(y),Be(()=>{De(N,s().pid),tt.disabled=!x(c),Ct.disabled=!x(u)}),Jt("click",ht,f),Jt("click",tt,p),Jt("click",Ct,k),Jt("click",Kt,m),fe(i,y),ln({get src(){return e()},set src(S){e(S),Os()},get puzzle(){return s()},set puzzle(S){s(S),Os()}})}vo(er,{src:{},puzzle:{}},[],[],!0);const z=i=>class extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("div");t.appendChild(e),oi(er,{target:e,props:{puzzle:new i({type:"player"}),src:this.getAttribute("src")??""}})}},ah=z(xl),ch=z(ql),uh=z(wl),dh=z(Cl),bh=z(_l),fh=z(Al),ph=z(zl),mh=z(Bl),gh=z(Ll),yh=z(Nl),kh=z(Yn),vh=z(Ol),xh=z(El),wh=z(Rl),Ch=z(Il),qh=z($l),zh=z(Ql),Nh=z(Ml),Sh=z(Ul),_h=z(Wl),Ah=z(Xl),Lh=z(Zl),jh=z(th),Th=z(Tl),Bh=z(eh),Dh=z(sh);customElements.define("slitherlink-player",ah);customElements.define("mashu-player",ch);customElements.define("sudoku-player",uh);customElements.define("kakkuro-player",dh);customElements.define("numberlink-player",bh);customElements.define("nurikabe-player",fh);customElements.define("fillomino-player",yh);customElements.define("hitokure-player",ph);customElements.define("shakashaka-player",mh);customElements.define("shikaku-player",gh);customElements.define("heyawake-player",kh);customElements.define("yajilin-player",vh);customElements.define("ripple-player",xh);customElements.define("tentaisho-player",wh);customElements.define("norinori-player",Ch);customElements.define("lits-player",qh);customElements.define("akari-player",zh);customElements.define("tilepaint-player",Nh);customElements.define("nurimaze-player",Sh);customElements.define("slalom-player",_h);customElements.define("dbchoco-player",Ah);customElements.define("pencils-player",Lh);customElements.define("cbanana-player",jh);customElements.define("ayaheya-player",Th);customElements.define("nurimisaki-player",Bh);customElements.define("kurotto-player",Dh);var Yi;(Yi=document.getElementById("filter-text"))==null||Yi.addEventListener("input",i=>{const t=i.target.value.toUpperCase().trim();for(const e of document.querySelectorAll(".container > *")){const s=e;s.style.display=s.tagName.includes(t)||t===""?"":"none"}})});export default Oh();
